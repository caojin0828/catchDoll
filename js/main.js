(function(w){

	var W = w.innerWidth > 640 ? 640 : w.innerWidth,
		H = w.innerHeight;
	var type = 0,//状态type 0：未投币，1：玩家操作中，2：程序自动运行，3：未抓中，4：抓错，5成功
		level = 1;//当前关卡
		var cuH = 1030;
	var maxTime = 123 / (cuH/w.document.body.clientHeight);
	//console.log(w.document.body.clientHeight ,w.screen.height);
	function Main(imgData){
		
		
	};
	/*初始化方法*/
	Main.prototype.init = function(){
		var s = this;
		
		//是否正在移动
		s.move = false;
		//是否绑定过事件
		s.bind = false;
		//是否可刷新
		s.isRefresh = false;
		//当前目标礼物
		s.taskGift = [];
		//所有礼物
		s.gift = [];
		//当前关卡
		s.level = 1;
		//图片数据
		s.imgData = imgData;
		//对错ico
		s.icos = [];
		
		W = w.innerWidth > 640 ? 640 : w.innerWidth,
		H = w.innerHeight;
		type = 0,//状态type 0：未投币，1：玩家操作中，2：程序自动运行，3：未抓中，4：抓错，5成功
		level = 1;//当前关卡
		
	    maxTime = 123 / (cuH/w.document.body.clientHeight);
		
		var s = this;
		
		//初始化
		LInit(20,"mylegend",W,H,function(){
			LStage.box2d = new LBox2d(undefined,false);
			if(LStage.canTouch == true){
				document.body.style.margin = "0px 0px";
				LStage.stageScale = LStageScaleMode.SHOW_ALL;
				LSystem.screen(LStage.FULL_SCREEN);
			};
			base(s,LSprite,[]);
		    LLoadManage.load(
		    	s.imgData,
		    	function(progress){
		    		s.showLoad(progress);
		        },
		    	function(result){
		        	s.imglist = result; 
		        	/**背景初始化*/
			    	s.setBg();
			        /**加入围墙*/
					s.addWall();
					/**加入礼物*/
					s.addGift(); 
					/**加入起重机*/
					s.addClaw();
					/**上下菜单*/
					s.topBar();
					s.botBar();
					/**事件绑定*/
					s.bindEvent();
		    	}
		    );
		    /**添加左右移动力度向量*/  
		    s.moveVec = new LStage.box2d.b2Vec2();  
		    /**添加拉压操作力度向量*/  
		    s.tcVec = new LStage.box2d.b2Vec2();  
			addChild(s);
		});
	};
	//数据响应方法
	Main.prototype.response = function(f){
		var s = this;
		typeof f == 'function' ? s.callBack = f : alert('请定义response回调方法');
	};
	//loading方法
	Main.prototype.loading = function(f){
		var s = this;
		typeof f == 'function' ? s.showLoad = f : alert('请定义loading回调方法');
	};
	//点击抓，游戏开始
	Main.prototype.gameStart = function(f){
		var s = this;
		typeof f == 'function' ? s.getData = f : alert('请定义gameStart回调方法');
	};
	//游戏重置
	Main.prototype.gameReset = function(s){
		var s = this;
		s.pointA.SetPosition(new LStage.box2d.b2Vec2(W/2/30,s.pointA.GetPosition().y));
		if(s.isRefresh){
			//刷新任务
			s.randomGift(s.topBox);
			s.gift.map(function(item){
				s.removeChild(item);
			});
			s.gift = [];
			s.addGift();
			s.addChild(s.topBar2);
			s.addChild(s.botBar2);
			s.botBar2(s.rocker);
			s.clearIco();
			s.isRefresh = false;
			level = 1;
		}else if(typeof s.getNum == 'number'){
			s.removeChild(s.gift[s.getNum]);
			s.gift.splice(s.getNum,1);
//			s.callBack({'msg':'当前不可刷新'});
		};
	};
	/*场景初始化*/
	Main.prototype.setBg = function(){
		var s = this;
    	var bg = new LSprite();
		//设置背景
		var bg_pic = new LBitmap(new LBitmapData(s.imglist['bg']));  
		bg_pic.scaleX = W/bg_pic.getWidth();
		bg_pic.scaleY = H/bg_pic.getHeight();
		bg.addChild(bg_pic);
		//加入舞台
		s.addChild(bg);
	};
	//顶部bar
	Main.prototype.topBar = function(){
		var s = this;
		var topBar2 = new LSprite();
		//顶部bg
		var top_bar_pic = new LBitmap(new LBitmapData(s.imglist['top_bar']));
		var botBarScale = top_bar_pic.getWidth()/W;
		top_bar_pic.scaleX = botBarScale;
		top_bar_pic.x = 0;
		top_bar_pic.y = 0;
		topBar2.addChild(top_bar_pic);
		//top-box
		var topBox = new LSprite(); 
		var topBox_bg = new LBitmap(new LBitmapData(s.imglist['top_box']));
		topBox_bg.scaleX = 320/W;
		topBox_bg.scaleY = 320/W;
		topBox.addChild(topBox_bg);
		
		topBox.x = W / 2 -  topBox_bg.getWidth() / 2;
		topBox.y = 5;
		
		//生成随机目标礼物
		s.randomGift(topBox);
		topBar2.addChild(topBox);
		
		//加入舞台
		s.addChild(topBar2);
		s.topBox = topBox;
		s.topBar2 = topBar2;
	};
	//随机生成目标礼物
	Main.prototype.randomGift = function(p){
		var s = this;
		var maxNum = 12;
		var randoms = [];
		for(var i=0;i<maxNum;i++){
			randoms.push(i + 1);
		};
		//清除当前任务
		s.taskGift.map(function(item){
			s.removeChild(item);
		});
		s.taskGift = [];
		for(var i = 0;i<2;i++){
			var len = randoms.length;
			var random = Math.floor(Math.random()*len);
			var num = randoms[random];
			randoms.splice(random,1);
			var gift = new LSprite();
			var gift_bg = new LBitmap(new LBitmapData(s.imglist['w' + num]));
			var scaleNum = 60 / gift_bg.getWidth();
			gift_bg.scaleX = scaleNum;
			gift_bg.scaleY = scaleNum;
			gift_bg.name = 'ball' + num;
			gift.addChild(gift_bg);
			var gift_mask = new LSprite();
   			gift_mask.graphics.drawArc(1,"#000000",[gift_bg.getWidth()/2, gift_bg.getWidth()/2, gift_bg.getWidth()/2, 0, 2*Math.PI], true);
			gift_mask.alpha = 0.5;
			gift.addChild(gift_mask);
			gift.x = 70 + i * (gift_bg.getWidth() + 15);
			gift.y = 68;
			p.addChild(gift);
			s.taskGift.push(gift);
		};
	};
	//底部bar
	Main.prototype.botBar = function(){
		var s = this;
    	var botBar2 = new LSprite();
		//底部bar
		var bot_bar_pic = new LBitmap(new LBitmapData(s.imglist['bot_bar']));
		var botBarScale = bot_bar_pic.getWidth()/W;
		bot_bar_pic.scaleX = botBarScale;
		bot_bar_pic.x = -72;
		bot_bar_pic.y = H - bot_bar_pic.getHeight() + 20;
		botBar2.addChild(bot_bar_pic);
		//投币
		var pay_coins = new LSprite();
		var pay_coins_bg = new LBitmap(new LBitmapData(s.imglist['pay_coins']));  
		pay_coins.addChild(pay_coins_bg);
		pay_coins.x = 30;
		pay_coins.y = H - 70 - pay_coins.getHeight();
		botBar2.addChild(pay_coins);
		//遥感底座上
		var rocker3 = new LBitmap(new LBitmapData(s.imglist['rocker_3']));  
		rocker3.x = 218;
		rocker3.y = H - 110 - rocker3.getHeight()/2;
		botBar2.addChild(rocker3);
		//摇杆
		var rocker = new LSprite();
		var rocker1 = new LBitmap(new LBitmapData(s.imglist['rocker_1']));  
		rocker1.y =  - rocker1.getHeight() + 20;
		rocker.addChild(rocker1);
		rocker.x = 258;
		rocker.y = H - 94;
		rocker.addBodyPolygon(rocker1.getWidth(),10,0);
		botBar2.addChild(rocker);
		//遥感底座下
		var rocker4 = new LBitmap(new LBitmapData(s.imglist['rocker_4']));  
		rocker4.x = 218;
		rocker4.y = H - 110 + rocker4.getHeight()/2 - 2;
		botBar2.addChild(rocker4);
		//抓取按钮
		var grabBtn = new LSprite();
		var btn1 = new LBitmap(new LBitmapData(s.imglist['btn1']));  
		btn1.x = 370;
		btn1.y = H - btn1.getHeight() - 63;
		grabBtn.addChild(btn1);
		botBar2.addChild(grabBtn);
		//刷洗按钮
		var refreshBtn = new LSprite();
		var btn2 = new LBitmap(new LBitmapData(s.imglist['btn2']));  
		btn2.x = 370 + btn1.getWidth() + 15;
		btn2.y = H - btn2.getHeight() - 63;
		refreshBtn.addChild(btn2);
		botBar2.addChild(refreshBtn);
		
		s.pay_coins = pay_coins;
		s.rocker = rocker;
		s.grabBtn = grabBtn;
		s.refreshBtn = refreshBtn;
		s.botBar2 = botBar2;
		
		//加入舞台
		s.addChild(botBar2);
		s.changeBtn();
	};
	//四周墙
	Main.prototype.addWall = function(){
		var s = this;
		
		//设置围墙大小
		var wallSize = 1;
		//设置围墙数据
		var wallList = [
			//左边
			[wallSize*0.5, LStage.height*0.5, wallSize, LStage.height*2],
			//右边
			[LStage.width-wallSize*0.5, LStage.height*0.5, wallSize, LStage.height*2],
			//上面
				[LStage.width*0.5, wallSize*0.5, LStage.width, wallSize],				
			//下面
			[LStage.width*0.5, LStage.height-wallSize*0.5 - 140, LStage.width, wallSize],
		];
		//通过遍历围墙数据，添加四面围墙
		for(var key in wallList){
			//获取数据
			var item = wallList[key];
			//创建围墙对象
			var wallLayer = new LSprite();
			//设定对象位置
			wallLayer.x = item[0];
			wallLayer.y = item[1];
			wallLayer.graphics.lineStyle(5, "#F00"); 
			//加入刚体
			wallLayer.addBodyPolygon(item[2],item[3],0);
			//加入显示列表
			s.addChild(wallLayer);
		};
	};
	//起重机
	Main.prototype.addClaw = function(){
		var s = this;
		
		/**用于固定起重机的定点A*/
		var pointA = new LSprite();
		var drawPole = new LBitmap(new LBitmapData(s.imglist['draw_pole']));  //导入起重机杆图片
		var aW = drawPole.getWidth();
		var aH = drawPole.getHeight();
		var moveY = 800;
		pointA.x = W / 2;
		pointA.y = aH/2 - moveY;
		pointA.addBodyPolygon(aW,aH,0);
        pointA.addChild(drawPole);
		s.addChild(pointA);//加入显示列表
		
		//爪子轴承
		var bearing = new LSprite();
		var bearing_pic = new LBitmap(new LBitmapData(s.imglist['bearing']));  
		bearing_pic.y = 38;
		bearing.name = 'bearing';
        bearing.addChild(bearing_pic);
		bearing.x = pointA.x - bearing_pic.getWidth()*0.5;//设定对象位置
		bearing.y = aH - moveY - bearing_pic.getHeight()*0.5 + 4;
        bearing.addBodyCircle(bearing_pic.getWidth()*0.5,bearing_pic.getWidth()*0.5,bearing_pic.getWidth()*0.5-24,1,.5,.8,.8);  //加入刚体]
        
        //左爪子
		var leftD = new LSprite();
		var leftD_pic = new LBitmap(new LBitmapData(s.imglist['left_draw']));
		leftD_pic.rotate = -38;
		leftD_pic.x = -50;
		leftD_pic.y = -30;
		leftD.addChild(leftD_pic);
		leftD.x = bearing.x+bearing_pic.getWidth()/2-70;
		leftD.y = bearing.y+160 - 30;
		leftD.name = 'left';
		s.addChild(leftD);//加入显示列表
		leftD.addBodyPolygon(40,135,1,0.5,1,0.8);
		var leftD_1 = new LSprite();
		leftD_1.x = bearing.x+bearing_pic.getWidth()/2-40;
		leftD_1.y = bearing.y+135 +50;
		s.addChild(leftD_1);//加入显示列表
		leftD_1.addBodyPolygon(40,60,1,0.5,1,0.8);
		leftD_1.setRotate(90*Math.PI/180);
		
        //右爪子
		var rightD = new LSprite();
		var rightD_pic = new LBitmap(new LBitmapData(s.imglist['right_draw']));
		rightD_pic.rotate = 38;
		rightD_pic.x = -110;
		rightD_pic.y = -30;
		rightD.addChild(rightD_pic);
		rightD.x = bearing.x+bearing_pic.getWidth()/2+70;
		rightD.y = bearing.y+160 - 30;
		rightD.name = 'right';
		s.addChild(rightD);//加入显示列表
		rightD.addBodyPolygon(40,135,1,0.5,1,0.8);//
		var rightD_1 = new LSprite();
		rightD_1.x = bearing.x+bearing_pic.getWidth()/2+40;
		rightD_1.y = bearing.y+135 +50;
		s.addChild(rightD_1);//加入显示列表
		rightD_1.addBodyPolygon(40,60,1,0.5,1,0.8);
		rightD_1.setRotate(-1*90*Math.PI/180);
		
		s.addChild(bearing);//加入显示列表
		
        /**添加关节*/  
        //杆与爪子轴承旋转关节
        LStage.box2d.setRevoluteJoint(pointA.box2dBody,bearing.box2dBody,[-30,30],[10,1]);
        //左爪子与轴承旋转关节
        s.left = LStage.box2d.setRevoluteJoint(bearing.box2dBody,leftD.box2dBody,[29,30],[10,1]);
        //左爪子与左爪子钩子敢接关节
        LStage.box2d.setWeldJoint(leftD.box2dBody,leftD_1.box2dBody);
        //右爪子与轴承旋转关节
        s.right = LStage.box2d.setRevoluteJoint(bearing.box2dBody,rightD.box2dBody,[-29,-30],[10,1]);
        //右爪子与右爪子钩子敢接关节
        LStage.box2d.setWeldJoint(rightD.box2dBody,rightD_1.box2dBody);
		
		s.bearing = bearing;
		s.leftD = leftD;
		s.rightD = rightD;
		s.pointA = pointA.box2dBody;
	};
	//礼物
	Main.prototype.addGift = function(){
		var s = this;
		for(var i=1;i<14;i++){
			var img = new LSprite();  
	        var bitmap = new LBitmap(new LBitmapData(s.imglist["w"+i]));  
	        img.x = Math.random()*(W - bitmap.getWidth());  
	        img.y = H / 2 + Math.random()*bitmap.getHeight();
	        s.addChild(img);  
	        bitmap.scaleX = 0.8;
	        bitmap.scaleY = 0.8;
	        img.name = 'ball' + i;
	        img.addChild(bitmap);  
	        img.addBodyCircle(bitmap.getWidth()*0.5,bitmap.getHeight()*0.5,bitmap.getWidth()*0.5,1,.3,.4,.5);  
	        s.gift.push(img);
		};
	};
	
	//事件绑定
	Main.prototype.bindEvent = function(){
		var s = this;
		//投币
		s.pay_coins.addEventListener(LMouseEvent.MOUSE_DOWN,s.payCoins.bind(s));
		//抓取
		s.grabBtn.addEventListener(LMouseEvent.MOUSE_DOWN,function(){
			if(type == 1)
				s.grabBtn.childList[0].bitmapData = new LBitmapData(s.imglist['btn1_press']);
		});
		s.grabBtn.addEventListener(LMouseEvent.MOUSE_UP,s.startGrap.bind(s));
		//刷新
		s.refreshBtn.addEventListener(LMouseEvent.MOUSE_DOWN,function(){
			if(type == 1)
				s.refreshBtn.childList[0].bitmapData = new LBitmapData(s.imglist['btn2_press']);
		});
		s.refreshBtn.addEventListener(LMouseEvent.MOUSE_UP,function(){
			var s = this;
			s.changeBtn();
			if(type == 0){
				s.callBack({'status':1,'type':0,'msg':'未投币','level':level,'success':'0'});
				return;
			}else if(type == 1){
				s.fresh();
			};
		}.bind(s));
		//遥感
		s.rocker.addEventListener(LMouseEvent.MOUSE_DOWN,s.rockerPlay.bind(s));
	};
	//设置btn禁用
	Main.prototype.changeBtn = function(){
		var s = this;
		if(type == 1){
			s.rocker.childList[0].bitmapData = new LBitmapData(s.imglist['rocker_1']);
			s.grabBtn.childList[0].bitmapData = new LBitmapData(s.imglist['btn1']);
			s.refreshBtn.childList[0].bitmapData = new LBitmapData(s.imglist['btn2']);
		}else{
			s.rocker.childList[0].bitmapData = new LBitmapData(s.imglist['rocker_1_dis']);
			s.grabBtn.childList[0].bitmapData = new LBitmapData(s.imglist['btn1_dis']);
			s.refreshBtn.childList[0].bitmapData = new LBitmapData(s.imglist['btn2_dis']);
		};
	};
	//投币
	Main.prototype.pay = function(f){
		var s = this;
		typeof f == 'function' ? s.paySuccess = f : alert('请定义pay回调方法');
	};
	Main.prototype.payCoins = function(){
		var s = this;
		if(type == 2){
			return;
		};
		if(type == 0){
			var success = s.paySuccess();
			if(success){//投币成功
				s.callBack({'status':1,'type':1,'msg':'支付成功','level':level,'success':'0'});
				type = 1;
				s.gameReset();
				s.changeBtn();
			}else{//投币失败
				s.callBack({'status':0,'type':0,'msg':'付款失败','level':level,'success':'0'});
			}
		}else{
			s.callBack({'status':1,'type':1,'msg':'请勿重复投币','level':level,'success':'0'});
		};
	};
	//刷新礼物
	Main.prototype.setFresh = function(a){
		var s = this;
		s.isRefresh = a;
		if(!s.isRefresh){
			return;
		};
		s.gameReset();
	};
	
	Main.prototype.refresh = function(f){
		var s = this;
		typeof f == 'function' ? s.fresh = f : alert('请定义loading回调方法');
	};
	
	//点击抓取按钮
	Main.prototype.startGrap = function(){
		var s = this;
		if(type == 0){
			s.callBack({'status':1,'type':0,'msg':'未投币','level':level,'success':'0'});
			return;
		};
		s.getData();
		
	};
	//起重机落下
	Main.prototype.downWard = function(isGet){
		var s = this;
		if(isGet == undefined){
			s.callBack({'status':0,'type':1,'msg':'请求错误，请刷新页面！','success':'0'});
			return;
		};
		s.isRefresh = false;
		
		var num = 0;
		if(type == 1){
			s.initY = s.pointA.GetPosition().y;
			type = 2;
			s.changeBtn();
			var time1 = setInterval(function(){
				num += 1;
				var _num = num;
				if(_num > 25){
					_num = 25;
				};
				s.left.m_lowerAngle = (29+_num)*Math.PI/180;
				s.left.m_upperAngle = (30+_num)*Math.PI/180;
				s.right.m_lowerAngle = -1 * (29+_num)*Math.PI/180;
				s.right.m_upperAngle = -1 * (30+_num)*Math.PI/180;
				s.pointA.SetPosition(new LStage.box2d.b2Vec2(s.pointA.GetPosition().x,s.pointA.GetPosition().y+num/500));
				if(num >= maxTime){
					clearInterval(time1);
					setTimeout(function(){
						s.grab(isGet);
					},1000);
				};
			},23);
		};
	};
	//起重机抓起
	Main.prototype.grab = function(isGet){
		var s = this;
		var num = 0;
		var time1 = setInterval(function(){
			num += 1;
			var _num = num;
			if(_num <= 25){
				s.left.m_lowerAngle = (54 - _num)*Math.PI/180;
				s.left.m_upperAngle = (55 - _num)*Math.PI/180;
				s.right.m_lowerAngle = -1 * (54 - _num)*Math.PI/180;
				s.right.m_upperAngle = -1 * (55 - _num)*Math.PI/180;
			}else if(_num > 50 && isGet == 0 && _num <= 70){
				s.left.m_lowerAngle = (_num/2 + 4.5)*Math.PI/180;
				s.left.m_upperAngle = (_num/2 + 5)*Math.PI/180;
				s.right.m_lowerAngle = -1 * (_num/2 + 4.5)*Math.PI/180;
				s.right.m_upperAngle = -1 * (_num/2 + 5)*Math.PI/180;
				s.pointA.SetPosition(new LStage.box2d.b2Vec2(s.pointA.GetPosition().x,s.pointA.GetPosition().y-num/500));
			}else if(_num > 75 && isGet == 0 && _num <= 95){
				s.left.m_lowerAngle = (77 - _num/2)*Math.PI/180;
				s.left.m_upperAngle = (77.5 - _num/2)*Math.PI/180;
				s.right.m_lowerAngle = -1 * (77 -_num/2)*Math.PI/180;
				s.right.m_upperAngle = -1 * (77.5 -_num/2)*Math.PI/180;
				s.pointA.SetPosition(new LStage.box2d.b2Vec2(s.pointA.GetPosition().x,s.pointA.GetPosition().y-num/500));
			}else{
				s.pointA.SetPosition(new LStage.box2d.b2Vec2(s.pointA.GetPosition().x,s.pointA.GetPosition().y-num/500));
				if(num >= (maxTime + 2)){
					s.pointA.SetPosition(new LStage.box2d.b2Vec2(s.pointA.GetPosition().x,s.initY));
					clearInterval(time1);
					s.judge(isGet);
					return;
				};
			};
//			console.log(s.initY);
		},23);
	};
	//遥感控制
	Main.prototype.rockerPlay = function(e){
		var s = this;
		if(type == 0){
			s.callBack({'status':1,'type':0,'msg':'未投币','level':level,'success':'0'});
			return;
		};
		var startX = e.offsetX;
		var rocker = s.rocker;
		if(!s.bind){
			s.bind = true;
			LGlobal.stage.addEventListener(LMouseEvent.MOUSE_MOVE,function(e){
				if(type != 1)
					return;
				var nowX = e.offsetX;
				var _x = (nowX - startX)/3;
				if(_x > 15){
					_x = 15;
				}else if(_x < -15){
					_x = -15;
				};
				var angle = _x * Math.PI/180;
				rocker.setRotate(_x * Math.PI/180);
				if(type == 1){
					s.poleMove(angle >= 0);
				};
			});
			LGlobal.stage.addEventListener(LMouseEvent.MOUSE_UP,function(e){
				clearInterval(s.timer);
				rocker.setRotate(0);
				s.move = false;
			});
		};
	};
	//起重机水平移动
	Main.prototype.poleMove = function(b){
		var s = this;
		b ? s._x = 1/10 : s._x = -1/10;
		if(!s.move){
			s.turn = b;
			s.move = true;
			var timer = s.timer = setInterval(function(){
				var pointX = s.pointA.GetPosition().x+s._x;
				if(pointX < 3.2){
					pointX = 3.2;
				}else if(pointX > 18.5){
					pointX = 18.5;
				};
				s.pointA.SetPosition(new LStage.box2d.b2Vec2(pointX,s.pointA.GetPosition().y));
			},20);
		};
	};
	//是否为目标礼物
	Main.prototype.judge = function(isGet,f){//s：调用此方法时的对象，isGet：后台返回参数, 是否命中
		var s = this;
		var num;
		var taskNames = [s.taskGift[0].childList[0].name,s.taskGift[1].childList[0].name];
		setTimeout(function(){
			//遍历所有礼物，回去所抓中的礼物，礼物x坐标位于两个爪子之间并且y坐标位于爪子抽成下方一个礼物高度
			s.gift.map(function(item,index){
				var y = item.y;
				if(y > s.bearing.y && y < s.bearing.y + item.childList[0].getHeight() + 200 && (s.leftD.x - 20) <= item.x && (s.rightD.x + 20) >= item.x){
					num = index;//所抓住礼物的下标
				};
			});
			if(num == undefined || isGet == 0){
				s.callBack({'status':1,'type':3,'msg':'未抓中','level':level,'success':'0'});
				type = 0;
				s.getNum = undefined;
			}else if(taskNames.indexOf(s.gift[num].name) != -1 && isGet == 1){
				if(level == 2){
					s.callBack({'status':1,'type':5,'msg':'抓取成功','level':level,'success':'1'});
				}else{
					s.callBack({'status':1,'type':5,'msg':'抓取成功','level':level,'success':'0'});
				};
				s.getNum = num;
				s.addIco(s.taskGift[taskNames.indexOf(s.gift[num].name)],1);//添加ico
				level = 2;
				type = 0;
			}else{
				s.callBack({'status':1,'type':4,'msg':'抓取错误','level':level,'success':'0'});
				type = 0;
				s.getNum = num;
			};
			num ? s.gift[num].alpha = 0 : null;
			typeof f == 'function' ? f() : null;
		},500);
	};
	
	//添加对错ico  parents:当前父元素 ， num：1为对，2为错
	Main.prototype.addIco = function(p,num){
		var s = this;
		var parents = p ? p : s.taskGift[0];
		var index = num ? num : 1;
		var ico = new LBitmap(new LBitmapData(s.imglist['ico' + index]));
		ico.x = parents.childList[0].x + parents.childList[0].getWidth() - 20;
		ico.y = parents.childList[0].y + parents.childList[0].getHeight() - 30;
		parents.removeChild(parents.childList[1]);
		
		parents.addChild(ico);
		s.icos.push(ico);
	};
	//清除ico
	Main.prototype.clearIco = function(){
		var s = this;
		s.icos.map(function(item){
			item.parent.removeChild(item);
		});
		s.icos = [];
	};
	
	return w.Main = Main;
})(window);



var Box2D={};
(function(F,G){function K(){}

	F.inherit=function(y,w){K.prototype=w.prototype;y.prototype=new K;y.prototype.constructor=y};F.generateCallback=function(y,w){return function(){w.apply(y,arguments)}};
F.NVector=function(y){if(y===G)y=0;for(var w=Array(y||0),A=0;A<y;++A)w[A]=0;return w};F.is=function(y,w){if(y===null)return false;if(w instanceof Function&&y instanceof w)return true;if(y.constructor.__implements!=G&&y.constructor.__implements[w])return true;return false};F.parseUInt=function(y){return Math.abs(parseInt(y))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;if(typeof Box2D==="undefined")Box2D={};if(typeof Box2D.Collision==="undefined")Box2D.Collision={};
if(typeof Box2D.Collision.Shapes==="undefined")Box2D.Collision.Shapes={};if(typeof Box2D.Common==="undefined")Box2D.Common={};if(typeof Box2D.Common.Math==="undefined")Box2D.Common.Math={};if(typeof Box2D.Dynamics==="undefined")Box2D.Dynamics={};if(typeof Box2D.Dynamics.Contacts==="undefined")Box2D.Dynamics.Contacts={};if(typeof Box2D.Dynamics.Controllers==="undefined")Box2D.Dynamics.Controllers={};if(typeof Box2D.Dynamics.Joints==="undefined")Box2D.Dynamics.Joints={};
(function(){function F(){F.b2AABB.apply(this,arguments)}function G(){G.b2Bound.apply(this,arguments)}function K(){K.b2BoundValues.apply(this,arguments);this.constructor===K&&this.b2BoundValues.apply(this,arguments)}function y(){y.b2Collision.apply(this,arguments)}function w(){w.b2ContactID.apply(this,arguments);this.constructor===w&&this.b2ContactID.apply(this,arguments)}function A(){A.b2ContactPoint.apply(this,arguments)}function U(){U.b2Distance.apply(this,arguments)}function p(){p.b2DistanceInput.apply(this,
arguments)}function B(){B.b2DistanceOutput.apply(this,arguments)}function Q(){Q.b2DistanceProxy.apply(this,arguments)}function V(){V.b2DynamicTree.apply(this,arguments);this.constructor===V&&this.b2DynamicTree.apply(this,arguments)}function M(){M.b2DynamicTreeBroadPhase.apply(this,arguments)}function L(){L.b2DynamicTreeNode.apply(this,arguments)}function I(){I.b2DynamicTreePair.apply(this,arguments)}function W(){W.b2Manifold.apply(this,arguments);this.constructor===W&&this.b2Manifold.apply(this,arguments)}
function Y(){Y.b2ManifoldPoint.apply(this,arguments);this.constructor===Y&&this.b2ManifoldPoint.apply(this,arguments)}function k(){k.b2Point.apply(this,arguments)}function z(){z.b2RayCastInput.apply(this,arguments);this.constructor===z&&this.b2RayCastInput.apply(this,arguments)}function u(){u.b2RayCastOutput.apply(this,arguments)}function D(){D.b2Segment.apply(this,arguments)}function H(){H.b2SeparationFunction.apply(this,arguments)}function O(){O.b2Simplex.apply(this,arguments);this.constructor===
O&&this.b2Simplex.apply(this,arguments)}function E(){E.b2SimplexCache.apply(this,arguments)}function R(){R.b2SimplexVertex.apply(this,arguments)}function N(){N.b2TimeOfImpact.apply(this,arguments)}function S(){S.b2TOIInput.apply(this,arguments)}function aa(){aa.b2WorldManifold.apply(this,arguments);this.constructor===aa&&this.b2WorldManifold.apply(this,arguments)}function Z(){Z.ClipVertex.apply(this,arguments)}function d(){d.Features.apply(this,arguments)}function h(){h.b2CircleShape.apply(this,arguments);
this.constructor===h&&this.b2CircleShape.apply(this,arguments)}function l(){l.b2EdgeChainDef.apply(this,arguments);this.constructor===l&&this.b2EdgeChainDef.apply(this,arguments)}function j(){j.b2EdgeShape.apply(this,arguments);this.constructor===j&&this.b2EdgeShape.apply(this,arguments)}function o(){o.b2MassData.apply(this,arguments)}function q(){q.b2PolygonShape.apply(this,arguments);this.constructor===q&&this.b2PolygonShape.apply(this,arguments)}function n(){n.b2Shape.apply(this,arguments);this.constructor===
n&&this.b2Shape.apply(this,arguments)}function a(){a.b2Color.apply(this,arguments);this.constructor===a&&this.b2Color.apply(this,arguments)}function c(){c.b2Settings.apply(this,arguments)}function g(){g.b2Mat22.apply(this,arguments);this.constructor===g&&this.b2Mat22.apply(this,arguments)}function b(){b.b2Mat33.apply(this,arguments);this.constructor===b&&this.b2Mat33.apply(this,arguments)}function e(){e.b2Math.apply(this,arguments)}function f(){f.b2Sweep.apply(this,arguments)}function m(){m.b2Transform.apply(this,
arguments);this.constructor===m&&this.b2Transform.apply(this,arguments)}function r(){r.b2Vec2.apply(this,arguments);this.constructor===r&&this.b2Vec2.apply(this,arguments)}function s(){s.b2Vec3.apply(this,arguments);this.constructor===s&&this.b2Vec3.apply(this,arguments)}function v(){v.b2Body.apply(this,arguments);this.constructor===v&&this.b2Body.apply(this,arguments)}function t(){t.b2BodyDef.apply(this,arguments);this.constructor===t&&this.b2BodyDef.apply(this,arguments)}function x(){x.b2ContactFilter.apply(this,
arguments)}function C(){C.b2ContactImpulse.apply(this,arguments)}function J(){J.b2ContactListener.apply(this,arguments)}function T(){T.b2ContactManager.apply(this,arguments);this.constructor===T&&this.b2ContactManager.apply(this,arguments)}function P(){P.b2DebugDraw.apply(this,arguments);this.constructor===P&&this.b2DebugDraw.apply(this,arguments)}function X(){X.b2DestructionListener.apply(this,arguments)}function $(){$.b2FilterData.apply(this,arguments)}function ba(){ba.b2Fixture.apply(this,arguments);
this.constructor===ba&&this.b2Fixture.apply(this,arguments)}function ca(){ca.b2FixtureDef.apply(this,arguments);this.constructor===ca&&this.b2FixtureDef.apply(this,arguments)}function da(){da.b2Island.apply(this,arguments);this.constructor===da&&this.b2Island.apply(this,arguments)}function Fa(){Fa.b2TimeStep.apply(this,arguments)}function ea(){ea.b2World.apply(this,arguments);this.constructor===ea&&this.b2World.apply(this,arguments)}function Ga(){Ga.b2CircleContact.apply(this,arguments)}function fa(){fa.b2Contact.apply(this,
arguments);this.constructor===fa&&this.b2Contact.apply(this,arguments)}function ga(){ga.b2ContactConstraint.apply(this,arguments);this.constructor===ga&&this.b2ContactConstraint.apply(this,arguments)}function Ha(){Ha.b2ContactConstraintPoint.apply(this,arguments)}function Ia(){Ia.b2ContactEdge.apply(this,arguments)}function ha(){ha.b2ContactFactory.apply(this,arguments);this.constructor===ha&&this.b2ContactFactory.apply(this,arguments)}function Ja(){Ja.b2ContactRegister.apply(this,arguments)}function Ka(){Ka.b2ContactResult.apply(this,
arguments)}function ia(){ia.b2ContactSolver.apply(this,arguments);this.constructor===ia&&this.b2ContactSolver.apply(this,arguments)}function La(){La.b2EdgeAndCircleContact.apply(this,arguments)}function ja(){ja.b2NullContact.apply(this,arguments);this.constructor===ja&&this.b2NullContact.apply(this,arguments)}function Ma(){Ma.b2PolyAndCircleContact.apply(this,arguments)}function Na(){Na.b2PolyAndEdgeContact.apply(this,arguments)}function Oa(){Oa.b2PolygonContact.apply(this,arguments)}function ka(){ka.b2PositionSolverManifold.apply(this,
arguments);this.constructor===ka&&this.b2PositionSolverManifold.apply(this,arguments)}function Pa(){Pa.b2BuoyancyController.apply(this,arguments)}function Qa(){Qa.b2ConstantAccelController.apply(this,arguments)}function Ra(){Ra.b2ConstantForceController.apply(this,arguments)}function Sa(){Sa.b2Controller.apply(this,arguments)}function Ta(){Ta.b2ControllerEdge.apply(this,arguments)}function Ua(){Ua.b2GravityController.apply(this,arguments)}function Va(){Va.b2TensorDampingController.apply(this,arguments)}
function la(){la.b2DistanceJoint.apply(this,arguments);this.constructor===la&&this.b2DistanceJoint.apply(this,arguments)}function ma(){ma.b2DistanceJointDef.apply(this,arguments);this.constructor===ma&&this.b2DistanceJointDef.apply(this,arguments)}function na(){na.b2FrictionJoint.apply(this,arguments);this.constructor===na&&this.b2FrictionJoint.apply(this,arguments)}function oa(){oa.b2FrictionJointDef.apply(this,arguments);this.constructor===oa&&this.b2FrictionJointDef.apply(this,arguments)}function pa(){pa.b2GearJoint.apply(this,
arguments);this.constructor===pa&&this.b2GearJoint.apply(this,arguments)}function qa(){qa.b2GearJointDef.apply(this,arguments);this.constructor===qa&&this.b2GearJointDef.apply(this,arguments)}function Wa(){Wa.b2Jacobian.apply(this,arguments)}function ra(){ra.b2Joint.apply(this,arguments);this.constructor===ra&&this.b2Joint.apply(this,arguments)}function sa(){sa.b2JointDef.apply(this,arguments);this.constructor===sa&&this.b2JointDef.apply(this,arguments)}function Xa(){Xa.b2JointEdge.apply(this,arguments)}
function ta(){ta.b2LineJoint.apply(this,arguments);this.constructor===ta&&this.b2LineJoint.apply(this,arguments)}function ua(){ua.b2LineJointDef.apply(this,arguments);this.constructor===ua&&this.b2LineJointDef.apply(this,arguments)}function va(){va.b2MouseJoint.apply(this,arguments);this.constructor===va&&this.b2MouseJoint.apply(this,arguments)}function wa(){wa.b2MouseJointDef.apply(this,arguments);this.constructor===wa&&this.b2MouseJointDef.apply(this,arguments)}function xa(){xa.b2PrismaticJoint.apply(this,
arguments);this.constructor===xa&&this.b2PrismaticJoint.apply(this,arguments)}function ya(){ya.b2PrismaticJointDef.apply(this,arguments);this.constructor===ya&&this.b2PrismaticJointDef.apply(this,arguments)}function za(){za.b2PulleyJoint.apply(this,arguments);this.constructor===za&&this.b2PulleyJoint.apply(this,arguments)}function Aa(){Aa.b2PulleyJointDef.apply(this,arguments);this.constructor===Aa&&this.b2PulleyJointDef.apply(this,arguments)}function Ba(){Ba.b2RevoluteJoint.apply(this,arguments);
this.constructor===Ba&&this.b2RevoluteJoint.apply(this,arguments)}function Ca(){Ca.b2RevoluteJointDef.apply(this,arguments);this.constructor===Ca&&this.b2RevoluteJointDef.apply(this,arguments)}function Da(){Da.b2WeldJoint.apply(this,arguments);this.constructor===Da&&this.b2WeldJoint.apply(this,arguments)}function Ea(){Ea.b2WeldJointDef.apply(this,arguments);this.constructor===Ea&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";Box2D.Collision.b2AABB=
F;Box2D.Collision.b2Bound=G;Box2D.Collision.b2BoundValues=K;Box2D.Collision.b2Collision=y;Box2D.Collision.b2ContactID=w;Box2D.Collision.b2ContactPoint=A;Box2D.Collision.b2Distance=U;Box2D.Collision.b2DistanceInput=p;Box2D.Collision.b2DistanceOutput=B;Box2D.Collision.b2DistanceProxy=Q;Box2D.Collision.b2DynamicTree=V;Box2D.Collision.b2DynamicTreeBroadPhase=M;Box2D.Collision.b2DynamicTreeNode=L;Box2D.Collision.b2DynamicTreePair=I;Box2D.Collision.b2Manifold=W;Box2D.Collision.b2ManifoldPoint=Y;Box2D.Collision.b2Point=
k;Box2D.Collision.b2RayCastInput=z;Box2D.Collision.b2RayCastOutput=u;Box2D.Collision.b2Segment=D;Box2D.Collision.b2SeparationFunction=H;Box2D.Collision.b2Simplex=O;Box2D.Collision.b2SimplexCache=E;Box2D.Collision.b2SimplexVertex=R;Box2D.Collision.b2TimeOfImpact=N;Box2D.Collision.b2TOIInput=S;Box2D.Collision.b2WorldManifold=aa;Box2D.Collision.ClipVertex=Z;Box2D.Collision.Features=d;Box2D.Collision.Shapes.b2CircleShape=h;Box2D.Collision.Shapes.b2EdgeChainDef=l;Box2D.Collision.Shapes.b2EdgeShape=j;Box2D.Collision.Shapes.b2MassData=
o;Box2D.Collision.Shapes.b2PolygonShape=q;Box2D.Collision.Shapes.b2Shape=n;Box2D.Common.b2internal="Box2D.Common.b2internal";Box2D.Common.b2Color=a;Box2D.Common.b2Settings=c;Box2D.Common.Math.b2Mat22=g;Box2D.Common.Math.b2Mat33=b;Box2D.Common.Math.b2Math=e;Box2D.Common.Math.b2Sweep=f;Box2D.Common.Math.b2Transform=m;Box2D.Common.Math.b2Vec2=r;Box2D.Common.Math.b2Vec3=s;Box2D.Dynamics.b2Body=v;Box2D.Dynamics.b2BodyDef=t;Box2D.Dynamics.b2ContactFilter=x;Box2D.Dynamics.b2ContactImpulse=C;Box2D.Dynamics.b2ContactListener=
J;Box2D.Dynamics.b2ContactManager=T;Box2D.Dynamics.b2DebugDraw=P;Box2D.Dynamics.b2DestructionListener=X;Box2D.Dynamics.b2FilterData=$;Box2D.Dynamics.b2Fixture=ba;Box2D.Dynamics.b2FixtureDef=ca;Box2D.Dynamics.b2Island=da;Box2D.Dynamics.b2TimeStep=Fa;Box2D.Dynamics.b2World=ea;Box2D.Dynamics.Contacts.b2CircleContact=Ga;Box2D.Dynamics.Contacts.b2Contact=fa;Box2D.Dynamics.Contacts.b2ContactConstraint=ga;Box2D.Dynamics.Contacts.b2ContactConstraintPoint=Ha;Box2D.Dynamics.Contacts.b2ContactEdge=Ia;Box2D.Dynamics.Contacts.b2ContactFactory=
ha;Box2D.Dynamics.Contacts.b2ContactRegister=Ja;Box2D.Dynamics.Contacts.b2ContactResult=Ka;Box2D.Dynamics.Contacts.b2ContactSolver=ia;Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=La;Box2D.Dynamics.Contacts.b2NullContact=ja;Box2D.Dynamics.Contacts.b2PolyAndCircleContact=Ma;Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=Na;Box2D.Dynamics.Contacts.b2PolygonContact=Oa;Box2D.Dynamics.Contacts.b2PositionSolverManifold=ka;Box2D.Dynamics.Controllers.b2BuoyancyController=Pa;Box2D.Dynamics.Controllers.b2ConstantAccelController=
Qa;Box2D.Dynamics.Controllers.b2ConstantForceController=Ra;Box2D.Dynamics.Controllers.b2Controller=Sa;Box2D.Dynamics.Controllers.b2ControllerEdge=Ta;Box2D.Dynamics.Controllers.b2GravityController=Ua;Box2D.Dynamics.Controllers.b2TensorDampingController=Va;Box2D.Dynamics.Joints.b2DistanceJoint=la;Box2D.Dynamics.Joints.b2DistanceJointDef=ma;Box2D.Dynamics.Joints.b2FrictionJoint=na;Box2D.Dynamics.Joints.b2FrictionJointDef=oa;Box2D.Dynamics.Joints.b2GearJoint=pa;Box2D.Dynamics.Joints.b2GearJointDef=qa;
Box2D.Dynamics.Joints.b2Jacobian=Wa;Box2D.Dynamics.Joints.b2Joint=ra;Box2D.Dynamics.Joints.b2JointDef=sa;Box2D.Dynamics.Joints.b2JointEdge=Xa;Box2D.Dynamics.Joints.b2LineJoint=ta;Box2D.Dynamics.Joints.b2LineJointDef=ua;Box2D.Dynamics.Joints.b2MouseJoint=va;Box2D.Dynamics.Joints.b2MouseJointDef=wa;Box2D.Dynamics.Joints.b2PrismaticJoint=xa;Box2D.Dynamics.Joints.b2PrismaticJointDef=ya;Box2D.Dynamics.Joints.b2PulleyJoint=za;Box2D.Dynamics.Joints.b2PulleyJointDef=Aa;Box2D.Dynamics.Joints.b2RevoluteJoint=
Ba;Box2D.Dynamics.Joints.b2RevoluteJointDef=Ca;Box2D.Dynamics.Joints.b2WeldJoint=Da;Box2D.Dynamics.Joints.b2WeldJointDef=Ea})();Box2D.postDefs=[];
(function(){var F=Box2D.Collision.Shapes.b2CircleShape,G=Box2D.Collision.Shapes.b2PolygonShape,K=Box2D.Collision.Shapes.b2Shape,y=Box2D.Common.b2Settings,w=Box2D.Common.Math.b2Math,A=Box2D.Common.Math.b2Sweep,U=Box2D.Common.Math.b2Transform,p=Box2D.Common.Math.b2Vec2,B=Box2D.Collision.b2AABB,Q=Box2D.Collision.b2Bound,V=Box2D.Collision.b2BoundValues,M=Box2D.Collision.b2Collision,L=Box2D.Collision.b2ContactID,I=Box2D.Collision.b2ContactPoint,W=Box2D.Collision.b2Distance,Y=Box2D.Collision.b2DistanceInput,
k=Box2D.Collision.b2DistanceOutput,z=Box2D.Collision.b2DistanceProxy,u=Box2D.Collision.b2DynamicTree,D=Box2D.Collision.b2DynamicTreeBroadPhase,H=Box2D.Collision.b2DynamicTreeNode,O=Box2D.Collision.b2DynamicTreePair,E=Box2D.Collision.b2Manifold,R=Box2D.Collision.b2ManifoldPoint,N=Box2D.Collision.b2Point,S=Box2D.Collision.b2RayCastInput,aa=Box2D.Collision.b2RayCastOutput,Z=Box2D.Collision.b2Segment,d=Box2D.Collision.b2SeparationFunction,h=Box2D.Collision.b2Simplex,l=Box2D.Collision.b2SimplexCache,j=
Box2D.Collision.b2SimplexVertex,o=Box2D.Collision.b2TimeOfImpact,q=Box2D.Collision.b2TOIInput,n=Box2D.Collision.b2WorldManifold,a=Box2D.Collision.ClipVertex,c=Box2D.Collision.Features,g=Box2D.Collision.IBroadPhase;B.b2AABB=function(){this.lowerBound=new p;this.upperBound=new p};B.prototype.IsValid=function(){var b=this.upperBound.y-this.lowerBound.y;return b=(b=this.upperBound.x-this.lowerBound.x>=0&&b>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};B.prototype.GetCenter=function(){return new p((this.lowerBound.x+
this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};B.prototype.GetExtents=function(){return new p((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};B.prototype.Contains=function(b){var e=true;return e=(e=(e=(e=e&&this.lowerBound.x<=b.lowerBound.x)&&this.lowerBound.y<=b.lowerBound.y)&&b.upperBound.x<=this.upperBound.x)&&b.upperBound.y<=this.upperBound.y};B.prototype.RayCast=function(b,e){var f=-Number.MAX_VALUE,m=Number.MAX_VALUE,r=e.p1.x,s=e.p1.y,v=e.p2.x-
e.p1.x,t=e.p2.y-e.p1.y,x=Math.abs(t),C=b.normal,J=0,T=0,P=J=0;P=0;if(Math.abs(v)<Number.MIN_VALUE){if(r<this.lowerBound.x||this.upperBound.x<r)return false}else{J=1/v;T=(this.lowerBound.x-r)*J;J=(this.upperBound.x-r)*J;P=-1;if(T>J){P=T;T=J;J=P;P=1}if(T>f){C.x=P;C.y=0;f=T}m=Math.min(m,J);if(f>m)return false}if(x<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return false}else{J=1/t;T=(this.lowerBound.y-s)*J;J=(this.upperBound.y-s)*J;P=-1;if(T>J){P=T;T=J;J=P;P=1}if(T>f){C.y=P;C.x=0;f=
T}m=Math.min(m,J);if(f>m)return false}b.fraction=f;return true};B.prototype.TestOverlap=function(b){var e=b.lowerBound.y-this.upperBound.y,f=this.lowerBound.y-b.upperBound.y;if(b.lowerBound.x-this.upperBound.x>0||e>0)return false;if(this.lowerBound.x-b.upperBound.x>0||f>0)return false;return true};B.Combine=function(b,e){var f=new B;f.Combine(b,e);return f};B.prototype.Combine=function(b,e){this.lowerBound.x=Math.min(b.lowerBound.x,e.lowerBound.x);this.lowerBound.y=Math.min(b.lowerBound.y,e.lowerBound.y);
this.upperBound.x=Math.max(b.upperBound.x,e.upperBound.x);this.upperBound.y=Math.max(b.upperBound.y,e.upperBound.y)};Q.b2Bound=function(){};Q.prototype.IsLower=function(){return(this.value&1)==0};Q.prototype.IsUpper=function(){return(this.value&1)==1};Q.prototype.Swap=function(b){var e=this.value,f=this.proxy,m=this.stabbingCount;this.value=b.value;this.proxy=b.proxy;this.stabbingCount=b.stabbingCount;b.value=e;b.proxy=f;b.stabbingCount=m};V.b2BoundValues=function(){};V.prototype.b2BoundValues=function(){this.lowerValues=
new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};M.b2Collision=function(){};M.ClipSegmentToLine=function(b,e,f,m){if(m===undefined)m=0;var r,s=0;r=e[0];var v=r.v;r=e[1];var t=r.v,x=f.x*v.x+f.y*v.y-m;r=f.x*t.x+f.y*t.y-m;x<=0&&b[s++].Set(e[0]);r<=0&&b[s++].Set(e[1]);if(x*r<0){f=x/(x-r);r=b[s];r=r.v;r.x=v.x+f*(t.x-v.x);r.y=v.y+f*(t.y-v.y);r=b[s];r.id=(x>0?e[0]:e[1]).id;++s}return s};M.EdgeSeparation=
function(b,e,f,m,r){if(f===undefined)f=0;parseInt(b.m_vertexCount);var s=b.m_vertices;b=b.m_normals;var v=parseInt(m.m_vertexCount),t=m.m_vertices,x,C;x=e.R;C=b[f];b=x.col1.x*C.x+x.col2.x*C.y;m=x.col1.y*C.x+x.col2.y*C.y;x=r.R;var J=x.col1.x*b+x.col1.y*m;x=x.col2.x*b+x.col2.y*m;for(var T=0,P=Number.MAX_VALUE,X=0;X<v;++X){C=t[X];C=C.x*J+C.y*x;if(C<P){P=C;T=X}}C=s[f];x=e.R;f=e.position.x+(x.col1.x*C.x+x.col2.x*C.y);e=e.position.y+(x.col1.y*C.x+x.col2.y*C.y);C=t[T];x=r.R;s=r.position.x+(x.col1.x*C.x+
x.col2.x*C.y);r=r.position.y+(x.col1.y*C.x+x.col2.y*C.y);s-=f;r-=e;return s*b+r*m};M.FindMaxSeparation=function(b,e,f,m,r){var s=parseInt(e.m_vertexCount),v=e.m_normals,t,x;x=r.R;t=m.m_centroid;var C=r.position.x+(x.col1.x*t.x+x.col2.x*t.y),J=r.position.y+(x.col1.y*t.x+x.col2.y*t.y);x=f.R;t=e.m_centroid;C-=f.position.x+(x.col1.x*t.x+x.col2.x*t.y);J-=f.position.y+(x.col1.y*t.x+x.col2.y*t.y);x=C*f.R.col1.x+J*f.R.col1.y;J=C*f.R.col2.x+J*f.R.col2.y;C=0;for(var T=-Number.MAX_VALUE,P=0;P<s;++P){t=v[P];
t=t.x*x+t.y*J;if(t>T){T=t;C=P}}v=M.EdgeSeparation(e,f,C,m,r);t=parseInt(C-1>=0?C-1:s-1);x=M.EdgeSeparation(e,f,t,m,r);J=parseInt(C+1<s?C+1:0);T=M.EdgeSeparation(e,f,J,m,r);var X=P=0,$=0;if(x>v&&x>T){$=-1;P=t;X=x}else if(T>v){$=1;P=J;X=T}else{b[0]=C;return v}for(;;){C=$==-1?P-1>=0?P-1:s-1:P+1<s?P+1:0;v=M.EdgeSeparation(e,f,C,m,r);if(v>X){P=C;X=v}else break}b[0]=P;return X};M.FindIncidentEdge=function(b,e,f,m,r,s){if(m===undefined)m=0;parseInt(e.m_vertexCount);var v=e.m_normals,t=parseInt(r.m_vertexCount);
e=r.m_vertices;r=r.m_normals;var x;x=f.R;f=v[m];v=x.col1.x*f.x+x.col2.x*f.y;var C=x.col1.y*f.x+x.col2.y*f.y;x=s.R;f=x.col1.x*v+x.col1.y*C;C=x.col2.x*v+x.col2.y*C;v=f;x=0;for(var J=Number.MAX_VALUE,T=0;T<t;++T){f=r[T];f=v*f.x+C*f.y;if(f<J){J=f;x=T}}r=parseInt(x);v=parseInt(r+1<t?r+1:0);t=b[0];f=e[r];x=s.R;t.v.x=s.position.x+(x.col1.x*f.x+x.col2.x*f.y);t.v.y=s.position.y+(x.col1.y*f.x+x.col2.y*f.y);t.id.features.referenceEdge=m;t.id.features.incidentEdge=r;t.id.features.incidentVertex=0;t=b[1];f=e[v];
x=s.R;t.v.x=s.position.x+(x.col1.x*f.x+x.col2.x*f.y);t.v.y=s.position.y+(x.col1.y*f.x+x.col2.y*f.y);t.id.features.referenceEdge=m;t.id.features.incidentEdge=v;t.id.features.incidentVertex=1};M.MakeClipPointVector=function(){var b=new Vector(2);b[0]=new a;b[1]=new a;return b};M.CollidePolygons=function(b,e,f,m,r){var s;b.m_pointCount=0;var v=e.m_radius+m.m_radius;s=0;M.s_edgeAO[0]=s;var t=M.FindMaxSeparation(M.s_edgeAO,e,f,m,r);s=M.s_edgeAO[0];if(!(t>v)){var x=0;M.s_edgeBO[0]=x;var C=M.FindMaxSeparation(M.s_edgeBO,
m,r,e,f);x=M.s_edgeBO[0];if(!(C>v)){var J=0,T=0;if(C>0.98*t+0.0010){t=m;m=e;e=r;f=f;J=x;b.m_type=E.e_faceB;T=1}else{t=e;m=m;e=f;f=r;J=s;b.m_type=E.e_faceA;T=0}s=M.s_incidentEdge;M.FindIncidentEdge(s,t,e,J,m,f);x=parseInt(t.m_vertexCount);r=t.m_vertices;t=r[J];var P;P=J+1<x?r[parseInt(J+1)]:r[0];J=M.s_localTangent;J.Set(P.x-t.x,P.y-t.y);J.Normalize();r=M.s_localNormal;r.x=J.y;r.y=-J.x;m=M.s_planePoint;m.Set(0.5*(t.x+P.x),0.5*(t.y+P.y));C=M.s_tangent;x=e.R;C.x=x.col1.x*J.x+x.col2.x*J.y;C.y=x.col1.y*
J.x+x.col2.y*J.y;var X=M.s_tangent2;X.x=-C.x;X.y=-C.y;J=M.s_normal;J.x=C.y;J.y=-C.x;var $=M.s_v11,ba=M.s_v12;$.x=e.position.x+(x.col1.x*t.x+x.col2.x*t.y);$.y=e.position.y+(x.col1.y*t.x+x.col2.y*t.y);ba.x=e.position.x+(x.col1.x*P.x+x.col2.x*P.y);ba.y=e.position.y+(x.col1.y*P.x+x.col2.y*P.y);e=J.x*$.x+J.y*$.y;x=C.x*ba.x+C.y*ba.y+v;P=M.s_clipPoints1;t=M.s_clipPoints2;ba=0;ba=M.ClipSegmentToLine(P,s,X,-C.x*$.x-C.y*$.y+v);if(!(ba<2)){ba=M.ClipSegmentToLine(t,P,C,x);if(!(ba<2)){b.m_localPlaneNormal.SetV(r);
b.m_localPoint.SetV(m);for(m=r=0;m<y.b2_maxManifoldPoints;++m){s=t[m];if(J.x*s.v.x+J.y*s.v.y-e<=v){C=b.m_points[r];x=f.R;X=s.v.x-f.position.x;$=s.v.y-f.position.y;C.m_localPoint.x=X*x.col1.x+$*x.col1.y;C.m_localPoint.y=X*x.col2.x+$*x.col2.y;C.m_id.Set(s.id);C.m_id.features.flip=T;++r}}b.m_pointCount=r}}}}};M.CollideCircles=function(b,e,f,m,r){b.m_pointCount=0;var s,v;s=f.R;v=e.m_p;var t=f.position.x+(s.col1.x*v.x+s.col2.x*v.y);f=f.position.y+(s.col1.y*v.x+s.col2.y*v.y);s=r.R;v=m.m_p;t=r.position.x+
(s.col1.x*v.x+s.col2.x*v.y)-t;r=r.position.y+(s.col1.y*v.x+s.col2.y*v.y)-f;s=e.m_radius+m.m_radius;if(!(t*t+r*r>s*s)){b.m_type=E.e_circles;b.m_localPoint.SetV(e.m_p);b.m_localPlaneNormal.SetZero();b.m_pointCount=1;b.m_points[0].m_localPoint.SetV(m.m_p);b.m_points[0].m_id.key=0}};M.CollidePolygonAndCircle=function(b,e,f,m,r){var s=b.m_pointCount=0,v=0,t,x;x=r.R;t=m.m_p;var C=r.position.y+(x.col1.y*t.x+x.col2.y*t.y);s=r.position.x+(x.col1.x*t.x+x.col2.x*t.y)-f.position.x;v=C-f.position.y;x=f.R;f=s*
x.col1.x+v*x.col1.y;x=s*x.col2.x+v*x.col2.y;var J=0;C=-Number.MAX_VALUE;r=e.m_radius+m.m_radius;var T=parseInt(e.m_vertexCount),P=e.m_vertices;e=e.m_normals;for(var X=0;X<T;++X){t=P[X];s=f-t.x;v=x-t.y;t=e[X];s=t.x*s+t.y*v;if(s>r)return;if(s>C){C=s;J=X}}s=parseInt(J);v=parseInt(s+1<T?s+1:0);t=P[s];P=P[v];if(C<Number.MIN_VALUE){b.m_pointCount=1;b.m_type=E.e_faceA;b.m_localPlaneNormal.SetV(e[J]);b.m_localPoint.x=0.5*(t.x+P.x);b.m_localPoint.y=0.5*(t.y+P.y)}else{C=(f-P.x)*(t.x-P.x)+(x-P.y)*(t.y-P.y);
if((f-t.x)*(P.x-t.x)+(x-t.y)*(P.y-t.y)<=0){if((f-t.x)*(f-t.x)+(x-t.y)*(x-t.y)>r*r)return;b.m_pointCount=1;b.m_type=E.e_faceA;b.m_localPlaneNormal.x=f-t.x;b.m_localPlaneNormal.y=x-t.y;b.m_localPlaneNormal.Normalize();b.m_localPoint.SetV(t)}else if(C<=0){if((f-P.x)*(f-P.x)+(x-P.y)*(x-P.y)>r*r)return;b.m_pointCount=1;b.m_type=E.e_faceA;b.m_localPlaneNormal.x=f-P.x;b.m_localPlaneNormal.y=x-P.y;b.m_localPlaneNormal.Normalize();b.m_localPoint.SetV(P)}else{J=0.5*(t.x+P.x);t=0.5*(t.y+P.y);C=(f-J)*e[s].x+
(x-t)*e[s].y;if(C>r)return;b.m_pointCount=1;b.m_type=E.e_faceA;b.m_localPlaneNormal.x=e[s].x;b.m_localPlaneNormal.y=e[s].y;b.m_localPlaneNormal.Normalize();b.m_localPoint.Set(J,t)}}b.m_points[0].m_localPoint.SetV(m.m_p);b.m_points[0].m_id.key=0};M.TestOverlap=function(b,e){var f=e.lowerBound,m=b.upperBound,r=f.x-m.x,s=f.y-m.y;f=b.lowerBound;m=e.upperBound;var v=f.y-m.y;if(r>0||s>0)return false;if(f.x-m.x>0||v>0)return false;return true};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=
M.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=M.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=M.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new p;Box2D.Collision.b2Collision.s_localNormal=new p;Box2D.Collision.b2Collision.s_planePoint=new p;Box2D.Collision.b2Collision.s_normal=new p;Box2D.Collision.b2Collision.s_tangent=
new p;Box2D.Collision.b2Collision.s_tangent2=new p;Box2D.Collision.b2Collision.s_v11=new p;Box2D.Collision.b2Collision.s_v12=new p;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new p;Box2D.Collision.b2Collision.b2_nullFeature=255});L.b2ContactID=function(){this.features=new c};L.prototype.b2ContactID=function(){this.features._m_id=this};L.prototype.Set=function(b){this.key=b._key};L.prototype.Copy=function(){var b=new L;b.key=this.key;return b};Object.defineProperty(L.prototype,"key",{enumerable:false,
configurable:true,get:function(){return this._key}});Object.defineProperty(L.prototype,"key",{enumerable:false,configurable:true,set:function(b){if(b===undefined)b=0;this._key=b;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});I.b2ContactPoint=function(){this.position=new p;this.velocity=new p;this.normal=new p;this.id=new L};W.b2Distance=
function(){};W.Distance=function(b,e,f){++W.b2_gjkCalls;var m=f.proxyA,r=f.proxyB,s=f.transformA,v=f.transformB,t=W.s_simplex;t.ReadCache(e,m,s,r,v);var x=t.m_vertices,C=W.s_saveA,J=W.s_saveB,T=0;t.GetClosestPoint().LengthSquared();for(var P=0,X,$=0;$<20;){T=t.m_count;for(P=0;P<T;P++){C[P]=x[P].indexA;J[P]=x[P].indexB}switch(t.m_count){case 1:break;case 2:t.Solve2();break;case 3:t.Solve3();break;default:y.b2Assert(false)}if(t.m_count==3)break;X=t.GetClosestPoint();X.LengthSquared();P=t.GetSearchDirection();
if(P.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;X=x[t.m_count];X.indexA=m.GetSupport(w.MulTMV(s.R,P.GetNegative()));X.wA=w.MulX(s,m.GetVertex(X.indexA));X.indexB=r.GetSupport(w.MulTMV(v.R,P));X.wB=w.MulX(v,r.GetVertex(X.indexB));X.w=w.SubtractVV(X.wB,X.wA);++$;++W.b2_gjkIters;var ba=false;for(P=0;P<T;P++)if(X.indexA==C[P]&&X.indexB==J[P]){ba=true;break}if(ba)break;++t.m_count}W.b2_gjkMaxIters=w.Max(W.b2_gjkMaxIters,$);t.GetWitnessPoints(b.pointA,b.pointB);b.distance=w.SubtractVV(b.pointA,
b.pointB).Length();b.iterations=$;t.WriteCache(e);if(f.useRadii){e=m.m_radius;r=r.m_radius;if(b.distance>e+r&&b.distance>Number.MIN_VALUE){b.distance-=e+r;f=w.SubtractVV(b.pointB,b.pointA);f.Normalize();b.pointA.x+=e*f.x;b.pointA.y+=e*f.y;b.pointB.x-=r*f.x;b.pointB.y-=r*f.y}else{X=new p;X.x=0.5*(b.pointA.x+b.pointB.x);X.y=0.5*(b.pointA.y+b.pointB.y);b.pointA.x=b.pointB.x=X.x;b.pointA.y=b.pointB.y=X.y;b.distance=0}}};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new h;Box2D.Collision.b2Distance.s_saveA=
new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});Y.b2DistanceInput=function(){};k.b2DistanceOutput=function(){this.pointA=new p;this.pointB=new p};z.b2DistanceProxy=function(){};z.prototype.Set=function(b){switch(b.GetType()){case K.e_circleShape:b=b instanceof F?b:null;this.m_vertices=new Vector(1,true);this.m_vertices[0]=b.m_p;this.m_count=1;this.m_radius=b.m_radius;break;case K.e_polygonShape:b=b instanceof G?b:null;this.m_vertices=b.m_vertices;this.m_count=
b.m_vertexCount;this.m_radius=b.m_radius;break;default:y.b2Assert(false)}};z.prototype.GetSupport=function(b){for(var e=0,f=this.m_vertices[0].x*b.x+this.m_vertices[0].y*b.y,m=1;m<this.m_count;++m){var r=this.m_vertices[m].x*b.x+this.m_vertices[m].y*b.y;if(r>f){e=m;f=r}}return e};z.prototype.GetSupportVertex=function(b){for(var e=0,f=this.m_vertices[0].x*b.x+this.m_vertices[0].y*b.y,m=1;m<this.m_count;++m){var r=this.m_vertices[m].x*b.x+this.m_vertices[m].y*b.y;if(r>f){e=m;f=r}}return this.m_vertices[e]};
z.prototype.GetVertexCount=function(){return this.m_count};z.prototype.GetVertex=function(b){if(b===undefined)b=0;y.b2Assert(0<=b&&b<this.m_count);return this.m_vertices[b]};u.b2DynamicTree=function(){};u.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null;this.m_insertionCount=this.m_path=0};u.prototype.CreateProxy=function(b,e){var f=this.AllocateNode(),m=y.b2_aabbExtension,r=y.b2_aabbExtension;f.aabb.lowerBound.x=b.lowerBound.x-m;f.aabb.lowerBound.y=b.lowerBound.y-r;f.aabb.upperBound.x=
b.upperBound.x+m;f.aabb.upperBound.y=b.upperBound.y+r;f.userData=e;this.InsertLeaf(f);return f};u.prototype.DestroyProxy=function(b){this.RemoveLeaf(b);this.FreeNode(b)};u.prototype.MoveProxy=function(b,e,f){y.b2Assert(b.IsLeaf());if(b.aabb.Contains(e))return false;this.RemoveLeaf(b);var m=y.b2_aabbExtension+y.b2_aabbMultiplier*(f.x>0?f.x:-f.x);f=y.b2_aabbExtension+y.b2_aabbMultiplier*(f.y>0?f.y:-f.y);b.aabb.lowerBound.x=e.lowerBound.x-m;b.aabb.lowerBound.y=e.lowerBound.y-f;b.aabb.upperBound.x=e.upperBound.x+
m;b.aabb.upperBound.y=e.upperBound.y+f;this.InsertLeaf(b);return true};u.prototype.Rebalance=function(b){if(b===undefined)b=0;if(this.m_root!=null)for(var e=0;e<b;e++){for(var f=this.m_root,m=0;f.IsLeaf()==false;){f=this.m_path>>m&1?f.child2:f.child1;m=m+1&31}++this.m_path;this.RemoveLeaf(f);this.InsertLeaf(f)}};u.prototype.GetFatAABB=function(b){return b.aabb};u.prototype.GetUserData=function(b){return b.userData};u.prototype.Query=function(b,e){if(this.m_root!=null){var f=new Vector,m=0;for(f[m++]=
this.m_root;m>0;){var r=f[--m];if(r.aabb.TestOverlap(e))if(r.IsLeaf()){if(!b(r))break}else{f[m++]=r.child1;f[m++]=r.child2}}}};u.prototype.RayCast=function(b,e){if(this.m_root!=null){var f=e.p1,m=e.p2,r=w.SubtractVV(f,m);r.Normalize();r=w.CrossFV(1,r);var s=w.AbsV(r),v=e.maxFraction,t=new B,x=0,C=0;x=f.x+v*(m.x-f.x);C=f.y+v*(m.y-f.y);t.lowerBound.x=Math.min(f.x,x);t.lowerBound.y=Math.min(f.y,C);t.upperBound.x=Math.max(f.x,x);t.upperBound.y=Math.max(f.y,C);var J=new Vector,T=0;for(J[T++]=this.m_root;T>
0;){v=J[--T];if(v.aabb.TestOverlap(t)!=false){x=v.aabb.GetCenter();C=v.aabb.GetExtents();if(!(Math.abs(r.x*(f.x-x.x)+r.y*(f.y-x.y))-s.x*C.x-s.y*C.y>0))if(v.IsLeaf()){x=new S;x.p1=e.p1;x.p2=e.p2;x.maxFraction=e.maxFraction;v=b(x,v);if(v==0)break;if(v>0){x=f.x+v*(m.x-f.x);C=f.y+v*(m.y-f.y);t.lowerBound.x=Math.min(f.x,x);t.lowerBound.y=Math.min(f.y,C);t.upperBound.x=Math.max(f.x,x);t.upperBound.y=Math.max(f.y,C)}}else{J[T++]=v.child1;J[T++]=v.child2}}}}};u.prototype.AllocateNode=function(){if(this.m_freeList){var b=
this.m_freeList;this.m_freeList=b.parent;b.parent=null;b.child1=null;b.child2=null;return b}return new H};u.prototype.FreeNode=function(b){b.parent=this.m_freeList;this.m_freeList=b};u.prototype.InsertLeaf=function(b){++this.m_insertionCount;if(this.m_root==null){this.m_root=b;this.m_root.parent=null}else{var e=b.aabb.GetCenter(),f=this.m_root;if(f.IsLeaf()==false){do{var m=f.child1;f=f.child2;f=Math.abs((m.aabb.lowerBound.x+m.aabb.upperBound.x)/2-e.x)+Math.abs((m.aabb.lowerBound.y+m.aabb.upperBound.y)/
2-e.y)<Math.abs((f.aabb.lowerBound.x+f.aabb.upperBound.x)/2-e.x)+Math.abs((f.aabb.lowerBound.y+f.aabb.upperBound.y)/2-e.y)?m:f}while(f.IsLeaf()==false)}e=f.parent;m=this.AllocateNode();m.parent=e;m.userData=null;m.aabb.Combine(b.aabb,f.aabb);if(e){if(f.parent.child1==f)e.child1=m;else e.child2=m;m.child1=f;m.child2=b;f.parent=m;b.parent=m;do{if(e.aabb.Contains(m.aabb))break;e.aabb.Combine(e.child1.aabb,e.child2.aabb);m=e;e=e.parent}while(e)}else{m.child1=f;m.child2=b;f.parent=m;this.m_root=b.parent=
m}}};u.prototype.RemoveLeaf=function(b){if(b==this.m_root)this.m_root=null;else{var e=b.parent,f=e.parent;b=e.child1==b?e.child2:e.child1;if(f){if(f.child1==e)f.child1=b;else f.child2=b;b.parent=f;for(this.FreeNode(e);f;){e=f.aabb;f.aabb=B.Combine(f.child1.aabb,f.child2.aabb);if(e.Contains(f.aabb))break;f=f.parent}}else{this.m_root=b;b.parent=null;this.FreeNode(e)}}};D.b2DynamicTreeBroadPhase=function(){this.m_tree=new u;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};
D.prototype.CreateProxy=function(b,e){var f=this.m_tree.CreateProxy(b,e);++this.m_proxyCount;this.BufferMove(f);return f};D.prototype.DestroyProxy=function(b){this.UnBufferMove(b);--this.m_proxyCount;this.m_tree.DestroyProxy(b)};D.prototype.MoveProxy=function(b,e,f){this.m_tree.MoveProxy(b,e,f)&&this.BufferMove(b)};D.prototype.TestOverlap=function(b,e){var f=this.m_tree.GetFatAABB(b),m=this.m_tree.GetFatAABB(e);return f.TestOverlap(m)};D.prototype.GetUserData=function(b){return this.m_tree.GetUserData(b)};
D.prototype.GetFatAABB=function(b){return this.m_tree.GetFatAABB(b)};D.prototype.GetProxyCount=function(){return this.m_proxyCount};D.prototype.UpdatePairs=function(b){var e=this;var f=e.m_pairCount=0,m;for(f=0;f<e.m_moveBuffer.length;++f){m=e.m_moveBuffer[f];var r=e.m_tree.GetFatAABB(m);e.m_tree.Query(function(t){if(t==m)return true;if(e.m_pairCount==e.m_pairBuffer.length)e.m_pairBuffer[e.m_pairCount]=new O;var x=e.m_pairBuffer[e.m_pairCount];x.proxyA=t<m?t:m;x.proxyB=t>=m?t:m;++e.m_pairCount;return true},
r)}for(f=e.m_moveBuffer.length=0;f<e.m_pairCount;){r=e.m_pairBuffer[f];var s=e.m_tree.GetUserData(r.proxyA),v=e.m_tree.GetUserData(r.proxyB);b(s,v);for(++f;f<e.m_pairCount;){s=e.m_pairBuffer[f];if(s.proxyA!=r.proxyA||s.proxyB!=r.proxyB)break;++f}}};D.prototype.Query=function(b,e){this.m_tree.Query(b,e)};D.prototype.RayCast=function(b,e){this.m_tree.RayCast(b,e)};D.prototype.Validate=function(){};D.prototype.Rebalance=function(b){if(b===undefined)b=0;this.m_tree.Rebalance(b)};D.prototype.BufferMove=
function(b){this.m_moveBuffer[this.m_moveBuffer.length]=b};D.prototype.UnBufferMove=function(b){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(b)),1)};D.prototype.ComparePairs=function(){return 0};D.__implements={};D.__implements[g]=true;H.b2DynamicTreeNode=function(){this.aabb=new B};H.prototype.IsLeaf=function(){return this.child1==null};O.b2DynamicTreePair=function(){};E.b2Manifold=function(){this.m_pointCount=0};E.prototype.b2Manifold=function(){this.m_points=new Vector(y.b2_maxManifoldPoints);
for(var b=0;b<y.b2_maxManifoldPoints;b++)this.m_points[b]=new R;this.m_localPlaneNormal=new p;this.m_localPoint=new p};E.prototype.Reset=function(){for(var b=0;b<y.b2_maxManifoldPoints;b++)(this.m_points[b]instanceof R?this.m_points[b]:null).Reset();this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_pointCount=this.m_type=0};E.prototype.Set=function(b){this.m_pointCount=b.m_pointCount;for(var e=0;e<y.b2_maxManifoldPoints;e++)(this.m_points[e]instanceof R?this.m_points[e]:null).Set(b.m_points[e]);
this.m_localPlaneNormal.SetV(b.m_localPlaneNormal);this.m_localPoint.SetV(b.m_localPoint);this.m_type=b.m_type};E.prototype.Copy=function(){var b=new E;b.Set(this);return b};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});R.b2ManifoldPoint=function(){this.m_localPoint=new p;this.m_id=new L};R.prototype.b2ManifoldPoint=function(){this.Reset()};R.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_tangentImpulse=
this.m_normalImpulse=0;this.m_id.key=0};R.prototype.Set=function(b){this.m_localPoint.SetV(b.m_localPoint);this.m_normalImpulse=b.m_normalImpulse;this.m_tangentImpulse=b.m_tangentImpulse;this.m_id.Set(b.m_id)};N.b2Point=function(){this.p=new p};N.prototype.Support=function(){return this.p};N.prototype.GetFirstVertex=function(){return this.p};S.b2RayCastInput=function(){this.p1=new p;this.p2=new p};S.prototype.b2RayCastInput=function(b,e,f){if(b===undefined)b=null;if(e===undefined)e=null;if(f===undefined)f=
1;b&&this.p1.SetV(b);e&&this.p2.SetV(e);this.maxFraction=f};aa.b2RayCastOutput=function(){this.normal=new p};Z.b2Segment=function(){this.p1=new p;this.p2=new p};Z.prototype.TestSegment=function(b,e,f,m){if(m===undefined)m=0;var r=f.p1,s=f.p2.x-r.x,v=f.p2.y-r.y;f=this.p2.y-this.p1.y;var t=-(this.p2.x-this.p1.x),x=100*Number.MIN_VALUE,C=-(s*f+v*t);if(C>x){var J=r.x-this.p1.x,T=r.y-this.p1.y;r=J*f+T*t;if(0<=r&&r<=m*C){m=-s*T+v*J;if(-x*C<=m&&m<=C*(1+x)){r/=C;m=Math.sqrt(f*f+t*t);f/=m;t/=m;b[0]=r;e.Set(f,
t);return true}}}return false};Z.prototype.Extend=function(b){this.ExtendForward(b);this.ExtendBackward(b)};Z.prototype.ExtendForward=function(b){var e=this.p2.x-this.p1.x,f=this.p2.y-this.p1.y;b=Math.min(e>0?(b.upperBound.x-this.p1.x)/e:e<0?(b.lowerBound.x-this.p1.x)/e:Number.POSITIVE_INFINITY,f>0?(b.upperBound.y-this.p1.y)/f:f<0?(b.lowerBound.y-this.p1.y)/f:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+e*b;this.p2.y=this.p1.y+f*b};Z.prototype.ExtendBackward=function(b){var e=-this.p2.x+this.p1.x,
f=-this.p2.y+this.p1.y;b=Math.min(e>0?(b.upperBound.x-this.p2.x)/e:e<0?(b.lowerBound.x-this.p2.x)/e:Number.POSITIVE_INFINITY,f>0?(b.upperBound.y-this.p2.y)/f:f<0?(b.lowerBound.y-this.p2.y)/f:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+e*b;this.p1.y=this.p2.y+f*b};d.b2SeparationFunction=function(){this.m_localPoint=new p;this.m_axis=new p};d.prototype.Initialize=function(b,e,f,m,r){this.m_proxyA=e;this.m_proxyB=m;var s=parseInt(b.count);y.b2Assert(0<s&&s<3);var v,t,x,C,J=C=x=m=e=0,T=0;J=0;if(s==
1){this.m_type=d.e_points;v=this.m_proxyA.GetVertex(b.indexA[0]);t=this.m_proxyB.GetVertex(b.indexB[0]);s=v;b=f.R;e=f.position.x+(b.col1.x*s.x+b.col2.x*s.y);m=f.position.y+(b.col1.y*s.x+b.col2.y*s.y);s=t;b=r.R;x=r.position.x+(b.col1.x*s.x+b.col2.x*s.y);C=r.position.y+(b.col1.y*s.x+b.col2.y*s.y);this.m_axis.x=x-e;this.m_axis.y=C-m;this.m_axis.Normalize()}else{if(b.indexB[0]==b.indexB[1]){this.m_type=d.e_faceA;e=this.m_proxyA.GetVertex(b.indexA[0]);m=this.m_proxyA.GetVertex(b.indexA[1]);t=this.m_proxyB.GetVertex(b.indexB[0]);
this.m_localPoint.x=0.5*(e.x+m.x);this.m_localPoint.y=0.5*(e.y+m.y);this.m_axis=w.CrossVF(w.SubtractVV(m,e),1);this.m_axis.Normalize();s=this.m_axis;b=f.R;J=b.col1.x*s.x+b.col2.x*s.y;T=b.col1.y*s.x+b.col2.y*s.y;s=this.m_localPoint;b=f.R;e=f.position.x+(b.col1.x*s.x+b.col2.x*s.y);m=f.position.y+(b.col1.y*s.x+b.col2.y*s.y);s=t;b=r.R;x=r.position.x+(b.col1.x*s.x+b.col2.x*s.y);C=r.position.y+(b.col1.y*s.x+b.col2.y*s.y);J=(x-e)*J+(C-m)*T}else if(b.indexA[0]==b.indexA[0]){this.m_type=d.e_faceB;x=this.m_proxyB.GetVertex(b.indexB[0]);
C=this.m_proxyB.GetVertex(b.indexB[1]);v=this.m_proxyA.GetVertex(b.indexA[0]);this.m_localPoint.x=0.5*(x.x+C.x);this.m_localPoint.y=0.5*(x.y+C.y);this.m_axis=w.CrossVF(w.SubtractVV(C,x),1);this.m_axis.Normalize();s=this.m_axis;b=r.R;J=b.col1.x*s.x+b.col2.x*s.y;T=b.col1.y*s.x+b.col2.y*s.y;s=this.m_localPoint;b=r.R;x=r.position.x+(b.col1.x*s.x+b.col2.x*s.y);C=r.position.y+(b.col1.y*s.x+b.col2.y*s.y);s=v;b=f.R;e=f.position.x+(b.col1.x*s.x+b.col2.x*s.y);m=f.position.y+(b.col1.y*s.x+b.col2.y*s.y);J=(e-
x)*J+(m-C)*T}else{e=this.m_proxyA.GetVertex(b.indexA[0]);m=this.m_proxyA.GetVertex(b.indexA[1]);x=this.m_proxyB.GetVertex(b.indexB[0]);C=this.m_proxyB.GetVertex(b.indexB[1]);w.MulX(f,v);v=w.MulMV(f.R,w.SubtractVV(m,e));w.MulX(r,t);J=w.MulMV(r.R,w.SubtractVV(C,x));r=v.x*v.x+v.y*v.y;t=J.x*J.x+J.y*J.y;b=w.SubtractVV(J,v);f=v.x*b.x+v.y*b.y;b=J.x*b.x+J.y*b.y;v=v.x*J.x+v.y*J.y;T=r*t-v*v;J=0;if(T!=0)J=w.Clamp((v*b-f*t)/T,0,1);if((v*J+b)/t<0)J=w.Clamp((v-f)/r,0,1);v=new p;v.x=e.x+J*(m.x-e.x);v.y=e.y+J*(m.y-
e.y);t=new p;t.x=x.x+J*(C.x-x.x);t.y=x.y+J*(C.y-x.y);if(J==0||J==1){this.m_type=d.e_faceB;this.m_axis=w.CrossVF(w.SubtractVV(C,x),1);this.m_axis.Normalize();this.m_localPoint=t}else{this.m_type=d.e_faceA;this.m_axis=w.CrossVF(w.SubtractVV(m,e),1);this.m_localPoint=v}}J<0&&this.m_axis.NegativeSelf()}};d.prototype.Evaluate=function(b,e){var f,m,r=0;switch(this.m_type){case d.e_points:f=w.MulTMV(b.R,this.m_axis);m=w.MulTMV(e.R,this.m_axis.GetNegative());f=this.m_proxyA.GetSupportVertex(f);m=this.m_proxyB.GetSupportVertex(m);
f=w.MulX(b,f);m=w.MulX(e,m);return r=(m.x-f.x)*this.m_axis.x+(m.y-f.y)*this.m_axis.y;case d.e_faceA:r=w.MulMV(b.R,this.m_axis);f=w.MulX(b,this.m_localPoint);m=w.MulTMV(e.R,r.GetNegative());m=this.m_proxyB.GetSupportVertex(m);m=w.MulX(e,m);return r=(m.x-f.x)*r.x+(m.y-f.y)*r.y;case d.e_faceB:r=w.MulMV(e.R,this.m_axis);m=w.MulX(e,this.m_localPoint);f=w.MulTMV(b.R,r.GetNegative());f=this.m_proxyA.GetSupportVertex(f);f=w.MulX(b,f);return r=(f.x-m.x)*r.x+(f.y-m.y)*r.y;default:y.b2Assert(false);return 0}};
Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4});h.b2Simplex=function(){this.m_v1=new j;this.m_v2=new j;this.m_v3=new j;this.m_vertices=new Vector(3)};h.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};h.prototype.ReadCache=function(b,e,f,m,r){y.b2Assert(0<=b.count&&b.count<=3);var s,v;this.m_count=b.count;
for(var t=this.m_vertices,x=0;x<this.m_count;x++){var C=t[x];C.indexA=b.indexA[x];C.indexB=b.indexB[x];s=e.GetVertex(C.indexA);v=m.GetVertex(C.indexB);C.wA=w.MulX(f,s);C.wB=w.MulX(r,v);C.w=w.SubtractVV(C.wB,C.wA);C.a=0}if(this.m_count>1){b=b.metric;s=this.GetMetric();if(s<0.5*b||2*b<s||s<Number.MIN_VALUE)this.m_count=0}if(this.m_count==0){C=t[0];C.indexA=0;C.indexB=0;s=e.GetVertex(0);v=m.GetVertex(0);C.wA=w.MulX(f,s);C.wB=w.MulX(r,v);C.w=w.SubtractVV(C.wB,C.wA);this.m_count=1}};h.prototype.WriteCache=
function(b){b.metric=this.GetMetric();b.count=Box2D.parseUInt(this.m_count);for(var e=this.m_vertices,f=0;f<this.m_count;f++){b.indexA[f]=Box2D.parseUInt(e[f].indexA);b.indexB[f]=Box2D.parseUInt(e[f].indexB)}};h.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var b=w.SubtractVV(this.m_v2.w,this.m_v1.w);return w.CrossVV(b,this.m_v1.w.GetNegative())>0?w.CrossFV(1,b):w.CrossVF(b,1);default:y.b2Assert(false);return new p}};h.prototype.GetClosestPoint=
function(){switch(this.m_count){case 0:y.b2Assert(false);return new p;case 1:return this.m_v1.w;case 2:return new p(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:y.b2Assert(false);return new p}};h.prototype.GetWitnessPoints=function(b,e){switch(this.m_count){case 0:y.b2Assert(false);break;case 1:b.SetV(this.m_v1.wA);e.SetV(this.m_v1.wB);break;case 2:b.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;b.y=this.m_v1.a*this.m_v1.wA.y+
this.m_v2.a*this.m_v2.wA.y;e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=b.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;e.y=b.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:y.b2Assert(false)}};h.prototype.GetMetric=function(){switch(this.m_count){case 0:y.b2Assert(false);return 0;case 1:return 0;case 2:return w.SubtractVV(this.m_v1.w,
this.m_v2.w).Length();case 3:return w.CrossVV(w.SubtractVV(this.m_v2.w,this.m_v1.w),w.SubtractVV(this.m_v3.w,this.m_v1.w));default:y.b2Assert(false);return 0}};h.prototype.Solve2=function(){var b=this.m_v1.w,e=this.m_v2.w,f=w.SubtractVV(e,b);b=-(b.x*f.x+b.y*f.y);if(b<=0)this.m_count=this.m_v1.a=1;else{e=e.x*f.x+e.y*f.y;if(e<=0){this.m_count=this.m_v2.a=1;this.m_v1.Set(this.m_v2)}else{f=1/(e+b);this.m_v1.a=e*f;this.m_v2.a=b*f;this.m_count=2}}};h.prototype.Solve3=function(){var b=this.m_v1.w,e=this.m_v2.w,
f=this.m_v3.w,m=w.SubtractVV(e,b),r=w.Dot(b,m),s=w.Dot(e,m);r=-r;var v=w.SubtractVV(f,b),t=w.Dot(b,v),x=w.Dot(f,v);t=-t;var C=w.SubtractVV(f,e),J=w.Dot(e,C);C=w.Dot(f,C);J=-J;v=w.CrossVV(m,v);m=v*w.CrossVV(e,f);f=v*w.CrossVV(f,b);b=v*w.CrossVV(b,e);if(r<=0&&t<=0)this.m_count=this.m_v1.a=1;else if(s>0&&r>0&&b<=0){x=1/(s+r);this.m_v1.a=s*x;this.m_v2.a=r*x;this.m_count=2}else if(x>0&&t>0&&f<=0){s=1/(x+t);this.m_v1.a=x*s;this.m_v3.a=t*s;this.m_count=2;this.m_v2.Set(this.m_v3)}else if(s<=0&&J<=0){this.m_count=
this.m_v2.a=1;this.m_v1.Set(this.m_v2)}else if(x<=0&&C<=0){this.m_count=this.m_v3.a=1;this.m_v1.Set(this.m_v3)}else if(C>0&&J>0&&m<=0){s=1/(C+J);this.m_v2.a=C*s;this.m_v3.a=J*s;this.m_count=2;this.m_v1.Set(this.m_v3)}else{s=1/(m+f+b);this.m_v1.a=m*s;this.m_v2.a=f*s;this.m_v3.a=b*s;this.m_count=3}};l.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};j.b2SimplexVertex=function(){};j.prototype.Set=function(b){this.wA.SetV(b.wA);this.wB.SetV(b.wB);this.w.SetV(b.w);
this.a=b.a;this.indexA=b.indexA;this.indexB=b.indexB};o.b2TimeOfImpact=function(){};o.TimeOfImpact=function(b){++o.b2_toiCalls;var e=b.proxyA,f=b.proxyB,m=b.sweepA,r=b.sweepB;y.b2Assert(m.t0==r.t0);y.b2Assert(1-m.t0>Number.MIN_VALUE);var s=e.m_radius+f.m_radius;b=b.tolerance;var v=0,t=0,x=0;o.s_cache.count=0;for(o.s_distanceInput.useRadii=false;;){m.GetTransform(o.s_xfA,v);r.GetTransform(o.s_xfB,v);o.s_distanceInput.proxyA=e;o.s_distanceInput.proxyB=f;o.s_distanceInput.transformA=o.s_xfA;o.s_distanceInput.transformB=
o.s_xfB;W.Distance(o.s_distanceOutput,o.s_cache,o.s_distanceInput);if(o.s_distanceOutput.distance<=0){v=1;break}o.s_fcn.Initialize(o.s_cache,e,o.s_xfA,f,o.s_xfB);var C=o.s_fcn.Evaluate(o.s_xfA,o.s_xfB);if(C<=0){v=1;break}if(t==0)x=C>s?w.Max(s-b,0.75*s):w.Max(C-b,0.02*s);if(C-x<0.5*b){if(t==0){v=1;break}break}var J=v,T=v,P=1;C=C;m.GetTransform(o.s_xfA,P);r.GetTransform(o.s_xfB,P);var X=o.s_fcn.Evaluate(o.s_xfA,o.s_xfB);if(X>=x){v=1;break}for(var $=0;;){var ba=0;ba=$&1?T+(x-C)*(P-T)/(X-C):0.5*(T+P);
m.GetTransform(o.s_xfA,ba);r.GetTransform(o.s_xfB,ba);var ca=o.s_fcn.Evaluate(o.s_xfA,o.s_xfB);if(w.Abs(ca-x)<0.025*b){J=ba;break}if(ca>x){T=ba;C=ca}else{P=ba;X=ca}++$;++o.b2_toiRootIters;if($==50)break}o.b2_toiMaxRootIters=w.Max(o.b2_toiMaxRootIters,$);if(J<(1+100*Number.MIN_VALUE)*v)break;v=J;t++;++o.b2_toiIters;if(t==1E3)break}o.b2_toiMaxIters=w.Max(o.b2_toiMaxIters,t);return v};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=
0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new l;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new Y;Box2D.Collision.b2TimeOfImpact.s_xfA=new U;Box2D.Collision.b2TimeOfImpact.s_xfB=new U;Box2D.Collision.b2TimeOfImpact.s_fcn=new d;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new k});q.b2TOIInput=function(){this.proxyA=new z;this.proxyB=new z;this.sweepA=
new A;this.sweepB=new A};n.b2WorldManifold=function(){this.m_normal=new p};n.prototype.b2WorldManifold=function(){this.m_points=new Vector(y.b2_maxManifoldPoints);for(var b=0;b<y.b2_maxManifoldPoints;b++)this.m_points[b]=new p};n.prototype.Initialize=function(b,e,f,m,r){if(f===undefined)f=0;if(r===undefined)r=0;if(b.m_pointCount!=0){var s=0,v,t,x=0,C=0,J=0,T=0,P=0;v=0;switch(b.m_type){case E.e_circles:t=e.R;v=b.m_localPoint;s=e.position.x+t.col1.x*v.x+t.col2.x*v.y;e=e.position.y+t.col1.y*v.x+t.col2.y*
v.y;t=m.R;v=b.m_points[0].m_localPoint;b=m.position.x+t.col1.x*v.x+t.col2.x*v.y;m=m.position.y+t.col1.y*v.x+t.col2.y*v.y;v=b-s;t=m-e;x=v*v+t*t;if(x>Number.MIN_VALUE*Number.MIN_VALUE){x=Math.sqrt(x);this.m_normal.x=v/x;this.m_normal.y=t/x}else{this.m_normal.x=1;this.m_normal.y=0}v=e+f*this.m_normal.y;m=m-r*this.m_normal.y;this.m_points[0].x=0.5*(s+f*this.m_normal.x+(b-r*this.m_normal.x));this.m_points[0].y=0.5*(v+m);break;case E.e_faceA:t=e.R;v=b.m_localPlaneNormal;x=t.col1.x*v.x+t.col2.x*v.y;C=t.col1.y*
v.x+t.col2.y*v.y;t=e.R;v=b.m_localPoint;J=e.position.x+t.col1.x*v.x+t.col2.x*v.y;T=e.position.y+t.col1.y*v.x+t.col2.y*v.y;this.m_normal.x=x;this.m_normal.y=C;for(s=0;s<b.m_pointCount;s++){t=m.R;v=b.m_points[s].m_localPoint;P=m.position.x+t.col1.x*v.x+t.col2.x*v.y;v=m.position.y+t.col1.y*v.x+t.col2.y*v.y;this.m_points[s].x=P+0.5*(f-(P-J)*x-(v-T)*C-r)*x;this.m_points[s].y=v+0.5*(f-(P-J)*x-(v-T)*C-r)*C}break;case E.e_faceB:t=m.R;v=b.m_localPlaneNormal;x=t.col1.x*v.x+t.col2.x*v.y;C=t.col1.y*v.x+t.col2.y*
v.y;t=m.R;v=b.m_localPoint;J=m.position.x+t.col1.x*v.x+t.col2.x*v.y;T=m.position.y+t.col1.y*v.x+t.col2.y*v.y;this.m_normal.x=-x;this.m_normal.y=-C;for(s=0;s<b.m_pointCount;s++){t=e.R;v=b.m_points[s].m_localPoint;P=e.position.x+t.col1.x*v.x+t.col2.x*v.y;v=e.position.y+t.col1.y*v.x+t.col2.y*v.y;this.m_points[s].x=P+0.5*(r-(P-J)*x-(v-T)*C-f)*x;this.m_points[s].y=v+0.5*(r-(P-J)*x-(v-T)*C-f)*C}}}};a.ClipVertex=function(){this.v=new p;this.id=new L};a.prototype.Set=function(b){this.v.SetV(b.v);this.id.Set(b.id)};
c.Features=function(){};Object.defineProperty(c.prototype,"referenceEdge",{enumerable:false,configurable:true,get:function(){return this._referenceEdge}});Object.defineProperty(c.prototype,"referenceEdge",{enumerable:false,configurable:true,set:function(b){if(b===undefined)b=0;this._referenceEdge=b;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(c.prototype,"incidentEdge",{enumerable:false,configurable:true,get:function(){return this._incidentEdge}});Object.defineProperty(c.prototype,
"incidentEdge",{enumerable:false,configurable:true,set:function(b){if(b===undefined)b=0;this._incidentEdge=b;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(c.prototype,"incidentVertex",{enumerable:false,configurable:true,get:function(){return this._incidentVertex}});Object.defineProperty(c.prototype,"incidentVertex",{enumerable:false,configurable:true,set:function(b){if(b===undefined)b=0;this._incidentVertex=b;this._m_id._key=this._m_id._key&4278255615|
this._incidentVertex<<16&16711680}});Object.defineProperty(c.prototype,"flip",{enumerable:false,configurable:true,get:function(){return this._flip}});Object.defineProperty(c.prototype,"flip",{enumerable:false,configurable:true,set:function(b){if(b===undefined)b=0;this._flip=b;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();
(function(){var F=Box2D.Common.b2Settings,G=Box2D.Collision.Shapes.b2CircleShape,K=Box2D.Collision.Shapes.b2EdgeChainDef,y=Box2D.Collision.Shapes.b2EdgeShape,w=Box2D.Collision.Shapes.b2MassData,A=Box2D.Collision.Shapes.b2PolygonShape,U=Box2D.Collision.Shapes.b2Shape,p=Box2D.Common.Math.b2Mat22,B=Box2D.Common.Math.b2Math,Q=Box2D.Common.Math.b2Transform,V=Box2D.Common.Math.b2Vec2,M=Box2D.Collision.b2Distance,L=Box2D.Collision.b2DistanceInput,I=Box2D.Collision.b2DistanceOutput,W=Box2D.Collision.b2DistanceProxy,
Y=Box2D.Collision.b2SimplexCache;Box2D.inherit(G,Box2D.Collision.Shapes.b2Shape);G.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;G.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new V};G.prototype.Copy=function(){var k=new G;k.Set(this);return k};G.prototype.Set=function(k){this.__super.Set.call(this,k);if(Box2D.is(k,G))this.m_p.SetV((k instanceof G?k:null).m_p)};G.prototype.TestPoint=function(k,z){var u=k.R,D=k.position.x+(u.col1.x*this.m_p.x+
u.col2.x*this.m_p.y);u=k.position.y+(u.col1.y*this.m_p.x+u.col2.y*this.m_p.y);D=z.x-D;u=z.y-u;return D*D+u*u<=this.m_radius*this.m_radius};G.prototype.RayCast=function(k,z,u){var D=u.R,H=z.p1.x-(u.position.x+(D.col1.x*this.m_p.x+D.col2.x*this.m_p.y));u=z.p1.y-(u.position.y+(D.col1.y*this.m_p.x+D.col2.y*this.m_p.y));D=z.p2.x-z.p1.x;var O=z.p2.y-z.p1.y,E=H*D+u*O,R=D*D+O*O,N=E*E-R*(H*H+u*u-this.m_radius*this.m_radius);if(N<0||R<Number.MIN_VALUE)return false;E=-(E+Math.sqrt(N));if(0<=E&&E<=z.maxFraction*
R){E/=R;k.fraction=E;k.normal.x=H+E*D;k.normal.y=u+E*O;k.normal.Normalize();return true}return false};G.prototype.ComputeAABB=function(k,z){var u=z.R,D=z.position.x+(u.col1.x*this.m_p.x+u.col2.x*this.m_p.y);u=z.position.y+(u.col1.y*this.m_p.x+u.col2.y*this.m_p.y);k.lowerBound.Set(D-this.m_radius,u-this.m_radius);k.upperBound.Set(D+this.m_radius,u+this.m_radius)};G.prototype.ComputeMass=function(k,z){if(z===undefined)z=0;k.mass=z*F.b2_pi*this.m_radius*this.m_radius;k.center.SetV(this.m_p);k.I=k.mass*
(0.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};G.prototype.ComputeSubmergedArea=function(k,z,u,D){if(z===undefined)z=0;u=B.MulX(u,this.m_p);var H=-(B.Dot(k,u)-z);if(H<-this.m_radius+Number.MIN_VALUE)return 0;if(H>this.m_radius){D.SetV(u);return Math.PI*this.m_radius*this.m_radius}z=this.m_radius*this.m_radius;var O=H*H;H=z*(Math.asin(H/this.m_radius)+Math.PI/2)+H*Math.sqrt(z-O);z=-2/3*Math.pow(z-O,1.5)/H;D.x=u.x+k.x*z;D.y=u.y+k.y*z;return H};G.prototype.GetLocalPosition=
function(){return this.m_p};G.prototype.SetLocalPosition=function(k){this.m_p.SetV(k)};G.prototype.GetRadius=function(){return this.m_radius};G.prototype.SetRadius=function(k){if(k===undefined)k=0;this.m_radius=k};G.prototype.b2CircleShape=function(k){if(k===undefined)k=0;this.__super.b2Shape.call(this);this.m_type=U.e_circleShape;this.m_radius=k};K.b2EdgeChainDef=function(){};K.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=true;this.vertices=[]};Box2D.inherit(y,Box2D.Collision.Shapes.b2Shape);
y.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;y.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new V;this.m_v1=new V;this.m_v2=new V;this.m_coreV1=new V;this.m_coreV2=new V;this.m_normal=new V;this.m_direction=new V;this.m_cornerDir1=new V;this.m_cornerDir2=new V};y.prototype.TestPoint=function(){return false};y.prototype.RayCast=function(k,z,u){var D,H=z.p2.x-z.p1.x,O=z.p2.y-z.p1.y;D=u.R;var E=u.position.x+(D.col1.x*this.m_v1.x+
D.col2.x*this.m_v1.y),R=u.position.y+(D.col1.y*this.m_v1.x+D.col2.y*this.m_v1.y),N=u.position.y+(D.col1.y*this.m_v2.x+D.col2.y*this.m_v2.y)-R;u=-(u.position.x+(D.col1.x*this.m_v2.x+D.col2.x*this.m_v2.y)-E);D=100*Number.MIN_VALUE;var S=-(H*N+O*u);if(S>D){E=z.p1.x-E;var aa=z.p1.y-R;R=E*N+aa*u;if(0<=R&&R<=z.maxFraction*S){z=-H*aa+O*E;if(-D*S<=z&&z<=S*(1+D)){R/=S;k.fraction=R;z=Math.sqrt(N*N+u*u);k.normal.x=N/z;k.normal.y=u/z;return true}}}return false};y.prototype.ComputeAABB=function(k,z){var u=z.R,
D=z.position.x+(u.col1.x*this.m_v1.x+u.col2.x*this.m_v1.y),H=z.position.y+(u.col1.y*this.m_v1.x+u.col2.y*this.m_v1.y),O=z.position.x+(u.col1.x*this.m_v2.x+u.col2.x*this.m_v2.y);u=z.position.y+(u.col1.y*this.m_v2.x+u.col2.y*this.m_v2.y);if(D<O){k.lowerBound.x=D;k.upperBound.x=O}else{k.lowerBound.x=O;k.upperBound.x=D}if(H<u){k.lowerBound.y=H;k.upperBound.y=u}else{k.lowerBound.y=u;k.upperBound.y=H}};y.prototype.ComputeMass=function(k){k.mass=0;k.center.SetV(this.m_v1);k.I=0};y.prototype.ComputeSubmergedArea=
function(k,z,u,D){if(z===undefined)z=0;var H=new V(k.x*z,k.y*z),O=B.MulX(u,this.m_v1);u=B.MulX(u,this.m_v2);var E=B.Dot(k,O)-z;k=B.Dot(k,u)-z;if(E>0)if(k>0)return 0;else{O.x=-k/(E-k)*O.x+E/(E-k)*u.x;O.y=-k/(E-k)*O.y+E/(E-k)*u.y}else if(k>0){u.x=-k/(E-k)*O.x+E/(E-k)*u.x;u.y=-k/(E-k)*O.y+E/(E-k)*u.y}D.x=(H.x+O.x+u.x)/3;D.y=(H.y+O.y+u.y)/3;return 0.5*((O.x-H.x)*(u.y-H.y)-(O.y-H.y)*(u.x-H.x))};y.prototype.GetLength=function(){return this.m_length};y.prototype.GetVertex1=function(){return this.m_v1};y.prototype.GetVertex2=
function(){return this.m_v2};y.prototype.GetCoreVertex1=function(){return this.m_coreV1};y.prototype.GetCoreVertex2=function(){return this.m_coreV2};y.prototype.GetNormalVector=function(){return this.m_normal};y.prototype.GetDirectionVector=function(){return this.m_direction};y.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};y.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};y.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};y.prototype.Corner2IsConvex=
function(){return this.m_cornerConvex2};y.prototype.GetFirstVertex=function(k){var z=k.R;return new V(k.position.x+(z.col1.x*this.m_coreV1.x+z.col2.x*this.m_coreV1.y),k.position.y+(z.col1.y*this.m_coreV1.x+z.col2.y*this.m_coreV1.y))};y.prototype.GetNextEdge=function(){return this.m_nextEdge};y.prototype.GetPrevEdge=function(){return this.m_prevEdge};y.prototype.Support=function(k,z,u){if(z===undefined)z=0;if(u===undefined)u=0;var D=k.R,H=k.position.x+(D.col1.x*this.m_coreV1.x+D.col2.x*this.m_coreV1.y),
O=k.position.y+(D.col1.y*this.m_coreV1.x+D.col2.y*this.m_coreV1.y),E=k.position.x+(D.col1.x*this.m_coreV2.x+D.col2.x*this.m_coreV2.y);k=k.position.y+(D.col1.y*this.m_coreV2.x+D.col2.y*this.m_coreV2.y);if(H*z+O*u>E*z+k*u){this.s_supportVec.x=H;this.s_supportVec.y=O}else{this.s_supportVec.x=E;this.s_supportVec.y=k}return this.s_supportVec};y.prototype.b2EdgeShape=function(k,z){this.__super.b2Shape.call(this);this.m_type=U.e_edgeShape;this.m_nextEdge=this.m_prevEdge=null;this.m_v1=k;this.m_v2=z;this.m_direction.Set(this.m_v2.x-
this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-F.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-F.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-F.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-F.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};
y.prototype.SetPrevEdge=function(k,z,u,D){this.m_prevEdge=k;this.m_coreV1=z;this.m_cornerDir1=u;this.m_cornerConvex1=D};y.prototype.SetNextEdge=function(k,z,u,D){this.m_nextEdge=k;this.m_coreV2=z;this.m_cornerDir2=u;this.m_cornerConvex2=D};w.b2MassData=function(){this.mass=0;this.center=new V(0,0);this.I=0};Box2D.inherit(A,Box2D.Collision.Shapes.b2Shape);A.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;A.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};
A.prototype.Copy=function(){var k=new A;k.Set(this);return k};A.prototype.Set=function(k){this.__super.Set.call(this,k);if(Box2D.is(k,A)){k=k instanceof A?k:null;this.m_centroid.SetV(k.m_centroid);this.m_vertexCount=k.m_vertexCount;this.Reserve(this.m_vertexCount);for(var z=0;z<this.m_vertexCount;z++){this.m_vertices[z].SetV(k.m_vertices[z]);this.m_normals[z].SetV(k.m_normals[z])}}};A.prototype.SetAsArray=function(k,z){if(z===undefined)z=0;var u=new Vector,D=0,H;for(D=0;D<k.length;++D){H=k[D];u.push(H)}this.SetAsVector(u,
z)};A.AsArray=function(k,z){if(z===undefined)z=0;var u=new A;u.SetAsArray(k,z);return u};A.prototype.SetAsVector=function(k,z){if(z===undefined)z=0;if(z==0)z=k.length;F.b2Assert(2<=z);this.m_vertexCount=z;this.Reserve(z);var u=0;for(u=0;u<this.m_vertexCount;u++)this.m_vertices[u].SetV(k[u]);for(u=0;u<this.m_vertexCount;++u){var D=parseInt(u),H=parseInt(u+1<this.m_vertexCount?u+1:0);D=B.SubtractVV(this.m_vertices[H],this.m_vertices[D]);F.b2Assert(D.LengthSquared()>Number.MIN_VALUE);this.m_normals[u].SetV(B.CrossVF(D,
1));this.m_normals[u].Normalize()}this.m_centroid=A.ComputeCentroid(this.m_vertices,this.m_vertexCount)};A.AsVector=function(k,z){if(z===undefined)z=0;var u=new A;u.SetAsVector(k,z);return u};A.prototype.SetAsBox=function(k,z){if(k===undefined)k=0;if(z===undefined)z=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-k,-z);this.m_vertices[1].Set(k,-z);this.m_vertices[2].Set(k,z);this.m_vertices[3].Set(-k,z);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,
1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};A.AsBox=function(k,z){if(k===undefined)k=0;if(z===undefined)z=0;var u=new A;u.SetAsBox(k,z);return u};A.prototype.SetAsOrientedBox=function(k,z,u,D){if(k===undefined)k=0;if(z===undefined)z=0;if(u===undefined)u=null;if(D===undefined)D=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-k,-z);this.m_vertices[1].Set(k,-z);this.m_vertices[2].Set(k,z);this.m_vertices[3].Set(-k,z);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);
this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=u;k=new Q;k.position=u;k.R.Set(D);for(u=0;u<this.m_vertexCount;++u){this.m_vertices[u]=B.MulX(k,this.m_vertices[u]);this.m_normals[u]=B.MulMV(k.R,this.m_normals[u])}};A.AsOrientedBox=function(k,z,u,D){if(k===undefined)k=0;if(z===undefined)z=0;if(u===undefined)u=null;if(D===undefined)D=0;var H=new A;H.SetAsOrientedBox(k,z,u,D);return H};A.prototype.SetAsEdge=function(k,z){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(k);
this.m_vertices[1].SetV(z);this.m_centroid.x=0.5*(k.x+z.x);this.m_centroid.y=0.5*(k.y+z.y);this.m_normals[0]=B.CrossVF(B.SubtractVV(z,k),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};A.AsEdge=function(k,z){var u=new A;u.SetAsEdge(k,z);return u};A.prototype.TestPoint=function(k,z){var u;u=k.R;for(var D=z.x-k.position.x,H=z.y-k.position.y,O=D*u.col1.x+H*u.col1.y,E=D*u.col2.x+H*u.col2.y,R=0;R<this.m_vertexCount;++R){u=this.m_vertices[R];
D=O-u.x;H=E-u.y;u=this.m_normals[R];if(u.x*D+u.y*H>0)return false}return true};A.prototype.RayCast=function(k,z,u){var D=0,H=z.maxFraction,O=0,E=0,R,N;O=z.p1.x-u.position.x;E=z.p1.y-u.position.y;R=u.R;var S=O*R.col1.x+E*R.col1.y,aa=O*R.col2.x+E*R.col2.y;O=z.p2.x-u.position.x;E=z.p2.y-u.position.y;R=u.R;z=O*R.col1.x+E*R.col1.y-S;R=O*R.col2.x+E*R.col2.y-aa;for(var Z=parseInt(-1),d=0;d<this.m_vertexCount;++d){N=this.m_vertices[d];O=N.x-S;E=N.y-aa;N=this.m_normals[d];O=N.x*O+N.y*E;E=N.x*z+N.y*R;if(E==
0){if(O<0)return false}else if(E<0&&O<D*E){D=O/E;Z=d}else if(E>0&&O<H*E)H=O/E;if(H<D-Number.MIN_VALUE)return false}if(Z>=0){k.fraction=D;R=u.R;N=this.m_normals[Z];k.normal.x=R.col1.x*N.x+R.col2.x*N.y;k.normal.y=R.col1.y*N.x+R.col2.y*N.y;return true}return false};A.prototype.ComputeAABB=function(k,z){for(var u=z.R,D=this.m_vertices[0],H=z.position.x+(u.col1.x*D.x+u.col2.x*D.y),O=z.position.y+(u.col1.y*D.x+u.col2.y*D.y),E=H,R=O,N=1;N<this.m_vertexCount;++N){D=this.m_vertices[N];var S=z.position.x+(u.col1.x*
D.x+u.col2.x*D.y);D=z.position.y+(u.col1.y*D.x+u.col2.y*D.y);H=H<S?H:S;O=O<D?O:D;E=E>S?E:S;R=R>D?R:D}k.lowerBound.x=H-this.m_radius;k.lowerBound.y=O-this.m_radius;k.upperBound.x=E+this.m_radius;k.upperBound.y=R+this.m_radius};A.prototype.ComputeMass=function(k,z){if(z===undefined)z=0;if(this.m_vertexCount==2){k.center.x=0.5*(this.m_vertices[0].x+this.m_vertices[1].x);k.center.y=0.5*(this.m_vertices[0].y+this.m_vertices[1].y);k.mass=0;k.I=0}else{for(var u=0,D=0,H=0,O=0,E=1/3,R=0;R<this.m_vertexCount;++R){var N=
this.m_vertices[R],S=R+1<this.m_vertexCount?this.m_vertices[parseInt(R+1)]:this.m_vertices[0],aa=N.x-0,Z=N.y-0,d=S.x-0,h=S.y-0,l=aa*h-Z*d,j=0.5*l;H+=j;u+=j*E*(0+N.x+S.x);D+=j*E*(0+N.y+S.y);N=aa;Z=Z;d=d;h=h;O+=l*(E*(0.25*(N*N+d*N+d*d)+(0*N+0*d))+0+(E*(0.25*(Z*Z+h*Z+h*h)+(0*Z+0*h))+0))}k.mass=z*H;u*=1/H;D*=1/H;k.center.Set(u,D);k.I=z*O}};A.prototype.ComputeSubmergedArea=function(k,z,u,D){if(z===undefined)z=0;var H=B.MulTMV(u.R,k),O=z-B.Dot(k,u.position),E=new Vector_a2j_Number,R=0,N=parseInt(-1);z=
parseInt(-1);var S=false;for(k=k=0;k<this.m_vertexCount;++k){E[k]=B.Dot(H,this.m_vertices[k])-O;var aa=E[k]<-Number.MIN_VALUE;if(k>0)if(aa){if(!S){N=k-1;R++}}else if(S){z=k-1;R++}S=aa}switch(R){case 0:if(S){k=new w;this.ComputeMass(k,1);D.SetV(B.MulX(u,k.center));return k.mass}else return 0;case 1:if(N==-1)N=this.m_vertexCount-1;else z=this.m_vertexCount-1}k=parseInt((N+1)%this.m_vertexCount);H=parseInt((z+1)%this.m_vertexCount);O=(0-E[N])/(E[k]-E[N]);E=(0-E[z])/(E[H]-E[z]);N=new V(this.m_vertices[N].x*
(1-O)+this.m_vertices[k].x*O,this.m_vertices[N].y*(1-O)+this.m_vertices[k].y*O);z=new V(this.m_vertices[z].x*(1-E)+this.m_vertices[H].x*E,this.m_vertices[z].y*(1-E)+this.m_vertices[H].y*E);E=0;O=new V;R=this.m_vertices[k];for(k=k;k!=H;){k=(k+1)%this.m_vertexCount;S=k==H?z:this.m_vertices[k];aa=0.5*((R.x-N.x)*(S.y-N.y)-(R.y-N.y)*(S.x-N.x));E+=aa;O.x+=aa*(N.x+R.x+S.x)/3;O.y+=aa*(N.y+R.y+S.y)/3;R=S}O.Multiply(1/E);D.SetV(B.MulX(u,O));return E};A.prototype.GetVertexCount=function(){return this.m_vertexCount};
A.prototype.GetVertices=function(){return this.m_vertices};A.prototype.GetNormals=function(){return this.m_normals};A.prototype.GetSupport=function(k){for(var z=0,u=this.m_vertices[0].x*k.x+this.m_vertices[0].y*k.y,D=1;D<this.m_vertexCount;++D){var H=this.m_vertices[D].x*k.x+this.m_vertices[D].y*k.y;if(H>u){z=D;u=H}}return z};A.prototype.GetSupportVertex=function(k){for(var z=0,u=this.m_vertices[0].x*k.x+this.m_vertices[0].y*k.y,D=1;D<this.m_vertexCount;++D){var H=this.m_vertices[D].x*k.x+this.m_vertices[D].y*
k.y;if(H>u){z=D;u=H}}return this.m_vertices[z]};A.prototype.Validate=function(){return false};A.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=U.e_polygonShape;this.m_centroid=new V;this.m_vertices=new Vector;this.m_normals=new Vector};A.prototype.Reserve=function(k){if(k===undefined)k=0;for(var z=parseInt(this.m_vertices.length);z<k;z++){this.m_vertices[z]=new V;this.m_normals[z]=new V}};A.ComputeCentroid=function(k,z){if(z===undefined)z=0;for(var u=new V,D=0,H=1/
3,O=0;O<z;++O){var E=k[O],R=O+1<z?k[parseInt(O+1)]:k[0],N=0.5*((E.x-0)*(R.y-0)-(E.y-0)*(R.x-0));D+=N;u.x+=N*H*(0+E.x+R.x);u.y+=N*H*(0+E.y+R.y)}u.x*=1/D;u.y*=1/D;return u};A.ComputeOBB=function(k,z,u){if(u===undefined)u=0;var D=0,H=new Vector(u+1);for(D=0;D<u;++D)H[D]=z[D];H[u]=H[0];z=Number.MAX_VALUE;for(D=1;D<=u;++D){var O=H[parseInt(D-1)],E=H[D].x-O.x,R=H[D].y-O.y,N=Math.sqrt(E*E+R*R);E/=N;R/=N;for(var S=-R,aa=E,Z=N=Number.MAX_VALUE,d=-Number.MAX_VALUE,h=-Number.MAX_VALUE,l=0;l<u;++l){var j=H[l].x-
O.x,o=H[l].y-O.y,q=E*j+R*o;j=S*j+aa*o;if(q<N)N=q;if(j<Z)Z=j;if(q>d)d=q;if(j>h)h=j}l=(d-N)*(h-Z);if(l<0.95*z){z=l;k.R.col1.x=E;k.R.col1.y=R;k.R.col2.x=S;k.R.col2.y=aa;E=0.5*(N+d);R=0.5*(Z+h);S=k.R;k.center.x=O.x+(S.col1.x*E+S.col2.x*R);k.center.y=O.y+(S.col1.y*E+S.col2.y*R);k.extents.x=0.5*(d-N);k.extents.y=0.5*(h-Z)}}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new p});U.b2Shape=function(){};U.prototype.Copy=function(){return null};U.prototype.Set=function(k){this.m_radius=
k.m_radius};U.prototype.GetType=function(){return this.m_type};U.prototype.TestPoint=function(){return false};U.prototype.RayCast=function(){return false};U.prototype.ComputeAABB=function(){};U.prototype.ComputeMass=function(){};U.prototype.ComputeSubmergedArea=function(){return 0};U.TestOverlap=function(k,z,u,D){var H=new L;H.proxyA=new W;H.proxyA.Set(k);H.proxyB=new W;H.proxyB.Set(u);H.transformA=z;H.transformB=D;H.useRadii=true;k=new Y;k.count=0;z=new I;M.Distance(z,k,H);return z.distance<10*Number.MIN_VALUE};
U.prototype.b2Shape=function(){this.m_type=U.e_unknownShape;this.m_radius=F.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=
parseInt(-1)})})();
(function(){var F=Box2D.Common.b2Color,G=Box2D.Common.b2Settings,K=Box2D.Common.Math.b2Math;F.b2Color=function(){this._b=this._g=this._r=0};F.prototype.b2Color=function(y,w,A){if(y===undefined)y=0;if(w===undefined)w=0;if(A===undefined)A=0;this._r=Box2D.parseUInt(255*K.Clamp(y,0,1));this._g=Box2D.parseUInt(255*K.Clamp(w,0,1));this._b=Box2D.parseUInt(255*K.Clamp(A,0,1))};F.prototype.Set=function(y,w,A){if(y===undefined)y=0;if(w===undefined)w=0;if(A===undefined)A=0;this._r=Box2D.parseUInt(255*K.Clamp(y,
0,1));this._g=Box2D.parseUInt(255*K.Clamp(w,0,1));this._b=Box2D.parseUInt(255*K.Clamp(A,0,1))};Object.defineProperty(F.prototype,"r",{enumerable:false,configurable:true,set:function(y){if(y===undefined)y=0;this._r=Box2D.parseUInt(255*K.Clamp(y,0,1))}});Object.defineProperty(F.prototype,"g",{enumerable:false,configurable:true,set:function(y){if(y===undefined)y=0;this._g=Box2D.parseUInt(255*K.Clamp(y,0,1))}});Object.defineProperty(F.prototype,"b",{enumerable:false,configurable:true,set:function(y){if(y===
undefined)y=0;this._b=Box2D.parseUInt(255*K.Clamp(y,0,1))}});Object.defineProperty(F.prototype,"color",{enumerable:false,configurable:true,get:function(){return this._r<<16|this._g<<8|this._b}});G.b2Settings=function(){};G.b2MixFriction=function(y,w){if(y===undefined)y=0;if(w===undefined)w=0;return Math.sqrt(y*w)};G.b2MixRestitution=function(y,w){if(y===undefined)y=0;if(w===undefined)w=0;return y>w?y:w};G.b2Assert=function(y){if(!y)throw"Assertion Failed";};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION=
"2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=0.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*G.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=0.0050;Box2D.Common.b2Settings.b2_angularSlop=2/180*G.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*G.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=
32;Box2D.Common.b2Settings.b2_velocityThreshold=1;Box2D.Common.b2Settings.b2_maxLinearCorrection=0.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*G.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=G.b2_maxTranslation*G.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=0.5*G.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=G.b2_maxRotation*G.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=0.2;Box2D.Common.b2Settings.b2_timeToSleep=
0.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=0.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*G.b2_pi})})();
(function(){var F=Box2D.Common.Math.b2Mat22,G=Box2D.Common.Math.b2Mat33,K=Box2D.Common.Math.b2Math,y=Box2D.Common.Math.b2Sweep,w=Box2D.Common.Math.b2Transform,A=Box2D.Common.Math.b2Vec2,U=Box2D.Common.Math.b2Vec3;F.b2Mat22=function(){this.col1=new A;this.col2=new A};F.prototype.b2Mat22=function(){this.SetIdentity()};F.FromAngle=function(p){if(p===undefined)p=0;var B=new F;B.Set(p);return B};F.FromVV=function(p,B){var Q=new F;Q.SetVV(p,B);return Q};F.prototype.Set=function(p){if(p===undefined)p=0;
var B=Math.cos(p);p=Math.sin(p);this.col1.x=B;this.col2.x=-p;this.col1.y=p;this.col2.y=B};F.prototype.SetVV=function(p,B){this.col1.SetV(p);this.col2.SetV(B)};F.prototype.Copy=function(){var p=new F;p.SetM(this);return p};F.prototype.SetM=function(p){this.col1.SetV(p.col1);this.col2.SetV(p.col2)};F.prototype.AddM=function(p){this.col1.x+=p.col1.x;this.col1.y+=p.col1.y;this.col2.x+=p.col2.x;this.col2.y+=p.col2.y};F.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=
1};F.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};F.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};F.prototype.GetInverse=function(p){var B=this.col1.x,Q=this.col2.x,V=this.col1.y,M=this.col2.y,L=B*M-Q*V;if(L!=0)L=1/L;p.col1.x=L*M;p.col2.x=-L*Q;p.col1.y=-L*V;p.col2.y=L*B;return p};F.prototype.Solve=function(p,B,Q){if(B===undefined)B=0;if(Q===undefined)Q=0;var V=this.col1.x,M=this.col2.x,L=this.col1.y,I=this.col2.y,W=V*I-M*L;if(W!=
0)W=1/W;p.x=W*(I*B-M*Q);p.y=W*(V*Q-L*B);return p};F.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};G.b2Mat33=function(){this.col1=new U;this.col2=new U;this.col3=new U};G.prototype.b2Mat33=function(p,B,Q){if(p===undefined)p=null;if(B===undefined)B=null;if(Q===undefined)Q=null;if(!p&&!B&&!Q){this.col1.SetZero();this.col2.SetZero();this.col3.SetZero()}else{this.col1.SetV(p);this.col2.SetV(B);this.col3.SetV(Q)}};G.prototype.SetVVV=function(p,B,Q){this.col1.SetV(p);this.col2.SetV(B);this.col3.SetV(Q)};
G.prototype.Copy=function(){return new G(this.col1,this.col2,this.col3)};G.prototype.SetM=function(p){this.col1.SetV(p.col1);this.col2.SetV(p.col2);this.col3.SetV(p.col3)};G.prototype.AddM=function(p){this.col1.x+=p.col1.x;this.col1.y+=p.col1.y;this.col1.z+=p.col1.z;this.col2.x+=p.col2.x;this.col2.y+=p.col2.y;this.col2.z+=p.col2.z;this.col3.x+=p.col3.x;this.col3.y+=p.col3.y;this.col3.z+=p.col3.z};G.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=
1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};G.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};G.prototype.Solve22=function(p,B,Q){if(B===undefined)B=0;if(Q===undefined)Q=0;var V=this.col1.x,M=this.col2.x,L=this.col1.y,I=this.col2.y,W=V*I-M*L;if(W!=0)W=1/W;p.x=W*(I*B-M*Q);p.y=W*(V*Q-L*B);return p};G.prototype.Solve33=function(p,B,Q,V){if(B===undefined)B=0;if(Q===undefined)Q=0;
if(V===undefined)V=0;var M=this.col1.x,L=this.col1.y,I=this.col1.z,W=this.col2.x,Y=this.col2.y,k=this.col2.z,z=this.col3.x,u=this.col3.y,D=this.col3.z,H=M*(Y*D-k*u)+L*(k*z-W*D)+I*(W*u-Y*z);if(H!=0)H=1/H;p.x=H*(B*(Y*D-k*u)+Q*(k*z-W*D)+V*(W*u-Y*z));p.y=H*(M*(Q*D-V*u)+L*(V*z-B*D)+I*(B*u-Q*z));p.z=H*(M*(Y*V-k*Q)+L*(k*B-W*V)+I*(W*Q-Y*B));return p};K.b2Math=function(){};K.IsValid=function(p){if(p===undefined)p=0;return isFinite(p)};K.Dot=function(p,B){return p.x*B.x+p.y*B.y};K.CrossVV=function(p,B){return p.x*
B.y-p.y*B.x};K.CrossVF=function(p,B){if(B===undefined)B=0;return new A(B*p.y,-B*p.x)};K.CrossFV=function(p,B){if(p===undefined)p=0;return new A(-p*B.y,p*B.x)};K.MulMV=function(p,B){return new A(p.col1.x*B.x+p.col2.x*B.y,p.col1.y*B.x+p.col2.y*B.y)};K.MulTMV=function(p,B){return new A(K.Dot(B,p.col1),K.Dot(B,p.col2))};K.MulX=function(p,B){var Q=K.MulMV(p.R,B);Q.x+=p.position.x;Q.y+=p.position.y;return Q};K.MulXT=function(p,B){var Q=K.SubtractVV(B,p.position),V=Q.x*p.R.col1.x+Q.y*p.R.col1.y;Q.y=Q.x*
p.R.col2.x+Q.y*p.R.col2.y;Q.x=V;return Q};K.AddVV=function(p,B){return new A(p.x+B.x,p.y+B.y)};K.SubtractVV=function(p,B){return new A(p.x-B.x,p.y-B.y)};K.Distance=function(p,B){var Q=p.x-B.x,V=p.y-B.y;return Math.sqrt(Q*Q+V*V)};K.DistanceSquared=function(p,B){var Q=p.x-B.x,V=p.y-B.y;return Q*Q+V*V};K.MulFV=function(p,B){if(p===undefined)p=0;return new A(p*B.x,p*B.y)};K.AddMM=function(p,B){return F.FromVV(K.AddVV(p.col1,B.col1),K.AddVV(p.col2,B.col2))};K.MulMM=function(p,B){return F.FromVV(K.MulMV(p,
B.col1),K.MulMV(p,B.col2))};K.MulTMM=function(p,B){var Q=new A(K.Dot(p.col1,B.col1),K.Dot(p.col2,B.col1)),V=new A(K.Dot(p.col1,B.col2),K.Dot(p.col2,B.col2));return F.FromVV(Q,V)};K.Abs=function(p){if(p===undefined)p=0;return p>0?p:-p};K.AbsV=function(p){return new A(K.Abs(p.x),K.Abs(p.y))};K.AbsM=function(p){return F.FromVV(K.AbsV(p.col1),K.AbsV(p.col2))};K.Min=function(p,B){if(p===undefined)p=0;if(B===undefined)B=0;return p<B?p:B};K.MinV=function(p,B){return new A(K.Min(p.x,B.x),K.Min(p.y,B.y))};
K.Max=function(p,B){if(p===undefined)p=0;if(B===undefined)B=0;return p>B?p:B};K.MaxV=function(p,B){return new A(K.Max(p.x,B.x),K.Max(p.y,B.y))};K.Clamp=function(p,B,Q){if(p===undefined)p=0;if(B===undefined)B=0;if(Q===undefined)Q=0;return p<B?B:p>Q?Q:p};K.ClampV=function(p,B,Q){return K.MaxV(B,K.MinV(p,Q))};K.Swap=function(p,B){var Q=p[0];p[0]=B[0];B[0]=Q};K.Random=function(){return Math.random()*2-1};K.RandomRange=function(p,B){if(p===undefined)p=0;if(B===undefined)B=0;var Q=Math.random();return Q=
(B-p)*Q+p};K.NextPowerOfTwo=function(p){if(p===undefined)p=0;p|=p>>1&2147483647;p|=p>>2&1073741823;p|=p>>4&268435455;p|=p>>8&16777215;p|=p>>16&65535;return p+1};K.IsPowerOfTwo=function(p){if(p===undefined)p=0;return p>0&&(p&p-1)==0};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new A(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=F.FromVV(new A(1,0),new A(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new w(K.b2Vec2_zero,K.b2Mat22_identity)});y.b2Sweep=function(){this.localCenter=
new A;this.c0=new A;this.c=new A};y.prototype.Set=function(p){this.localCenter.SetV(p.localCenter);this.c0.SetV(p.c0);this.c.SetV(p.c);this.a0=p.a0;this.a=p.a;this.t0=p.t0};y.prototype.Copy=function(){var p=new y;p.localCenter.SetV(this.localCenter);p.c0.SetV(this.c0);p.c.SetV(this.c);p.a0=this.a0;p.a=this.a;p.t0=this.t0;return p};y.prototype.GetTransform=function(p,B){if(B===undefined)B=0;p.position.x=(1-B)*this.c0.x+B*this.c.x;p.position.y=(1-B)*this.c0.y+B*this.c.y;p.R.Set((1-B)*this.a0+B*this.a);
var Q=p.R;p.position.x-=Q.col1.x*this.localCenter.x+Q.col2.x*this.localCenter.y;p.position.y-=Q.col1.y*this.localCenter.x+Q.col2.y*this.localCenter.y};y.prototype.Advance=function(p){if(p===undefined)p=0;if(this.t0<p&&1-this.t0>Number.MIN_VALUE){var B=(p-this.t0)/(1-this.t0);this.c0.x=(1-B)*this.c0.x+B*this.c.x;this.c0.y=(1-B)*this.c0.y+B*this.c.y;this.a0=(1-B)*this.a0+B*this.a;this.t0=p}};w.b2Transform=function(){this.position=new A;this.R=new F};w.prototype.b2Transform=function(p,B){if(p===undefined)p=
null;if(B===undefined)B=null;if(p){this.position.SetV(p);this.R.SetM(B)}};w.prototype.Initialize=function(p,B){this.position.SetV(p);this.R.SetM(B)};w.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};w.prototype.Set=function(p){this.position.SetV(p.position);this.R.SetM(p.R)};w.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};A.b2Vec2=function(){};A.prototype.b2Vec2=function(p,B){if(p===undefined)p=0;if(B===undefined)B=0;this.x=p;this.y=B};
A.prototype.SetZero=function(){this.y=this.x=0};A.prototype.Set=function(p,B){if(p===undefined)p=0;if(B===undefined)B=0;this.x=p;this.y=B};A.prototype.SetV=function(p){this.x=p.x;this.y=p.y};A.prototype.GetNegative=function(){return new A(-this.x,-this.y)};A.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};A.Make=function(p,B){if(p===undefined)p=0;if(B===undefined)B=0;return new A(p,B)};A.prototype.Copy=function(){return new A(this.x,this.y)};A.prototype.Add=function(p){this.x+=p.x;
this.y+=p.y};A.prototype.Subtract=function(p){this.x-=p.x;this.y-=p.y};A.prototype.Multiply=function(p){if(p===undefined)p=0;this.x*=p;this.y*=p};A.prototype.MulM=function(p){var B=this.x;this.x=p.col1.x*B+p.col2.x*this.y;this.y=p.col1.y*B+p.col2.y*this.y};A.prototype.MulTM=function(p){var B=K.Dot(this,p.col1);this.y=K.Dot(this,p.col2);this.x=B};A.prototype.CrossVF=function(p){if(p===undefined)p=0;var B=this.x;this.x=p*this.y;this.y=-p*B};A.prototype.CrossFV=function(p){if(p===undefined)p=0;var B=
this.x;this.x=-p*this.y;this.y=p*B};A.prototype.MinV=function(p){this.x=this.x<p.x?this.x:p.x;this.y=this.y<p.y?this.y:p.y};A.prototype.MaxV=function(p){this.x=this.x>p.x?this.x:p.x;this.y=this.y>p.y?this.y:p.y};A.prototype.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};A.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};A.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};A.prototype.Normalize=function(){var p=Math.sqrt(this.x*this.x+
this.y*this.y);if(p<Number.MIN_VALUE)return 0;var B=1/p;this.x*=B;this.y*=B;return p};A.prototype.IsValid=function(){return K.IsValid(this.x)&&K.IsValid(this.y)};U.b2Vec3=function(){};U.prototype.b2Vec3=function(p,B,Q){if(p===undefined)p=0;if(B===undefined)B=0;if(Q===undefined)Q=0;this.x=p;this.y=B;this.z=Q};U.prototype.SetZero=function(){this.x=this.y=this.z=0};U.prototype.Set=function(p,B,Q){if(p===undefined)p=0;if(B===undefined)B=0;if(Q===undefined)Q=0;this.x=p;this.y=B;this.z=Q};U.prototype.SetV=
function(p){this.x=p.x;this.y=p.y;this.z=p.z};U.prototype.GetNegative=function(){return new U(-this.x,-this.y,-this.z)};U.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};U.prototype.Copy=function(){return new U(this.x,this.y,this.z)};U.prototype.Add=function(p){this.x+=p.x;this.y+=p.y;this.z+=p.z};U.prototype.Subtract=function(p){this.x-=p.x;this.y-=p.y;this.z-=p.z};U.prototype.Multiply=function(p){if(p===undefined)p=0;this.x*=p;this.y*=p;this.z*=p}})();
(function(){var F=Box2D.Common.Math.b2Math,G=Box2D.Common.Math.b2Sweep,K=Box2D.Common.Math.b2Transform,y=Box2D.Common.Math.b2Vec2,w=Box2D.Common.b2Color,A=Box2D.Common.b2Settings,U=Box2D.Collision.b2AABB,p=Box2D.Collision.b2ContactPoint,B=Box2D.Collision.b2DynamicTreeBroadPhase,Q=Box2D.Collision.b2RayCastInput,V=Box2D.Collision.b2RayCastOutput,M=Box2D.Collision.Shapes.b2CircleShape,L=Box2D.Collision.Shapes.b2EdgeShape,I=Box2D.Collision.Shapes.b2MassData,W=Box2D.Collision.Shapes.b2PolygonShape,Y=Box2D.Collision.Shapes.b2Shape,
k=Box2D.Dynamics.b2Body,z=Box2D.Dynamics.b2BodyDef,u=Box2D.Dynamics.b2ContactFilter,D=Box2D.Dynamics.b2ContactImpulse,H=Box2D.Dynamics.b2ContactListener,O=Box2D.Dynamics.b2ContactManager,E=Box2D.Dynamics.b2DebugDraw,R=Box2D.Dynamics.b2DestructionListener,N=Box2D.Dynamics.b2FilterData,S=Box2D.Dynamics.b2Fixture,aa=Box2D.Dynamics.b2FixtureDef,Z=Box2D.Dynamics.b2Island,d=Box2D.Dynamics.b2TimeStep,h=Box2D.Dynamics.b2World,l=Box2D.Dynamics.Contacts.b2Contact,j=Box2D.Dynamics.Contacts.b2ContactFactory,
o=Box2D.Dynamics.Contacts.b2ContactSolver,q=Box2D.Dynamics.Joints.b2Joint,n=Box2D.Dynamics.Joints.b2PulleyJoint;k.b2Body=function(){this.m_xf=new K;this.m_sweep=new G;this.m_linearVelocity=new y;this.m_force=new y};k.prototype.connectEdges=function(a,c,g){if(g===undefined)g=0;var b=Math.atan2(c.GetDirectionVector().y,c.GetDirectionVector().x);g=F.MulFV(Math.tan((b-g)*0.5),c.GetDirectionVector());g=F.SubtractVV(g,c.GetNormalVector());g=F.MulFV(A.b2_toiSlop,g);g=F.AddVV(g,c.GetVertex1());var e=F.AddVV(a.GetDirectionVector(),
c.GetDirectionVector());e.Normalize();var f=F.Dot(a.GetDirectionVector(),c.GetNormalVector())>0;a.SetNextEdge(c,g,e,f);c.SetPrevEdge(a,g,e,f);return b};k.prototype.CreateFixture=function(a){if(this.m_world.IsLocked()==true)return null;var c=new S;c.Create(this,this.m_xf,a);this.m_flags&k.e_activeFlag&&c.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);c.m_next=this.m_fixtureList;this.m_fixtureList=c;++this.m_fixtureCount;c.m_body=this;c.m_density>0&&this.ResetMassData();this.m_world.m_flags|=
h.e_newFixture;return c};k.prototype.CreateFixture2=function(a,c){if(c===undefined)c=0;var g=new aa;g.shape=a;g.density=c;return this.CreateFixture(g)};k.prototype.DestroyFixture=function(a){if(this.m_world.IsLocked()!=true){for(var c=this.m_fixtureList,g=null;c!=null;){if(c==a){if(g)g.m_next=a.m_next;else this.m_fixtureList=a.m_next;break}g=c;c=c.m_next}for(c=this.m_contactList;c;){g=c.contact;c=c.next;var b=g.GetFixtureA(),e=g.GetFixtureB();if(a==b||a==e)this.m_world.m_contactManager.Destroy(g)}this.m_flags&
k.e_activeFlag&&a.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);a.Destroy();a.m_body=null;a.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};k.prototype.SetPositionAndAngle=function(a,c){if(c===undefined)c=0;var g;if(this.m_world.IsLocked()!=true){this.m_xf.R.Set(c);this.m_xf.position.SetV(a);g=this.m_xf.R;var b=this.m_sweep.localCenter;this.m_sweep.c.x=g.col1.x*b.x+g.col2.x*b.y;this.m_sweep.c.y=g.col1.y*b.x+g.col2.y*b.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=
this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=c;b=this.m_world.m_contactManager.m_broadPhase;for(g=this.m_fixtureList;g;g=g.m_next)g.Synchronize(b,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}};k.prototype.SetTransform=function(a){this.SetPositionAndAngle(a.position,a.GetAngle())};k.prototype.GetTransform=function(){return this.m_xf};k.prototype.GetPosition=function(){return this.m_xf.position};k.prototype.SetPosition=function(a){this.SetPositionAndAngle(a,
this.GetAngle())};k.prototype.GetAngle=function(){return this.m_sweep.a};k.prototype.SetAngle=function(a){if(a===undefined)a=0;this.SetPositionAndAngle(this.GetPosition(),a)};k.prototype.GetWorldCenter=function(){return this.m_sweep.c};k.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};k.prototype.SetLinearVelocity=function(a){this.m_type!=k.b2_staticBody&&this.m_linearVelocity.SetV(a)};k.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};k.prototype.SetAngularVelocity=
function(a){if(a===undefined)a=0;if(this.m_type!=k.b2_staticBody)this.m_angularVelocity=a};k.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};k.prototype.GetDefinition=function(){var a=new z;a.type=this.GetType();a.allowSleep=(this.m_flags&k.e_allowSleepFlag)==k.e_allowSleepFlag;a.angle=this.GetAngle();a.angularDamping=this.m_angularDamping;a.angularVelocity=this.m_angularVelocity;a.fixedRotation=(this.m_flags&k.e_fixedRotationFlag)==k.e_fixedRotationFlag;a.bullet=(this.m_flags&
k.e_bulletFlag)==k.e_bulletFlag;a.awake=(this.m_flags&k.e_awakeFlag)==k.e_awakeFlag;a.linearDamping=this.m_linearDamping;a.linearVelocity.SetV(this.GetLinearVelocity());a.position=this.GetPosition();a.userData=this.GetUserData();return a};k.prototype.ApplyForce=function(a,c){if(this.m_type==k.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_force.x+=a.x;this.m_force.y+=a.y;this.m_torque+=(c.x-this.m_sweep.c.x)*a.y-(c.y-this.m_sweep.c.y)*a.x}};k.prototype.ApplyTorque=function(a){if(a===
undefined)a=0;if(this.m_type==k.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_torque+=a}};k.prototype.ApplyImpulse=function(a,c){if(this.m_type==k.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_linearVelocity.x+=this.m_invMass*a.x;this.m_linearVelocity.y+=this.m_invMass*a.y;this.m_angularVelocity+=this.m_invI*((c.x-this.m_sweep.c.x)*a.y-(c.y-this.m_sweep.c.y)*a.x)}};k.prototype.Split=function(a){for(var c=this.GetLinearVelocity().Copy(),g=this.GetAngularVelocity(),
b=this.GetWorldCenter(),e=this.m_world.CreateBody(this.GetDefinition()),f,m=this.m_fixtureList;m;)if(a(m)){var r=m.m_next;if(f)f.m_next=r;else this.m_fixtureList=r;this.m_fixtureCount--;m.m_next=e.m_fixtureList;e.m_fixtureList=m;e.m_fixtureCount++;m.m_body=e;m=r}else{f=m;m=m.m_next}this.ResetMassData();e.ResetMassData();f=this.GetWorldCenter();a=e.GetWorldCenter();f=F.AddVV(c,F.CrossFV(g,F.SubtractVV(f,b)));c=F.AddVV(c,F.CrossFV(g,F.SubtractVV(a,b)));this.SetLinearVelocity(f);e.SetLinearVelocity(c);
this.SetAngularVelocity(g);e.SetAngularVelocity(g);this.SynchronizeFixtures();e.SynchronizeFixtures();return e};k.prototype.Merge=function(a){var c;for(c=a.m_fixtureList;c;){var g=c.m_next;a.m_fixtureCount--;c.m_next=this.m_fixtureList;this.m_fixtureList=c;this.m_fixtureCount++;c.m_body=e;c=g}b.m_fixtureCount=0;var b=this,e=a;b.GetWorldCenter();e.GetWorldCenter();b.GetLinearVelocity().Copy();e.GetLinearVelocity().Copy();b.GetAngularVelocity();e.GetAngularVelocity();b.ResetMassData();this.SynchronizeFixtures()};
k.prototype.GetMass=function(){return this.m_mass};k.prototype.GetInertia=function(){return this.m_I};k.prototype.GetMassData=function(a){a.mass=this.m_mass;a.I=this.m_I;a.center.SetV(this.m_sweep.localCenter)};k.prototype.SetMassData=function(a){A.b2Assert(this.m_world.IsLocked()==false);if(this.m_world.IsLocked()!=true)if(this.m_type==k.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=a.mass;if(this.m_mass<=0)this.m_mass=1;this.m_invMass=1/this.m_mass;if(a.I>0&&(this.m_flags&k.e_fixedRotationFlag)==
0){this.m_I=a.I-this.m_mass*(a.center.x*a.center.x+a.center.y*a.center.y);this.m_invI=1/this.m_I}var c=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a.center);this.m_sweep.c0.SetV(F.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-c.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-c.x)}};k.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();
if(!(this.m_type==k.b2_staticBody||this.m_type==k.b2_kinematicBody)){for(var a=y.Make(0,0),c=this.m_fixtureList;c;c=c.m_next)if(c.m_density!=0){var g=c.GetMassData();this.m_mass+=g.mass;a.x+=g.center.x*g.mass;a.y+=g.center.y*g.mass;this.m_I+=g.I}if(this.m_mass>0){this.m_invMass=1/this.m_mass;a.x*=this.m_invMass;a.y*=this.m_invMass}else this.m_invMass=this.m_mass=1;if(this.m_I>0&&(this.m_flags&k.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(a.x*a.x+a.y*a.y);this.m_I*=this.m_inertiaScale;A.b2Assert(this.m_I>
0);this.m_invI=1/this.m_I}else this.m_invI=this.m_I=0;c=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a);this.m_sweep.c0.SetV(F.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-c.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-c.x)}};k.prototype.GetWorldPoint=function(a){var c=this.m_xf.R;a=new y(c.col1.x*a.x+c.col2.x*a.y,c.col1.y*a.x+c.col2.y*a.y);a.x+=this.m_xf.position.x;
a.y+=this.m_xf.position.y;return a};k.prototype.GetWorldVector=function(a){return F.MulMV(this.m_xf.R,a)};k.prototype.GetLocalPoint=function(a){return F.MulXT(this.m_xf,a)};k.prototype.GetLocalVector=function(a){return F.MulTMV(this.m_xf.R,a)};k.prototype.GetLinearVelocityFromWorldPoint=function(a){return new y(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))};k.prototype.GetLinearVelocityFromLocalPoint=function(a){var c=
this.m_xf.R;a=new y(c.col1.x*a.x+c.col2.x*a.y,c.col1.y*a.x+c.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;return new y(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))};k.prototype.GetLinearDamping=function(){return this.m_linearDamping};k.prototype.SetLinearDamping=function(a){if(a===undefined)a=0;this.m_linearDamping=a};k.prototype.GetAngularDamping=function(){return this.m_angularDamping};
k.prototype.SetAngularDamping=function(a){if(a===undefined)a=0;this.m_angularDamping=a};k.prototype.SetType=function(a){if(a===undefined)a=0;if(this.m_type!=a){this.m_type=a;this.ResetMassData();if(this.m_type==k.b2_staticBody){this.m_linearVelocity.SetZero();this.m_angularVelocity=0}this.SetAwake(true);this.m_force.SetZero();this.m_torque=0;for(a=this.m_contactList;a;a=a.next)a.contact.FlagForFiltering()}};k.prototype.GetType=function(){return this.m_type};k.prototype.SetBullet=function(a){if(a)this.m_flags|=
k.e_bulletFlag;else this.m_flags&=~k.e_bulletFlag};k.prototype.IsBullet=function(){return(this.m_flags&k.e_bulletFlag)==k.e_bulletFlag};k.prototype.SetSleepingAllowed=function(a){if(a)this.m_flags|=k.e_allowSleepFlag;else{this.m_flags&=~k.e_allowSleepFlag;this.SetAwake(true)}};k.prototype.SetAwake=function(a){if(a){this.m_flags|=k.e_awakeFlag;this.m_sleepTime=0}else{this.m_flags&=~k.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=
0}};k.prototype.IsAwake=function(){return(this.m_flags&k.e_awakeFlag)==k.e_awakeFlag};k.prototype.SetFixedRotation=function(a){if(a)this.m_flags|=k.e_fixedRotationFlag;else this.m_flags&=~k.e_fixedRotationFlag;this.ResetMassData()};k.prototype.IsFixedRotation=function(){return(this.m_flags&k.e_fixedRotationFlag)==k.e_fixedRotationFlag};k.prototype.SetActive=function(a){if(a!=this.IsActive()){var c;if(a){this.m_flags|=k.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=
c.m_next)c.CreateProxy(a,this.m_xf)}else{this.m_flags&=~k.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=c.m_next)c.DestroyProxy(a);for(a=this.m_contactList;a;){c=a;a=a.next;this.m_world.m_contactManager.Destroy(c.contact)}this.m_contactList=null}}};k.prototype.IsActive=function(){return(this.m_flags&k.e_activeFlag)==k.e_activeFlag};k.prototype.IsSleepingAllowed=function(){return(this.m_flags&k.e_allowSleepFlag)==k.e_allowSleepFlag};k.prototype.GetFixtureList=
function(){return this.m_fixtureList};k.prototype.GetJointList=function(){return this.m_jointList};k.prototype.GetControllerList=function(){return this.m_controllerList};k.prototype.GetContactList=function(){return this.m_contactList};k.prototype.GetNext=function(){return this.m_next};k.prototype.GetUserData=function(){return this.m_userData};k.prototype.SetUserData=function(a){this.m_userData=a};k.prototype.GetWorld=function(){return this.m_world};k.prototype.b2Body=function(a,c){this.m_flags=0;
if(a.bullet)this.m_flags|=k.e_bulletFlag;if(a.fixedRotation)this.m_flags|=k.e_fixedRotationFlag;if(a.allowSleep)this.m_flags|=k.e_allowSleepFlag;if(a.awake)this.m_flags|=k.e_awakeFlag;if(a.active)this.m_flags|=k.e_activeFlag;this.m_world=c;this.m_xf.position.SetV(a.position);this.m_xf.R.Set(a.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=a.angle;var g=this.m_xf.R,b=this.m_sweep.localCenter;this.m_sweep.c.x=g.col1.x*b.x+g.col2.x*b.y;this.m_sweep.c.y=g.col1.y*
b.x+g.col2.y*b.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_contactList=this.m_controllerList=this.m_jointList=null;this.m_controllerCount=0;this.m_next=this.m_prev=null;this.m_linearVelocity.SetV(a.linearVelocity);this.m_angularVelocity=a.angularVelocity;this.m_linearDamping=a.linearDamping;this.m_angularDamping=a.angularDamping;this.m_force.Set(0,0);this.m_sleepTime=this.m_torque=0;this.m_type=a.type;if(this.m_type==
k.b2_dynamicBody)this.m_invMass=this.m_mass=1;else this.m_invMass=this.m_mass=0;this.m_invI=this.m_I=0;this.m_inertiaScale=a.inertiaScale;this.m_userData=a.userData;this.m_fixtureList=null;this.m_fixtureCount=0};k.prototype.SynchronizeFixtures=function(){var a=k.s_xf1;a.R.Set(this.m_sweep.a0);var c=a.R,g=this.m_sweep.localCenter;a.position.x=this.m_sweep.c0.x-(c.col1.x*g.x+c.col2.x*g.y);a.position.y=this.m_sweep.c0.y-(c.col1.y*g.x+c.col2.y*g.y);g=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=
c.m_next)c.Synchronize(g,a,this.m_xf)};k.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var a=this.m_xf.R,c=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*c.x+a.col2.x*c.y);this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*c.x+a.col2.y*c.y)};k.prototype.ShouldCollide=function(a){if(this.m_type!=k.b2_dynamicBody&&a.m_type!=k.b2_dynamicBody)return false;for(var c=this.m_jointList;c;c=c.next)if(c.other==a)if(c.joint.m_collideConnected==false)return false;
return true};k.prototype.Advance=function(a){if(a===undefined)a=0;this.m_sweep.Advance(a);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new K;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=
0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});z.b2BodyDef=function(){this.position=new y;this.linearVelocity=new y};z.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=true;this.bullet=this.fixedRotation=false;this.type=k.b2_staticBody;this.active=true;this.inertiaScale=1};u.b2ContactFilter=function(){};u.prototype.ShouldCollide=
function(a,c){var g=a.GetFilterData(),b=c.GetFilterData();if(g.groupIndex==b.groupIndex&&g.groupIndex!=0)return g.groupIndex>0;return(g.maskBits&b.categoryBits)!=0&&(g.categoryBits&b.maskBits)!=0};u.prototype.RayCollide=function(a,c){if(!a)return true;return this.ShouldCollide(a instanceof S?a:null,c)};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new u});D.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(A.b2_maxManifoldPoints);this.tangentImpulses=
new Vector_a2j_Number(A.b2_maxManifoldPoints)};H.b2ContactListener=function(){};H.prototype.BeginContact=function(){};H.prototype.EndContact=function(){};H.prototype.PreSolve=function(){};H.prototype.PostSolve=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new H});O.b2ContactManager=function(){};O.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=u.b2_defaultFilter;this.m_contactListener=H.b2_defaultListener;
this.m_contactFactory=new j(this.m_allocator);this.m_broadPhase=new B};O.prototype.AddPair=function(a,c){var g=a instanceof S?a:null,b=c instanceof S?c:null,e=g.GetBody(),f=b.GetBody();if(e!=f){for(var m=f.GetContactList();m;){if(m.other==e){var r=m.contact.GetFixtureA(),s=m.contact.GetFixtureB();if(r==g&&s==b)return;if(r==b&&s==g)return}m=m.next}if(f.ShouldCollide(e)!=false)if(this.m_contactFilter.ShouldCollide(g,b)!=false){m=this.m_contactFactory.Create(g,b);g=m.GetFixtureA();b=m.GetFixtureB();
e=g.m_body;f=b.m_body;m.m_prev=null;m.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null)this.m_world.m_contactList.m_prev=m;this.m_world.m_contactList=m;m.m_nodeA.contact=m;m.m_nodeA.other=f;m.m_nodeA.prev=null;m.m_nodeA.next=e.m_contactList;if(e.m_contactList!=null)e.m_contactList.prev=m.m_nodeA;e.m_contactList=m.m_nodeA;m.m_nodeB.contact=m;m.m_nodeB.other=e;m.m_nodeB.prev=null;m.m_nodeB.next=f.m_contactList;if(f.m_contactList!=null)f.m_contactList.prev=m.m_nodeB;f.m_contactList=
m.m_nodeB;++this.m_world.m_contactCount}}};O.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};O.prototype.Destroy=function(a){var c=a.GetFixtureA(),g=a.GetFixtureB();c=c.GetBody();g=g.GetBody();a.IsTouching()&&this.m_contactListener.EndContact(a);if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_world.m_contactList)this.m_world.m_contactList=a.m_next;if(a.m_nodeA.prev)a.m_nodeA.prev.next=a.m_nodeA.next;
if(a.m_nodeA.next)a.m_nodeA.next.prev=a.m_nodeA.prev;if(a.m_nodeA==c.m_contactList)c.m_contactList=a.m_nodeA.next;if(a.m_nodeB.prev)a.m_nodeB.prev.next=a.m_nodeB.next;if(a.m_nodeB.next)a.m_nodeB.next.prev=a.m_nodeB.prev;if(a.m_nodeB==g.m_contactList)g.m_contactList=a.m_nodeB.next;this.m_contactFactory.Destroy(a);--this.m_contactCount};O.prototype.Collide=function(){for(var a=this.m_world.m_contactList;a;){var c=a.GetFixtureA(),g=a.GetFixtureB(),b=c.GetBody(),e=g.GetBody();if(b.IsAwake()==false&&e.IsAwake()==
false)a=a.GetNext();else{if(a.m_flags&l.e_filterFlag){if(e.ShouldCollide(b)==false){c=a;a=c.GetNext();this.Destroy(c);continue}if(this.m_contactFilter.ShouldCollide(c,g)==false){c=a;a=c.GetNext();this.Destroy(c);continue}a.m_flags&=~l.e_filterFlag}if(this.m_broadPhase.TestOverlap(c.m_proxy,g.m_proxy)==false){c=a;a=c.GetNext();this.Destroy(c)}else{a.Update(this.m_contactListener);a=a.GetNext()}}}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new p});E.b2DebugDraw=function(){};
E.prototype.b2DebugDraw=function(){};E.prototype.SetFlags=function(){};E.prototype.GetFlags=function(){};E.prototype.AppendFlags=function(){};E.prototype.ClearFlags=function(){};E.prototype.SetSprite=function(){};E.prototype.GetSprite=function(){};E.prototype.SetDrawScale=function(){};E.prototype.GetDrawScale=function(){};E.prototype.SetLineThickness=function(){};E.prototype.GetLineThickness=function(){};E.prototype.SetAlpha=function(){};E.prototype.GetAlpha=function(){};E.prototype.SetFillAlpha=
function(){};E.prototype.GetFillAlpha=function(){};E.prototype.SetXFormScale=function(){};E.prototype.GetXFormScale=function(){};E.prototype.DrawPolygon=function(){};E.prototype.DrawSolidPolygon=function(){};E.prototype.DrawCircle=function(){};E.prototype.DrawSolidCircle=function(){};E.prototype.DrawSegment=function(){};E.prototype.DrawTransform=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=
4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});R.b2DestructionListener=function(){};R.prototype.SayGoodbyeJoint=function(){};R.prototype.SayGoodbyeFixture=function(){};N.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};N.prototype.Copy=function(){var a=new N;a.categoryBits=this.categoryBits;a.maskBits=this.maskBits;a.groupIndex=this.groupIndex;return a};S.b2Fixture=function(){this.m_filter=
new N};S.prototype.GetType=function(){return this.m_shape.GetType()};S.prototype.GetShape=function(){return this.m_shape};S.prototype.SetSensor=function(a){if(this.m_isSensor!=a){this.m_isSensor=a;if(this.m_body!=null)for(a=this.m_body.GetContactList();a;){var c=a.contact,g=c.GetFixtureA(),b=c.GetFixtureB();if(g==this||b==this)c.SetSensor(g.IsSensor()||b.IsSensor());a=a.next}}};S.prototype.IsSensor=function(){return this.m_isSensor};S.prototype.SetFilterData=function(a){this.m_filter=a.Copy();if(!this.m_body)for(a=
this.m_body.GetContactList();a;){var c=a.contact,g=c.GetFixtureA(),b=c.GetFixtureB();if(g==this||b==this)c.FlagForFiltering();a=a.next}};S.prototype.GetFilterData=function(){return this.m_filter.Copy()};S.prototype.GetBody=function(){return this.m_body};S.prototype.GetNext=function(){return this.m_next};S.prototype.GetUserData=function(){return this.m_userData};S.prototype.SetUserData=function(a){this.m_userData=a};S.prototype.TestPoint=function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),
a)};S.prototype.RayCast=function(a,c){return this.m_shape.RayCast(a,c,this.m_body.GetTransform())};S.prototype.GetMassData=function(a){if(a===undefined)a=null;if(a==null)a=new I;this.m_shape.ComputeMass(a,this.m_density);return a};S.prototype.SetDensity=function(a){if(a===undefined)a=0;this.m_density=a};S.prototype.GetDensity=function(){return this.m_density};S.prototype.GetFriction=function(){return this.m_friction};S.prototype.SetFriction=function(a){if(a===undefined)a=0;this.m_friction=a};S.prototype.GetRestitution=
function(){return this.m_restitution};S.prototype.SetRestitution=function(a){if(a===undefined)a=0;this.m_restitution=a};S.prototype.GetAABB=function(){return this.m_aabb};S.prototype.b2Fixture=function(){this.m_aabb=new U;this.m_shape=this.m_next=this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0};S.prototype.Create=function(a,c,g){this.m_userData=g.userData;this.m_friction=g.friction;this.m_restitution=g.restitution;this.m_body=a;this.m_next=null;this.m_filter=g.filter.Copy();
this.m_isSensor=g.isSensor;this.m_shape=g.shape.Copy();this.m_density=g.density};S.prototype.Destroy=function(){this.m_shape=null};S.prototype.CreateProxy=function(a,c){this.m_shape.ComputeAABB(this.m_aabb,c);this.m_proxy=a.CreateProxy(this.m_aabb,this)};S.prototype.DestroyProxy=function(a){if(this.m_proxy!=null){a.DestroyProxy(this.m_proxy);this.m_proxy=null}};S.prototype.Synchronize=function(a,c,g){if(this.m_proxy){var b=new U,e=new U;this.m_shape.ComputeAABB(b,c);this.m_shape.ComputeAABB(e,g);
this.m_aabb.Combine(b,e);c=F.SubtractVV(g.position,c.position);a.MoveProxy(this.m_proxy,this.m_aabb,c)}};aa.b2FixtureDef=function(){this.filter=new N};aa.prototype.b2FixtureDef=function(){this.userData=this.shape=null;this.friction=0.2;this.density=this.restitution=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=false};Z.b2Island=function(){};Z.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};
Z.prototype.Initialize=function(a,c,g,b,e,f){if(a===undefined)a=0;if(c===undefined)c=0;if(g===undefined)g=0;var m=0;this.m_bodyCapacity=a;this.m_contactCapacity=c;this.m_jointCapacity=g;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=b;this.m_listener=e;this.m_contactSolver=f;for(m=this.m_bodies.length;m<a;m++)this.m_bodies[m]=null;for(m=this.m_contacts.length;m<c;m++)this.m_contacts[m]=null;for(m=this.m_joints.length;m<g;m++)this.m_joints[m]=null};Z.prototype.Clear=function(){this.m_jointCount=
this.m_contactCount=this.m_bodyCount=0};Z.prototype.Solve=function(a,c,g){var b=0,e=0,f;for(b=0;b<this.m_bodyCount;++b){e=this.m_bodies[b];if(e.GetType()==k.b2_dynamicBody){e.m_linearVelocity.x+=a.dt*(c.x+e.m_invMass*e.m_force.x);e.m_linearVelocity.y+=a.dt*(c.y+e.m_invMass*e.m_force.y);e.m_angularVelocity+=a.dt*e.m_invI*e.m_torque;e.m_linearVelocity.Multiply(F.Clamp(1-a.dt*e.m_linearDamping,0,1));e.m_angularVelocity*=F.Clamp(1-a.dt*e.m_angularDamping,0,1)}}this.m_contactSolver.Initialize(a,this.m_contacts,
this.m_contactCount,this.m_allocator);c=this.m_contactSolver;c.InitVelocityConstraints(a);for(b=0;b<this.m_jointCount;++b){f=this.m_joints[b];f.InitVelocityConstraints(a)}for(b=0;b<a.velocityIterations;++b){for(e=0;e<this.m_jointCount;++e){f=this.m_joints[e];f.SolveVelocityConstraints(a)}c.SolveVelocityConstraints()}for(b=0;b<this.m_jointCount;++b){f=this.m_joints[b];f.FinalizeVelocityConstraints()}c.FinalizeVelocityConstraints();for(b=0;b<this.m_bodyCount;++b){e=this.m_bodies[b];if(e.GetType()!=
k.b2_staticBody){var m=a.dt*e.m_linearVelocity.x,r=a.dt*e.m_linearVelocity.y;if(m*m+r*r>A.b2_maxTranslationSquared){e.m_linearVelocity.Normalize();e.m_linearVelocity.x*=A.b2_maxTranslation*a.inv_dt;e.m_linearVelocity.y*=A.b2_maxTranslation*a.inv_dt}m=a.dt*e.m_angularVelocity;if(m*m>A.b2_maxRotationSquared)e.m_angularVelocity=e.m_angularVelocity<0?-A.b2_maxRotation*a.inv_dt:A.b2_maxRotation*a.inv_dt;e.m_sweep.c0.SetV(e.m_sweep.c);e.m_sweep.a0=e.m_sweep.a;e.m_sweep.c.x+=a.dt*e.m_linearVelocity.x;e.m_sweep.c.y+=
a.dt*e.m_linearVelocity.y;e.m_sweep.a+=a.dt*e.m_angularVelocity;e.SynchronizeTransform()}}for(b=0;b<a.positionIterations;++b){m=c.SolvePositionConstraints(A.b2_contactBaumgarte);r=true;for(e=0;e<this.m_jointCount;++e){f=this.m_joints[e];f=f.SolvePositionConstraints(A.b2_contactBaumgarte);r=r&&f}if(m&&r)break}this.Report(c.m_constraints);if(g){g=Number.MAX_VALUE;c=A.b2_linearSleepTolerance*A.b2_linearSleepTolerance;m=A.b2_angularSleepTolerance*A.b2_angularSleepTolerance;for(b=0;b<this.m_bodyCount;++b){e=
this.m_bodies[b];if(e.GetType()!=k.b2_staticBody){if((e.m_flags&k.e_allowSleepFlag)==0)g=e.m_sleepTime=0;if((e.m_flags&k.e_allowSleepFlag)==0||e.m_angularVelocity*e.m_angularVelocity>m||F.Dot(e.m_linearVelocity,e.m_linearVelocity)>c)g=e.m_sleepTime=0;else{e.m_sleepTime+=a.dt;g=F.Min(g,e.m_sleepTime)}}}if(g>=A.b2_timeToSleep)for(b=0;b<this.m_bodyCount;++b){e=this.m_bodies[b];e.SetAwake(false)}}};Z.prototype.SolveTOI=function(a){var c=0,g=0;this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,
this.m_allocator);var b=this.m_contactSolver;for(c=0;c<this.m_jointCount;++c)this.m_joints[c].InitVelocityConstraints(a);for(c=0;c<a.velocityIterations;++c){b.SolveVelocityConstraints();for(g=0;g<this.m_jointCount;++g)this.m_joints[g].SolveVelocityConstraints(a)}for(c=0;c<this.m_bodyCount;++c){g=this.m_bodies[c];if(g.GetType()!=k.b2_staticBody){var e=a.dt*g.m_linearVelocity.x,f=a.dt*g.m_linearVelocity.y;if(e*e+f*f>A.b2_maxTranslationSquared){g.m_linearVelocity.Normalize();g.m_linearVelocity.x*=A.b2_maxTranslation*
a.inv_dt;g.m_linearVelocity.y*=A.b2_maxTranslation*a.inv_dt}e=a.dt*g.m_angularVelocity;if(e*e>A.b2_maxRotationSquared)g.m_angularVelocity=g.m_angularVelocity<0?-A.b2_maxRotation*a.inv_dt:A.b2_maxRotation*a.inv_dt;g.m_sweep.c0.SetV(g.m_sweep.c);g.m_sweep.a0=g.m_sweep.a;g.m_sweep.c.x+=a.dt*g.m_linearVelocity.x;g.m_sweep.c.y+=a.dt*g.m_linearVelocity.y;g.m_sweep.a+=a.dt*g.m_angularVelocity;g.SynchronizeTransform()}}for(c=0;c<a.positionIterations;++c){e=b.SolvePositionConstraints(0.75);f=true;for(g=0;g<
this.m_jointCount;++g){var m=this.m_joints[g].SolvePositionConstraints(A.b2_contactBaumgarte);f=f&&m}if(e&&f)break}this.Report(b.m_constraints)};Z.prototype.Report=function(a){if(this.m_listener!=null)for(var c=0;c<this.m_contactCount;++c){for(var g=this.m_contacts[c],b=a[c],e=0;e<b.pointCount;++e){Z.s_impulse.normalImpulses[e]=b.points[e].normalImpulse;Z.s_impulse.tangentImpulses[e]=b.points[e].tangentImpulse}this.m_listener.PostSolve(g,Z.s_impulse)}};Z.prototype.AddBody=function(a){a.m_islandIndex=
this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=a};Z.prototype.AddContact=function(a){this.m_contacts[this.m_contactCount++]=a};Z.prototype.AddJoint=function(a){this.m_joints[this.m_jointCount++]=a};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new D});d.b2TimeStep=function(){};d.prototype.Set=function(a){this.dt=a.dt;this.inv_dt=a.inv_dt;this.positionIterations=a.positionIterations;this.velocityIterations=a.velocityIterations;this.warmStarting=a.warmStarting};h.b2World=function(){this.s_stack=
new Vector;this.m_contactManager=new O;this.m_contactSolver=new o;this.m_island=new Z};h.prototype.b2World=function(a,c){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null;this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;h.m_warmStarting=true;h.m_continuousPhysics=true;this.m_allowSleep=c;this.m_gravity=a;this.m_inv_dt0=0;this.m_contactManager.m_world=this;this.m_groundBody=this.CreateBody(new z)};
h.prototype.SetDestructionListener=function(a){this.m_destructionListener=a};h.prototype.SetContactFilter=function(a){this.m_contactManager.m_contactFilter=a};h.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a};h.prototype.SetDebugDraw=function(a){this.m_debugDraw=a};h.prototype.SetBroadPhase=function(a){var c=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var g=this.m_bodyList;g;g=g.m_next)for(var b=g.m_fixtureList;b;b=b.m_next)b.m_proxy=
a.CreateProxy(c.GetFatAABB(b.m_proxy),b)};h.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};h.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};h.prototype.CreateBody=function(a){if(this.IsLocked()==true)return null;a=new k(a,this);a.m_prev=null;if(a.m_next=this.m_bodyList)this.m_bodyList.m_prev=a;this.m_bodyList=a;++this.m_bodyCount;return a};h.prototype.DestroyBody=function(a){if(this.IsLocked()!=true){for(var c=a.m_jointList;c;){var g=
c;c=c.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(g.joint);this.DestroyJoint(g.joint)}for(c=a.m_controllerList;c;){g=c;c=c.nextController;g.controller.RemoveBody(a)}for(c=a.m_contactList;c;){g=c;c=c.next;this.m_contactManager.Destroy(g.contact)}a.m_contactList=null;for(c=a.m_fixtureList;c;){g=c;c=c.m_next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(g);g.DestroyProxy(this.m_contactManager.m_broadPhase);g.Destroy()}a.m_fixtureList=null;a.m_fixtureCount=
0;if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_bodyList)this.m_bodyList=a.m_next;--this.m_bodyCount}};h.prototype.CreateJoint=function(a){var c=q.Create(a,null);c.m_prev=null;if(c.m_next=this.m_jointList)this.m_jointList.m_prev=c;this.m_jointList=c;++this.m_jointCount;c.m_edgeA.joint=c;c.m_edgeA.other=c.m_bodyB;c.m_edgeA.prev=null;if(c.m_edgeA.next=c.m_bodyA.m_jointList)c.m_bodyA.m_jointList.prev=c.m_edgeA;c.m_bodyA.m_jointList=c.m_edgeA;c.m_edgeB.joint=c;
c.m_edgeB.other=c.m_bodyA;c.m_edgeB.prev=null;if(c.m_edgeB.next=c.m_bodyB.m_jointList)c.m_bodyB.m_jointList.prev=c.m_edgeB;c.m_bodyB.m_jointList=c.m_edgeB;var g=a.bodyA,b=a.bodyB;if(a.collideConnected==false)for(a=b.GetContactList();a;){a.other==g&&a.contact.FlagForFiltering();a=a.next}return c};h.prototype.DestroyJoint=function(a){var c=a.m_collideConnected;if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_jointList)this.m_jointList=a.m_next;var g=a.m_bodyA,b=
a.m_bodyB;g.SetAwake(true);b.SetAwake(true);if(a.m_edgeA.prev)a.m_edgeA.prev.next=a.m_edgeA.next;if(a.m_edgeA.next)a.m_edgeA.next.prev=a.m_edgeA.prev;if(a.m_edgeA==g.m_jointList)g.m_jointList=a.m_edgeA.next;a.m_edgeA.prev=null;a.m_edgeA.next=null;if(a.m_edgeB.prev)a.m_edgeB.prev.next=a.m_edgeB.next;if(a.m_edgeB.next)a.m_edgeB.next.prev=a.m_edgeB.prev;if(a.m_edgeB==b.m_jointList)b.m_jointList=a.m_edgeB.next;a.m_edgeB.prev=null;a.m_edgeB.next=null;q.Destroy(a,null);--this.m_jointCount;if(c==false)for(a=
b.GetContactList();a;){a.other==g&&a.contact.FlagForFiltering();a=a.next}};h.prototype.AddController=function(a){a.m_next=this.m_controllerList;a.m_prev=null;this.m_controllerList=a;a.m_world=this;this.m_controllerCount++;return a};h.prototype.RemoveController=function(a){if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(this.m_controllerList==a)this.m_controllerList=a.m_next;this.m_controllerCount--};h.prototype.CreateController=function(a){if(a.m_world!=this)throw Error("Controller can only be a member of one world");
a.m_next=this.m_controllerList;a.m_prev=null;if(this.m_controllerList)this.m_controllerList.m_prev=a;this.m_controllerList=a;++this.m_controllerCount;a.m_world=this;return a};h.prototype.DestroyController=function(a){a.Clear();if(a.m_next)a.m_next.m_prev=a.m_prev;if(a.m_prev)a.m_prev.m_next=a.m_next;if(a==this.m_controllerList)this.m_controllerList=a.m_next;--this.m_controllerCount};h.prototype.SetWarmStarting=function(a){h.m_warmStarting=a};h.prototype.SetContinuousPhysics=function(a){h.m_continuousPhysics=
a};h.prototype.GetBodyCount=function(){return this.m_bodyCount};h.prototype.GetJointCount=function(){return this.m_jointCount};h.prototype.GetContactCount=function(){return this.m_contactCount};h.prototype.SetGravity=function(a){this.m_gravity=a};h.prototype.GetGravity=function(){return this.m_gravity};h.prototype.GetGroundBody=function(){return this.m_groundBody};h.prototype.Step=function(a,c,g){if(a===undefined)a=0;if(c===undefined)c=0;if(g===undefined)g=0;if(this.m_flags&h.e_newFixture){this.m_contactManager.FindNewContacts();
this.m_flags&=~h.e_newFixture}this.m_flags|=h.e_locked;var b=h.s_timestep2;b.dt=a;b.velocityIterations=c;b.positionIterations=g;b.inv_dt=a>0?1/a:0;b.dtRatio=this.m_inv_dt0*a;b.warmStarting=h.m_warmStarting;this.m_contactManager.Collide();b.dt>0&&this.Solve(b);h.m_continuousPhysics&&b.dt>0&&this.SolveTOI(b);if(b.dt>0)this.m_inv_dt0=b.inv_dt;this.m_flags&=~h.e_locked};h.prototype.ClearForces=function(){for(var a=this.m_bodyList;a;a=a.m_next){a.m_force.SetZero();a.m_torque=0}};h.prototype.DrawDebugData=
function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var a=this.m_debugDraw.GetFlags(),c,g,b;new y;new y;new y;var e;new U;new U;e=[new y,new y,new y,new y];var f=new w(0,0,0);if(a&E.e_shapeBit)for(c=this.m_bodyList;c;c=c.m_next){e=c.m_xf;for(g=c.GetFixtureList();g;g=g.m_next){b=g.GetShape();if(c.IsActive()==false)f.Set(0.5,0.5,0.3);else if(c.GetType()==k.b2_staticBody)f.Set(0.5,0.9,0.5);else if(c.GetType()==k.b2_kinematicBody)f.Set(0.5,0.5,0.9);else c.IsAwake()==false?
f.Set(0.6,0.6,0.6):f.Set(0.9,0.7,0.7);this.DrawShape(b,e,f)}}if(a&E.e_jointBit)for(c=this.m_jointList;c;c=c.m_next)this.DrawJoint(c);if(a&E.e_controllerBit)for(c=this.m_controllerList;c;c=c.m_next)c.Draw(this.m_debugDraw);if(a&E.e_pairBit){f.Set(0.3,0.9,0.9);for(c=this.m_contactManager.m_contactList;c;c=c.GetNext()){b=c.GetFixtureA();g=c.GetFixtureB();b=b.GetAABB().GetCenter();g=g.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(b,g,f)}}if(a&E.e_aabbBit){b=this.m_contactManager.m_broadPhase;e=[new y,
new y,new y,new y];for(c=this.m_bodyList;c;c=c.GetNext())if(c.IsActive()!=false)for(g=c.GetFixtureList();g;g=g.GetNext()){var m=b.GetFatAABB(g.m_proxy);e[0].Set(m.lowerBound.x,m.lowerBound.y);e[1].Set(m.upperBound.x,m.lowerBound.y);e[2].Set(m.upperBound.x,m.upperBound.y);e[3].Set(m.lowerBound.x,m.upperBound.y);this.m_debugDraw.DrawPolygon(e,4,f)}}if(a&E.e_centerOfMassBit)for(c=this.m_bodyList;c;c=c.m_next){e=h.s_xf;e.R=c.m_xf.R;e.position=c.GetWorldCenter();this.m_debugDraw.DrawTransform(e)}}};h.prototype.QueryAABB=
function(a,c){var g=this.m_contactManager.m_broadPhase;g.Query(function(b){return a(g.GetUserData(b))},c)};h.prototype.QueryShape=function(a,c,g){if(g===undefined)g=null;if(g==null){g=new K;g.SetIdentity()}var b=this.m_contactManager.m_broadPhase,e=new U;c.ComputeAABB(e,g);b.Query(function(f){f=b.GetUserData(f)instanceof S?b.GetUserData(f):null;if(Y.TestOverlap(c,g,f.GetShape(),f.GetBody().GetTransform()))return a(f);return true},e)};h.prototype.QueryPoint=function(a,c){var g=this.m_contactManager.m_broadPhase,
b=new U;b.lowerBound.Set(c.x-A.b2_linearSlop,c.y-A.b2_linearSlop);b.upperBound.Set(c.x+A.b2_linearSlop,c.y+A.b2_linearSlop);g.Query(function(e){e=g.GetUserData(e)instanceof S?g.GetUserData(e):null;if(e.TestPoint(c))return a(e);return true},b)};h.prototype.RayCast=function(a,c,g){var b=this.m_contactManager.m_broadPhase,e=new V,f=new Q(c,g);b.RayCast(function(m,r){var s=b.GetUserData(r);s=s instanceof S?s:null;if(s.RayCast(e,m)){var v=e.fraction,t=new y((1-v)*c.x+v*g.x,(1-v)*c.y+v*g.y);return a(s,
t,e.normal,v)}return m.maxFraction},f)};h.prototype.RayCastOne=function(a,c){var g;this.RayCast(function(b,e,f,m){if(m===undefined)m=0;g=b;return m},a,c);return g};h.prototype.RayCastAll=function(a,c){var g=new Vector;this.RayCast(function(b){g[g.length]=b;return 1},a,c);return g};h.prototype.GetBodyList=function(){return this.m_bodyList};h.prototype.GetJointList=function(){return this.m_jointList};h.prototype.GetContactList=function(){return this.m_contactList};h.prototype.IsLocked=function(){return(this.m_flags&
h.e_locked)>0};h.prototype.Solve=function(a){for(var c,g=this.m_controllerList;g;g=g.m_next)g.Step(a);g=this.m_island;g.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(c=this.m_bodyList;c;c=c.m_next)c.m_flags&=~k.e_islandFlag;for(var b=this.m_contactList;b;b=b.m_next)b.m_flags&=~l.e_islandFlag;for(b=this.m_jointList;b;b=b.m_next)b.m_islandFlag=false;parseInt(this.m_bodyCount);b=this.s_stack;for(var e=this.m_bodyList;e;e=
e.m_next)if(!(e.m_flags&k.e_islandFlag))if(!(e.IsAwake()==false||e.IsActive()==false))if(e.GetType()!=k.b2_staticBody){g.Clear();var f=0;b[f++]=e;for(e.m_flags|=k.e_islandFlag;f>0;){c=b[--f];g.AddBody(c);c.IsAwake()==false&&c.SetAwake(true);if(c.GetType()!=k.b2_staticBody){for(var m,r=c.m_contactList;r;r=r.next)if(!(r.contact.m_flags&l.e_islandFlag))if(!(r.contact.IsSensor()==true||r.contact.IsEnabled()==false||r.contact.IsTouching()==false)){g.AddContact(r.contact);r.contact.m_flags|=l.e_islandFlag;
m=r.other;if(!(m.m_flags&k.e_islandFlag)){b[f++]=m;m.m_flags|=k.e_islandFlag}}for(c=c.m_jointList;c;c=c.next)if(c.joint.m_islandFlag!=true){m=c.other;if(m.IsActive()!=false){g.AddJoint(c.joint);c.joint.m_islandFlag=true;if(!(m.m_flags&k.e_islandFlag)){b[f++]=m;m.m_flags|=k.e_islandFlag}}}}}g.Solve(a,this.m_gravity,this.m_allowSleep);for(f=0;f<g.m_bodyCount;++f){c=g.m_bodies[f];if(c.GetType()==k.b2_staticBody)c.m_flags&=~k.e_islandFlag}}for(f=0;f<b.length;++f){if(!b[f])break;b[f]=null}for(c=this.m_bodyList;c;c=
c.m_next)c.IsAwake()==false||c.IsActive()==false||c.GetType()!=k.b2_staticBody&&c.SynchronizeFixtures();this.m_contactManager.FindNewContacts()};h.prototype.SolveTOI=function(a){var c,g,b,e=this.m_island;e.Initialize(this.m_bodyCount,A.b2_maxTOIContactsPerIsland,A.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var f=h.s_queue;for(c=this.m_bodyList;c;c=c.m_next){c.m_flags&=~k.e_islandFlag;c.m_sweep.t0=0}for(b=this.m_contactList;b;b=b.m_next)b.m_flags&=~(l.e_toiFlag|
l.e_islandFlag);for(b=this.m_jointList;b;b=b.m_next)b.m_islandFlag=false;for(;;){var m=null,r=1;for(b=this.m_contactList;b;b=b.m_next)if(!(b.IsSensor()==true||b.IsEnabled()==false||b.IsContinuous()==false)){c=1;if(b.m_flags&l.e_toiFlag)c=b.m_toi;else{c=b.m_fixtureA;g=b.m_fixtureB;c=c.m_body;g=g.m_body;if((c.GetType()!=k.b2_dynamicBody||c.IsAwake()==false)&&(g.GetType()!=k.b2_dynamicBody||g.IsAwake()==false))continue;var s=c.m_sweep.t0;if(c.m_sweep.t0<g.m_sweep.t0){s=g.m_sweep.t0;c.m_sweep.Advance(s)}else if(g.m_sweep.t0<
c.m_sweep.t0){s=c.m_sweep.t0;g.m_sweep.Advance(s)}c=b.ComputeTOI(c.m_sweep,g.m_sweep);A.b2Assert(0<=c&&c<=1);if(c>0&&c<1){c=(1-c)*s+c;if(c>1)c=1}b.m_toi=c;b.m_flags|=l.e_toiFlag}if(Number.MIN_VALUE<c&&c<r){m=b;r=c}}if(m==null||1-100*Number.MIN_VALUE<r)break;c=m.m_fixtureA;g=m.m_fixtureB;c=c.m_body;g=g.m_body;h.s_backupA.Set(c.m_sweep);h.s_backupB.Set(g.m_sweep);c.Advance(r);g.Advance(r);m.Update(this.m_contactManager.m_contactListener);m.m_flags&=~l.e_toiFlag;if(m.IsSensor()==true||m.IsEnabled()==
false){c.m_sweep.Set(h.s_backupA);g.m_sweep.Set(h.s_backupB);c.SynchronizeTransform();g.SynchronizeTransform()}else if(m.IsTouching()!=false){c=c;if(c.GetType()!=k.b2_dynamicBody)c=g;e.Clear();m=b=0;f[b+m++]=c;for(c.m_flags|=k.e_islandFlag;m>0;){c=f[b++];--m;e.AddBody(c);c.IsAwake()==false&&c.SetAwake(true);if(c.GetType()==k.b2_dynamicBody){for(g=c.m_contactList;g;g=g.next){if(e.m_contactCount==e.m_contactCapacity)break;if(!(g.contact.m_flags&l.e_islandFlag))if(!(g.contact.IsSensor()==true||g.contact.IsEnabled()==
false||g.contact.IsTouching()==false)){e.AddContact(g.contact);g.contact.m_flags|=l.e_islandFlag;s=g.other;if(!(s.m_flags&k.e_islandFlag)){if(s.GetType()!=k.b2_staticBody){s.Advance(r);s.SetAwake(true)}f[b+m]=s;++m;s.m_flags|=k.e_islandFlag}}}for(c=c.m_jointList;c;c=c.next)if(e.m_jointCount!=e.m_jointCapacity)if(c.joint.m_islandFlag!=true){s=c.other;if(s.IsActive()!=false){e.AddJoint(c.joint);c.joint.m_islandFlag=true;if(!(s.m_flags&k.e_islandFlag)){if(s.GetType()!=k.b2_staticBody){s.Advance(r);s.SetAwake(true)}f[b+
m]=s;++m;s.m_flags|=k.e_islandFlag}}}}}b=h.s_timestep;b.warmStarting=false;b.dt=(1-r)*a.dt;b.inv_dt=1/b.dt;b.dtRatio=0;b.velocityIterations=a.velocityIterations;b.positionIterations=a.positionIterations;e.SolveTOI(b);for(r=r=0;r<e.m_bodyCount;++r){c=e.m_bodies[r];c.m_flags&=~k.e_islandFlag;if(c.IsAwake()!=false)if(c.GetType()==k.b2_dynamicBody){c.SynchronizeFixtures();for(g=c.m_contactList;g;g=g.next)g.contact.m_flags&=~l.e_toiFlag}}for(r=0;r<e.m_contactCount;++r){b=e.m_contacts[r];b.m_flags&=~(l.e_toiFlag|
l.e_islandFlag)}for(r=0;r<e.m_jointCount;++r){b=e.m_joints[r];b.m_islandFlag=false}this.m_contactManager.FindNewContacts()}}};h.prototype.DrawJoint=function(a){var c=a.GetBodyA(),g=a.GetBodyB(),b=c.m_xf.position,e=g.m_xf.position,f=a.GetAnchorA(),m=a.GetAnchorB(),r=h.s_jointColor;switch(a.m_type){case q.e_distanceJoint:this.m_debugDraw.DrawSegment(f,m,r);break;case q.e_pulleyJoint:c=a instanceof n?a:null;a=c.GetGroundAnchorA();c=c.GetGroundAnchorB();this.m_debugDraw.DrawSegment(a,f,r);this.m_debugDraw.DrawSegment(c,
m,r);this.m_debugDraw.DrawSegment(a,c,r);break;case q.e_mouseJoint:this.m_debugDraw.DrawSegment(f,m,r);break;default:c!=this.m_groundBody&&this.m_debugDraw.DrawSegment(b,f,r);this.m_debugDraw.DrawSegment(f,m,r);g!=this.m_groundBody&&this.m_debugDraw.DrawSegment(e,m,r)}};h.prototype.DrawShape=function(a,c,g){switch(a.m_type){case Y.e_circleShape:var b=a instanceof M?a:null;this.m_debugDraw.DrawSolidCircle(F.MulX(c,b.m_p),b.m_radius,c.R.col1,g);break;case Y.e_polygonShape:b=0;b=a instanceof W?a:null;
a=parseInt(b.GetVertexCount());var e=b.GetVertices(),f=new Vector(a);for(b=0;b<a;++b)f[b]=F.MulX(c,e[b]);this.m_debugDraw.DrawSolidPolygon(f,a,g);break;case Y.e_edgeShape:b=a instanceof L?a:null;this.m_debugDraw.DrawSegment(F.MulX(c,b.GetVertex1()),F.MulX(c,b.GetVertex2()),g)}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new d;Box2D.Dynamics.b2World.s_xf=new K;Box2D.Dynamics.b2World.s_backupA=new G;Box2D.Dynamics.b2World.s_backupB=new G;Box2D.Dynamics.b2World.s_timestep=new d;
Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new w(0.5,0.8,0.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})})();
(function(){var F=Box2D.Collision.Shapes.b2CircleShape,G=Box2D.Collision.Shapes.b2EdgeShape,K=Box2D.Collision.Shapes.b2PolygonShape,y=Box2D.Collision.Shapes.b2Shape,w=Box2D.Dynamics.Contacts.b2CircleContact,A=Box2D.Dynamics.Contacts.b2Contact,U=Box2D.Dynamics.Contacts.b2ContactConstraint,p=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,B=Box2D.Dynamics.Contacts.b2ContactEdge,Q=Box2D.Dynamics.Contacts.b2ContactFactory,V=Box2D.Dynamics.Contacts.b2ContactRegister,M=Box2D.Dynamics.Contacts.b2ContactResult,
L=Box2D.Dynamics.Contacts.b2ContactSolver,I=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,W=Box2D.Dynamics.Contacts.b2NullContact,Y=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,k=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,z=Box2D.Dynamics.Contacts.b2PolygonContact,u=Box2D.Dynamics.Contacts.b2PositionSolverManifold,D=Box2D.Dynamics.b2Body,H=Box2D.Dynamics.b2TimeStep,O=Box2D.Common.b2Settings,E=Box2D.Common.Math.b2Mat22,R=Box2D.Common.Math.b2Math,N=Box2D.Common.Math.b2Vec2,S=Box2D.Collision.b2Collision,
aa=Box2D.Collision.b2ContactID,Z=Box2D.Collision.b2Manifold,d=Box2D.Collision.b2TimeOfImpact,h=Box2D.Collision.b2TOIInput,l=Box2D.Collision.b2WorldManifold;Box2D.inherit(w,Box2D.Dynamics.Contacts.b2Contact);w.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;w.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};w.Create=function(){return new w};w.Destroy=function(){};w.prototype.Reset=function(j,o){this.__super.Reset.call(this,j,o)};w.prototype.Evaluate=
function(){var j=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody();S.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof F?this.m_fixtureA.GetShape():null,j.m_xf,this.m_fixtureB.GetShape()instanceof F?this.m_fixtureB.GetShape():null,o.m_xf)};A.b2Contact=function(){this.m_nodeA=new B;this.m_nodeB=new B;this.m_manifold=new Z;this.m_oldManifold=new Z};A.prototype.GetManifold=function(){return this.m_manifold};A.prototype.GetWorldManifold=function(j){var o=this.m_fixtureA.GetBody(),
q=this.m_fixtureB.GetBody(),n=this.m_fixtureA.GetShape(),a=this.m_fixtureB.GetShape();j.Initialize(this.m_manifold,o.GetTransform(),n.m_radius,q.GetTransform(),a.m_radius)};A.prototype.IsTouching=function(){return(this.m_flags&A.e_touchingFlag)==A.e_touchingFlag};A.prototype.IsContinuous=function(){return(this.m_flags&A.e_continuousFlag)==A.e_continuousFlag};A.prototype.SetSensor=function(j){if(j)this.m_flags|=A.e_sensorFlag;else this.m_flags&=~A.e_sensorFlag};A.prototype.IsSensor=function(){return(this.m_flags&
A.e_sensorFlag)==A.e_sensorFlag};A.prototype.SetEnabled=function(j){if(j)this.m_flags|=A.e_enabledFlag;else this.m_flags&=~A.e_enabledFlag};A.prototype.IsEnabled=function(){return(this.m_flags&A.e_enabledFlag)==A.e_enabledFlag};A.prototype.GetNext=function(){return this.m_next};A.prototype.GetFixtureA=function(){return this.m_fixtureA};A.prototype.GetFixtureB=function(){return this.m_fixtureB};A.prototype.FlagForFiltering=function(){this.m_flags|=A.e_filterFlag};A.prototype.b2Contact=function(){};
A.prototype.Reset=function(j,o){if(j===undefined)j=null;if(o===undefined)o=null;this.m_flags=A.e_enabledFlag;if(!j||!o)this.m_fixtureB=this.m_fixtureA=null;else{if(j.IsSensor()||o.IsSensor())this.m_flags|=A.e_sensorFlag;var q=j.GetBody(),n=o.GetBody();if(q.GetType()!=D.b2_dynamicBody||q.IsBullet()||n.GetType()!=D.b2_dynamicBody||n.IsBullet())this.m_flags|=A.e_continuousFlag;this.m_fixtureA=j;this.m_fixtureB=o;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=
null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}};A.prototype.Update=function(j){var o=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=o;this.m_flags|=A.e_enabledFlag;var q=false;o=(this.m_flags&A.e_touchingFlag)==A.e_touchingFlag;var n=this.m_fixtureA.m_body,a=this.m_fixtureB.m_body,c=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&A.e_sensorFlag){if(c){q=
this.m_fixtureA.GetShape();c=this.m_fixtureB.GetShape();n=n.GetTransform();a=a.GetTransform();q=y.TestOverlap(q,n,c,a)}this.m_manifold.m_pointCount=0}else{if(n.GetType()!=D.b2_dynamicBody||n.IsBullet()||a.GetType()!=D.b2_dynamicBody||a.IsBullet())this.m_flags|=A.e_continuousFlag;else this.m_flags&=~A.e_continuousFlag;if(c){this.Evaluate();q=this.m_manifold.m_pointCount>0;for(c=0;c<this.m_manifold.m_pointCount;++c){var g=this.m_manifold.m_points[c];g.m_normalImpulse=0;g.m_tangentImpulse=0;for(var b=
g.m_id,e=0;e<this.m_oldManifold.m_pointCount;++e){var f=this.m_oldManifold.m_points[e];if(f.m_id.key==b.key){g.m_normalImpulse=f.m_normalImpulse;g.m_tangentImpulse=f.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;if(q!=o){n.SetAwake(true);a.SetAwake(true)}}if(q)this.m_flags|=A.e_touchingFlag;else this.m_flags&=~A.e_touchingFlag;o==false&&q==true&&j.BeginContact(this);o==true&&q==false&&j.EndContact(this);(this.m_flags&A.e_sensorFlag)==0&&j.PreSolve(this,this.m_oldManifold)};A.prototype.Evaluate=
function(){};A.prototype.ComputeTOI=function(j,o){A.s_input.proxyA.Set(this.m_fixtureA.GetShape());A.s_input.proxyB.Set(this.m_fixtureB.GetShape());A.s_input.sweepA=j;A.s_input.sweepB=o;A.s_input.tolerance=O.b2_linearSlop;return d.TimeOfImpact(A.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=
16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64;Box2D.Dynamics.Contacts.b2Contact.s_input=new h});U.b2ContactConstraint=function(){this.localPlaneNormal=new N;this.localPoint=new N;this.normal=new N;this.normalMass=new E;this.K=new E};U.prototype.b2ContactConstraint=function(){this.points=new Vector(O.b2_maxManifoldPoints);for(var j=0;j<O.b2_maxManifoldPoints;j++)this.points[j]=new p};p.b2ContactConstraintPoint=function(){this.localPoint=new N;
this.rA=new N;this.rB=new N};B.b2ContactEdge=function(){};Q.b2ContactFactory=function(){};Q.prototype.b2ContactFactory=function(j){this.m_allocator=j;this.InitializeRegisters()};Q.prototype.AddType=function(j,o,q,n){if(q===undefined)q=0;if(n===undefined)n=0;this.m_registers[q][n].createFcn=j;this.m_registers[q][n].destroyFcn=o;this.m_registers[q][n].primary=true;if(q!=n){this.m_registers[n][q].createFcn=j;this.m_registers[n][q].destroyFcn=o;this.m_registers[n][q].primary=false}};Q.prototype.InitializeRegisters=
function(){this.m_registers=new Vector(y.e_shapeTypeCount);for(var j=0;j<y.e_shapeTypeCount;j++){this.m_registers[j]=new Vector(y.e_shapeTypeCount);for(var o=0;o<y.e_shapeTypeCount;o++)this.m_registers[j][o]=new V}this.AddType(w.Create,w.Destroy,y.e_circleShape,y.e_circleShape);this.AddType(Y.Create,Y.Destroy,y.e_polygonShape,y.e_circleShape);this.AddType(z.Create,z.Destroy,y.e_polygonShape,y.e_polygonShape);this.AddType(I.Create,I.Destroy,y.e_edgeShape,y.e_circleShape);this.AddType(k.Create,k.Destroy,
y.e_polygonShape,y.e_edgeShape)};Q.prototype.Create=function(j,o){var q=parseInt(j.GetType()),n=parseInt(o.GetType());q=this.m_registers[q][n];if(q.pool){n=q.pool;q.pool=n.m_next;q.poolCount--;n.Reset(j,o);return n}n=q.createFcn;if(n!=null){if(q.primary){n=n(this.m_allocator);n.Reset(j,o)}else{n=n(this.m_allocator);n.Reset(o,j)}return n}else return null};Q.prototype.Destroy=function(j){if(j.m_manifold.m_pointCount>0){j.m_fixtureA.m_body.SetAwake(true);j.m_fixtureB.m_body.SetAwake(true)}var o=parseInt(j.m_fixtureA.GetType()),
q=parseInt(j.m_fixtureB.GetType());o=this.m_registers[o][q];o.poolCount++;j.m_next=o.pool;o.pool=j;o=o.destroyFcn;o(j,this.m_allocator)};V.b2ContactRegister=function(){};M.b2ContactResult=function(){this.position=new N;this.normal=new N;this.id=new aa};L.b2ContactSolver=function(){this.m_step=new H;this.m_constraints=new Vector};L.prototype.b2ContactSolver=function(){};L.prototype.Initialize=function(j,o,q,n){if(q===undefined)q=0;var a;this.m_step.Set(j);this.m_allocator=n;j=0;for(this.m_constraintCount=
q;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new U;for(j=0;j<q;++j){a=o[j];n=a.m_fixtureA;var c=a.m_fixtureB,g=n.m_shape.m_radius,b=c.m_shape.m_radius,e=n.m_body,f=c.m_body,m=a.GetManifold(),r=O.b2MixFriction(n.GetFriction(),c.GetFriction()),s=O.b2MixRestitution(n.GetRestitution(),c.GetRestitution()),v=e.m_linearVelocity.x,t=e.m_linearVelocity.y,x=f.m_linearVelocity.x,C=f.m_linearVelocity.y,J=e.m_angularVelocity,T=f.m_angularVelocity;O.b2Assert(m.m_pointCount>
0);L.s_worldManifold.Initialize(m,e.m_xf,g,f.m_xf,b);c=L.s_worldManifold.m_normal.x;a=L.s_worldManifold.m_normal.y;n=this.m_constraints[j];n.bodyA=e;n.bodyB=f;n.manifold=m;n.normal.x=c;n.normal.y=a;n.pointCount=m.m_pointCount;n.friction=r;n.restitution=s;n.localPlaneNormal.x=m.m_localPlaneNormal.x;n.localPlaneNormal.y=m.m_localPlaneNormal.y;n.localPoint.x=m.m_localPoint.x;n.localPoint.y=m.m_localPoint.y;n.radius=g+b;n.type=m.m_type;for(g=0;g<n.pointCount;++g){r=m.m_points[g];b=n.points[g];b.normalImpulse=
r.m_normalImpulse;b.tangentImpulse=r.m_tangentImpulse;b.localPoint.SetV(r.m_localPoint);r=b.rA.x=L.s_worldManifold.m_points[g].x-e.m_sweep.c.x;s=b.rA.y=L.s_worldManifold.m_points[g].y-e.m_sweep.c.y;var P=b.rB.x=L.s_worldManifold.m_points[g].x-f.m_sweep.c.x,X=b.rB.y=L.s_worldManifold.m_points[g].y-f.m_sweep.c.y,$=r*a-s*c,ba=P*a-X*c;$*=$;ba*=ba;b.normalMass=1/(e.m_invMass+f.m_invMass+e.m_invI*$+f.m_invI*ba);var ca=e.m_mass*e.m_invMass+f.m_mass*f.m_invMass;ca+=e.m_mass*e.m_invI*$+f.m_mass*f.m_invI*ba;
b.equalizedMass=1/ca;ba=a;ca=-c;$=r*ca-s*ba;ba=P*ca-X*ba;$*=$;ba*=ba;b.tangentMass=1/(e.m_invMass+f.m_invMass+e.m_invI*$+f.m_invI*ba);b.velocityBias=0;r=n.normal.x*(x+-T*X-v- -J*s)+n.normal.y*(C+T*P-t-J*r);if(r<-O.b2_velocityThreshold)b.velocityBias+=-n.restitution*r}if(n.pointCount==2){C=n.points[0];x=n.points[1];m=e.m_invMass;e=e.m_invI;v=f.m_invMass;f=f.m_invI;t=C.rA.x*a-C.rA.y*c;C=C.rB.x*a-C.rB.y*c;J=x.rA.x*a-x.rA.y*c;x=x.rB.x*a-x.rB.y*c;c=m+v+e*t*t+f*C*C;a=m+v+e*J*J+f*x*x;f=m+v+e*t*J+f*C*x;if(c*
c<100*(c*a-f*f)){n.K.col1.Set(c,f);n.K.col2.Set(f,a);n.K.GetInverse(n.normalMass)}else n.pointCount=1}}};L.prototype.InitVelocityConstraints=function(j){for(var o=0;o<this.m_constraintCount;++o){var q=this.m_constraints[o],n=q.bodyA,a=q.bodyB,c=n.m_invMass,g=n.m_invI,b=a.m_invMass,e=a.m_invI,f=q.normal.x,m=q.normal.y,r=m,s=-f,v=0,t=0;if(j.warmStarting){t=q.pointCount;for(v=0;v<t;++v){var x=q.points[v];x.normalImpulse*=j.dtRatio;x.tangentImpulse*=j.dtRatio;var C=x.normalImpulse*f+x.tangentImpulse*
r,J=x.normalImpulse*m+x.tangentImpulse*s;n.m_angularVelocity-=g*(x.rA.x*J-x.rA.y*C);n.m_linearVelocity.x-=c*C;n.m_linearVelocity.y-=c*J;a.m_angularVelocity+=e*(x.rB.x*J-x.rB.y*C);a.m_linearVelocity.x+=b*C;a.m_linearVelocity.y+=b*J}}else{t=q.pointCount;for(v=0;v<t;++v){n=q.points[v];n.normalImpulse=0;n.tangentImpulse=0}}}};L.prototype.SolveVelocityConstraints=function(){for(var j=0,o,q=0,n=0,a=0,c=n=n=q=q=0,g=q=q=0,b=q=a=0,e=0,f,m=0;m<this.m_constraintCount;++m){a=this.m_constraints[m];var r=a.bodyA,
s=a.bodyB,v=r.m_angularVelocity,t=s.m_angularVelocity,x=r.m_linearVelocity,C=s.m_linearVelocity,J=r.m_invMass,T=r.m_invI,P=s.m_invMass,X=s.m_invI;b=a.normal.x;var $=e=a.normal.y;f=-b;g=a.friction;for(j=0;j<a.pointCount;j++){o=a.points[j];q=C.x-t*o.rB.y-x.x+v*o.rA.y;n=C.y+t*o.rB.x-x.y-v*o.rA.x;q=q*$+n*f;q=o.tangentMass*-q;n=g*o.normalImpulse;n=R.Clamp(o.tangentImpulse+q,-n,n);q=n-o.tangentImpulse;c=q*$;q=q*f;x.x-=J*c;x.y-=J*q;v-=T*(o.rA.x*q-o.rA.y*c);C.x+=P*c;C.y+=P*q;t+=X*(o.rB.x*q-o.rB.y*c);o.tangentImpulse=
n}parseInt(a.pointCount);if(a.pointCount==1){o=a.points[0];q=C.x+-t*o.rB.y-x.x- -v*o.rA.y;n=C.y+t*o.rB.x-x.y-v*o.rA.x;a=q*b+n*e;q=-o.normalMass*(a-o.velocityBias);n=o.normalImpulse+q;n=n>0?n:0;q=n-o.normalImpulse;c=q*b;q=q*e;x.x-=J*c;x.y-=J*q;v-=T*(o.rA.x*q-o.rA.y*c);C.x+=P*c;C.y+=P*q;t+=X*(o.rB.x*q-o.rB.y*c);o.normalImpulse=n}else{o=a.points[0];j=a.points[1];q=o.normalImpulse;g=j.normalImpulse;var ba=(C.x-t*o.rB.y-x.x+v*o.rA.y)*b+(C.y+t*o.rB.x-x.y-v*o.rA.x)*e,ca=(C.x-t*j.rB.y-x.x+v*j.rA.y)*b+(C.y+
t*j.rB.x-x.y-v*j.rA.x)*e;n=ba-o.velocityBias;c=ca-j.velocityBias;f=a.K;n-=f.col1.x*q+f.col2.x*g;for(c-=f.col1.y*q+f.col2.y*g;;){f=a.normalMass;$=-(f.col1.x*n+f.col2.x*c);f=-(f.col1.y*n+f.col2.y*c);if($>=0&&f>=0){q=$-q;g=f-g;a=q*b;q=q*e;b=g*b;e=g*e;x.x-=J*(a+b);x.y-=J*(q+e);v-=T*(o.rA.x*q-o.rA.y*a+j.rA.x*e-j.rA.y*b);C.x+=P*(a+b);C.y+=P*(q+e);t+=X*(o.rB.x*q-o.rB.y*a+j.rB.x*e-j.rB.y*b);o.normalImpulse=$;j.normalImpulse=f;break}$=-o.normalMass*n;f=0;ca=a.K.col1.y*$+c;if($>=0&&ca>=0){q=$-q;g=f-g;a=q*b;
q=q*e;b=g*b;e=g*e;x.x-=J*(a+b);x.y-=J*(q+e);v-=T*(o.rA.x*q-o.rA.y*a+j.rA.x*e-j.rA.y*b);C.x+=P*(a+b);C.y+=P*(q+e);t+=X*(o.rB.x*q-o.rB.y*a+j.rB.x*e-j.rB.y*b);o.normalImpulse=$;j.normalImpulse=f;break}$=0;f=-j.normalMass*c;ba=a.K.col2.x*f+n;if(f>=0&&ba>=0){q=$-q;g=f-g;a=q*b;q=q*e;b=g*b;e=g*e;x.x-=J*(a+b);x.y-=J*(q+e);v-=T*(o.rA.x*q-o.rA.y*a+j.rA.x*e-j.rA.y*b);C.x+=P*(a+b);C.y+=P*(q+e);t+=X*(o.rB.x*q-o.rB.y*a+j.rB.x*e-j.rB.y*b);o.normalImpulse=$;j.normalImpulse=f;break}f=$=0;ba=n;ca=c;if(ba>=0&&ca>=0){q=
$-q;g=f-g;a=q*b;q=q*e;b=g*b;e=g*e;x.x-=J*(a+b);x.y-=J*(q+e);v-=T*(o.rA.x*q-o.rA.y*a+j.rA.x*e-j.rA.y*b);C.x+=P*(a+b);C.y+=P*(q+e);t+=X*(o.rB.x*q-o.rB.y*a+j.rB.x*e-j.rB.y*b);o.normalImpulse=$;j.normalImpulse=f;break}break}}r.m_angularVelocity=v;s.m_angularVelocity=t}};L.prototype.FinalizeVelocityConstraints=function(){for(var j=0;j<this.m_constraintCount;++j)for(var o=this.m_constraints[j],q=o.manifold,n=0;n<o.pointCount;++n){var a=q.m_points[n],c=o.points[n];a.m_normalImpulse=c.normalImpulse;a.m_tangentImpulse=
c.tangentImpulse}};L.prototype.SolvePositionConstraints=function(j){if(j===undefined)j=0;for(var o=0,q=0;q<this.m_constraintCount;q++){var n=this.m_constraints[q],a=n.bodyA,c=n.bodyB,g=a.m_mass*a.m_invMass,b=a.m_mass*a.m_invI,e=c.m_mass*c.m_invMass,f=c.m_mass*c.m_invI;L.s_psm.Initialize(n);for(var m=L.s_psm.m_normal,r=0;r<n.pointCount;r++){var s=n.points[r],v=L.s_psm.m_points[r],t=L.s_psm.m_separations[r],x=v.x-a.m_sweep.c.x,C=v.y-a.m_sweep.c.y,J=v.x-c.m_sweep.c.x;v=v.y-c.m_sweep.c.y;o=o<t?o:t;t=
R.Clamp(j*(t+O.b2_linearSlop),-O.b2_maxLinearCorrection,0);t=-s.equalizedMass*t;s=t*m.x;t=t*m.y;a.m_sweep.c.x-=g*s;a.m_sweep.c.y-=g*t;a.m_sweep.a-=b*(x*t-C*s);a.SynchronizeTransform();c.m_sweep.c.x+=e*s;c.m_sweep.c.y+=e*t;c.m_sweep.a+=f*(J*t-v*s);c.SynchronizeTransform()}}return o>-1.5*O.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new l;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new u});Box2D.inherit(I,Box2D.Dynamics.Contacts.b2Contact);
I.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;I.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};I.Create=function(){return new I};I.Destroy=function(){};I.prototype.Reset=function(j,o){this.__super.Reset.call(this,j,o)};I.prototype.Evaluate=function(){var j=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof G?this.m_fixtureA.GetShape():null,j.m_xf,
this.m_fixtureB.GetShape()instanceof F?this.m_fixtureB.GetShape():null,o.m_xf)};I.prototype.b2CollideEdgeAndCircle=function(){};Box2D.inherit(W,Box2D.Dynamics.Contacts.b2Contact);W.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;W.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};W.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};W.prototype.Evaluate=function(){};Box2D.inherit(Y,Box2D.Dynamics.Contacts.b2Contact);Y.prototype.__super=
Box2D.Dynamics.Contacts.b2Contact.prototype;Y.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};Y.Create=function(){return new Y};Y.Destroy=function(){};Y.prototype.Reset=function(j,o){this.__super.Reset.call(this,j,o);O.b2Assert(j.GetType()==y.e_polygonShape);O.b2Assert(o.GetType()==y.e_circleShape)};Y.prototype.Evaluate=function(){var j=this.m_fixtureA.m_body,o=this.m_fixtureB.m_body;S.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof
K?this.m_fixtureA.GetShape():null,j.m_xf,this.m_fixtureB.GetShape()instanceof F?this.m_fixtureB.GetShape():null,o.m_xf)};Box2D.inherit(k,Box2D.Dynamics.Contacts.b2Contact);k.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;k.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};k.Create=function(){return new k};k.Destroy=function(){};k.prototype.Reset=function(j,o){this.__super.Reset.call(this,j,o);O.b2Assert(j.GetType()==y.e_polygonShape);
O.b2Assert(o.GetType()==y.e_edgeShape)};k.prototype.Evaluate=function(){var j=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof K?this.m_fixtureA.GetShape():null,j.m_xf,this.m_fixtureB.GetShape()instanceof G?this.m_fixtureB.GetShape():null,o.m_xf)};k.prototype.b2CollidePolyAndEdge=function(){};Box2D.inherit(z,Box2D.Dynamics.Contacts.b2Contact);z.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;z.b2PolygonContact=
function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};z.Create=function(){return new z};z.Destroy=function(){};z.prototype.Reset=function(j,o){this.__super.Reset.call(this,j,o)};z.prototype.Evaluate=function(){var j=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody();S.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof K?this.m_fixtureA.GetShape():null,j.m_xf,this.m_fixtureB.GetShape()instanceof K?this.m_fixtureB.GetShape():null,o.m_xf)};u.b2PositionSolverManifold=
function(){};u.prototype.b2PositionSolverManifold=function(){this.m_normal=new N;this.m_separations=new Vector_a2j_Number(O.b2_maxManifoldPoints);this.m_points=new Vector(O.b2_maxManifoldPoints);for(var j=0;j<O.b2_maxManifoldPoints;j++)this.m_points[j]=new N};u.prototype.Initialize=function(j){O.b2Assert(j.pointCount>0);var o=0,q=0,n=0,a,c=0,g=0;switch(j.type){case Z.e_circles:a=j.bodyA.m_xf.R;n=j.localPoint;o=j.bodyA.m_xf.position.x+(a.col1.x*n.x+a.col2.x*n.y);q=j.bodyA.m_xf.position.y+(a.col1.y*
n.x+a.col2.y*n.y);a=j.bodyB.m_xf.R;n=j.points[0].localPoint;c=j.bodyB.m_xf.position.x+(a.col1.x*n.x+a.col2.x*n.y);a=j.bodyB.m_xf.position.y+(a.col1.y*n.x+a.col2.y*n.y);n=c-o;g=a-q;var b=n*n+g*g;if(b>Number.MIN_VALUE*Number.MIN_VALUE){b=Math.sqrt(b);this.m_normal.x=n/b;this.m_normal.y=g/b}else{this.m_normal.x=1;this.m_normal.y=0}this.m_points[0].x=0.5*(o+c);this.m_points[0].y=0.5*(q+a);this.m_separations[0]=n*this.m_normal.x+g*this.m_normal.y-j.radius;break;case Z.e_faceA:a=j.bodyA.m_xf.R;n=j.localPlaneNormal;
this.m_normal.x=a.col1.x*n.x+a.col2.x*n.y;this.m_normal.y=a.col1.y*n.x+a.col2.y*n.y;a=j.bodyA.m_xf.R;n=j.localPoint;c=j.bodyA.m_xf.position.x+(a.col1.x*n.x+a.col2.x*n.y);g=j.bodyA.m_xf.position.y+(a.col1.y*n.x+a.col2.y*n.y);a=j.bodyB.m_xf.R;for(o=0;o<j.pointCount;++o){n=j.points[o].localPoint;q=j.bodyB.m_xf.position.x+(a.col1.x*n.x+a.col2.x*n.y);n=j.bodyB.m_xf.position.y+(a.col1.y*n.x+a.col2.y*n.y);this.m_separations[o]=(q-c)*this.m_normal.x+(n-g)*this.m_normal.y-j.radius;this.m_points[o].x=q;this.m_points[o].y=
n}break;case Z.e_faceB:a=j.bodyB.m_xf.R;n=j.localPlaneNormal;this.m_normal.x=a.col1.x*n.x+a.col2.x*n.y;this.m_normal.y=a.col1.y*n.x+a.col2.y*n.y;a=j.bodyB.m_xf.R;n=j.localPoint;c=j.bodyB.m_xf.position.x+(a.col1.x*n.x+a.col2.x*n.y);g=j.bodyB.m_xf.position.y+(a.col1.y*n.x+a.col2.y*n.y);a=j.bodyA.m_xf.R;for(o=0;o<j.pointCount;++o){n=j.points[o].localPoint;q=j.bodyA.m_xf.position.x+(a.col1.x*n.x+a.col2.x*n.y);n=j.bodyA.m_xf.position.y+(a.col1.y*n.x+a.col2.y*n.y);this.m_separations[o]=(q-c)*this.m_normal.x+
(n-g)*this.m_normal.y-j.radius;this.m_points[o].Set(q,n)}this.m_normal.x*=-1;this.m_normal.y*=-1}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new N;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new N})})();
(function(){var F=Box2D.Common.Math.b2Mat22,G=Box2D.Common.Math.b2Math,K=Box2D.Common.Math.b2Vec2,y=Box2D.Common.b2Color,w=Box2D.Dynamics.Controllers.b2BuoyancyController,A=Box2D.Dynamics.Controllers.b2ConstantAccelController,U=Box2D.Dynamics.Controllers.b2ConstantForceController,p=Box2D.Dynamics.Controllers.b2Controller,B=Box2D.Dynamics.Controllers.b2ControllerEdge,Q=Box2D.Dynamics.Controllers.b2GravityController,V=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(w,Box2D.Dynamics.Controllers.b2Controller);
w.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;w.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new K(0,-1);this.density=this.offset=0;this.velocity=new K(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=false;this.useWorldGravity=true;this.gravity=null};w.prototype.Step=function(){if(this.m_bodyList){if(this.useWorldGravity)this.gravity=this.GetWorld().GetGravity().Copy();for(var M=this.m_bodyList;M;M=
M.nextBody){var L=M.body;if(L.IsAwake()!=false){for(var I=new K,W=new K,Y=0,k=0,z=L.GetFixtureList();z;z=z.GetNext()){var u=new K,D=z.GetShape().ComputeSubmergedArea(this.normal,this.offset,L.GetTransform(),u);Y+=D;I.x+=D*u.x;I.y+=D*u.y;var H=0;H=1;k+=D*H;W.x+=D*u.x*H;W.y+=D*u.y*H}I.x/=Y;I.y/=Y;W.x/=k;W.y/=k;if(!(Y<Number.MIN_VALUE)){k=this.gravity.GetNegative();k.Multiply(this.density*Y);L.ApplyForce(k,W);W=L.GetLinearVelocityFromWorldPoint(I);W.Subtract(this.velocity);W.Multiply(-this.linearDrag*
Y);L.ApplyForce(W,I);L.ApplyTorque(-L.GetInertia()/L.GetMass()*Y*L.GetAngularVelocity()*this.angularDrag)}}}}};w.prototype.Draw=function(M){var L=new K,I=new K;L.x=this.normal.x*this.offset+this.normal.y*1E3;L.y=this.normal.y*this.offset-this.normal.x*1E3;I.x=this.normal.x*this.offset-this.normal.y*1E3;I.y=this.normal.y*this.offset+this.normal.x*1E3;var W=new y(0,0,1);M.DrawSegment(L,I,W)};Box2D.inherit(A,Box2D.Dynamics.Controllers.b2Controller);A.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
A.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new K(0,0)};A.prototype.Step=function(M){M=new K(this.A.x*M.dt,this.A.y*M.dt);for(var L=this.m_bodyList;L;L=L.nextBody){var I=L.body;I.IsAwake()&&I.SetLinearVelocity(new K(I.GetLinearVelocity().x+M.x,I.GetLinearVelocity().y+M.y))}};Box2D.inherit(U,Box2D.Dynamics.Controllers.b2Controller);U.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;U.b2ConstantForceController=
function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new K(0,0)};U.prototype.Step=function(){for(var M=this.m_bodyList;M;M=M.nextBody){var L=M.body;L.IsAwake()&&L.ApplyForce(this.F,L.GetWorldCenter())}};p.b2Controller=function(){};p.prototype.Step=function(){};p.prototype.Draw=function(){};p.prototype.AddBody=function(M){var L=new B;L.controller=this;L.body=M;L.nextBody=this.m_bodyList;L.prevBody=null;this.m_bodyList=L;if(L.nextBody)L.nextBody.prevBody=L;this.m_bodyCount++;
L.nextController=M.m_controllerList;L.prevController=null;M.m_controllerList=L;if(L.nextController)L.nextController.prevController=L;M.m_controllerCount++};p.prototype.RemoveBody=function(M){for(var L=M.m_controllerList;L&&L.controller!=this;)L=L.nextController;if(L.prevBody)L.prevBody.nextBody=L.nextBody;if(L.nextBody)L.nextBody.prevBody=L.prevBody;if(L.nextController)L.nextController.prevController=L.prevController;if(L.prevController)L.prevController.nextController=L.nextController;if(this.m_bodyList==
L)this.m_bodyList=L.nextBody;if(M.m_controllerList==L)M.m_controllerList=L.nextController;M.m_controllerCount--;this.m_bodyCount--};p.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};p.prototype.GetNext=function(){return this.m_next};p.prototype.GetWorld=function(){return this.m_world};p.prototype.GetBodyList=function(){return this.m_bodyList};B.b2ControllerEdge=function(){};Box2D.inherit(Q,Box2D.Dynamics.Controllers.b2Controller);Q.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
Q.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=true};Q.prototype.Step=function(){var M=null,L=null,I=null,W=0,Y=null,k=null,z=null,u=0,D=0,H=0;u=null;if(this.invSqr)for(M=this.m_bodyList;M;M=M.nextBody){L=M.body;I=L.GetWorldCenter();W=L.GetMass();for(Y=this.m_bodyList;Y!=M;Y=Y.nextBody){k=Y.body;z=k.GetWorldCenter();u=z.x-I.x;D=z.y-I.y;H=u*u+D*D;if(!(H<Number.MIN_VALUE)){u=new K(u,D);u.Multiply(this.G/H/Math.sqrt(H)*
W*k.GetMass());L.IsAwake()&&L.ApplyForce(u,I);u.Multiply(-1);k.IsAwake()&&k.ApplyForce(u,z)}}}else for(M=this.m_bodyList;M;M=M.nextBody){L=M.body;I=L.GetWorldCenter();W=L.GetMass();for(Y=this.m_bodyList;Y!=M;Y=Y.nextBody){k=Y.body;z=k.GetWorldCenter();u=z.x-I.x;D=z.y-I.y;H=u*u+D*D;if(!(H<Number.MIN_VALUE)){u=new K(u,D);u.Multiply(this.G/H*W*k.GetMass());L.IsAwake()&&L.ApplyForce(u,I);u.Multiply(-1);k.IsAwake()&&k.ApplyForce(u,z)}}}};Box2D.inherit(V,Box2D.Dynamics.Controllers.b2Controller);V.prototype.__super=
Box2D.Dynamics.Controllers.b2Controller.prototype;V.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new F;this.maxTimestep=0};V.prototype.SetAxisAligned=function(M,L){if(M===undefined)M=0;if(L===undefined)L=0;this.T.col1.x=-M;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-L;this.maxTimestep=M>0||L>0?1/Math.max(M,L):0};V.prototype.Step=function(M){M=M.dt;if(!(M<=Number.MIN_VALUE)){if(M>this.maxTimestep&&this.maxTimestep>0)M=this.maxTimestep;
for(var L=this.m_bodyList;L;L=L.nextBody){var I=L.body;if(I.IsAwake()){var W=I.GetWorldVector(G.MulMV(this.T,I.GetLocalVector(I.GetLinearVelocity())));I.SetLinearVelocity(new K(I.GetLinearVelocity().x+W.x*M,I.GetLinearVelocity().y+W.y*M))}}}}})();
(function(){var F=Box2D.Common.b2Settings,G=Box2D.Common.Math.b2Mat22,K=Box2D.Common.Math.b2Mat33,y=Box2D.Common.Math.b2Math,w=Box2D.Common.Math.b2Vec2,A=Box2D.Common.Math.b2Vec3,U=Box2D.Dynamics.Joints.b2DistanceJoint,p=Box2D.Dynamics.Joints.b2DistanceJointDef,B=Box2D.Dynamics.Joints.b2FrictionJoint,Q=Box2D.Dynamics.Joints.b2FrictionJointDef,V=Box2D.Dynamics.Joints.b2GearJoint,M=Box2D.Dynamics.Joints.b2GearJointDef,L=Box2D.Dynamics.Joints.b2Jacobian,I=Box2D.Dynamics.Joints.b2Joint,W=Box2D.Dynamics.Joints.b2JointDef,
Y=Box2D.Dynamics.Joints.b2JointEdge,k=Box2D.Dynamics.Joints.b2LineJoint,z=Box2D.Dynamics.Joints.b2LineJointDef,u=Box2D.Dynamics.Joints.b2MouseJoint,D=Box2D.Dynamics.Joints.b2MouseJointDef,H=Box2D.Dynamics.Joints.b2PrismaticJoint,O=Box2D.Dynamics.Joints.b2PrismaticJointDef,E=Box2D.Dynamics.Joints.b2PulleyJoint,R=Box2D.Dynamics.Joints.b2PulleyJointDef,N=Box2D.Dynamics.Joints.b2RevoluteJoint,S=Box2D.Dynamics.Joints.b2RevoluteJointDef,aa=Box2D.Dynamics.Joints.b2WeldJoint,Z=Box2D.Dynamics.Joints.b2WeldJointDef;
Box2D.inherit(U,Box2D.Dynamics.Joints.b2Joint);U.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;U.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new w;this.m_localAnchor2=new w;this.m_u=new w};U.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};U.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};U.prototype.GetReactionForce=function(d){if(d===undefined)d=
0;return new w(d*this.m_impulse*this.m_u.x,d*this.m_impulse*this.m_u.y)};U.prototype.GetReactionTorque=function(){return 0};U.prototype.GetLength=function(){return this.m_length};U.prototype.SetLength=function(d){if(d===undefined)d=0;this.m_length=d};U.prototype.GetFrequency=function(){return this.m_frequencyHz};U.prototype.SetFrequency=function(d){if(d===undefined)d=0;this.m_frequencyHz=d};U.prototype.GetDampingRatio=function(){return this.m_dampingRatio};U.prototype.SetDampingRatio=function(d){if(d===
undefined)d=0;this.m_dampingRatio=d};U.prototype.b2DistanceJoint=function(d){this.__super.b2Joint.call(this,d);this.m_localAnchor1.SetV(d.localAnchorA);this.m_localAnchor2.SetV(d.localAnchorB);this.m_length=d.length;this.m_frequencyHz=d.frequencyHz;this.m_dampingRatio=d.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0};U.prototype.InitVelocityConstraints=function(d){var h,l=0,j=this.m_bodyA,o=this.m_bodyB;h=j.m_xf.R;var q=this.m_localAnchor1.x-j.m_sweep.localCenter.x,n=this.m_localAnchor1.y-
j.m_sweep.localCenter.y;l=h.col1.x*q+h.col2.x*n;n=h.col1.y*q+h.col2.y*n;q=l;h=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,c=this.m_localAnchor2.y-o.m_sweep.localCenter.y;l=h.col1.x*a+h.col2.x*c;c=h.col1.y*a+h.col2.y*c;a=l;this.m_u.x=o.m_sweep.c.x+a-j.m_sweep.c.x-q;this.m_u.y=o.m_sweep.c.y+c-j.m_sweep.c.y-n;l=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);l>F.b2_linearSlop?this.m_u.Multiply(1/l):this.m_u.SetZero();h=q*this.m_u.y-n*this.m_u.x;var g=a*this.m_u.y-c*this.m_u.x;
h=j.m_invMass+j.m_invI*h*h+o.m_invMass+o.m_invI*g*g;this.m_mass=h!=0?1/h:0;if(this.m_frequencyHz>0){l=l-this.m_length;g=2*Math.PI*this.m_frequencyHz;var b=this.m_mass*g*g;this.m_gamma=d.dt*(2*this.m_mass*this.m_dampingRatio*g+d.dt*b);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=l*d.dt*b*this.m_gamma;this.m_mass=h+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(d.warmStarting){this.m_impulse*=d.dtRatio;d=this.m_impulse*this.m_u.x;h=this.m_impulse*this.m_u.y;j.m_linearVelocity.x-=
j.m_invMass*d;j.m_linearVelocity.y-=j.m_invMass*h;j.m_angularVelocity-=j.m_invI*(q*h-n*d);o.m_linearVelocity.x+=o.m_invMass*d;o.m_linearVelocity.y+=o.m_invMass*h;o.m_angularVelocity+=o.m_invI*(a*h-c*d)}else this.m_impulse=0};U.prototype.SolveVelocityConstraints=function(){var d,h=this.m_bodyA,l=this.m_bodyB;d=h.m_xf.R;var j=this.m_localAnchor1.x-h.m_sweep.localCenter.x,o=this.m_localAnchor1.y-h.m_sweep.localCenter.y,q=d.col1.x*j+d.col2.x*o;o=d.col1.y*j+d.col2.y*o;j=q;d=l.m_xf.R;var n=this.m_localAnchor2.x-
l.m_sweep.localCenter.x,a=this.m_localAnchor2.y-l.m_sweep.localCenter.y;q=d.col1.x*n+d.col2.x*a;a=d.col1.y*n+d.col2.y*a;n=q;q=-this.m_mass*(this.m_u.x*(l.m_linearVelocity.x+-l.m_angularVelocity*a-(h.m_linearVelocity.x+-h.m_angularVelocity*o))+this.m_u.y*(l.m_linearVelocity.y+l.m_angularVelocity*n-(h.m_linearVelocity.y+h.m_angularVelocity*j))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=q;d=q*this.m_u.x;q=q*this.m_u.y;h.m_linearVelocity.x-=h.m_invMass*d;h.m_linearVelocity.y-=h.m_invMass*
q;h.m_angularVelocity-=h.m_invI*(j*q-o*d);l.m_linearVelocity.x+=l.m_invMass*d;l.m_linearVelocity.y+=l.m_invMass*q;l.m_angularVelocity+=l.m_invI*(n*q-a*d)};U.prototype.SolvePositionConstraints=function(){var d;if(this.m_frequencyHz>0)return true;var h=this.m_bodyA,l=this.m_bodyB;d=h.m_xf.R;var j=this.m_localAnchor1.x-h.m_sweep.localCenter.x,o=this.m_localAnchor1.y-h.m_sweep.localCenter.y,q=d.col1.x*j+d.col2.x*o;o=d.col1.y*j+d.col2.y*o;j=q;d=l.m_xf.R;var n=this.m_localAnchor2.x-l.m_sweep.localCenter.x,
a=this.m_localAnchor2.y-l.m_sweep.localCenter.y;q=d.col1.x*n+d.col2.x*a;a=d.col1.y*n+d.col2.y*a;n=q;q=l.m_sweep.c.x+n-h.m_sweep.c.x-j;var c=l.m_sweep.c.y+a-h.m_sweep.c.y-o;d=Math.sqrt(q*q+c*c);q/=d;c/=d;d=d-this.m_length;d=y.Clamp(d,-F.b2_maxLinearCorrection,F.b2_maxLinearCorrection);var g=-this.m_mass*d;this.m_u.Set(q,c);q=g*this.m_u.x;c=g*this.m_u.y;h.m_sweep.c.x-=h.m_invMass*q;h.m_sweep.c.y-=h.m_invMass*c;h.m_sweep.a-=h.m_invI*(j*c-o*q);l.m_sweep.c.x+=l.m_invMass*q;l.m_sweep.c.y+=l.m_invMass*c;
l.m_sweep.a+=l.m_invI*(n*c-a*q);h.SynchronizeTransform();l.SynchronizeTransform();return y.Abs(d)<F.b2_linearSlop};Box2D.inherit(p,Box2D.Dynamics.Joints.b2JointDef);p.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;p.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new w;this.localAnchorB=new w};p.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=I.e_distanceJoint;this.length=1;this.dampingRatio=
this.frequencyHz=0};p.prototype.Initialize=function(d,h,l,j){this.bodyA=d;this.bodyB=h;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(l));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(j));d=j.x-l.x;l=j.y-l.y;this.length=Math.sqrt(d*d+l*l);this.dampingRatio=this.frequencyHz=0};Box2D.inherit(B,Box2D.Dynamics.Joints.b2Joint);B.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;B.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new w;
this.m_localAnchorB=new w;this.m_linearMass=new G;this.m_linearImpulse=new w};B.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};B.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};B.prototype.GetReactionForce=function(d){if(d===undefined)d=0;return new w(d*this.m_linearImpulse.x,d*this.m_linearImpulse.y)};B.prototype.GetReactionTorque=function(d){if(d===undefined)d=0;return d*this.m_angularImpulse};B.prototype.SetMaxForce=
function(d){if(d===undefined)d=0;this.m_maxForce=d};B.prototype.GetMaxForce=function(){return this.m_maxForce};B.prototype.SetMaxTorque=function(d){if(d===undefined)d=0;this.m_maxTorque=d};B.prototype.GetMaxTorque=function(){return this.m_maxTorque};B.prototype.b2FrictionJoint=function(d){this.__super.b2Joint.call(this,d);this.m_localAnchorA.SetV(d.localAnchorA);this.m_localAnchorB.SetV(d.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=
0;this.m_maxForce=d.maxForce;this.m_maxTorque=d.maxTorque};B.prototype.InitVelocityConstraints=function(d){var h,l=0,j=this.m_bodyA,o=this.m_bodyB;h=j.m_xf.R;var q=this.m_localAnchorA.x-j.m_sweep.localCenter.x,n=this.m_localAnchorA.y-j.m_sweep.localCenter.y;l=h.col1.x*q+h.col2.x*n;n=h.col1.y*q+h.col2.y*n;q=l;h=o.m_xf.R;var a=this.m_localAnchorB.x-o.m_sweep.localCenter.x,c=this.m_localAnchorB.y-o.m_sweep.localCenter.y;l=h.col1.x*a+h.col2.x*c;c=h.col1.y*a+h.col2.y*c;a=l;h=j.m_invMass;l=o.m_invMass;
var g=j.m_invI,b=o.m_invI,e=new G;e.col1.x=h+l;e.col2.x=0;e.col1.y=0;e.col2.y=h+l;e.col1.x+=g*n*n;e.col2.x+=-g*q*n;e.col1.y+=-g*q*n;e.col2.y+=g*q*q;e.col1.x+=b*c*c;e.col2.x+=-b*a*c;e.col1.y+=-b*a*c;e.col2.y+=b*a*a;e.GetInverse(this.m_linearMass);this.m_angularMass=g+b;if(this.m_angularMass>0)this.m_angularMass=1/this.m_angularMass;if(d.warmStarting){this.m_linearImpulse.x*=d.dtRatio;this.m_linearImpulse.y*=d.dtRatio;this.m_angularImpulse*=d.dtRatio;d=this.m_linearImpulse;j.m_linearVelocity.x-=h*d.x;
j.m_linearVelocity.y-=h*d.y;j.m_angularVelocity-=g*(q*d.y-n*d.x+this.m_angularImpulse);o.m_linearVelocity.x+=l*d.x;o.m_linearVelocity.y+=l*d.y;o.m_angularVelocity+=b*(a*d.y-c*d.x+this.m_angularImpulse)}else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}};B.prototype.SolveVelocityConstraints=function(d){var h,l=0,j=this.m_bodyA,o=this.m_bodyB,q=j.m_linearVelocity,n=j.m_angularVelocity,a=o.m_linearVelocity,c=o.m_angularVelocity,g=j.m_invMass,b=o.m_invMass,e=j.m_invI,f=o.m_invI;h=j.m_xf.R;var m=
this.m_localAnchorA.x-j.m_sweep.localCenter.x,r=this.m_localAnchorA.y-j.m_sweep.localCenter.y;l=h.col1.x*m+h.col2.x*r;r=h.col1.y*m+h.col2.y*r;m=l;h=o.m_xf.R;var s=this.m_localAnchorB.x-o.m_sweep.localCenter.x,v=this.m_localAnchorB.y-o.m_sweep.localCenter.y;l=h.col1.x*s+h.col2.x*v;v=h.col1.y*s+h.col2.y*v;s=l;h=0;l=-this.m_angularMass*(c-n);var t=this.m_angularImpulse;h=d.dt*this.m_maxTorque;this.m_angularImpulse=y.Clamp(this.m_angularImpulse+l,-h,h);l=this.m_angularImpulse-t;n-=e*l;c+=f*l;h=y.MulMV(this.m_linearMass,
new w(-(a.x-c*v-q.x+n*r),-(a.y+c*s-q.y-n*m)));l=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(h);h=d.dt*this.m_maxForce;if(this.m_linearImpulse.LengthSquared()>h*h){this.m_linearImpulse.Normalize();this.m_linearImpulse.Multiply(h)}h=y.SubtractVV(this.m_linearImpulse,l);q.x-=g*h.x;q.y-=g*h.y;n-=e*(m*h.y-r*h.x);a.x+=b*h.x;a.y+=b*h.y;c+=f*(s*h.y-v*h.x);j.m_angularVelocity=n;o.m_angularVelocity=c};B.prototype.SolvePositionConstraints=function(){return true};Box2D.inherit(Q,Box2D.Dynamics.Joints.b2JointDef);
Q.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;Q.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new w;this.localAnchorB=new w};Q.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=I.e_frictionJoint;this.maxTorque=this.maxForce=0};Q.prototype.Initialize=function(d,h,l){this.bodyA=d;this.bodyB=h;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(l));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(l))};
Box2D.inherit(V,Box2D.Dynamics.Joints.b2Joint);V.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;V.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new w;this.m_groundAnchor2=new w;this.m_localAnchor1=new w;this.m_localAnchor2=new w;this.m_J=new L};V.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};V.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};V.prototype.GetReactionForce=
function(d){if(d===undefined)d=0;return new w(d*this.m_impulse*this.m_J.linearB.x,d*this.m_impulse*this.m_J.linearB.y)};V.prototype.GetReactionTorque=function(d){if(d===undefined)d=0;var h=this.m_bodyB.m_xf.R,l=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,j=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,o=h.col1.x*l+h.col2.x*j;j=h.col1.y*l+h.col2.y*j;l=o;return d*(this.m_impulse*this.m_J.angularB-l*this.m_impulse*this.m_J.linearB.y+j*this.m_impulse*this.m_J.linearB.x)};V.prototype.GetRatio=
function(){return this.m_ratio};V.prototype.SetRatio=function(d){if(d===undefined)d=0;this.m_ratio=d};V.prototype.b2GearJoint=function(d){this.__super.b2Joint.call(this,d);var h=parseInt(d.joint1.m_type),l=parseInt(d.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var j=0,o=0;this.m_ground1=d.joint1.GetBodyA();this.m_bodyA=d.joint1.GetBodyB();if(h==I.e_revoluteJoint){this.m_revolute1=d.joint1 instanceof N?d.joint1:null;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);
this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);j=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=d.joint1 instanceof H?d.joint1:null;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);j=this.m_prismatic1.GetJointTranslation()}this.m_ground2=d.joint2.GetBodyA();this.m_bodyB=d.joint2.GetBodyB();if(l==I.e_revoluteJoint){this.m_revolute2=d.joint2 instanceof N?d.joint2:null;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);
this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);o=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=d.joint2 instanceof H?d.joint2:null;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);o=this.m_prismatic2.GetJointTranslation()}this.m_ratio=d.ratio;this.m_constant=j+this.m_ratio*o;this.m_impulse=0};V.prototype.InitVelocityConstraints=function(d){var h=this.m_ground1,l=this.m_ground2,j=this.m_bodyA,o=this.m_bodyB,
q=0,n=0,a=0,c=0,g=a=0,b=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angularA=-1;b+=j.m_invI}else{h=h.m_xf.R;n=this.m_prismatic1.m_localXAxis1;q=h.col1.x*n.x+h.col2.x*n.y;n=h.col1.y*n.x+h.col2.y*n.y;h=j.m_xf.R;a=this.m_localAnchor1.x-j.m_sweep.localCenter.x;c=this.m_localAnchor1.y-j.m_sweep.localCenter.y;g=h.col1.x*a+h.col2.x*c;c=h.col1.y*a+h.col2.y*c;a=g;a=a*n-c*q;this.m_J.linearA.Set(-q,-n);this.m_J.angularA=-a;b+=j.m_invMass+j.m_invI*a*a}if(this.m_revolute2){this.m_J.angularB=-this.m_ratio;
b+=this.m_ratio*this.m_ratio*o.m_invI}else{h=l.m_xf.R;n=this.m_prismatic2.m_localXAxis1;q=h.col1.x*n.x+h.col2.x*n.y;n=h.col1.y*n.x+h.col2.y*n.y;h=o.m_xf.R;a=this.m_localAnchor2.x-o.m_sweep.localCenter.x;c=this.m_localAnchor2.y-o.m_sweep.localCenter.y;g=h.col1.x*a+h.col2.x*c;c=h.col1.y*a+h.col2.y*c;a=g;a=a*n-c*q;this.m_J.linearB.Set(-this.m_ratio*q,-this.m_ratio*n);this.m_J.angularB=-this.m_ratio*a;b+=this.m_ratio*this.m_ratio*(o.m_invMass+o.m_invI*a*a)}this.m_mass=b>0?1/b:0;if(d.warmStarting){j.m_linearVelocity.x+=
j.m_invMass*this.m_impulse*this.m_J.linearA.x;j.m_linearVelocity.y+=j.m_invMass*this.m_impulse*this.m_J.linearA.y;j.m_angularVelocity+=j.m_invI*this.m_impulse*this.m_J.angularA;o.m_linearVelocity.x+=o.m_invMass*this.m_impulse*this.m_J.linearB.x;o.m_linearVelocity.y+=o.m_invMass*this.m_impulse*this.m_J.linearB.y;o.m_angularVelocity+=o.m_invI*this.m_impulse*this.m_J.angularB}else this.m_impulse=0};V.prototype.SolveVelocityConstraints=function(){var d=this.m_bodyA,h=this.m_bodyB,l=-this.m_mass*this.m_J.Compute(d.m_linearVelocity,
d.m_angularVelocity,h.m_linearVelocity,h.m_angularVelocity);this.m_impulse+=l;d.m_linearVelocity.x+=d.m_invMass*l*this.m_J.linearA.x;d.m_linearVelocity.y+=d.m_invMass*l*this.m_J.linearA.y;d.m_angularVelocity+=d.m_invI*l*this.m_J.angularA;h.m_linearVelocity.x+=h.m_invMass*l*this.m_J.linearB.x;h.m_linearVelocity.y+=h.m_invMass*l*this.m_J.linearB.y;h.m_angularVelocity+=h.m_invI*l*this.m_J.angularB};V.prototype.SolvePositionConstraints=function(){var d=this.m_bodyA,h=this.m_bodyB,l=0,j=0;l=this.m_revolute1?
this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation();j=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();l=-this.m_mass*(this.m_constant-(l+this.m_ratio*j));d.m_sweep.c.x+=d.m_invMass*l*this.m_J.linearA.x;d.m_sweep.c.y+=d.m_invMass*l*this.m_J.linearA.y;d.m_sweep.a+=d.m_invI*l*this.m_J.angularA;h.m_sweep.c.x+=h.m_invMass*l*this.m_J.linearB.x;h.m_sweep.c.y+=h.m_invMass*l*this.m_J.linearB.y;h.m_sweep.a+=h.m_invI*l*this.m_J.angularB;d.SynchronizeTransform();
h.SynchronizeTransform();return 0<F.b2_linearSlop};Box2D.inherit(M,Box2D.Dynamics.Joints.b2JointDef);M.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;M.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};M.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=I.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};L.b2Jacobian=function(){this.linearA=new w;this.linearB=new w};L.prototype.SetZero=function(){this.linearA.SetZero();
this.angularA=0;this.linearB.SetZero();this.angularB=0};L.prototype.Set=function(d,h,l,j){if(h===undefined)h=0;if(j===undefined)j=0;this.linearA.SetV(d);this.angularA=h;this.linearB.SetV(l);this.angularB=j};L.prototype.Compute=function(d,h,l,j){if(h===undefined)h=0;if(j===undefined)j=0;return this.linearA.x*d.x+this.linearA.y*d.y+this.angularA*h+(this.linearB.x*l.x+this.linearB.y*l.y)+this.angularB*j};I.b2Joint=function(){this.m_edgeA=new Y;this.m_edgeB=new Y;this.m_localCenterA=new w;this.m_localCenterB=
new w};I.prototype.GetType=function(){return this.m_type};I.prototype.GetAnchorA=function(){return null};I.prototype.GetAnchorB=function(){return null};I.prototype.GetReactionForce=function(){return null};I.prototype.GetReactionTorque=function(){return 0};I.prototype.GetBodyA=function(){return this.m_bodyA};I.prototype.GetBodyB=function(){return this.m_bodyB};I.prototype.GetNext=function(){return this.m_next};I.prototype.GetUserData=function(){return this.m_userData};I.prototype.SetUserData=function(d){this.m_userData=
d};I.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};I.Create=function(d){var h=null;switch(d.type){case I.e_distanceJoint:h=new U(d instanceof p?d:null);break;case I.e_mouseJoint:h=new u(d instanceof D?d:null);break;case I.e_prismaticJoint:h=new H(d instanceof O?d:null);break;case I.e_revoluteJoint:h=new N(d instanceof S?d:null);break;case I.e_pulleyJoint:h=new E(d instanceof R?d:null);break;case I.e_gearJoint:h=new V(d instanceof M?d:null);break;case I.e_lineJoint:h=
new k(d instanceof z?d:null);break;case I.e_weldJoint:h=new aa(d instanceof Z?d:null);break;case I.e_frictionJoint:h=new B(d instanceof Q?d:null)}return h};I.Destroy=function(){};I.prototype.b2Joint=function(d){F.b2Assert(d.bodyA!=d.bodyB);this.m_type=d.type;this.m_next=this.m_prev=null;this.m_bodyA=d.bodyA;this.m_bodyB=d.bodyB;this.m_collideConnected=d.collideConnected;this.m_islandFlag=false;this.m_userData=d.userData};I.prototype.InitVelocityConstraints=function(){};I.prototype.SolveVelocityConstraints=
function(){};I.prototype.FinalizeVelocityConstraints=function(){};I.prototype.SolvePositionConstraints=function(){return false};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=
7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});W.b2JointDef=function(){};W.prototype.b2JointDef=function(){this.type=I.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=false};Y.b2JointEdge=function(){};Box2D.inherit(k,Box2D.Dynamics.Joints.b2Joint);
k.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;k.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new w;this.m_localAnchor2=new w;this.m_localXAxis1=new w;this.m_localYAxis1=new w;this.m_axis=new w;this.m_perp=new w;this.m_K=new G;this.m_impulse=new w};k.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};k.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};k.prototype.GetReactionForce=
function(d){if(d===undefined)d=0;return new w(d*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),d*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};k.prototype.GetReactionTorque=function(d){if(d===undefined)d=0;return d*this.m_impulse.y};k.prototype.GetJointTranslation=function(){var d=this.m_bodyA,h=this.m_bodyB,l=d.GetWorldPoint(this.m_localAnchor1),j=h.GetWorldPoint(this.m_localAnchor2);h=j.x-l.x;l=j.y-l.y;d=d.GetWorldVector(this.m_localXAxis1);
return d.x*h+d.y*l};k.prototype.GetJointSpeed=function(){var d=this.m_bodyA,h=this.m_bodyB,l;l=d.m_xf.R;var j=this.m_localAnchor1.x-d.m_sweep.localCenter.x,o=this.m_localAnchor1.y-d.m_sweep.localCenter.y,q=l.col1.x*j+l.col2.x*o;o=l.col1.y*j+l.col2.y*o;j=q;l=h.m_xf.R;var n=this.m_localAnchor2.x-h.m_sweep.localCenter.x,a=this.m_localAnchor2.y-h.m_sweep.localCenter.y;q=l.col1.x*n+l.col2.x*a;a=l.col1.y*n+l.col2.y*a;n=q;l=h.m_sweep.c.x+n-(d.m_sweep.c.x+j);q=h.m_sweep.c.y+a-(d.m_sweep.c.y+o);var c=d.GetWorldVector(this.m_localXAxis1),
g=d.m_linearVelocity,b=h.m_linearVelocity;d=d.m_angularVelocity;h=h.m_angularVelocity;return l*-d*c.y+q*d*c.x+(c.x*(b.x+-h*a-g.x- -d*o)+c.y*(b.y+h*n-g.y-d*j))};k.prototype.IsLimitEnabled=function(){return this.m_enableLimit};k.prototype.EnableLimit=function(d){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=d};k.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};k.prototype.GetUpperLimit=function(){return this.m_upperTranslation};k.prototype.SetLimits=function(d,
h){if(d===undefined)d=0;if(h===undefined)h=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=d;this.m_upperTranslation=h};k.prototype.IsMotorEnabled=function(){return this.m_enableMotor};k.prototype.EnableMotor=function(d){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=d};k.prototype.SetMotorSpeed=function(d){if(d===undefined)d=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=d};k.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};
k.prototype.SetMaxMotorForce=function(d){if(d===undefined)d=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=d};k.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};k.prototype.GetMotorForce=function(){return this.m_motorImpulse};k.prototype.b2LineJoint=function(d){this.__super.b2Joint.call(this,d);this.m_localAnchor1.SetV(d.localAnchorA);this.m_localAnchor2.SetV(d.localAnchorB);this.m_localXAxis1.SetV(d.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;
this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=d.lowerTranslation;this.m_upperTranslation=d.upperTranslation;this.m_maxMotorForce=d.maxMotorForce;this.m_motorSpeed=d.motorSpeed;this.m_enableLimit=d.enableLimit;this.m_enableMotor=d.enableMotor;this.m_limitState=I.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};k.prototype.InitVelocityConstraints=function(d){var h=this.m_bodyA,l=this.m_bodyB,j,o=0;this.m_localCenterA.SetV(h.GetLocalCenter());
this.m_localCenterB.SetV(l.GetLocalCenter());var q=h.GetTransform();l.GetTransform();j=h.m_xf.R;var n=this.m_localAnchor1.x-this.m_localCenterA.x,a=this.m_localAnchor1.y-this.m_localCenterA.y;o=j.col1.x*n+j.col2.x*a;a=j.col1.y*n+j.col2.y*a;n=o;j=l.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,g=this.m_localAnchor2.y-this.m_localCenterB.y;o=j.col1.x*c+j.col2.x*g;g=j.col1.y*c+j.col2.y*g;c=o;j=l.m_sweep.c.x+c-h.m_sweep.c.x-n;o=l.m_sweep.c.y+g-h.m_sweep.c.y-a;this.m_invMassA=h.m_invMass;this.m_invMassB=
l.m_invMass;this.m_invIA=h.m_invI;this.m_invIB=l.m_invI;this.m_axis.SetV(y.MulMV(q.R,this.m_localXAxis1));this.m_a1=(j+n)*this.m_axis.y-(o+a)*this.m_axis.x;this.m_a2=c*this.m_axis.y-g*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(y.MulMV(q.R,this.m_localYAxis1));this.m_s1=(j+n)*this.m_perp.y-(o+a)*this.m_perp.x;this.m_s2=c*this.m_perp.y-
g*this.m_perp.x;q=this.m_invMassA;n=this.m_invMassB;a=this.m_invIA;c=this.m_invIB;this.m_K.col1.x=q+n+a*this.m_s1*this.m_s1+c*this.m_s2*this.m_s2;this.m_K.col1.y=a*this.m_s1*this.m_a1+c*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=q+n+a*this.m_a1*this.m_a1+c*this.m_a2*this.m_a2;if(this.m_enableLimit){j=this.m_axis.x*j+this.m_axis.y*o;if(y.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*F.b2_linearSlop)this.m_limitState=I.e_equalLimits;else if(j<=this.m_lowerTranslation){if(this.m_limitState!=
I.e_atLowerLimit){this.m_limitState=I.e_atLowerLimit;this.m_impulse.y=0}}else if(j>=this.m_upperTranslation){if(this.m_limitState!=I.e_atUpperLimit){this.m_limitState=I.e_atUpperLimit;this.m_impulse.y=0}}else{this.m_limitState=I.e_inactiveLimit;this.m_impulse.y=0}}else this.m_limitState=I.e_inactiveLimit;if(this.m_enableMotor==false)this.m_motorImpulse=0;if(d.warmStarting){this.m_impulse.x*=d.dtRatio;this.m_impulse.y*=d.dtRatio;this.m_motorImpulse*=d.dtRatio;d=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+
this.m_impulse.y)*this.m_axis.x;j=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y;o=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1;q=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;h.m_linearVelocity.x-=this.m_invMassA*d;h.m_linearVelocity.y-=this.m_invMassA*j;h.m_angularVelocity-=this.m_invIA*o;l.m_linearVelocity.x+=this.m_invMassB*d;l.m_linearVelocity.y+=this.m_invMassB*j;l.m_angularVelocity+=this.m_invIB*
q}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};k.prototype.SolveVelocityConstraints=function(d){var h=this.m_bodyA,l=this.m_bodyB,j=h.m_linearVelocity,o=h.m_angularVelocity,q=l.m_linearVelocity,n=l.m_angularVelocity,a=0,c=0,g=0,b=0;if(this.m_enableMotor&&this.m_limitState!=I.e_equalLimits){b=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(q.x-j.x)+this.m_axis.y*(q.y-j.y)+this.m_a2*n-this.m_a1*o));a=this.m_motorImpulse;c=d.dt*this.m_maxMotorForce;this.m_motorImpulse=y.Clamp(this.m_motorImpulse+
b,-c,c);b=this.m_motorImpulse-a;a=b*this.m_axis.x;c=b*this.m_axis.y;g=b*this.m_a1;b=b*this.m_a2;j.x-=this.m_invMassA*a;j.y-=this.m_invMassA*c;o-=this.m_invIA*g;q.x+=this.m_invMassB*a;q.y+=this.m_invMassB*c;n+=this.m_invIB*b}c=this.m_perp.x*(q.x-j.x)+this.m_perp.y*(q.y-j.y)+this.m_s2*n-this.m_s1*o;if(this.m_enableLimit&&this.m_limitState!=I.e_inactiveLimit){g=this.m_axis.x*(q.x-j.x)+this.m_axis.y*(q.y-j.y)+this.m_a2*n-this.m_a1*o;a=this.m_impulse.Copy();d=this.m_K.Solve(new w,-c,-g);this.m_impulse.Add(d);
if(this.m_limitState==I.e_atLowerLimit)this.m_impulse.y=y.Max(this.m_impulse.y,0);else if(this.m_limitState==I.e_atUpperLimit)this.m_impulse.y=y.Min(this.m_impulse.y,0);c=-c-(this.m_impulse.y-a.y)*this.m_K.col2.x;g=0;g=this.m_K.col1.x!=0?c/this.m_K.col1.x+a.x:a.x;this.m_impulse.x=g;d.x=this.m_impulse.x-a.x;d.y=this.m_impulse.y-a.y;a=d.x*this.m_perp.x+d.y*this.m_axis.x;c=d.x*this.m_perp.y+d.y*this.m_axis.y;g=d.x*this.m_s1+d.y*this.m_a1;b=d.x*this.m_s2+d.y*this.m_a2}else{d=0;d=this.m_K.col1.x!=0?-c/
this.m_K.col1.x:0;this.m_impulse.x+=d;a=d*this.m_perp.x;c=d*this.m_perp.y;g=d*this.m_s1;b=d*this.m_s2}j.x-=this.m_invMassA*a;j.y-=this.m_invMassA*c;o-=this.m_invIA*g;q.x+=this.m_invMassB*a;q.y+=this.m_invMassB*c;n+=this.m_invIB*b;h.m_linearVelocity.SetV(j);h.m_angularVelocity=o;l.m_linearVelocity.SetV(q);l.m_angularVelocity=n};k.prototype.SolvePositionConstraints=function(){var d=this.m_bodyA,h=this.m_bodyB,l=d.m_sweep.c,j=d.m_sweep.a,o=h.m_sweep.c,q=h.m_sweep.a,n,a=0,c=0,g=0,b=0,e=n=0,f=0;c=false;
var m=0,r=G.FromAngle(j);g=G.FromAngle(q);n=r;f=this.m_localAnchor1.x-this.m_localCenterA.x;var s=this.m_localAnchor1.y-this.m_localCenterA.y;a=n.col1.x*f+n.col2.x*s;s=n.col1.y*f+n.col2.y*s;f=a;n=g;g=this.m_localAnchor2.x-this.m_localCenterB.x;b=this.m_localAnchor2.y-this.m_localCenterB.y;a=n.col1.x*g+n.col2.x*b;b=n.col1.y*g+n.col2.y*b;g=a;n=o.x+g-l.x-f;a=o.y+b-l.y-s;if(this.m_enableLimit){this.m_axis=y.MulMV(r,this.m_localXAxis1);this.m_a1=(n+f)*this.m_axis.y-(a+s)*this.m_axis.x;this.m_a2=g*this.m_axis.y-
b*this.m_axis.x;var v=this.m_axis.x*n+this.m_axis.y*a;if(y.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*F.b2_linearSlop){m=y.Clamp(v,-F.b2_maxLinearCorrection,F.b2_maxLinearCorrection);e=y.Abs(v);c=true}else if(v<=this.m_lowerTranslation){m=y.Clamp(v-this.m_lowerTranslation+F.b2_linearSlop,-F.b2_maxLinearCorrection,0);e=this.m_lowerTranslation-v;c=true}else if(v>=this.m_upperTranslation){m=y.Clamp(v-this.m_upperTranslation+F.b2_linearSlop,0,F.b2_maxLinearCorrection);e=v-this.m_upperTranslation;
c=true}}this.m_perp=y.MulMV(r,this.m_localYAxis1);this.m_s1=(n+f)*this.m_perp.y-(a+s)*this.m_perp.x;this.m_s2=g*this.m_perp.y-b*this.m_perp.x;r=new w;s=this.m_perp.x*n+this.m_perp.y*a;e=y.Max(e,y.Abs(s));f=0;if(c){c=this.m_invMassA;g=this.m_invMassB;b=this.m_invIA;n=this.m_invIB;this.m_K.col1.x=c+g+b*this.m_s1*this.m_s1+n*this.m_s2*this.m_s2;this.m_K.col1.y=b*this.m_s1*this.m_a1+n*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=c+g+b*this.m_a1*this.m_a1+n*this.m_a2*this.m_a2;this.m_K.Solve(r,
-s,-m)}else{c=this.m_invMassA;g=this.m_invMassB;b=this.m_invIA;n=this.m_invIB;m=c+g+b*this.m_s1*this.m_s1+n*this.m_s2*this.m_s2;c=0;c=m!=0?-s/m:0;r.x=c;r.y=0}m=r.x*this.m_perp.x+r.y*this.m_axis.x;c=r.x*this.m_perp.y+r.y*this.m_axis.y;s=r.x*this.m_s1+r.y*this.m_a1;r=r.x*this.m_s2+r.y*this.m_a2;l.x-=this.m_invMassA*m;l.y-=this.m_invMassA*c;j-=this.m_invIA*s;o.x+=this.m_invMassB*m;o.y+=this.m_invMassB*c;q+=this.m_invIB*r;d.m_sweep.a=j;h.m_sweep.a=q;d.SynchronizeTransform();h.SynchronizeTransform();return e<=
F.b2_linearSlop&&f<=F.b2_angularSlop};Box2D.inherit(z,Box2D.Dynamics.Joints.b2JointDef);z.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;z.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new w;this.localAnchorB=new w;this.localAxisA=new w};z.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=I.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=false;this.upperTranslation=this.lowerTranslation=
0;this.enableMotor=false;this.motorSpeed=this.maxMotorForce=0};z.prototype.Initialize=function(d,h,l,j){this.bodyA=d;this.bodyB=h;this.localAnchorA=this.bodyA.GetLocalPoint(l);this.localAnchorB=this.bodyB.GetLocalPoint(l);this.localAxisA=this.bodyA.GetLocalVector(j)};Box2D.inherit(u,Box2D.Dynamics.Joints.b2Joint);u.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;u.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new G;this.K1=new G;this.K2=new G;
this.m_localAnchor=new w;this.m_target=new w;this.m_impulse=new w;this.m_mass=new G;this.m_C=new w};u.prototype.GetAnchorA=function(){return this.m_target};u.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};u.prototype.GetReactionForce=function(d){if(d===undefined)d=0;return new w(d*this.m_impulse.x,d*this.m_impulse.y)};u.prototype.GetReactionTorque=function(){return 0};u.prototype.GetTarget=function(){return this.m_target};u.prototype.SetTarget=function(d){this.m_bodyB.IsAwake()==
false&&this.m_bodyB.SetAwake(true);this.m_target=d};u.prototype.GetMaxForce=function(){return this.m_maxForce};u.prototype.SetMaxForce=function(d){if(d===undefined)d=0;this.m_maxForce=d};u.prototype.GetFrequency=function(){return this.m_frequencyHz};u.prototype.SetFrequency=function(d){if(d===undefined)d=0;this.m_frequencyHz=d};u.prototype.GetDampingRatio=function(){return this.m_dampingRatio};u.prototype.SetDampingRatio=function(d){if(d===undefined)d=0;this.m_dampingRatio=d};u.prototype.b2MouseJoint=
function(d){this.__super.b2Joint.call(this,d);this.m_target.SetV(d.target);var h=this.m_target.x-this.m_bodyB.m_xf.position.x,l=this.m_target.y-this.m_bodyB.m_xf.position.y,j=this.m_bodyB.m_xf.R;this.m_localAnchor.x=h*j.col1.x+l*j.col1.y;this.m_localAnchor.y=h*j.col2.x+l*j.col2.y;this.m_maxForce=d.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=d.frequencyHz;this.m_dampingRatio=d.dampingRatio;this.m_gamma=this.m_beta=0};u.prototype.InitVelocityConstraints=function(d){var h=this.m_bodyB,l=h.GetMass(),
j=2*Math.PI*this.m_frequencyHz,o=l*j*j;this.m_gamma=d.dt*(2*l*this.m_dampingRatio*j+d.dt*o);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=d.dt*o*this.m_gamma;o=h.m_xf.R;l=this.m_localAnchor.x-h.m_sweep.localCenter.x;j=this.m_localAnchor.y-h.m_sweep.localCenter.y;var q=o.col1.x*l+o.col2.x*j;j=o.col1.y*l+o.col2.y*j;l=q;o=h.m_invMass;q=h.m_invI;this.K1.col1.x=o;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=o;this.K2.col1.x=q*j*j;this.K2.col2.x=-q*l*j;this.K2.col1.y=-q*l*j;this.K2.col2.y=
q*l*l;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=h.m_sweep.c.x+l-this.m_target.x;this.m_C.y=h.m_sweep.c.y+j-this.m_target.y;h.m_angularVelocity*=0.98;this.m_impulse.x*=d.dtRatio;this.m_impulse.y*=d.dtRatio;h.m_linearVelocity.x+=o*this.m_impulse.x;h.m_linearVelocity.y+=o*this.m_impulse.y;h.m_angularVelocity+=q*(l*this.m_impulse.y-j*this.m_impulse.x)};u.prototype.SolveVelocityConstraints=function(d){var h=
this.m_bodyB,l,j=0,o=0;l=h.m_xf.R;var q=this.m_localAnchor.x-h.m_sweep.localCenter.x,n=this.m_localAnchor.y-h.m_sweep.localCenter.y;j=l.col1.x*q+l.col2.x*n;n=l.col1.y*q+l.col2.y*n;q=j;j=h.m_linearVelocity.x+-h.m_angularVelocity*n;var a=h.m_linearVelocity.y+h.m_angularVelocity*q;l=this.m_mass;j=j+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;o=a+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;a=-(l.col1.x*j+l.col2.x*o);o=-(l.col1.y*j+l.col2.y*o);l=this.m_impulse.x;j=this.m_impulse.y;this.m_impulse.x+=
a;this.m_impulse.y+=o;d=d.dt*this.m_maxForce;this.m_impulse.LengthSquared()>d*d&&this.m_impulse.Multiply(d/this.m_impulse.Length());a=this.m_impulse.x-l;o=this.m_impulse.y-j;h.m_linearVelocity.x+=h.m_invMass*a;h.m_linearVelocity.y+=h.m_invMass*o;h.m_angularVelocity+=h.m_invI*(q*o-n*a)};u.prototype.SolvePositionConstraints=function(){return true};Box2D.inherit(D,Box2D.Dynamics.Joints.b2JointDef);D.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;D.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.target=new w};D.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=I.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7};Box2D.inherit(H,Box2D.Dynamics.Joints.b2Joint);H.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;H.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new w;this.m_localAnchor2=new w;this.m_localXAxis1=new w;this.m_localYAxis1=new w;this.m_axis=new w;
this.m_perp=new w;this.m_K=new K;this.m_impulse=new A};H.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};H.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};H.prototype.GetReactionForce=function(d){if(d===undefined)d=0;return new w(d*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),d*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};H.prototype.GetReactionTorque=
function(d){if(d===undefined)d=0;return d*this.m_impulse.y};H.prototype.GetJointTranslation=function(){var d=this.m_bodyA,h=this.m_bodyB,l=d.GetWorldPoint(this.m_localAnchor1),j=h.GetWorldPoint(this.m_localAnchor2);h=j.x-l.x;l=j.y-l.y;d=d.GetWorldVector(this.m_localXAxis1);return d.x*h+d.y*l};H.prototype.GetJointSpeed=function(){var d=this.m_bodyA,h=this.m_bodyB,l;l=d.m_xf.R;var j=this.m_localAnchor1.x-d.m_sweep.localCenter.x,o=this.m_localAnchor1.y-d.m_sweep.localCenter.y,q=l.col1.x*j+l.col2.x*o;
o=l.col1.y*j+l.col2.y*o;j=q;l=h.m_xf.R;var n=this.m_localAnchor2.x-h.m_sweep.localCenter.x,a=this.m_localAnchor2.y-h.m_sweep.localCenter.y;q=l.col1.x*n+l.col2.x*a;a=l.col1.y*n+l.col2.y*a;n=q;l=h.m_sweep.c.x+n-(d.m_sweep.c.x+j);q=h.m_sweep.c.y+a-(d.m_sweep.c.y+o);var c=d.GetWorldVector(this.m_localXAxis1),g=d.m_linearVelocity,b=h.m_linearVelocity;d=d.m_angularVelocity;h=h.m_angularVelocity;return l*-d*c.y+q*d*c.x+(c.x*(b.x+-h*a-g.x- -d*o)+c.y*(b.y+h*n-g.y-d*j))};H.prototype.IsLimitEnabled=function(){return this.m_enableLimit};
H.prototype.EnableLimit=function(d){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=d};H.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};H.prototype.GetUpperLimit=function(){return this.m_upperTranslation};H.prototype.SetLimits=function(d,h){if(d===undefined)d=0;if(h===undefined)h=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=d;this.m_upperTranslation=h};H.prototype.IsMotorEnabled=function(){return this.m_enableMotor};
H.prototype.EnableMotor=function(d){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=d};H.prototype.SetMotorSpeed=function(d){if(d===undefined)d=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=d};H.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};H.prototype.SetMaxMotorForce=function(d){if(d===undefined)d=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=d};H.prototype.GetMotorForce=function(){return this.m_motorImpulse};
H.prototype.b2PrismaticJoint=function(d){this.__super.b2Joint.call(this,d);this.m_localAnchor1.SetV(d.localAnchorA);this.m_localAnchor2.SetV(d.localAnchorB);this.m_localXAxis1.SetV(d.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=d.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=d.lowerTranslation;this.m_upperTranslation=d.upperTranslation;this.m_maxMotorForce=d.maxMotorForce;this.m_motorSpeed=
d.motorSpeed;this.m_enableLimit=d.enableLimit;this.m_enableMotor=d.enableMotor;this.m_limitState=I.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};H.prototype.InitVelocityConstraints=function(d){var h=this.m_bodyA,l=this.m_bodyB,j,o=0;this.m_localCenterA.SetV(h.GetLocalCenter());this.m_localCenterB.SetV(l.GetLocalCenter());var q=h.GetTransform();l.GetTransform();j=h.m_xf.R;var n=this.m_localAnchor1.x-this.m_localCenterA.x,a=this.m_localAnchor1.y-this.m_localCenterA.y;o=j.col1.x*n+j.col2.x*
a;a=j.col1.y*n+j.col2.y*a;n=o;j=l.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,g=this.m_localAnchor2.y-this.m_localCenterB.y;o=j.col1.x*c+j.col2.x*g;g=j.col1.y*c+j.col2.y*g;c=o;j=l.m_sweep.c.x+c-h.m_sweep.c.x-n;o=l.m_sweep.c.y+g-h.m_sweep.c.y-a;this.m_invMassA=h.m_invMass;this.m_invMassB=l.m_invMass;this.m_invIA=h.m_invI;this.m_invIB=l.m_invI;this.m_axis.SetV(y.MulMV(q.R,this.m_localXAxis1));this.m_a1=(j+n)*this.m_axis.y-(o+a)*this.m_axis.x;this.m_a2=c*this.m_axis.y-g*this.m_axis.x;this.m_motorMass=
this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Number.MIN_VALUE)this.m_motorMass=1/this.m_motorMass;this.m_perp.SetV(y.MulMV(q.R,this.m_localYAxis1));this.m_s1=(j+n)*this.m_perp.y-(o+a)*this.m_perp.x;this.m_s2=c*this.m_perp.y-g*this.m_perp.x;q=this.m_invMassA;n=this.m_invMassB;a=this.m_invIA;c=this.m_invIB;this.m_K.col1.x=q+n+a*this.m_s1*this.m_s1+c*this.m_s2*this.m_s2;this.m_K.col1.y=a*this.m_s1+c*this.m_s2;this.m_K.col1.z=a*
this.m_s1*this.m_a1+c*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=a+c;this.m_K.col2.z=a*this.m_a1+c*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=q+n+a*this.m_a1*this.m_a1+c*this.m_a2*this.m_a2;if(this.m_enableLimit){j=this.m_axis.x*j+this.m_axis.y*o;if(y.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*F.b2_linearSlop)this.m_limitState=I.e_equalLimits;else if(j<=this.m_lowerTranslation){if(this.m_limitState!=I.e_atLowerLimit){this.m_limitState=
I.e_atLowerLimit;this.m_impulse.z=0}}else if(j>=this.m_upperTranslation){if(this.m_limitState!=I.e_atUpperLimit){this.m_limitState=I.e_atUpperLimit;this.m_impulse.z=0}}else{this.m_limitState=I.e_inactiveLimit;this.m_impulse.z=0}}else this.m_limitState=I.e_inactiveLimit;if(this.m_enableMotor==false)this.m_motorImpulse=0;if(d.warmStarting){this.m_impulse.x*=d.dtRatio;this.m_impulse.y*=d.dtRatio;this.m_motorImpulse*=d.dtRatio;d=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x;
j=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y;o=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1;q=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;h.m_linearVelocity.x-=this.m_invMassA*d;h.m_linearVelocity.y-=this.m_invMassA*j;h.m_angularVelocity-=this.m_invIA*o;l.m_linearVelocity.x+=this.m_invMassB*d;l.m_linearVelocity.y+=this.m_invMassB*j;l.m_angularVelocity+=this.m_invIB*
q}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};H.prototype.SolveVelocityConstraints=function(d){var h=this.m_bodyA,l=this.m_bodyB,j=h.m_linearVelocity,o=h.m_angularVelocity,q=l.m_linearVelocity,n=l.m_angularVelocity,a=0,c=0,g=0,b=0;if(this.m_enableMotor&&this.m_limitState!=I.e_equalLimits){b=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(q.x-j.x)+this.m_axis.y*(q.y-j.y)+this.m_a2*n-this.m_a1*o));a=this.m_motorImpulse;d=d.dt*this.m_maxMotorForce;this.m_motorImpulse=y.Clamp(this.m_motorImpulse+
b,-d,d);b=this.m_motorImpulse-a;a=b*this.m_axis.x;c=b*this.m_axis.y;g=b*this.m_a1;b=b*this.m_a2;j.x-=this.m_invMassA*a;j.y-=this.m_invMassA*c;o-=this.m_invIA*g;q.x+=this.m_invMassB*a;q.y+=this.m_invMassB*c;n+=this.m_invIB*b}g=this.m_perp.x*(q.x-j.x)+this.m_perp.y*(q.y-j.y)+this.m_s2*n-this.m_s1*o;c=n-o;if(this.m_enableLimit&&this.m_limitState!=I.e_inactiveLimit){d=this.m_axis.x*(q.x-j.x)+this.m_axis.y*(q.y-j.y)+this.m_a2*n-this.m_a1*o;a=this.m_impulse.Copy();d=this.m_K.Solve33(new A,-g,-c,-d);this.m_impulse.Add(d);
if(this.m_limitState==I.e_atLowerLimit)this.m_impulse.z=y.Max(this.m_impulse.z,0);else if(this.m_limitState==I.e_atUpperLimit)this.m_impulse.z=y.Min(this.m_impulse.z,0);g=-g-(this.m_impulse.z-a.z)*this.m_K.col3.x;c=-c-(this.m_impulse.z-a.z)*this.m_K.col3.y;c=this.m_K.Solve22(new w,g,c);c.x+=a.x;c.y+=a.y;this.m_impulse.x=c.x;this.m_impulse.y=c.y;d.x=this.m_impulse.x-a.x;d.y=this.m_impulse.y-a.y;d.z=this.m_impulse.z-a.z;a=d.x*this.m_perp.x+d.z*this.m_axis.x;c=d.x*this.m_perp.y+d.z*this.m_axis.y;g=d.x*
this.m_s1+d.y+d.z*this.m_a1;b=d.x*this.m_s2+d.y+d.z*this.m_a2}else{d=this.m_K.Solve22(new w,-g,-c);this.m_impulse.x+=d.x;this.m_impulse.y+=d.y;a=d.x*this.m_perp.x;c=d.x*this.m_perp.y;g=d.x*this.m_s1+d.y;b=d.x*this.m_s2+d.y}j.x-=this.m_invMassA*a;j.y-=this.m_invMassA*c;o-=this.m_invIA*g;q.x+=this.m_invMassB*a;q.y+=this.m_invMassB*c;n+=this.m_invIB*b;h.m_linearVelocity.SetV(j);h.m_angularVelocity=o;l.m_linearVelocity.SetV(q);l.m_angularVelocity=n};H.prototype.SolvePositionConstraints=function(){var d=
this.m_bodyA,h=this.m_bodyB,l=d.m_sweep.c,j=d.m_sweep.a,o=h.m_sweep.c,q=h.m_sweep.a,n,a=0,c=0,g=0,b=a=n=0,e=0;c=false;var f=0,m=G.FromAngle(j),r=G.FromAngle(q);n=m;e=this.m_localAnchor1.x-this.m_localCenterA.x;var s=this.m_localAnchor1.y-this.m_localCenterA.y;a=n.col1.x*e+n.col2.x*s;s=n.col1.y*e+n.col2.y*s;e=a;n=r;r=this.m_localAnchor2.x-this.m_localCenterB.x;g=this.m_localAnchor2.y-this.m_localCenterB.y;a=n.col1.x*r+n.col2.x*g;g=n.col1.y*r+n.col2.y*g;r=a;n=o.x+r-l.x-e;a=o.y+g-l.y-s;if(this.m_enableLimit){this.m_axis=
y.MulMV(m,this.m_localXAxis1);this.m_a1=(n+e)*this.m_axis.y-(a+s)*this.m_axis.x;this.m_a2=r*this.m_axis.y-g*this.m_axis.x;var v=this.m_axis.x*n+this.m_axis.y*a;if(y.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*F.b2_linearSlop){f=y.Clamp(v,-F.b2_maxLinearCorrection,F.b2_maxLinearCorrection);b=y.Abs(v);c=true}else if(v<=this.m_lowerTranslation){f=y.Clamp(v-this.m_lowerTranslation+F.b2_linearSlop,-F.b2_maxLinearCorrection,0);b=this.m_lowerTranslation-v;c=true}else if(v>=this.m_upperTranslation){f=
y.Clamp(v-this.m_upperTranslation+F.b2_linearSlop,0,F.b2_maxLinearCorrection);b=v-this.m_upperTranslation;c=true}}this.m_perp=y.MulMV(m,this.m_localYAxis1);this.m_s1=(n+e)*this.m_perp.y-(a+s)*this.m_perp.x;this.m_s2=r*this.m_perp.y-g*this.m_perp.x;m=new A;s=this.m_perp.x*n+this.m_perp.y*a;r=q-j-this.m_refAngle;b=y.Max(b,y.Abs(s));e=y.Abs(r);if(c){c=this.m_invMassA;g=this.m_invMassB;n=this.m_invIA;a=this.m_invIB;this.m_K.col1.x=c+g+n*this.m_s1*this.m_s1+a*this.m_s2*this.m_s2;this.m_K.col1.y=n*this.m_s1+
a*this.m_s2;this.m_K.col1.z=n*this.m_s1*this.m_a1+a*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=n+a;this.m_K.col2.z=n*this.m_a1+a*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=c+g+n*this.m_a1*this.m_a1+a*this.m_a2*this.m_a2;this.m_K.Solve33(m,-s,-r,-f)}else{c=this.m_invMassA;g=this.m_invMassB;n=this.m_invIA;a=this.m_invIB;f=n*this.m_s1+a*this.m_s2;v=n+a;this.m_K.col1.Set(c+g+n*this.m_s1*this.m_s1+a*this.m_s2*this.m_s2,f,0);this.m_K.col2.Set(f,
v,0);f=this.m_K.Solve22(new w,-s,-r);m.x=f.x;m.y=f.y;m.z=0}f=m.x*this.m_perp.x+m.z*this.m_axis.x;c=m.x*this.m_perp.y+m.z*this.m_axis.y;s=m.x*this.m_s1+m.y+m.z*this.m_a1;m=m.x*this.m_s2+m.y+m.z*this.m_a2;l.x-=this.m_invMassA*f;l.y-=this.m_invMassA*c;j-=this.m_invIA*s;o.x+=this.m_invMassB*f;o.y+=this.m_invMassB*c;q+=this.m_invIB*m;d.m_sweep.a=j;h.m_sweep.a=q;d.SynchronizeTransform();h.SynchronizeTransform();return b<=F.b2_linearSlop&&e<=F.b2_angularSlop};Box2D.inherit(O,Box2D.Dynamics.Joints.b2JointDef);
O.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;O.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new w;this.localAnchorB=new w;this.localAxisA=new w};O.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=I.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=false;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=false;this.motorSpeed=this.maxMotorForce=
0};O.prototype.Initialize=function(d,h,l,j){this.bodyA=d;this.bodyB=h;this.localAnchorA=this.bodyA.GetLocalPoint(l);this.localAnchorB=this.bodyB.GetLocalPoint(l);this.localAxisA=this.bodyA.GetLocalVector(j);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(E,Box2D.Dynamics.Joints.b2Joint);E.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;E.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new w;this.m_groundAnchor2=
new w;this.m_localAnchor1=new w;this.m_localAnchor2=new w;this.m_u1=new w;this.m_u2=new w};E.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};E.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};E.prototype.GetReactionForce=function(d){if(d===undefined)d=0;return new w(d*this.m_impulse*this.m_u2.x,d*this.m_impulse*this.m_u2.y)};E.prototype.GetReactionTorque=function(){return 0};E.prototype.GetGroundAnchorA=function(){var d=
this.m_ground.m_xf.position.Copy();d.Add(this.m_groundAnchor1);return d};E.prototype.GetGroundAnchorB=function(){var d=this.m_ground.m_xf.position.Copy();d.Add(this.m_groundAnchor2);return d};E.prototype.GetLength1=function(){var d=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),h=d.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);d=d.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(h*h+d*d)};E.prototype.GetLength2=function(){var d=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),
h=d.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);d=d.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(h*h+d*d)};E.prototype.GetRatio=function(){return this.m_ratio};E.prototype.b2PulleyJoint=function(d){this.__super.b2Joint.call(this,d);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=d.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=d.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=d.groundAnchorB.x-
this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=d.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(d.localAnchorA);this.m_localAnchor2.SetV(d.localAnchorB);this.m_ratio=d.ratio;this.m_constant=d.lengthA+this.m_ratio*d.lengthB;this.m_maxLength1=y.Min(d.maxLengthA,this.m_constant-this.m_ratio*E.b2_minPulleyLength);this.m_maxLength2=y.Min(d.maxLengthB,(this.m_constant-E.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};E.prototype.InitVelocityConstraints=
function(d){var h=this.m_bodyA,l=this.m_bodyB,j;j=h.m_xf.R;var o=this.m_localAnchor1.x-h.m_sweep.localCenter.x,q=this.m_localAnchor1.y-h.m_sweep.localCenter.y,n=j.col1.x*o+j.col2.x*q;q=j.col1.y*o+j.col2.y*q;o=n;j=l.m_xf.R;var a=this.m_localAnchor2.x-l.m_sweep.localCenter.x,c=this.m_localAnchor2.y-l.m_sweep.localCenter.y;n=j.col1.x*a+j.col2.x*c;c=j.col1.y*a+j.col2.y*c;a=n;j=l.m_sweep.c.x+a;n=l.m_sweep.c.y+c;var g=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,b=this.m_ground.m_xf.position.y+
this.m_groundAnchor2.y;this.m_u1.Set(h.m_sweep.c.x+o-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),h.m_sweep.c.y+q-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(j-g,n-b);j=this.m_u1.Length();n=this.m_u2.Length();j>F.b2_linearSlop?this.m_u1.Multiply(1/j):this.m_u1.SetZero();n>F.b2_linearSlop?this.m_u2.Multiply(1/n):this.m_u2.SetZero();if(this.m_constant-j-this.m_ratio*n>0){this.m_state=I.e_inactiveLimit;this.m_impulse=0}else this.m_state=I.e_atUpperLimit;if(j<this.m_maxLength1){this.m_limitState1=
I.e_inactiveLimit;this.m_limitImpulse1=0}else this.m_limitState1=I.e_atUpperLimit;if(n<this.m_maxLength2){this.m_limitState2=I.e_inactiveLimit;this.m_limitImpulse2=0}else this.m_limitState2=I.e_atUpperLimit;j=o*this.m_u1.y-q*this.m_u1.x;n=a*this.m_u2.y-c*this.m_u2.x;this.m_limitMass1=h.m_invMass+h.m_invI*j*j;this.m_limitMass2=l.m_invMass+l.m_invI*n*n;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;
this.m_pulleyMass=1/this.m_pulleyMass;if(d.warmStarting){this.m_impulse*=d.dtRatio;this.m_limitImpulse1*=d.dtRatio;this.m_limitImpulse2*=d.dtRatio;d=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x;j=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y;n=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x;g=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;h.m_linearVelocity.x+=h.m_invMass*d;h.m_linearVelocity.y+=h.m_invMass*j;h.m_angularVelocity+=h.m_invI*(o*j-q*d);l.m_linearVelocity.x+=
l.m_invMass*n;l.m_linearVelocity.y+=l.m_invMass*g;l.m_angularVelocity+=l.m_invI*(a*g-c*n)}else this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};E.prototype.SolveVelocityConstraints=function(){var d=this.m_bodyA,h=this.m_bodyB,l;l=d.m_xf.R;var j=this.m_localAnchor1.x-d.m_sweep.localCenter.x,o=this.m_localAnchor1.y-d.m_sweep.localCenter.y,q=l.col1.x*j+l.col2.x*o;o=l.col1.y*j+l.col2.y*o;j=q;l=h.m_xf.R;var n=this.m_localAnchor2.x-h.m_sweep.localCenter.x,a=this.m_localAnchor2.y-h.m_sweep.localCenter.y;
q=l.col1.x*n+l.col2.x*a;a=l.col1.y*n+l.col2.y*a;n=q;var c=q=l=0,g=0;l=g=l=g=c=q=l=0;if(this.m_state==I.e_atUpperLimit){l=d.m_linearVelocity.x+-d.m_angularVelocity*o;q=d.m_linearVelocity.y+d.m_angularVelocity*j;c=h.m_linearVelocity.x+-h.m_angularVelocity*a;g=h.m_linearVelocity.y+h.m_angularVelocity*n;l=-(this.m_u1.x*l+this.m_u1.y*q)-this.m_ratio*(this.m_u2.x*c+this.m_u2.y*g);g=this.m_pulleyMass*-l;l=this.m_impulse;this.m_impulse=y.Max(0,this.m_impulse+g);g=this.m_impulse-l;l=-g*this.m_u1.x;q=-g*this.m_u1.y;
c=-this.m_ratio*g*this.m_u2.x;g=-this.m_ratio*g*this.m_u2.y;d.m_linearVelocity.x+=d.m_invMass*l;d.m_linearVelocity.y+=d.m_invMass*q;d.m_angularVelocity+=d.m_invI*(j*q-o*l);h.m_linearVelocity.x+=h.m_invMass*c;h.m_linearVelocity.y+=h.m_invMass*g;h.m_angularVelocity+=h.m_invI*(n*g-a*c)}if(this.m_limitState1==I.e_atUpperLimit){l=d.m_linearVelocity.x+-d.m_angularVelocity*o;q=d.m_linearVelocity.y+d.m_angularVelocity*j;l=-(this.m_u1.x*l+this.m_u1.y*q);g=-this.m_limitMass1*l;l=this.m_limitImpulse1;this.m_limitImpulse1=
y.Max(0,this.m_limitImpulse1+g);g=this.m_limitImpulse1-l;l=-g*this.m_u1.x;q=-g*this.m_u1.y;d.m_linearVelocity.x+=d.m_invMass*l;d.m_linearVelocity.y+=d.m_invMass*q;d.m_angularVelocity+=d.m_invI*(j*q-o*l)}if(this.m_limitState2==I.e_atUpperLimit){c=h.m_linearVelocity.x+-h.m_angularVelocity*a;g=h.m_linearVelocity.y+h.m_angularVelocity*n;l=-(this.m_u2.x*c+this.m_u2.y*g);g=-this.m_limitMass2*l;l=this.m_limitImpulse2;this.m_limitImpulse2=y.Max(0,this.m_limitImpulse2+g);g=this.m_limitImpulse2-l;c=-g*this.m_u2.x;
g=-g*this.m_u2.y;h.m_linearVelocity.x+=h.m_invMass*c;h.m_linearVelocity.y+=h.m_invMass*g;h.m_angularVelocity+=h.m_invI*(n*g-a*c)}};E.prototype.SolvePositionConstraints=function(){var d=this.m_bodyA,h=this.m_bodyB,l,j=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,q=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,n=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,a=0,c=0,g=0,b=0,e=l=0,f=0,m=0,r=e=m=l=e=l=0;if(this.m_state==I.e_atUpperLimit){l=
d.m_xf.R;a=this.m_localAnchor1.x-d.m_sweep.localCenter.x;c=this.m_localAnchor1.y-d.m_sweep.localCenter.y;e=l.col1.x*a+l.col2.x*c;c=l.col1.y*a+l.col2.y*c;a=e;l=h.m_xf.R;g=this.m_localAnchor2.x-h.m_sweep.localCenter.x;b=this.m_localAnchor2.y-h.m_sweep.localCenter.y;e=l.col1.x*g+l.col2.x*b;b=l.col1.y*g+l.col2.y*b;g=e;l=d.m_sweep.c.x+a;e=d.m_sweep.c.y+c;f=h.m_sweep.c.x+g;m=h.m_sweep.c.y+b;this.m_u1.Set(l-j,e-o);this.m_u2.Set(f-q,m-n);l=this.m_u1.Length();e=this.m_u2.Length();l>F.b2_linearSlop?this.m_u1.Multiply(1/
l):this.m_u1.SetZero();e>F.b2_linearSlop?this.m_u2.Multiply(1/e):this.m_u2.SetZero();l=this.m_constant-l-this.m_ratio*e;r=y.Max(r,-l);l=y.Clamp(l+F.b2_linearSlop,-F.b2_maxLinearCorrection,0);m=-this.m_pulleyMass*l;l=-m*this.m_u1.x;e=-m*this.m_u1.y;f=-this.m_ratio*m*this.m_u2.x;m=-this.m_ratio*m*this.m_u2.y;d.m_sweep.c.x+=d.m_invMass*l;d.m_sweep.c.y+=d.m_invMass*e;d.m_sweep.a+=d.m_invI*(a*e-c*l);h.m_sweep.c.x+=h.m_invMass*f;h.m_sweep.c.y+=h.m_invMass*m;h.m_sweep.a+=h.m_invI*(g*m-b*f);d.SynchronizeTransform();
h.SynchronizeTransform()}if(this.m_limitState1==I.e_atUpperLimit){l=d.m_xf.R;a=this.m_localAnchor1.x-d.m_sweep.localCenter.x;c=this.m_localAnchor1.y-d.m_sweep.localCenter.y;e=l.col1.x*a+l.col2.x*c;c=l.col1.y*a+l.col2.y*c;a=e;l=d.m_sweep.c.x+a;e=d.m_sweep.c.y+c;this.m_u1.Set(l-j,e-o);l=this.m_u1.Length();if(l>F.b2_linearSlop){this.m_u1.x*=1/l;this.m_u1.y*=1/l}else this.m_u1.SetZero();l=this.m_maxLength1-l;r=y.Max(r,-l);l=y.Clamp(l+F.b2_linearSlop,-F.b2_maxLinearCorrection,0);m=-this.m_limitMass1*l;
l=-m*this.m_u1.x;e=-m*this.m_u1.y;d.m_sweep.c.x+=d.m_invMass*l;d.m_sweep.c.y+=d.m_invMass*e;d.m_sweep.a+=d.m_invI*(a*e-c*l);d.SynchronizeTransform()}if(this.m_limitState2==I.e_atUpperLimit){l=h.m_xf.R;g=this.m_localAnchor2.x-h.m_sweep.localCenter.x;b=this.m_localAnchor2.y-h.m_sweep.localCenter.y;e=l.col1.x*g+l.col2.x*b;b=l.col1.y*g+l.col2.y*b;g=e;f=h.m_sweep.c.x+g;m=h.m_sweep.c.y+b;this.m_u2.Set(f-q,m-n);e=this.m_u2.Length();if(e>F.b2_linearSlop){this.m_u2.x*=1/e;this.m_u2.y*=1/e}else this.m_u2.SetZero();
l=this.m_maxLength2-e;r=y.Max(r,-l);l=y.Clamp(l+F.b2_linearSlop,-F.b2_maxLinearCorrection,0);m=-this.m_limitMass2*l;f=-m*this.m_u2.x;m=-m*this.m_u2.y;h.m_sweep.c.x+=h.m_invMass*f;h.m_sweep.c.y+=h.m_invMass*m;h.m_sweep.a+=h.m_invI*(g*m-b*f);h.SynchronizeTransform()}return r<F.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(R,Box2D.Dynamics.Joints.b2JointDef);R.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;R.b2PulleyJointDef=
function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new w;this.groundAnchorB=new w;this.localAnchorA=new w;this.localAnchorB=new w};R.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=I.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=true};R.prototype.Initialize=
function(d,h,l,j,o,q,n){if(n===undefined)n=0;this.bodyA=d;this.bodyB=h;this.groundAnchorA.SetV(l);this.groundAnchorB.SetV(j);this.localAnchorA=this.bodyA.GetLocalPoint(o);this.localAnchorB=this.bodyB.GetLocalPoint(q);d=o.x-l.x;l=o.y-l.y;this.lengthA=Math.sqrt(d*d+l*l);l=q.x-j.x;j=q.y-j.y;this.lengthB=Math.sqrt(l*l+j*j);this.ratio=n;n=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=n-this.ratio*E.b2_minPulleyLength;this.maxLengthB=(n-E.b2_minPulleyLength)/this.ratio};Box2D.inherit(N,Box2D.Dynamics.Joints.b2Joint);
N.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;N.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new G;this.K1=new G;this.K2=new G;this.K3=new G;this.impulse3=new A;this.impulse2=new w;this.reduced=new w;this.m_localAnchor1=new w;this.m_localAnchor2=new w;this.m_impulse=new A;this.m_mass=new K};N.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};N.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};
N.prototype.GetReactionForce=function(d){if(d===undefined)d=0;return new w(d*this.m_impulse.x,d*this.m_impulse.y)};N.prototype.GetReactionTorque=function(d){if(d===undefined)d=0;return d*this.m_impulse.z};N.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};N.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};N.prototype.IsLimitEnabled=function(){return this.m_enableLimit};N.prototype.EnableLimit=
function(d){this.m_enableLimit=d};N.prototype.GetLowerLimit=function(){return this.m_lowerAngle};N.prototype.GetUpperLimit=function(){return this.m_upperAngle};N.prototype.SetLimits=function(d,h){if(d===undefined)d=0;if(h===undefined)h=0;this.m_lowerAngle=d;this.m_upperAngle=h};N.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);return this.m_enableMotor};N.prototype.EnableMotor=function(d){this.m_enableMotor=d};N.prototype.SetMotorSpeed=function(d){if(d===
undefined)d=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=d};N.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};N.prototype.SetMaxMotorTorque=function(d){if(d===undefined)d=0;this.m_maxMotorTorque=d};N.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};N.prototype.b2RevoluteJoint=function(d){this.__super.b2Joint.call(this,d);this.m_localAnchor1.SetV(d.localAnchorA);this.m_localAnchor2.SetV(d.localAnchorB);this.m_referenceAngle=d.referenceAngle;
this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=d.lowerAngle;this.m_upperAngle=d.upperAngle;this.m_maxMotorTorque=d.maxMotorTorque;this.m_motorSpeed=d.motorSpeed;this.m_enableLimit=d.enableLimit;this.m_enableMotor=d.enableMotor;this.m_limitState=I.e_inactiveLimit};N.prototype.InitVelocityConstraints=function(d){var h=this.m_bodyA,l=this.m_bodyB,j,o=0;j=h.m_xf.R;var q=this.m_localAnchor1.x-h.m_sweep.localCenter.x,n=this.m_localAnchor1.y-h.m_sweep.localCenter.y;o=j.col1.x*q+j.col2.x*
n;n=j.col1.y*q+j.col2.y*n;q=o;j=l.m_xf.R;var a=this.m_localAnchor2.x-l.m_sweep.localCenter.x,c=this.m_localAnchor2.y-l.m_sweep.localCenter.y;o=j.col1.x*a+j.col2.x*c;c=j.col1.y*a+j.col2.y*c;a=o;j=h.m_invMass;o=l.m_invMass;var g=h.m_invI,b=l.m_invI;this.m_mass.col1.x=j+o+n*n*g+c*c*b;this.m_mass.col2.x=-n*q*g-c*a*b;this.m_mass.col3.x=-n*g-c*b;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=j+o+q*q*g+a*a*b;this.m_mass.col3.y=q*g+a*b;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;
this.m_mass.col3.z=g+b;this.m_motorMass=1/(g+b);if(this.m_enableMotor==false)this.m_motorImpulse=0;if(this.m_enableLimit){var e=l.m_sweep.a-h.m_sweep.a-this.m_referenceAngle;if(y.Abs(this.m_upperAngle-this.m_lowerAngle)<2*F.b2_angularSlop)this.m_limitState=I.e_equalLimits;else if(e<=this.m_lowerAngle){if(this.m_limitState!=I.e_atLowerLimit)this.m_impulse.z=0;this.m_limitState=I.e_atLowerLimit}else if(e>=this.m_upperAngle){if(this.m_limitState!=I.e_atUpperLimit)this.m_impulse.z=0;this.m_limitState=
I.e_atUpperLimit}else{this.m_limitState=I.e_inactiveLimit;this.m_impulse.z=0}}else this.m_limitState=I.e_inactiveLimit;if(d.warmStarting){this.m_impulse.x*=d.dtRatio;this.m_impulse.y*=d.dtRatio;this.m_motorImpulse*=d.dtRatio;d=this.m_impulse.x;e=this.m_impulse.y;h.m_linearVelocity.x-=j*d;h.m_linearVelocity.y-=j*e;h.m_angularVelocity-=g*(q*e-n*d+this.m_motorImpulse+this.m_impulse.z);l.m_linearVelocity.x+=o*d;l.m_linearVelocity.y+=o*e;l.m_angularVelocity+=b*(a*e-c*d+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero();
this.m_motorImpulse=0}};N.prototype.SolveVelocityConstraints=function(d){var h=this.m_bodyA,l=this.m_bodyB,j=0,o=j=0,q=0,n=0,a=0,c=h.m_linearVelocity,g=h.m_angularVelocity,b=l.m_linearVelocity,e=l.m_angularVelocity,f=h.m_invMass,m=l.m_invMass,r=h.m_invI,s=l.m_invI;if(this.m_enableMotor&&this.m_limitState!=I.e_equalLimits){o=this.m_motorMass*-(e-g-this.m_motorSpeed);q=this.m_motorImpulse;n=d.dt*this.m_maxMotorTorque;this.m_motorImpulse=y.Clamp(this.m_motorImpulse+o,-n,n);o=this.m_motorImpulse-q;g-=
r*o;e+=s*o}if(this.m_enableLimit&&this.m_limitState!=I.e_inactiveLimit){d=h.m_xf.R;o=this.m_localAnchor1.x-h.m_sweep.localCenter.x;q=this.m_localAnchor1.y-h.m_sweep.localCenter.y;j=d.col1.x*o+d.col2.x*q;q=d.col1.y*o+d.col2.y*q;o=j;d=l.m_xf.R;n=this.m_localAnchor2.x-l.m_sweep.localCenter.x;a=this.m_localAnchor2.y-l.m_sweep.localCenter.y;j=d.col1.x*n+d.col2.x*a;a=d.col1.y*n+d.col2.y*a;n=j;d=b.x+-e*a-c.x- -g*q;var v=b.y+e*n-c.y-g*o;this.m_mass.Solve33(this.impulse3,-d,-v,-(e-g));if(this.m_limitState==
I.e_equalLimits)this.m_impulse.Add(this.impulse3);else if(this.m_limitState==I.e_atLowerLimit){j=this.m_impulse.z+this.impulse3.z;if(j<0){this.m_mass.Solve22(this.reduced,-d,-v);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}else if(this.m_limitState==I.e_atUpperLimit){j=this.m_impulse.z+this.impulse3.z;if(j>0){this.m_mass.Solve22(this.reduced,-d,-v);this.impulse3.x=
this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}c.x-=f*this.impulse3.x;c.y-=f*this.impulse3.y;g-=r*(o*this.impulse3.y-q*this.impulse3.x+this.impulse3.z);b.x+=m*this.impulse3.x;b.y+=m*this.impulse3.y;e+=s*(n*this.impulse3.y-a*this.impulse3.x+this.impulse3.z)}else{d=h.m_xf.R;o=this.m_localAnchor1.x-h.m_sweep.localCenter.x;q=this.m_localAnchor1.y-h.m_sweep.localCenter.y;j=d.col1.x*o+
d.col2.x*q;q=d.col1.y*o+d.col2.y*q;o=j;d=l.m_xf.R;n=this.m_localAnchor2.x-l.m_sweep.localCenter.x;a=this.m_localAnchor2.y-l.m_sweep.localCenter.y;j=d.col1.x*n+d.col2.x*a;a=d.col1.y*n+d.col2.y*a;n=j;this.m_mass.Solve22(this.impulse2,-(b.x+-e*a-c.x- -g*q),-(b.y+e*n-c.y-g*o));this.m_impulse.x+=this.impulse2.x;this.m_impulse.y+=this.impulse2.y;c.x-=f*this.impulse2.x;c.y-=f*this.impulse2.y;g-=r*(o*this.impulse2.y-q*this.impulse2.x);b.x+=m*this.impulse2.x;b.y+=m*this.impulse2.y;e+=s*(n*this.impulse2.y-
a*this.impulse2.x)}h.m_linearVelocity.SetV(c);h.m_angularVelocity=g;l.m_linearVelocity.SetV(b);l.m_angularVelocity=e};N.prototype.SolvePositionConstraints=function(){var d=0,h,l=this.m_bodyA,j=this.m_bodyB,o=0,q=h=0,n=0,a=0;if(this.m_enableLimit&&this.m_limitState!=I.e_inactiveLimit){d=j.m_sweep.a-l.m_sweep.a-this.m_referenceAngle;var c=0;if(this.m_limitState==I.e_equalLimits){d=y.Clamp(d-this.m_lowerAngle,-F.b2_maxAngularCorrection,F.b2_maxAngularCorrection);c=-this.m_motorMass*d;o=y.Abs(d)}else if(this.m_limitState==
I.e_atLowerLimit){d=d-this.m_lowerAngle;o=-d;d=y.Clamp(d+F.b2_angularSlop,-F.b2_maxAngularCorrection,0);c=-this.m_motorMass*d}else if(this.m_limitState==I.e_atUpperLimit){o=d=d-this.m_upperAngle;d=y.Clamp(d-F.b2_angularSlop,0,F.b2_maxAngularCorrection);c=-this.m_motorMass*d}l.m_sweep.a-=l.m_invI*c;j.m_sweep.a+=j.m_invI*c;l.SynchronizeTransform();j.SynchronizeTransform()}h=l.m_xf.R;c=this.m_localAnchor1.x-l.m_sweep.localCenter.x;d=this.m_localAnchor1.y-l.m_sweep.localCenter.y;q=h.col1.x*c+h.col2.x*
d;d=h.col1.y*c+h.col2.y*d;c=q;h=j.m_xf.R;var g=this.m_localAnchor2.x-j.m_sweep.localCenter.x,b=this.m_localAnchor2.y-j.m_sweep.localCenter.y;q=h.col1.x*g+h.col2.x*b;b=h.col1.y*g+h.col2.y*b;g=q;n=j.m_sweep.c.x+g-l.m_sweep.c.x-c;a=j.m_sweep.c.y+b-l.m_sweep.c.y-d;var e=n*n+a*a;h=Math.sqrt(e);q=l.m_invMass;var f=j.m_invMass,m=l.m_invI,r=j.m_invI,s=10*F.b2_linearSlop;if(e>s*s){e=1/(q+f);n=e*-n;a=e*-a;l.m_sweep.c.x-=0.5*q*n;l.m_sweep.c.y-=0.5*q*a;j.m_sweep.c.x+=0.5*f*n;j.m_sweep.c.y+=0.5*f*a;n=j.m_sweep.c.x+
g-l.m_sweep.c.x-c;a=j.m_sweep.c.y+b-l.m_sweep.c.y-d}this.K1.col1.x=q+f;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=q+f;this.K2.col1.x=m*d*d;this.K2.col2.x=-m*c*d;this.K2.col1.y=-m*c*d;this.K2.col2.y=m*c*c;this.K3.col1.x=r*b*b;this.K3.col2.x=-r*g*b;this.K3.col1.y=-r*g*b;this.K3.col2.y=r*g*g;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(N.tImpulse,-n,-a);n=N.tImpulse.x;a=N.tImpulse.y;l.m_sweep.c.x-=l.m_invMass*n;l.m_sweep.c.y-=l.m_invMass*a;l.m_sweep.a-=l.m_invI*(c*
a-d*n);j.m_sweep.c.x+=j.m_invMass*n;j.m_sweep.c.y+=j.m_invMass*a;j.m_sweep.a+=j.m_invI*(g*a-b*n);l.SynchronizeTransform();j.SynchronizeTransform();return h<=F.b2_linearSlop&&o<=F.b2_angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new w});Box2D.inherit(S,Box2D.Dynamics.Joints.b2JointDef);S.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;S.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=
new w;this.localAnchorB=new w};S.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=I.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=false};S.prototype.Initialize=function(d,h,l){this.bodyA=d;this.bodyB=h;this.localAnchorA=this.bodyA.GetLocalPoint(l);this.localAnchorB=this.bodyB.GetLocalPoint(l);this.referenceAngle=this.bodyB.GetAngle()-
this.bodyA.GetAngle()};Box2D.inherit(aa,Box2D.Dynamics.Joints.b2Joint);aa.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;aa.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new w;this.m_localAnchorB=new w;this.m_impulse=new A;this.m_mass=new K};aa.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};aa.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};aa.prototype.GetReactionForce=
function(d){if(d===undefined)d=0;return new w(d*this.m_impulse.x,d*this.m_impulse.y)};aa.prototype.GetReactionTorque=function(d){if(d===undefined)d=0;return d*this.m_impulse.z};aa.prototype.b2WeldJoint=function(d){this.__super.b2Joint.call(this,d);this.m_localAnchorA.SetV(d.localAnchorA);this.m_localAnchorB.SetV(d.localAnchorB);this.m_referenceAngle=d.referenceAngle;this.m_impulse.SetZero();this.m_mass=new K};aa.prototype.InitVelocityConstraints=function(d){var h,l=0,j=this.m_bodyA,o=this.m_bodyB;
h=j.m_xf.R;var q=this.m_localAnchorA.x-j.m_sweep.localCenter.x,n=this.m_localAnchorA.y-j.m_sweep.localCenter.y;l=h.col1.x*q+h.col2.x*n;n=h.col1.y*q+h.col2.y*n;q=l;h=o.m_xf.R;var a=this.m_localAnchorB.x-o.m_sweep.localCenter.x,c=this.m_localAnchorB.y-o.m_sweep.localCenter.y;l=h.col1.x*a+h.col2.x*c;c=h.col1.y*a+h.col2.y*c;a=l;h=j.m_invMass;l=o.m_invMass;var g=j.m_invI,b=o.m_invI;this.m_mass.col1.x=h+l+n*n*g+c*c*b;this.m_mass.col2.x=-n*q*g-c*a*b;this.m_mass.col3.x=-n*g-c*b;this.m_mass.col1.y=this.m_mass.col2.x;
this.m_mass.col2.y=h+l+q*q*g+a*a*b;this.m_mass.col3.y=q*g+a*b;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=g+b;if(d.warmStarting){this.m_impulse.x*=d.dtRatio;this.m_impulse.y*=d.dtRatio;this.m_impulse.z*=d.dtRatio;j.m_linearVelocity.x-=h*this.m_impulse.x;j.m_linearVelocity.y-=h*this.m_impulse.y;j.m_angularVelocity-=g*(q*this.m_impulse.y-n*this.m_impulse.x+this.m_impulse.z);o.m_linearVelocity.x+=l*this.m_impulse.x;o.m_linearVelocity.y+=l*this.m_impulse.y;
o.m_angularVelocity+=b*(a*this.m_impulse.y-c*this.m_impulse.x+this.m_impulse.z)}else this.m_impulse.SetZero()};aa.prototype.SolveVelocityConstraints=function(){var d,h=0,l=this.m_bodyA,j=this.m_bodyB,o=l.m_linearVelocity,q=l.m_angularVelocity,n=j.m_linearVelocity,a=j.m_angularVelocity,c=l.m_invMass,g=j.m_invMass,b=l.m_invI,e=j.m_invI;d=l.m_xf.R;var f=this.m_localAnchorA.x-l.m_sweep.localCenter.x,m=this.m_localAnchorA.y-l.m_sweep.localCenter.y;h=d.col1.x*f+d.col2.x*m;m=d.col1.y*f+d.col2.y*m;f=h;d=
j.m_xf.R;var r=this.m_localAnchorB.x-j.m_sweep.localCenter.x,s=this.m_localAnchorB.y-j.m_sweep.localCenter.y;h=d.col1.x*r+d.col2.x*s;s=d.col1.y*r+d.col2.y*s;r=h;d=n.x-a*s-o.x+q*m;h=n.y+a*r-o.y-q*f;var v=a-q,t=new A;this.m_mass.Solve33(t,-d,-h,-v);this.m_impulse.Add(t);o.x-=c*t.x;o.y-=c*t.y;q-=b*(f*t.y-m*t.x+t.z);n.x+=g*t.x;n.y+=g*t.y;a+=e*(r*t.y-s*t.x+t.z);l.m_angularVelocity=q;j.m_angularVelocity=a};aa.prototype.SolvePositionConstraints=function(){var d,h=0,l=this.m_bodyA,j=this.m_bodyB;d=l.m_xf.R;
var o=this.m_localAnchorA.x-l.m_sweep.localCenter.x,q=this.m_localAnchorA.y-l.m_sweep.localCenter.y;h=d.col1.x*o+d.col2.x*q;q=d.col1.y*o+d.col2.y*q;o=h;d=j.m_xf.R;var n=this.m_localAnchorB.x-j.m_sweep.localCenter.x,a=this.m_localAnchorB.y-j.m_sweep.localCenter.y;h=d.col1.x*n+d.col2.x*a;a=d.col1.y*n+d.col2.y*a;n=h;d=l.m_invMass;h=j.m_invMass;var c=l.m_invI,g=j.m_invI,b=j.m_sweep.c.x+n-l.m_sweep.c.x-o,e=j.m_sweep.c.y+a-l.m_sweep.c.y-q,f=j.m_sweep.a-l.m_sweep.a-this.m_referenceAngle,m=10*F.b2_linearSlop,
r=Math.sqrt(b*b+e*e),s=y.Abs(f);if(r>m){c*=1;g*=1}this.m_mass.col1.x=d+h+q*q*c+a*a*g;this.m_mass.col2.x=-q*o*c-a*n*g;this.m_mass.col3.x=-q*c-a*g;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=d+h+o*o*c+n*n*g;this.m_mass.col3.y=o*c+n*g;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=c+g;m=new A;this.m_mass.Solve33(m,-b,-e,-f);l.m_sweep.c.x-=d*m.x;l.m_sweep.c.y-=d*m.y;l.m_sweep.a-=c*(o*m.y-q*m.x+m.z);j.m_sweep.c.x+=h*m.x;j.m_sweep.c.y+=h*m.y;
j.m_sweep.a+=g*(n*m.y-a*m.x+m.z);l.SynchronizeTransform();j.SynchronizeTransform();return r<=F.b2_linearSlop&&s<=F.b2_angularSlop};Box2D.inherit(Z,Box2D.Dynamics.Joints.b2JointDef);Z.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;Z.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new w;this.localAnchorB=new w};Z.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=I.e_weldJoint;this.referenceAngle=
0};Z.prototype.Initialize=function(d,h,l){this.bodyA=d;this.bodyB=h;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(l));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(l));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();
(function(){var F=Box2D.Dynamics.b2DebugDraw;F.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var G=this;this.m_sprite={graphics:{clear:function(){G.m_ctx.clearRect(0,0,G.m_ctx.canvas.width,G.m_ctx.canvas.height)}}}};F.prototype._color=function(G,K){return"rgba("+((G&16711680)>>16)+","+((G&65280)>>8)+","+(G&255)+","+K+")"};F.prototype.b2DebugDraw=function(){this.m_drawFlags=0};F.prototype.SetFlags=function(G){if(G===undefined)G=0;this.m_drawFlags=
G};F.prototype.GetFlags=function(){return this.m_drawFlags};F.prototype.AppendFlags=function(G){if(G===undefined)G=0;this.m_drawFlags|=G};F.prototype.ClearFlags=function(G){if(G===undefined)G=0;this.m_drawFlags&=~G};F.prototype.SetSprite=function(G){this.m_ctx=G};F.prototype.GetSprite=function(){return this.m_ctx};F.prototype.SetDrawScale=function(G){if(G===undefined)G=0;this.m_drawScale=G};F.prototype.GetDrawScale=function(){return this.m_drawScale};F.prototype.SetLineThickness=function(G){if(G===
undefined)G=0;this.m_lineThickness=G;this.m_ctx.strokeWidth=G};F.prototype.GetLineThickness=function(){return this.m_lineThickness};F.prototype.SetAlpha=function(G){if(G===undefined)G=0;this.m_alpha=G};F.prototype.GetAlpha=function(){return this.m_alpha};F.prototype.SetFillAlpha=function(G){if(G===undefined)G=0;this.m_fillAlpha=G};F.prototype.GetFillAlpha=function(){return this.m_fillAlpha};F.prototype.SetXFormScale=function(G){if(G===undefined)G=0;this.m_xformScale=G};F.prototype.GetXFormScale=function(){return this.m_xformScale};
F.prototype.DrawPolygon=function(G,K,y){if(K){var w=this.m_ctx,A=this.m_drawScale;w.beginPath();w.strokeStyle=this._color(y.color,this.m_alpha);w.moveTo(G[0].x*A,G[0].y*A);for(y=1;y<K;y++)w.lineTo(G[y].x*A,G[y].y*A);w.lineTo(G[0].x*A,G[0].y*A);w.closePath();w.stroke()}};F.prototype.DrawSolidPolygon=function(G,K,y){if(K){var w=this.m_ctx,A=this.m_drawScale;w.beginPath();w.strokeStyle=this._color(y.color,this.m_alpha);w.fillStyle=this._color(y.color,this.m_fillAlpha);w.moveTo(G[0].x*A,G[0].y*A);for(y=
1;y<K;y++)w.lineTo(G[y].x*A,G[y].y*A);w.lineTo(G[0].x*A,G[0].y*A);w.closePath();w.fill();w.stroke()}};F.prototype.DrawCircle=function(G,K,y){if(K){var w=this.m_ctx,A=this.m_drawScale;w.beginPath();w.strokeStyle=this._color(y.color,this.m_alpha);w.arc(G.x*A,G.y*A,K*A,0,Math.PI*2,true);w.closePath();w.stroke()}};F.prototype.DrawSolidCircle=function(G,K,y,w){if(K){var A=this.m_ctx,U=this.m_drawScale,p=G.x*U,B=G.y*U;A.moveTo(0,0);A.beginPath();A.strokeStyle=this._color(w.color,this.m_alpha);A.fillStyle=
this._color(w.color,this.m_fillAlpha);A.arc(p,B,K*U,0,Math.PI*2,true);A.moveTo(p,B);A.lineTo((G.x+y.x*K)*U,(G.y+y.y*K)*U);A.closePath();A.fill();A.stroke()}};F.prototype.DrawSegment=function(G,K,y){var w=this.m_ctx,A=this.m_drawScale;w.strokeStyle=this._color(y.color,this.m_alpha);w.beginPath();w.moveTo(G.x*A,G.y*A);w.lineTo(K.x*A,K.y*A);w.closePath();w.stroke()};F.prototype.DrawTransform=function(G){var K=this.m_ctx,y=this.m_drawScale;K.beginPath();K.strokeStyle=this._color(16711680,this.m_alpha);
K.moveTo(G.position.x*y,G.position.y*y);K.lineTo((G.position.x+this.m_xformScale*G.R.col1.x)*y,(G.position.y+this.m_xformScale*G.R.col1.y)*y);K.strokeStyle=this._color(65280,this.m_alpha);K.moveTo(G.position.x*y,G.position.y*y);K.lineTo((G.position.x+this.m_xformScale*G.R.col2.x)*y,(G.position.y+this.m_xformScale*G.R.col2.y)*y);K.closePath();K.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;


var OS_PC="pc",OS_IPHONE="iPhone",OS_IPOD="iPod",OS_IPAD="iPad",OS_ANDROID="Android",OS_WINDOWS_PHONE="Windows Phone",OS_BLACK_BERRY="BlackBerry",NONE="none",UNDEFINED="undefined",LANDSCAPE="landscape",PORTRAIT="portrait",mouseX,mouseY;function LEvent(type){this.eventType=type;this._ll_preventDefault=false;}LEvent.prototype.preventDefault=function(){this._ll_preventDefault=true;};LEvent.INIT="init";LEvent.COMPLETE="complete";LEvent.ERROR="error";LEvent.PROGRESS="progress";LEvent.ENTER_FRAME="enter_frame";LEvent.WINDOW_RESIZE="resize";LEvent.WINDOW_ORIENTATIONCHANGE="orientationchange";LEvent.SOUND_COMPLETE="sound_complete";LEvent.END_CONTACT="endContact";LEvent.PRE_SOLVE="preSolve";LEvent.POST_SOLVE="postSolve";LEvent.BEGIN_CONTACT="beginContact";LEvent.addEventListener=function(n,t,f,b){if(b==null){b=false;}if(n.addEventListener){n.addEventListener(t,f,b);}else if(n.attachEvent){n["e"+t+f]=f;n[t+f]=function(){n["e"+t+f]();};n.attachEvent("on"+t,n[t+f]);}};LEvent.removeEventListener=function(n,t,f,b){if(b==null){b=false;}if(n.removeEventListener){n.removeEventListener(t,f,b);}else if(n.detachEvent){n["e"+t+f]=f;n[t+f]=function(){n["e"+t+f]();};n.detachEvent("on"+t,n[t+f]);}};var LMouseEvent=function(){throw "LMouseEvent cannot be instantiated";};LMouseEvent.MOUSE_DOWN="mousedown";LMouseEvent.MOUSE_UP="mouseup";LMouseEvent.TOUCH_START="touchstart";LMouseEvent.TOUCH_MOVE="touchmove";LMouseEvent.TOUCH_END="touchend";LMouseEvent.MOUSE_MOVE="mousemove";LMouseEvent.MOUSE_OVER="mouseover";LMouseEvent.MOUSE_OUT="mouseout";LMouseEvent.DOUBLE_CLICK="dblclick";var LMultitouchInputMode=function(){throw "LMultitouchInputMode cannot be instantiated";};LMultitouchInputMode.NONE="none";LMultitouchInputMode.GESTURE="gesture";LMultitouchInputMode.TOUCH_POINT="touchPoint";var LMultitouch=function(){throw "LMultitouch cannot be instantiated";};LMultitouch.inputMode="none";LMultitouch.touchs=[];var LTimerEvent=function(){throw "LTimerEvent cannot be instantiated";};LTimerEvent.TIMER="timer";LTimerEvent.TIMER_COMPLETE="timerComplete";var LTextEvent=function(){throw "LTextEvent cannot be instantiated";};LTextEvent.TEXT_INPUT="textInput";LTextEvent.WIND_COMPLETE="windComplete";var LFocusEvent=function(){throw "LFocusEvent cannot be instantiated";};LFocusEvent.FOCUS_IN="focusIn";LFocusEvent.FOCUS_OUT="focusOut";var LMouseEventContainer=(function(){function MouseEventContainer(){var s=this;s.container={};s.dispatchAllEvent=false;s.mouseDownContainer=[];s.mouseUpContainer=[];s.mouseMoveContainer=[];s.mouseOverContainer=[];s.mouseOutContainer=[];s.mouseDblContainer=[];s.textFieldInputContainer=[];s.buttonContainer=[];};MouseEventContainer.prototype={pushInputBox:function(d){var s=this,c=s.textFieldInputContainer,i,l;for(i=0,l=c.length; i<l; i++){if(d.objectIndex==c[i].objectIndex){return;}}s.textFieldInputContainer.push(d);},removeInputBox:function(d){var s=this,c=s.textFieldInputContainer,i,l;for(i=0,l=c.length; i<l; i++){if(d.objectIndex==c[i].objectIndex){s.textFieldInputContainer.splice(i,1);break;}}},pushButton:function(d){var s=this,c=s.buttonContainer,i,l;for(i=0,l=c.length; i<l; i++){if(d.objectIndex==c[i].objectIndex){return;}}s.buttonContainer.push(d);},removeButton:function(d){var s=this,c=s.buttonContainer,i,l;for(i=0,l=c.length; i<l; i++){if(d.objectIndex==c[i].objectIndex){s.buttonContainer.splice(i,1);break;}}},dispatchEventButton:function(e){var s=this,c=s.buttonContainer,i,l;for(i=0,l=c.length; i<l; i++){if(typeof s.buttonContainer[i].ll_button_mode=="function"){s.buttonContainer[i].ll_button_mode(e);}}},addEvent:function(o,list,f){var s=this;list.push({container:o,listener:f});},removeEvent:function(o,list,f){var s=this,i,l;for(i=0,l=list.length; i<l; i++){if(list[i].container.objectIndex===o.objectIndex&&(!f||list[i].listener==f)){list.splice(i,1);break;}}},addMouseDownEvent:function(o,f){var s=this;s.addEvent(o,s.mouseDownContainer,f);},addMouseUpEvent:function(o,f){var s=this;s.addEvent(o,s.mouseUpContainer,f);},addMouseMoveEvent:function(o,f){var s=this;s.addEvent(o,s.mouseMoveContainer,f);},addMouseOverEvent:function(o,f){var s=this;s.addEvent(o,s.mouseOverContainer,f);},addMouseOutEvent:function(o,f){var s=this;s.addEvent(o,s.mouseOutContainer,f);},addMouseDblEvent:function(o,f){var s=this;s.addEvent(o,s.mouseDblContainer,f);},addMouseEvent:function(o,t,f){var s=this;if(t==LMouseEvent.MOUSE_DOWN){s.addMouseDownEvent(o,f);}else if(t==LMouseEvent.MOUSE_UP){s.addMouseUpEvent(o,f);}else if(t==LMouseEvent.MOUSE_OVER){s.addMouseOverEvent(o,f);}else if(t==LMouseEvent.MOUSE_OUT){s.addMouseOutEvent(o,f);}else if(t==LMouseEvent.MOUSE_MOVE){s.addMouseMoveEvent(o,f);}else{s.addMouseDblEvent(o,f);}},hasEventListener:function(o,t,f){var s=this,list;if(t==LMouseEvent.MOUSE_DOWN){list=s.mouseDownContainer;}else if(t==LMouseEvent.MOUSE_UP){list=s.mouseUpContainer;}else if(t==LMouseEvent.MOUSE_OVER){list=s.mouseOverContainer;}else if(t==LMouseEvent.MOUSE_OUT){list=s.mouseOutContainer;}else if(t==LMouseEvent.MOUSE_MOVE){list=s.mouseMoveContainer;}else{list=s.mouseDblContainer;}for(var i=0,l=list.length; i<l; i++){if(list[i].container.objectIndex===o.objectIndex&&(!f||list[i].listener==f)){return true;}}return false;},removeMouseDownEvent:function(o,f){var s=this;s.removeEvent(o,s.mouseDownContainer,f);},removeMouseUpEvent:function(o,f){var s=this;s.removeEvent(o,s.mouseUpContainer,f);},removeMouseMoveEvent:function(o,f){var s=this;s.removeEvent(o,s.mouseMoveContainer,f);},removeMouseOverEvent:function(o,f){var s=this;s.removeEvent(o,s.mouseOverContainer,f);},removeMouseOutEvent:function(o,f){var s=this;s.removeEvent(o,s.mouseOutContainer,f);},removeMouseDblEvent:function(o,f){var s=this;s.removeEvent(o,s.mouseDblContainer,f);},removeMouseEvent:function(o,t,f){var s=this;if(t==LMouseEvent.MOUSE_DOWN){s.removeMouseDownEvent(o,f);}else if(t==LMouseEvent.MOUSE_UP){s.removeMouseUpEvent(o,f);}else if(t==LMouseEvent.MOUSE_OVER){s.removeMouseOverEvent(o,f);}else if(t==LMouseEvent.MOUSE_OUT){s.removeMouseOutEvent(o,f);}else if(t==LMouseEvent.MOUSE_MOVE){s.removeMouseMoveEvent(o,f);}else{s.removeMouseDblEvent(o,f);}},dispatchMouseEvent:function(event,type){var s=this;if(type==LMouseEvent.MOUSE_DOWN){s.dispatchEvent(event,s.mouseDownContainer,LMouseEvent.MOUSE_DOWN);s.dispatchEvent(event,s.textFieldInputContainer);}else if(type==LMouseEvent.MOUSE_UP){s.dispatchEvent(event,s.mouseUpContainer,LMouseEvent.MOUSE_UP);}else if(type==LMouseEvent.DOUBLE_CLICK){s.dispatchEvent(event,s.mouseDblContainer,LMouseEvent.DOUBLE_CLICK);}else{s.dispatchEventButton(event);s.dispatchEvent(event,s.mouseOutContainer,LMouseEvent.MOUSE_OUT);s.dispatchEvent(event,s.mouseOverContainer,LMouseEvent.MOUSE_OVER);s.dispatchEvent(event,s.mouseMoveContainer,LMouseEvent.MOUSE_MOVE);}},getRootParams:function(s){var p=s.parent,r={x:0,y:0,scaleX:1,scaleY:1};while(p&&p!="root"){r.x*=p.scaleX;r.y*=p.scaleY;r.x+=p.x;r.y+=p.y;r.scaleX*=p.scaleX;r.scaleY*=p.scaleY;p=p.parent;}return r;},_mouseEnabled:function(sp){var self=this;if(!sp||!sp.parent){return false;}if(!sp.visible||(typeof sp.mouseEnabled!=UNDEFINED&&!sp.mouseEnabled)){return false;}var p=sp.parent;while(p&&p!="root"){if(!p.mouseEnabled||!p.mouseChildren||!p.visible){return false;}p=p.parent;if(!p){return false;}}return true;},_dispatchEvent:function(event,type,st,index,fromIndex,endIndex){var self=this,i,j,l=st.length;for(i=fromIndex; i<=endIndex&&i<l; i++){o=st[i];if(o.sp.objectIndex!=index){continue;}event.currentTarget=event.clickTarget=o.sp;if(!event.target){event.target=o.sp;}event.event_type=type;event.selfX=(event.offsetX-o.co.x-o.sp.x)/(o.co.scaleX*o.sp.scaleX);event.selfY=(event.offsetY-o.co.y-o.sp.y)/(o.co.scaleY*o.sp.scaleY);o.listener(event,o.sp);}},dispatchEvent:function(event,list,type){var self=this,sp,co,st=[],o,i,l;for(i=0,l=list.length; i<l; i++){sp=list[i].container||list[i];if(!self._mouseEnabled(sp)){continue;}co=self.getRootParams(sp);if(!type&&sp.mouseEvent){sp.mouseEvent(event,LMouseEvent.MOUSE_DOWN,co);continue;}if(sp.ismouseon(event,co)){if(type==LMouseEvent.MOUSE_OUT){continue;}if(type==LMouseEvent.MOUSE_OVER){if(sp.ll_mousein){continue;}}if(type!=LMouseEvent.MOUSE_UP){sp.ll_mousein=true;}st.push({sp:sp,co:co,listener:list[i].listener});}else{if(type!=LMouseEvent.MOUSE_OUT&&type!=LMouseEvent.MOUSE_OVER){continue;}if(!sp.ll_mousein){continue;}sp.ll_mousein=false;st.push({sp:sp,co:co,listener:list[i].listener});}}if(st.length==0){return;}if(st.length>1){st=st.sort(self._sort.bind(self));}l=st.length;for(i=0; i<l; i++){o=st[i];self._dispatchEvent(event,type,st,o.sp.objectIndex,i,self.dispatchAllEvent?l-1:i);if(i<st.length-1&&o.sp.objectIndex==st[i+1].sp.objectIndex){st.splice(i,1);i--;continue;}var p;while(true){if(!p){p=o.sp.parent;event.target=o.sp;}if(!p||p=="root"){break;}self._dispatchEvent(event,type,st,p.objectIndex,i+1,l);event.target=p;p=p.parent;if(!p||p=="root"){break;}}if(!self.dispatchAllEvent){break;}else{continue;}}},set:function(t,v){this.container[t]=v;},_sort:function(a,b){var s=this,o1,o2,al=s._getSort(a.sp),bl=s._getSort(b.sp),i,l1,l2;for(i=0,l1=al.length,l2=bl.length; i<l1&&i<l2; i++){o1=al[i];o2=bl[i];if(o1.objectIndex==o2.objectIndex){continue;}return o2.parent.getChildIndex(o2)-o1.parent.getChildIndex(o1);}return bl.length-al.length;},_getSort:function(layer){var p=layer.parent,list=[layer];while(p&&p!="root"){list.unshift(p);p=p.parent;}return list;}};var container=new MouseEventContainer();container.set(LMouseEvent.MOUSE_DOWN,true);container.set(LMouseEvent.MOUSE_UP,true);container.set(LMouseEvent.MOUSE_MOVE,true);return container;})();var LKeyboardEvent=function(){throw "LKeyboardEvent cannot be instantiated";};LKeyboardEvent.KEY_DOWN="keydown";LKeyboardEvent.KEY_UP="keyup";LKeyboardEvent.KEY_PRESS="keypress";var LAccelerometerEvent=function(){throw "LAccelerometerEvent cannot be instantiated";};LAccelerometerEvent.DEVICEMOTION="devicemotion";function LStageAlign(){throw "LStageAlign cannot be instantiated";}LStageAlign.TOP="T";LStageAlign.BOTTOM="B";LStageAlign.LEFT="L";LStageAlign.RIGHT="Re";LStageAlign.TOP_LEFT="TL";LStageAlign.TOP_RIGHT="TR";LStageAlign.TOP_MIDDLE="TM";LStageAlign.BOTTOM_LEFT="BL";LStageAlign.BOTTOM_RIGHT="BR";LStageAlign.BOTTOM_MIDDLE="BM";LStageAlign.MIDDLE="M";function LStageScaleMode(){throw "LStageScaleMode cannot be instantiated";}LStageScaleMode.EXACT_FIT="exactFit";LStageScaleMode.SHOW_ALL="showAll";LStageScaleMode.NO_BORDER="noBorder";LStageScaleMode.NO_SCALE="noScale";var LGlobal=(function(){function LGlobal(){throw "LGlobal cannot be instantiated";}LGlobal.FULL_SCREEN="full_screen";LGlobal.traceDebug=false;LGlobal.displayState=NONE;LGlobal.aspectRatio=NONE;LGlobal.canvasObj=null;LGlobal.canvas=null;LGlobal.webAudio=true;LGlobal.objectIndex=1;LGlobal.stage=null;LGlobal.width=0;LGlobal.height=0;LGlobal.box2d=null;LGlobal.speed=50;LGlobal.IS_MOUSE_DOWN=false;LGlobal.stopPropagation=false;LGlobal.preventDefault=true;LGlobal.childList=new Array();LGlobal.dragList=new Array();LGlobal.excludingContainer=new Array();LGlobal.fpsStatus=null;LGlobal.stageScale="noScale";LGlobal.align="M";LGlobal.mobile=false;LGlobal.canTouch=false;LGlobal.os=OS_PC;LGlobal.ios=false;LGlobal.android=false;LGlobal.android_new=false;LGlobal.backgroundColor=null;LGlobal.destroy=true;LGlobal.forceRefresh=false;LGlobal.devicePixelRatio=window.devicePixelRatio||1;LGlobal.startTimer=0;LGlobal.keepClear=true;LGlobal.top=0;LGlobal.left=0;LGlobal.window=window;(function(n){LGlobal.isOldFirefox=(function(un){var i=un.toLowerCase().indexOf('firefox');if(i<0){return false;}var v=un.substring(i+8,un.length);return parseFloat(v)<39.0;})(n);if(n.indexOf(OS_IPHONE)>0){LGlobal.os=OS_IPHONE;LGlobal.canTouch=true;LGlobal.ios=true;}else if(n.indexOf(OS_IPOD)>0){LGlobal.os=OS_IPOD;LGlobal.canTouch=true;LGlobal.ios=true;}else if(n.indexOf(OS_IPAD)>0){LGlobal.os=OS_IPAD;LGlobal.ios=true;LGlobal.canTouch=true;}else if(n.indexOf(OS_ANDROID)>0){LGlobal.os=OS_ANDROID;LGlobal.canTouch=true;LGlobal.android=true;var i=n.indexOf(OS_ANDROID);if(parseInt(n.substr(i+8,1))>3){LGlobal.android_new=true;}}else if(n.indexOf(OS_WINDOWS_PHONE)>0){LGlobal.os=OS_WINDOWS_PHONE;LGlobal.canTouch=true;}else if(n.indexOf(OS_BLACK_BERRY)>0){LGlobal.os=OS_BLACK_BERRY;LGlobal.canTouch=true;}LGlobal.mobile=LGlobal.canTouch;})(navigator.userAgent);LGlobal.setDebug=function(v){LGlobal.traceDebug=v;};LGlobal.setCanvas=function(id,w,h){LGlobal.ll_createCanvas(id,w,h);LGlobal.ll_createStage();if(LGlobal.displayState==LStage.FULL_SCREEN){LGlobal.resize();}else if(typeof LGlobal.displayState=="number"){LGlobal.resize(LGlobal.width*LGlobal.displayState,LGlobal.height*LGlobal.displayState);}if(LGlobal.canTouch){LGlobal.ll_clicks=0;LGlobal.ll_prev_clickTime=0;LEvent.addEventListener(LGlobal.canvasObj,LMouseEvent.TOUCH_START,LGlobal.ll_touchStart);LEvent.addEventListener(document,LMouseEvent.TOUCH_END,LGlobal.ll_touchEnd);LEvent.addEventListener(LGlobal.canvasObj,LMouseEvent.TOUCH_MOVE,LGlobal.ll_touchMove);}else{LEvent.addEventListener(LGlobal.canvasObj,LMouseEvent.DOUBLE_CLICK,LGlobal.ll_mouseDbclick);LEvent.addEventListener(LGlobal.canvasObj,LMouseEvent.MOUSE_DOWN,LGlobal.ll_mouseDown);LEvent.addEventListener(LGlobal.canvasObj,LMouseEvent.MOUSE_MOVE,LGlobal.ll_mouseMove);LEvent.addEventListener(LGlobal.canvasObj,LMouseEvent.MOUSE_UP,LGlobal.ll_mouseUp);LEvent.addEventListener(LGlobal.canvasObj,LMouseEvent.MOUSE_OUT,LGlobal.ll_mouseOut);}};LGlobal.ll_createCanvas=function(id,w,h){LGlobal.id=id;LGlobal.object=document.getElementById(id);LGlobal.object.innerHTML='<div style="position:absolute;margin:0;padding:0;overflow:visible;-webkit-transform:translateZ(0);z-index:0;">'+'<canvas id="'+LGlobal.id+'_canvas" style="margin:0;padding:0;width:'+w+'px;height:'+h+'px;">'+'<div id="noCanvas">'+"<p>Hey there,it looks like you're using Microsoft's Internet Explorer. Microsoft hates the Web and doesn't support HTML5:(</p>"+'</div>'+'</canvas></div>'+'<div id="'+LGlobal.id+'_InputText" style="position:absolute;margin:0;padding:0;z-index:10;display:none;">'+'<textarea rows="1" id="'+LGlobal.id+'_InputTextareaBox" style="resize:none;background:transparent;border:0px;"></textarea>'+'<input type="text" id="'+LGlobal.id+'_InputTextBox"  style="background:transparent;border:0px;"/>'+'<input type="password" id="'+LGlobal.id+'_passwordBox"  style="background:transparent;border:0px;"/></div>';LGlobal.canvasObj=document.getElementById(LGlobal.id+"_canvas");LGlobal._canvas=document.createElement("canvas");LGlobal._context=LGlobal._canvas.getContext("2d");if(LGlobal._context){LGlobal.canvasObj.innerHTML="";}LGlobal.inputBox=document.getElementById(LGlobal.id+'_InputText');LGlobal.inputTextareaBoxObj=document.getElementById(LGlobal.id+'_InputTextareaBox');LGlobal.inputTextBoxObj=document.getElementById(LGlobal.id+'_InputTextBox');LGlobal.passwordBoxObj=document.getElementById(LGlobal.id+'_passwordBox');LGlobal.inputTextField=null;if(w){LGlobal.canvasObj.width=w;}if(h){LGlobal.canvasObj.height=h;}LGlobal.width=LGlobal.canvasObj.width;LGlobal.height=LGlobal.canvasObj.height;LGlobal.canvasStyleWidth=LGlobal.width;LGlobal.canvasStyleHeight=LGlobal.height;LGlobal.canvas=LGlobal.canvasObj.getContext("2d");LGlobal.offsetX=mouseX=0;LGlobal.offsetY=mouseY=0;};LGlobal.ll_createStage=function(){LGlobal.stage=new LSprite();LGlobal.stage.parent="root";LGlobal.childList.push(LGlobal.stage);LGlobal.stage.baseAddEvent=LGlobal.stage.addEventListener;LGlobal.stage.baseRemoveEvent=LGlobal.stage.removeEventListener;LGlobal.stage.addEventListener=function(type,listener){if(type==LEvent.WINDOW_RESIZE||type==LEvent.WINDOW_ORIENTATIONCHANGE){if(type==LEvent.WINDOW_RESIZE){LGlobal.stage.onresizeListener=listener;}else{LGlobal.stage.onorientationchangeListener=listener;}if(!LGlobal.stage.onresize){LGlobal.stage.onresize=function(e){LGlobal.stage.onresizeEvent=e;};LEvent.addEventListener(LGlobal.window,type,LGlobal.stage.onresize);}}else if(type==LKeyboardEvent.KEY_DOWN||type==LKeyboardEvent.KEY_UP||type==LKeyboardEvent.KEY_PRESS){LEvent.addEventListener(LGlobal.window,type,listener);}else{LGlobal.stage.baseAddEvent(type,listener);}};LGlobal.stage.removeEventListener=function(type,listener){if(type==LEvent.WINDOW_RESIZE||type==LEvent.WINDOW_ORIENTATIONCHANGE){if(type==LEvent.WINDOW_RESIZE){delete LGlobal.stage.onresizeListener;if(LGlobal.stage.onorientationchangeListener){return;}}else{delete LGlobal.stage.onorientationchangeListener;if(LGlobal.stage.onresizeListener){return;}}LEvent.removeEventListener(LGlobal.window,LEvent.WINDOW_RESIZE,LGlobal.stage.onresize);delete LGlobal.stage.onresize;}else if(type==LKeyboardEvent.KEY_DOWN||type==LKeyboardEvent.KEY_UP||type==LKeyboardEvent.KEY_PRESS){LEvent.removeEventListener(LGlobal.window,type,listener);}else{LGlobal.stage.baseRemoveEvent(type,listener);}};LGlobal.innerWidth=window.innerWidth;LGlobal.innerHeight=window.innerHeight;LEvent.addEventListener(LGlobal.window,"blur",function(){LGlobal.stage.dispatchEvent(new LEvent(LFocusEvent.FOCUS_OUT));});};LGlobal.ll_touchStart=function(event){LGlobal._outStageCheckCount=1;LGlobal.IS_MOUSE_DOWN=true;LGlobal.stage.dispatchEvent(new LEvent(LFocusEvent.FOCUS_IN));if(LGlobal.inputBox.style.display!=NONE){LGlobal.inputTextField._ll_getValue();}var canvasX,canvasY,eve,k,i;canvasX=parseInt(0+LGlobal.object.style.left)+parseInt(LGlobal.canvasObj.style.marginLeft);canvasY=parseInt(0+LGlobal.object.style.top)+parseInt(LGlobal.canvasObj.style.marginTop);if(LMultitouch.inputMode==LMultitouchInputMode.NONE){eve=LGlobal.ll_touchStartEvent(event,0,canvasX,canvasY);}else if(LMultitouch.inputMode==LMultitouchInputMode.TOUCH_POINT){for(var i=0,l=event.touches.length; i<l; i++){if(!LMultitouch.touchs["touch"+event.touches[i].identifier]){eve=LGlobal.ll_touchStartEvent(event,i,canvasX,canvasY);}}}var date=new Date();var clickTime=date.getTime();LGlobal.ll_clicks=(clickTime<=(LGlobal.ll_prev_clickTime+500))?(LGlobal.ll_clicks+1):1;LGlobal.ll_prev_clickTime=clickTime;if(LGlobal.ll_clicks===2){LGlobal.mouseEvent(eve,LMouseEvent.DOUBLE_CLICK);LGlobal.ll_clicks=0;}if(LGlobal.mouseJoint_start){LGlobal.mouseJoint_start(eve);}LGlobal.touchHandler(event);};LGlobal.ll_touchStartEvent=function(event,eveIndex,canvasX,canvasY){var eve={offsetX:(event.touches[eveIndex].pageX-canvasX),offsetY:(event.touches[eveIndex].pageY-canvasY),touchPointID:event.touches[eveIndex].identifier,force:event.touches[eveIndex].force,rotationAngle:event.touches[eveIndex].rotationAngle,radiusX:event.touches[eveIndex].radiusX,radiusY:event.touches[eveIndex].radiusY};eve.offsetX=LGlobal.ll_scaleX(eve.offsetX);eve.offsetY=LGlobal.ll_scaleY(eve.offsetY);mouseX=LGlobal.offsetX=eve.offsetX;mouseY=LGlobal.offsetY=eve.offsetY;LMultitouch.touchs["touch"+eve.touchPointID]=eve;LGlobal.mouseEvent(eve,LMouseEvent.MOUSE_DOWN);LGlobal.buttonStatusEvent=eve;return eve;};LGlobal.ll_touchEnd=function(event){var e,eve,k,i,l,h;LGlobal.IS_MOUSE_DOWN=false;if(LMultitouch.inputMode==LMultitouchInputMode.TOUCH_POINT){for(k in LMultitouch.touchs){e=LMultitouch.touchs[k];h=false;for(i=0,l=event.touches.length; i<l; i++){if(event.touches[i].identifier==e.touchPointID){h=true;break;}}if(!h){eve=e;delete LMultitouch.touchs[k];LGlobal.mouseEvent(eve,LMouseEvent.MOUSE_UP);}}}if(!eve){eve={offsetX:LGlobal.offsetX,offsetY:LGlobal.offsetY};}LGlobal.mouseEvent(eve,LMouseEvent.MOUSE_UP);LGlobal.touchHandler(event);LGlobal.buttonStatusEvent=null;if(LGlobal.mouseJoint_end){LGlobal.mouseJoint_end();}LGlobal.stage.dispatchEvent(new LEvent(LFocusEvent.FOCUS_OUT));};LGlobal.ll_touchMove=function(e){var cX,cY,eve,l,ll=e.touches.length;cX=parseInt(0+LGlobal.object.style.left)+parseInt(LGlobal.canvasObj.style.marginLeft);cY=parseInt(0+LGlobal.object.style.top)+parseInt(LGlobal.canvasObj.style.marginTop);if(LMultitouch.inputMode==LMultitouchInputMode.NONE){ll=1;}for(i=0,l=e.touches.length; i<l&&i<ll; i++){eve={offsetX:(e.touches[i].pageX-cX),offsetY:(e.touches[i].pageY-cY),touchPointID:e.touches[i].identifier};eve.offsetX=LGlobal.ll_scaleX(eve.offsetX);eve.offsetY=LGlobal.ll_scaleY(eve.offsetY);mouseX=LGlobal.offsetX=eve.offsetX;mouseY=LGlobal.offsetY=eve.offsetY;if(LMultitouch.touchs["touch"+eve.touchPointID]&&LMultitouch.touchs["touch"+eve.touchPointID].offsetX==eve.offsetX&&LMultitouch.touchs["touch"+eve.touchPointID].offsetY==eve.offsetY){continue;}LGlobal.buttonStatusEvent=eve;LMultitouch.touchs["touch"+eve.touchPointID]=eve;if(eve.offsetX<=0||eve.offsetX>=LGlobal.innerWidth||eve.offsetX>=LGlobal.width||eve.offsetY<=0||eve.offsetY>=LGlobal.innerHeight||eve.offsetY>=LGlobal.height){LGlobal._outStageCheckCount=0;}else{LGlobal._outStageCheckCount=1;}LGlobal.mouseEvent(eve,LMouseEvent.MOUSE_MOVE);}LGlobal.touchHandler(e);if(LGlobal.mouseJoint_move){LGlobal.mouseJoint_move(eve);}};LGlobal.ll_mouseDbclick=function(e){if(e.offsetX==null&&e.layerX!=null){e.offsetX=e.layerX;e.offsetY=e.layerY;}var event={button:e.button};event.offsetX=LGlobal.ll_scaleX(e.offsetX);event.offsetY=LGlobal.ll_scaleY(e.offsetY);LGlobal.mouseEvent(event,LMouseEvent.DOUBLE_CLICK);};LGlobal.ll_mouseDown=function(e){if(e.offsetX==null&&e.layerX!=null){e.offsetX=e.layerX;e.offsetY=e.layerY;}if(LGlobal.inputBox.style.display!=NONE){LGlobal.inputTextField._ll_getValue();}var event={button:e.button};event.offsetX=LGlobal.ll_scaleX(e.offsetX);event.offsetY=LGlobal.ll_scaleY(e.offsetY);LGlobal.mouseEvent(event,LMouseEvent.MOUSE_DOWN);LGlobal.IS_MOUSE_DOWN=true;if(LGlobal.mouseJoint_start){LGlobal.mouseJoint_start(event);}};LGlobal.ll_mouseMove=function(e){if(e.offsetX==null&&e.layerX!=null){e.offsetX=e.layerX;e.offsetY=e.layerY;}var event={};event.offsetX=LGlobal.ll_scaleX(e.offsetX);event.offsetY=LGlobal.ll_scaleY(e.offsetY);LGlobal.buttonStatusEvent=event;mouseX=LGlobal.offsetX=event.offsetX;mouseY=LGlobal.offsetY=event.offsetY;LGlobal.cursor="default";if(mouseX<=0||mouseX>=LGlobal.innerWidth||mouseX>=LGlobal.width||mouseY<=0||mouseY>=LGlobal.innerHeight||mouseY>=LGlobal.height){if(LGlobal._outStageCheckCount){LGlobal._outStageCheckCount=0;LGlobal.stage.dispatchEvent(new LEvent(LFocusEvent.FOCUS_OUT));}}else{if(!LGlobal._outStageCheckCount){LGlobal._outStageCheckCount=1;LGlobal.stage.dispatchEvent(new LEvent(LFocusEvent.FOCUS_IN));}}LGlobal.mouseEvent(event,LMouseEvent.MOUSE_MOVE);document.body.style.cursor=LGlobal.cursor;if(LGlobal.mouseJoint_move){LGlobal.mouseJoint_move(event);}};LGlobal.ll_mouseUp=function(e){if(e.offsetX==null&&e.layerX!=null){e.offsetX=e.layerX;e.offsetY=e.layerY;}var event={button:e.button};event.offsetX=LGlobal.ll_scaleX(e.offsetX);event.offsetY=LGlobal.ll_scaleY(e.offsetY);LGlobal.mouseEvent(event,LMouseEvent.MOUSE_UP);LGlobal.IS_MOUSE_DOWN=false;if(LGlobal.mouseJoint_end){LGlobal.mouseJoint_end();}};LGlobal.ll_mouseOut=function(e){if(e.offsetX==null&&e.layerX!=null){e.offsetX=e.layerX;e.offsetY=e.layerY;}var event={};event.offsetX=LGlobal.ll_scaleX(e.offsetX);event.offsetY=LGlobal.ll_scaleY(e.offsetY);LGlobal.mouseEvent(event,LMouseEvent.MOUSE_OUT);LGlobal.IS_MOUSE_DOWN=false;};LGlobal.touchHandler=function(e){if(LGlobal.stopPropagation){e.stopPropagation();if(e.stopImmediatePropagation){e.stopImmediatePropagation();}}if(LGlobal.preventDefault){e.preventDefault();}return e;};LGlobal.mouseEvent=function(e,t){if(t==LMouseEvent.MOUSE_MOVE){LGlobal.dragHandler(e);}if(LMouseEventContainer.container[t]){LMouseEventContainer.dispatchMouseEvent(e,t);return;}for(var k=LGlobal.childList.length-1; k>=0; k--){if(LGlobal.childList[k].mouseEvent&&LGlobal.childList[k].mouseEvent(e,t)){break;}}};LGlobal.dragHandler=function(e){var i,s,c,d=LGlobal.dragList;for(i=d.length-1; i>=0; i--){s=d[i];if(LGlobal.canTouch&&s.ll_touchPointID!=e.touchPointID){continue;}c=s.parent.globalToLocal(new LPoint(e.offsetX-s.ll_dragMX+s.ll_dragGlobalPoint.x,e.offsetY-s.ll_dragMY+s.ll_dragGlobalPoint.y));s.x=c.x;s.y=c.y;if(s.dragRange){if(s.x<s.dragRange.left){s.x=s.dragRange.left;}else if(s.x>s.dragRange.right){s.x=s.dragRange.right;}if(s.y<s.dragRange.top){s.y=s.dragRange.top;}else if(s.y>s.dragRange.bottom){s.y=s.dragRange.bottom;}}break;}};LGlobal._ll_mobile=function(){var w1=LGlobal.width*0.3,h1=w1*1.5,s=LGlobal.width*0.05,ss=w1*0.05,sm=w1*0.15,sx=w1*0.3,sh=h1*0.20,c='#cccccc',d='#000000',f='#ffffff',h='#ff0000',b,w1,h1,m,m1,n,v;b=new LSprite();addChild(b);w1=LGlobal.width*0.3,h1=w1*1.5;b.graphics.drawRoundRect(1,d,[s,s,w1,h1,s],true,c);b.graphics.drawRoundRect(1,d,[s+ss,s+ss,w1-ss*2,h1-ss*2,s],true,d);b.graphics.drawRect(1,f,[s+sm,s+sh,w1-sm*2,h1-sh*2],true,f);b.graphics.drawArc(1,f,[s+w1*0.5,s+h1-ss*3.5,ss*1.5,0,2*Math.PI]);b.graphics.drawRoundRect(1,f,[s+sx,s+sm,w1-sx*2,ss,ss*0.5]);m=new LSprite();m.x=-(w1-sm*2)*0.5;m.y=-ss*0.5;m.graphics.drawRect(1,h,[0,0,w1-sm*2,ss],true,h);m1=new LSprite();m1.y=-(w1-sm*2)*0.5;m1.x=-ss*0.5;m1.graphics.drawRect(1,h,[0,0,ss,w1-sm*2],true,h);n=new LSprite();n.x=s+sx+(w1-sx*2)*0.5;n.y=s+sh+(h1-sh*2)*0.5;n.rotate=45;n.addChild(m);n.addChild(m1);b.addChild(n);v=new LSprite();v.graphics.drawVertices(2,d,[[0,0],[sm,sm ],[0,sm*2]],true,c);v.x=s*1.5+h1;v.y=s*1.5+h1*0.5;addChild(v);b.arrow=v;var fn=function(){setTimeout(function(){location.href=location.href;},100);};window.onorientationchange=fn;return b;};LGlobal.verticalError=function(){var w1=LGlobal.width*0.3,s=LGlobal.width*0.05;var b=LGlobal._ll_mobile();var d=b.clone();d.getChildAt(0).visible=false;d.x=LGlobal.width*0.5+s;addChild(d);b.rotate=90;b.x=LGlobal.width*0.5+s;b.y=w1*0.5;};LGlobal.horizontalError=function(){var w1=LGlobal.width*0.3,s=LGlobal.width*0.05;var b=LGlobal._ll_mobile();var d=b.clone();d.getChildAt(0).visible=false;d.rotate=90;d.x=LGlobal.width-s;d.y=w1*0.5;addChild(d);b.arrow.x=s*1.5+w1;};LGlobal.onShow=function(){if(LGlobal.canvas==null){return;}if(LGlobal._outStageCheckCount<=0){LGlobal._outStageCheckCount--;if(LGlobal._outStageCheckCount<-2){LGlobal.stage.dispatchEvent(new LEvent(LFocusEvent.FOCUS_OUT));LGlobal._outStageCheckCount=1;}}if(LGlobal.fpsStatus){LGlobal.fpsStatus.reset();}if(LGlobal.stage.onresizeEvent){if(LGlobal.stage.onresizeListener){LGlobal.stage.onresizeListener(LGlobal.stage.onresizeEvent);}if(LGlobal.stage.onorientationchangeListener){LGlobal.stage.onorientationchangeListener({orientation:(window.innerWidth>window.innerHeight?LANDSCAPE:PORTRAIT)});}delete LGlobal.stage.onresizeEvent;}if(LGlobal.forceRefresh){LGlobal.canvasObj.width=LGlobal.canvasObj.width;LGlobal.forceRefresh=false;}LGlobal.canvas.beginPath();if(LGlobal.box2d!=null){LGlobal.box2d.ll_show();if(!LGlobal.traceDebug&&LGlobal.keepClear){LGlobal.canvas.clearRect(0,0,LGlobal.width+1,LGlobal.height+1);}}else{if(LGlobal.keepClear){LGlobal.canvas.clearRect(0,0,LGlobal.width+1,LGlobal.height+1);}if(LGlobal.backgroundColor!==null){LGlobal.canvas.fillStyle=LGlobal.backgroundColor;LGlobal.canvas.fillRect(0,0,LGlobal.width,LGlobal.height);}}LGlobal.show(LGlobal.childList,LGlobal.canvas);};LGlobal.show=function(s,ctx){ctx=ctx||LGlobal.canvas;for(var i=0,l=s.length,c; i<l; i++){c=s[i];if(c&&c.ll_show){c.ll_show(ctx);if(c._ll_removeFromSelf){i--;l--;}}}};LGlobal.divideCoordinate=function(w,h,row,col){var i,j,cw=w/col,ch=h/row,r=[],c;for(i=0; i<row; i++){c=[];for(j=0; j<col; j++){c.push({x:cw*j,y:ch*i,width:cw,height:ch});}r.push(c);}return r;};LGlobal._create_loading_color=function(){var co=LGlobal.canvas.createRadialGradient(LGlobal.width/2,LGlobal.height,0,LGlobal.width/2,0,LGlobal.height);co.addColorStop(0,"red");co.addColorStop(0.3,"orange");co.addColorStop(0.4,"yellow");co.addColorStop(0.5,"green");co.addColorStop(0.8,"blue");co.addColorStop(1,"violet");return co;};LGlobal.hitPolygon=function(list,x,y){var c=0,p0=list[0],b0x=(x<=p0[0]),b0y=(y<=p0[1]),i,l,p1,b1x,b1y;for(i=1,l=list.length; i<l+1; i++){p1=list[i % l];b1x=(x<=p1[0]);b1y=(y<=p1[1]);if(b0y!=b1y){if(b0x==b1x){if(b0x){c+=(b0y?-1:1);}}else{if(x<=(p0[0]+(p1[0]-p0[0])*(y-p0[1])/(p1[1]-p0[1]))){c+=(b0y?-1:1);}}}p0=p1;b0x=b1x;b0y=b1y;}return 0!=c;};LGlobal.hitTestPolygon=function(p1,p2){var i,j,l,listA,normals,vecs,list=[[p1,[],[]],[p2,[],[]]];for(j=0; j<list.length; j++){listA=list[j][0],normals=list[j][1];for(i=0,l=listA.length; i<l; i++){list[j][2].push(new LVec2(listA[i][0],listA[i][1]));if(i<l-1){normals.push((new LVec2(listA[i+1][0]-listA[i][0],listA[i+1][1]-listA[i][1])).normL());}}normals.push((new LVec2(listA[0][0]-listA[l-1][0],listA[0][1]-listA[l-1][1])).normL());}for(j=0; j<list.length; j++){normals=list[j][1];for(i=0,l=normals.length; i<l; i++){var r1=LVec2.getMinMax(list[0][2],normals[i]);var r2=LVec2.getMinMax(list[1][2],normals[i]);if(r1.max_o<r2.min_o||r1.min_o>r2.max_o){return false;}}}return true;};LGlobal.hitTestPolygonArc=function(vs,arc){if(LGlobal.hitPolygon(vs,arc[0],arc[1])){return true;}var i,j,l,p1,p2,v1,v2,ext,inn,l2;for(i=0,l=vs.length; i<l; i++){j=i<l-1?i+1:0;p1=vs[i],p2=vs[j];v1=new LVec2(arc[0]-p1[0],arc[1]-p1[1]),v2=new LVec2(p2[0]-p1[0],p2[1]-p1[1]);l2=v2.normalize();inn=LVec2.dot(v1,l2);if(inn<=0){if(v1.x*v1.x+v1.y*v1.y<arc[3]){return true;}}else if(inn*inn<v2.x*v2.x+v2.y*v2.y){ext=LVec2.cross(v1,l2);if(ext*ext<arc[3]){return true;}}}return false;};LGlobal.hitTestArc=function(objA,objB,objAR,objBR){var rA=objA.getWidth()*0.5,rB=objB.getWidth()*0.5,xA=objA._startX?objA._startX():objA.startX(),xB=objB._startX?objB._startX():objB.startX(),yA=objA._startY?objA._startY():objA.startY(),yB=objB._startY?objB._startY():objB.startY();if(typeof objAR!=UNDEFINED){xA+=(rA-objAR);yA+=(rA-objAR);rA=objAR;}if(typeof objBR!=UNDEFINED){xB+=(rB-objBR);yB+=(rB-objBR);rB=objBR;}var disx=xA+rA-xB-rB,disy=yA+rA-yB-rB;return disx*disx+disy*disy<(rA+rB)*(rA+rB);};LGlobal.hitTestRect=function(objA,objB,vecA,vecB){var wA=objA.getWidth(),wB=objB.getWidth(),hA=objA.getHeight(),hB=objB.getHeight(),xA=objA._startX?objA._startX():objA.startX(),xB=objB._startX?objB._startX():objB.startX(),yA=objA._startY?objA._startY():objA.startY(),yB=objB._startY?objB._startY():objB.startY();if(typeof vecA!=UNDEFINED){xA+=(wA-vecA[0])*0.5;yA+=(hA-vecA[1])*0.5;wA=vecA[0];hA=vecA[1];}if(typeof vecB!=UNDEFINED){xB+=(wB-vecB[0])*0.5;yB+=(hB-vecB[1])*0.5;wB=vecB[0];hB=vecB[1];}var minx=xA>xB?xA:xB,miny=yA>yB?yA:yB,maxx=(xA+wA)>(xB+wB)?(xB+wB):(xA+wA),maxy=(yA+hA)>(yB+hB)?(yB+hB):(yA+hA);return minx<=maxx&&miny<=maxy;};LGlobal.hitTest=LGlobal.hitTestRect;LGlobal.setFrameRate=function(s){if(LGlobal.frameRate){clearInterval(LGlobal.frameRate);}LGlobal.speed=s;LGlobal.frameRate=setInterval(function(){LGlobal.onShow();},s);};LGlobal.ll_scaleX=function(v){return(v-LGlobal.left)*LGlobal.width/LGlobal.canvasStyleWidth;};LGlobal.ll_scaleY=function(v){return(v-LGlobal.top)*LGlobal.height/LGlobal.canvasStyleHeight;};LGlobal.ll_setStageSize=function(w,h){w=Math.ceil(w);h=Math.ceil(h);LGlobal.canvasObj.style.width=w+"px";LGlobal.canvasObj.style.height=h+"px";LGlobal.canvasStyleWidth=w;LGlobal.canvasStyleHeight=h;};LGlobal.resize=function(canvasW,canvasH){var w,h,t=0,l=0,ww=window.innerWidth,wh=window.innerHeight;LGlobal.innerWidth=ww;LGlobal.innerHeight=wh;if(canvasW){w=canvasW;}if(canvasH){h=canvasH;}if(LGlobal.stageScale=="noScale"){w=canvasW||LGlobal.width;h=canvasH||LGlobal.height;}switch(LGlobal.stageScale){case "exactFit":w=canvasW||ww;h=canvasH||wh;break;case "noBorder":w=canvasW||ww;h=canvasH||LGlobal.height*ww/LGlobal.width;switch(LGlobal.align){case LStageAlign.BOTTOM:case LStageAlign.BOTTOM_LEFT:case LStageAlign.BOTTOM_RIGHT:case LStageAlign.BOTTOM_MIDDLE:t=wh-h;break;}break;case "showAll":if(ww/wh>LGlobal.width/LGlobal.height){h=canvasH||wh;w=canvasW||LGlobal.width*wh/LGlobal.height;}else{w=canvasW||ww;h=canvasH||LGlobal.height*ww/LGlobal.width;}case "noScale":default:switch(LGlobal.align){case LStageAlign.BOTTOM:case LStageAlign.BOTTOM_LEFT:t=wh-h;break;case LStageAlign.RIGHT:case LStageAlign.TOP_RIGHT:l=ww-w;break;case LStageAlign.TOP_MIDDLE:l=(ww-w)*0.5;break;case LStageAlign.BOTTOM_RIGHT:t=wh-h;l=ww-w;break;case LStageAlign.BOTTOM_MIDDLE:t=wh-h;l=(ww-w)*0.5;break;case LStageAlign.MIDDLE:t=(wh-h)*0.5;l=(ww-w)*0.5;break;case LStageAlign.TOP:case LStageAlign.LEFT:case LStageAlign.TOP_LEFT:default:}}LGlobal.canvasObj.style.marginTop=t+"px";LGlobal.canvasObj.style.marginLeft=l+"px";if(LGlobal.isOldFirefox){LGlobal.left=parseInt(LGlobal.canvasObj.style.marginLeft);LGlobal.top=parseInt(LGlobal.canvasObj.style.marginTop);}LGlobal.ll_setStageSize(w,h);};LGlobal.sleep=function(s){var d=new Date();while((new Date().getTime()-d.getTime())<s){}};LGlobal.screen=function(a){LGlobal.displayState=a;if(LGlobal.stage){if(typeof LGlobal.displayState=="number"){LGlobal.resize(LGlobal.width*LGlobal.displayState,LGlobal.height*LGlobal.displayState);}else{LGlobal.resize();}}};return LGlobal;})();var LSystem=LGlobal;var LStage=LGlobal;if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elt){var len=this.length>>>0;var from=Number(arguments[1])||0;from=(from<0)?Math.ceil(from):Math.floor(from);if(from<0){from+=len;}for(; from<len; from++){if(from in this&&this[from]===elt){return from;}}return-1;};}if(!Array.isArray){Array.isArray=function(value){return Object.prototype.toString.apply(value)=='[object Array]';};}if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind-what is trying to be bound is not callable");}var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};}if(!Array.prototype.find){Array.prototype.find=function(predicate){if(this==null){throw new TypeError('Array.prototype.find called on null or undefined');}if(typeof predicate!=='function'){throw new TypeError('predicate must be a function');}var list=Object(this);var length=list.length>>>0;var thisArg=arguments[1];var value;for(var i=0; i<length; i++){value=list[i];if(predicate.call(thisArg,value,i,list)){return value;}}return undefined;};}if(!Array.prototype.findIndex){Array.prototype.findIndex=function(predicate){if(this==null){throw new TypeError('Array.prototype.find called on null or undefined');}if(typeof predicate!=='function'){throw new TypeError('predicate must be a function');}var list=Object(this);var length=list.length>>>0;var thisArg=arguments[1];var value;for(var i=0; i<length; i++){value=list[i];if(predicate.call(thisArg,value,i,list)){return i;}}return-1;};}if(!Array.prototype.forEach){Array.prototype.forEach=function(callback,thisArg){var T,k;if(this==null){throw new TypeError(' this is null or not defined');}var O=Object(this);var len=O.length>>>0;if(typeof callback!=="function"){throw new TypeError(callback+' is not a function');}if(arguments.length>1){T=thisArg;}k=0;while(k<len){var kValue;if(k in O){kValue=O[k];callback.call(T,kValue,k,O);}k++;}};}if(!Array.prototype.every){Array.prototype.every=function(callbackfn,thisArg){'use strict';var T,k;if(this==null){throw new TypeError('this is null or not defined');}var O=Object(this);var len=O.length>>>0;if(typeof callbackfn!=='function'){throw new TypeError();}if(arguments.length>1){T=thisArg;}k=0;while(k<len){var kValue;if(k in O){kValue=O[k];var testResult=callbackfn.call(T,kValue,k,O);if(!testResult){return false;}}k++;}return true;};}if(!Array.prototype.some){Array.prototype.some=function(fun){'use strict';if(this==null){throw new TypeError('Array.prototype.some called on null or undefined');}if(typeof fun!=='function'){throw new TypeError();}var t=Object(this);var len=t.length>>>0;var thisArg=arguments.length>=2?arguments[1]:void 0;for(var i=0; i<len; i++){if(i in t&&fun.call(thisArg,t[i],i,t)){return true;}}return false;};}if(!String.format){String.format=function(format){var args=Array.prototype.slice.call(arguments,1);return format.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!='undefined'?args[number]:match;});};}if(Function.prototype.name===undefined&&Object.defineProperty!==undefined){Object.defineProperty(Function.prototype,'name',{get:function(){var funcNameRegex=/function\s([^(]{1,})\(/;var results=(funcNameRegex).exec((this).toString());return(results&&results.length>1)?results[1].trim():"";},set:function(value){}});}function trace(){if(!LGlobal.traceDebug)return;var t=document.getElementById("traceObject"),i;if(trace.arguments.length>0&&t==null){var d=document.createElement("DIV");d.position=0;d.style.position="absolute";document.body.appendChild(d);t=document.createElement("TEXTAREA");t.id="traceObject";t.style.width=(window.innerWidth*0.5)+"px";t.style.height="200px";var b=document.createElement("BUTTON");b.style.width=(window.innerWidth*0.25)+"px";b.innerHTML="Hide";d.appendChild(b);LEvent.addEventListener(b,LGlobal.mobile?"touchstart":"click",function(e){t.style.display=(t.style.display=="none"?"":"none");});b=document.createElement("BUTTON");b.style.width=(window.innerWidth*0.25)+"px";b.innerHTML="position";d.appendChild(b);var f=function(e){d.position++;if(d.position==0){d.style.top="5px";d.style.left="5px";}else if(d.position==1){d.style.top=(window.innerHeight-20-parseInt(t.style.height))+"px";d.style.left="5px";}else if(d.position==2){d.style.top="5px";d.style.left=(window.innerWidth-parseInt(t.style.width))+"px";}else{d.style.top=(window.innerHeight-20-parseInt(t.style.height))+"px";d.style.left=(window.innerWidth-parseInt(t.style.width))+"px";d.position=-1;}};f();LEvent.addEventListener(b,LGlobal.mobile?"touchstart":"click",f);d.appendChild(document.createElement("BR"));d.appendChild(t);}for(i=0; i<trace.arguments.length; i++){t.value=t.value+trace.arguments[i]+"\r\n";t.scrollTop=t.scrollHeight;}}if(!window.console){window.console={log:trace,warn:trace};}function addChild(o){LGlobal.stage.addChild(o);}function removeChild(o){LGlobal.stage.removeChild(o);}function init(s,c,w,h,f,t){LGlobal.speed=s;var _f=function(){if(LGlobal.canTouch&&LGlobal.aspectRatio==LANDSCAPE&&window.innerWidth<window.innerHeight){LGlobal.horizontalError();}else if(LGlobal.canTouch&&LGlobal.aspectRatio==PORTRAIT&&window.innerWidth>window.innerHeight){LGlobal.verticalError();}else{setTimeout(f,100);}LGlobal.startTimer=(new Date()).getTime();};var loop;if(typeof s=="function"){LGlobal.setCanvas(c,w,h);_f();loop=function(){s(loop);LGlobal.onShow();};LGlobal.speed=1000/60;}else{loop=function(){LGlobal.frameRate=setInterval(function(){LGlobal.onShow();},s);LGlobal.setCanvas(c,w,h);_f();};}if(document.readyState==="complete"){loop();}else{LEvent.addEventListener(window,"load",function(){loop();});}}var LInit=init;function base(d,b,a){var p=null,o=d.constructor.prototype,h={};if(d.constructor.name=="Object"){console.warn("When you use the extends. You must make a method like 'XX.prototype.xxx=function(){}'. but not 'XX.prototype={xxx:function(){}}'.");}if(typeof d.__ll__parent__==UNDEFINED){d.__ll__parent__=[];d.__ll__parent__=[];}d.__ll__parent__.push(b.prototype);for(p in o){h[p]=1;}for(p in b.prototype){if(!h[p]){o[p]=b.prototype[p];}}if(o.toString==Object.prototype.toString){o.toString=LObject.prototype.toString;}b.apply(d,a);}var LExtends=base;function getTimer(){return(new Date()).getTime()-LGlobal.startTimer;}function getExtension(path){var r,pattern=/([^#?]+\.)([^.#?]+)/;r=path.match(pattern);if(r.length>=3){return r[2].toLowerCase();}return null;}var LObject=(function(){function LObject(){this.type="LObject";this.objectIndex=++LGlobal.objectIndex;this.objectindex=this.objectIndex;}LObject.prototype={callParent:function(f_n,args){if(!f_n||!args){return;}var s=this,init=false,r,k="__ll__parent_call"+f_n;if(typeof s[k]=="undefined"){init=true;s[k]=0;}else{s[k]++;}if(s[k]>=s.__ll__parent__.length){return false;}if(!s.__ll__parent__[s[k]][f_n]){r=s.callParent(f_n,args);}else{r=s.__ll__parent__[s[k]][f_n].apply(s,args);}if(init){delete s[k];}return r;},copyProperty:function(a){var s=this,k;for(k in a){if(typeof a[k]=="number"||typeof a[k]=="string"||typeof a[k]=="boolean"){if(k=="objectindex"||k=="objectIndex"){continue;}s[k]=a[k];}else if(Array.isArray(a[k])){s[k]=a[k].slice();}}if(a.mask){s.mask=a.mask.clone();}},toString:function(){return "[object "+this.constructor.name+"]";}};return LObject;})();var LTimer=(function(){function LTimer(delay,repeat){var s=this;LExtends(s,LEventDispatcher,[]);s.type="LTimer";s.delay=delay;s.repeatCount=repeat?repeat:Number.MAX_VALUE;s.running=false;s.currentCount=0;s.reset();LTimer.TimerManager.add(s);}LTimer.TimerManager=(function(){function TimerManager(){this.childList=[];}TimerManager.prototype={ll_show:function(){var s=this,d;for(var i=0;i<s.childList.length;i++){d=s.childList[i];if(d){d.ll_show();}}},add:function(child){this.childList.push(child);},remove:function(d){var s=this,c=s.childList,i,l;for(i=0,l=c.length; i<l; i++){if(d.objectIndex==c[i].objectIndex){s.childList.splice(i,1);break;}}}};return new TimerManager();})();p={start:function(){this.running=true;},stop:function(){this.running=false;},reset:function(){var s=this;s.currentTime=0;s.currentCount=0;s.stop();},destroy:function(){LTimer.TimerManager.remove(this);},ll_show:function(){var s=this;if(!s.running||s.currentCount>=s.repeatCount){return;}s.currentTime+=LGlobal.speed;if(s.currentTime<s.delay){return;}s.currentTime=0;s.currentCount++;s.dispatchEvent(LTimerEvent.TIMER);if(s.currentCount>=s.repeatCount){s.dispatchEvent(LTimerEvent.TIMER_COMPLETE);}}};for(var k in p){LTimer.prototype[k]=p[k];}LGlobal.childList.push(LTimer.TimerManager);return LTimer;})();var LColorTransform=(function(){function LColorTransform(redMultiplier,greenMultiplier,blueMultiplier,alphaMultiplier,redOffset,greenOffset,blueOffset,alphaOffset){var s=this;LExtends(s,LObject,[]);s.redMultiplier=redMultiplier;s.greenMultiplier=greenMultiplier;s.blueMultiplier=blueMultiplier;s.alphaMultiplier=alphaMultiplier;s.redOffset=redOffset;s.greenOffset=greenOffset;s.blueOffset=blueOffset;s.alphaOffset=alphaOffset;}return LColorTransform;})();var LTransform=(function(){function LTransform(){var s=this;LExtends(s,LObject,[]);s.matrix=null;}return LTransform;})();var LMatrix=(function(){function LMatrix(a,b,c,d,tx,ty,u,v,w){var s=this;LExtends(s,LObject,[]);s.a=1;s.b=0;s.u=0;s.c=0;s.d=1;s.v=0;s.tx=0;s.ty=0;s.w=1;if(typeof a!=UNDEFINED){s.a=a;}if(typeof b!=UNDEFINED){s.b=b;}if(typeof c!=UNDEFINED){s.c=c;}if(typeof d!=UNDEFINED){s.d=d;}if(typeof tx!=UNDEFINED){s.tx=tx;}if(typeof ty!=UNDEFINED){s.ty=ty;}if(typeof u!=UNDEFINED){s.u=u;}if(typeof v!=UNDEFINED){s.v=v;}if(typeof w!=UNDEFINED){s.w=w;}}var p={setTo:function(a,b,c,d,tx,ty,u,v,w){var s=this;if(typeof a!=UNDEFINED){s.a=a;}if(typeof b!=UNDEFINED){s.b=b;}if(typeof c!=UNDEFINED){s.c=c;}if(typeof d!=UNDEFINED){s.d=d;}if(typeof tx!=UNDEFINED){s.tx=tx;}if(typeof ty!=UNDEFINED){s.ty=ty;}if(typeof u!=UNDEFINED){s.u=u;}if(typeof v!=UNDEFINED){s.v=v;}if(typeof w!=UNDEFINED){s.w=w;}return s;},isIdentity:function(){var s=this;return(s.a==1&&s.b==0&&s.c==0&&s.d==1&&s.tx==0&&s.ty==0&&u==0&&v==0&&w==1);},transform:function(c){var s=this;c.transform(s.a,s.b,s.c,s.d,s.tx,s.ty);return s;},identity:function(){this.setTo(1,0,0,1,0,0,0,0,1);},rotate:function(q){var s=this,radian=q*Math.PI/180,cos=Math.cos(radian),sin=Math.sin(radian),mtx=new LMatrix(cos,sin,-sin,cos,0,0,0,0,1);s.add(mtx);return s;},scale:function(sx,sy){var s=this,mtx=new LMatrix(sx,0,0,sy,0,0,0,0,1);s.add(mtx);return s;},translate:function(tx,ty){var s=this,mtx=new LMatrix(1,0,0,1,tx,ty,0,0,1);s.add(mtx);return s;},skew:function(kx,ky){var s=this,mtx=new LMatrix(1,ky,kx,1,0,0,0,0,1);s.add(mtx);return s;},add:function(mtx){var s=this,a,b,c,d,tx,ty,u,v,w;a=s.a*mtx.a+s.b*mtx.c+s.u*mtx.tx;b=s.a*mtx.b+s.b*mtx.d+s.u*mtx.ty;u=s.a*mtx.u+s.b*mtx.v+s.u*mtx.w;c=s.c*mtx.a+s.d*mtx.c+s.v*mtx.tx;d=s.c*mtx.b+s.d*mtx.d+s.v*mtx.ty;v=s.c*mtx.u+s.d*mtx.v+s.v*mtx.w;tx=s.tx*mtx.a+s.ty*mtx.c+s.w*mtx.tx;ty=s.tx*mtx.b+s.ty*mtx.d+s.w*mtx.ty;w=s.tx*mtx.u+s.ty*mtx.v+s.w*mtx.w;s.setTo(a,b,c,d,tx,ty,u,v,w);},toArray:function(mtx){var s=this;if(Array.isArray(mtx)&&mtx.length==3){var m=mtx[0]*s.a+mtx[1]*s.c+mtx[2]*s.tx,n=mtx[0]*s.b+mtx[1]*s.d+mtx[2]*s.ty,k=mtx[0]*s.u+mtx[1]*s.v+mtx[2]*s.w;return [m,n,k];}else{var a=s.a*mtx.a+s.b*mtx.c+s.u*mtx.tx,b=s.a*mtx.b+s.b*mtx.d+s.u*mtx.ty,u=s.a*mtx.u+s.b*mtx.v+s.u*mtx.w,c=s.c*mtx.a+s.d*mtx.c+s.v*mtx.tx,d=s.c*mtx.b+s.d*mtx.d+s.v*mtx.ty,v=s.c*mtx.u+s.d*mtx.v+s.v*mtx.w,tx=s.tx*mtx.a+s.ty*mtx.c+s.w*mtx.tx,ty=s.tx*mtx.b+s.ty*mtx.d+s.w*mtx.ty,w=s.tx*mtx.u+s.ty*mtx.v+s.w*mtx.w;return [a,b,c,d,tx,ty,u,v,w];}},clone:function(){var s=this;return new LMatrix(s.a,s.b,s.c,s.d,s.tx,s.ty,s.u,s.v,s.w);}};for(var k in p){LMatrix.prototype[k]=p[k];}return LMatrix;})();var LVec2=(function(){function LVec2(x,y){this.x=x||0;this.y=y||0;}LVec2.dot=function(a,b){return a.x*b.x+a.y*b.y;};LVec2.cross=function(a,b){return a.x*b.y-a.y*b.x;};LVec2.distance=function(a,b){var x=a.x-b.x;var y=a.y-b.y;return Math.sqrt(x*x+y*y);};LVec2.getMinMax=function(vecs,axis){var min_o=LVec2.dot(vecs[0],axis);var max_o=LVec2.dot(vecs[0],axis);var min_i=0;var max_i=0;for(var i=1; i<vecs.length; i++){var this_o=LVec2.dot(vecs[i],axis);if(min_o>this_o){min_o=this_o;min_i=i;}if(max_o<this_o){max_o=this_o;max_i=i;}}var r={"min_o":min_o,"min_i":min_i,"max_o":max_o,"max_i":max_i};return r;};LVec2.prototype={length:function(){var s=this;return Math.sqrt(s.x*s.x+s.y*s.y);},normalize:function(){var s=this,l=s.length();return new LVec2(s.x/l,s.y/l);},normR:function(){return new LVec2(-this.y,this.x);},normL:function(){return new LVec2(this.y,-this.x);}};return LVec2;})();var LEventDispatcher=(function(){function LEventDispatcher(){var s=this;LExtends(s,LObject,[]);s._eventList=new Array();}var p={addEventListener:function(type,listener){this._eventList.push({listener:listener,type:type});},removeEventListener:function(type,listener){var s=this,i,length;length=s._eventList.length;for(i=0; i<length; i++){if(!s._eventList[i]){continue;}if(type==s._eventList[i].type&&(!listener||s._eventList[i].listener==listener)){s._eventList.splice(i,1);return;}}},removeAllEventListener:function(){this._eventList=[];},dispatchEvent:function(event){var s=this,i,length=s._eventList.length,ctype=(typeof event=="string")?event:event.eventType;for(i=0; i<length; i++){if(!s._eventList[i]){continue;}if(ctype==s._eventList[i].type){if(typeof event=="string"){s.currentTarget=s.target=s;s.eventType=s.event_type=ctype;s._eventList[i].listener(s);delete s.currentTarget;delete s.target;delete s.eventType;}else{if(!event.target){event.target=s;}if(!event.currentTarget){event.currentTarget=event.target;}event._ll_preventDefault=false;s._eventList[i].listener(event);if(event._ll_preventDefault){return false;}}return true;}}return false;},hasEventListener:function(type,listener){var s=this,i,length=s._eventList.length;for(i=0; i<length; i++){if(!s._eventList[i]){continue;}if(type==s._eventList[i].type){if(typeof listener==UNDEFINED||listener==s._eventList[i].listener){return true;}}}return false;}};for(var k in p){LEventDispatcher.prototype[k]=p[k];}return LEventDispatcher;})();var LDisplayObject=(function(){function LDisplayObject(){var s=this;LExtends(s,LEventDispatcher,[]);s.name="instance"+s.objectIndex;s.x=0;s.y=0;s.width=0;s.height=0;s.scaleX=1;s.scaleY=1;s.alpha=1;s.visible=true;s.rotate=0;s.mask=null;s.blendMode=null;s.filters=null;s.transform=new LTransform();s.parent=null;}var p={_createCanvas:function(){var s=this;if(!s._canvas){s._canvas=document.createElement("canvas");s._context=s._canvas.getContext("2d");}},ll_show:function(c){var s=this;c=c||LGlobal.canvas;if(!s._canShow()){return;}s._ll_trans=false;if(!LGlobal.box2d&&typeof s._ll_loopframe=="function"){s._ll_loopframe();}c.save();s._showReady(c);if(s.blendMode){c.globalCompositeOperation=s.blendMode;}if(s.filters){s._ll_setFilters(c);}s._rotateReady();if(s.mask!=null&&s.mask.ll_show&&!s._ll_cacheAsBitmap){s.mask.ll_show(c);c.clip();}s._transformRotate(c);s._transformScale(c);s._coordinate(c);if(s.transform.matrix){s.transform.matrix.transform(c);}if(s.alpha<1){s._ll_trans=true;c.globalAlpha*=s.alpha;}if(LGlobal.fpsStatus){LGlobal.fpsStatus.display++;if(s._ll_trans){LGlobal.fpsStatus.transform++;}}if(s._ll_cacheAsBitmap){s._ll_cacheAsBitmap._ll_show(c);}else{s._ll_show(c);}c.restore();if(LGlobal.box2d!=null&&typeof s._ll_loopframe=="function"){s._ll_loopframe();}},_canShow:function(){return this.visible;},_coordinate:function(c){var s=this;if(s.x!=0||s.y!=0){s._ll_trans=true;c.transform(1,0,0,1,s.x,s.y);}},_rotateReady:function(){},_showReady:function(c){},_ll_show:function(c){},_ll_setFilters:function(c){var s=this,f=s.filters,i,l;if(!f){return;}for(i=0,l=f.length; i<l; i++){f[i].ll_show(s,c);}},startX:function(){return 0;},startY:function(){return 0;},getWidth:function(maskSize){return 1;},getHeight:function(maskSize){return 1;},_transformRotate:function(c){var s=this;c=c||LGlobal.canvas;if(s.rotate==0){return;}s._ll_trans=true;rotateFlag=Math.PI/180,rotateObj=new LMatrix();if((typeof s.rotatex)==UNDEFINED){s.rotatex=0;s.rotatey=0;}if(s.box2dBody){rotateFlag=1;}rotateObj.a=Math.cos(s.rotate*rotateFlag);rotateObj.b=Math.sin(s.rotate*rotateFlag);rotateObj.c=-rotateObj.b;rotateObj.d=rotateObj.a;rotateObj.tx=s.x+s.rotatex;rotateObj.ty=s.y+s.rotatey;rotateObj.transform(c).setTo(1,0,0,1,-rotateObj.tx,-rotateObj.ty).transform(c);},_transformScale:function(c){var s=this,scaleObj;c=c||LGlobal.canvas;if(s.scaleX==1&&s.scaleY==1){return;}s._ll_trans=true;scaleObj=new LMatrix();if(s.scaleX!=1){scaleObj.tx=s.x;}if(s.scaleY!=1){scaleObj.ty=s.y;}scaleObj.a=s.scaleX;scaleObj.d=s.scaleY;scaleObj.transform(c).setTo(1,0,0,1,-scaleObj.tx,-scaleObj.ty).transform(c);},getAbsoluteScale:function(){var s=this,sX,sY,p;sX=s.scaleX;sY=s.scaleY;p=s.parent;while(p&&p!="root"){sX*=p.scaleX;sY*=p.scaleY;p=p.parent;}return{scaleX:sX,scaleY:sY};},getRootCoordinate:function(){return this.localToGlobal(new LPoint(0,0));},localToGlobal:function(point){var s=this,x,y,p;m=s.getRootMatrix();p=m.toArray([point.x,point.y,1]);return new LPoint(p[0],p[1]);},globalToLocal:function(point){var s=this,x,y,p;m=s.getLocalMatrix();p=m.toArray([point.x,point.y,1]);return new LPoint(p[0],p[1]);},getBounds:function(d){if(typeof d==UNDEFINED){return new LRectangle(0,0,0,0);}var s=this,x=0,y=0,w=0,h=0,sp,dp;if(s.objectIndex!=d.objectIndex){sp=s.getRootCoordinate();dp=d.getRootCoordinate();x=sp.x-dp.x;y=sp.y-dp.y;}w=s.getWidth(true);h=s.getHeight(true);return new LRectangle(x,y,w,h);},cacheAsBitmap:function(value){var s=this;if(!value){s._ll_cacheAsBitmap=null;return;}var sx=s.x-s.startX(true),sy=s.y-s.startY(true);var data=s.getDataCanvas(sx,sy,s.getWidth(true),s.getHeight(true));var b=new LBitmapData(data,0,0,null,null,LBitmapData.DATA_CANVAS);var cache=new LBitmap(b);cache.x=-sx;cache.y=-sy;s._ll_cacheAsBitmap=cache;},getDataCanvas:function(x,y,w,h){var s=this,_o,o,_c,c,_x,_y;s._createCanvas();_x=s.x;_y=s.y;s.x=x||0;s.y=y||0;s.width=w||s.getWidth();s.height=h||s.getHeight();s._canvas.width=s.width;s._canvas.height=s.height;var mx,my;if(s.mask){mx=s.mask.x;my=s.mask.y;s.mask.x+=(s.x-_x);s.mask.y+=(s.y-_y);}s.ll_show(s._context);s.x=_x;s.y=_y;if(s.mask){s.mask.x=mx;s.mask.y=my;}return s._canvas;},getDataURL:function(){var s=this;var sx=s.x-s.startX(true),sy=s.y-s.startY(true);var r=s.getDataCanvas(sx,sy,s.getWidth(true),s.getHeight(true));return r.toDataURL.apply(r,arguments);},getParentByConstructor:function(value){var parent=this.parent;while(typeof parent=="object"){if(parent instanceof value){return parent;}parent=parent.parent;}return null;},ismouseonShapes:function(shapes,mx,my){var s=this,parent=s,m,child,j,v,arg;if(typeof shapes==UNDEFINED){shapes=s.shapes;}m=s.getRootMatrix();for(j=shapes.length-1; j>=0; j--){child=shapes[j];arg=child.arg;v=s._changeShape(child.type,arg,m);if(child.type==LShape.VERTICES){if(LGlobal.hitPolygon(v,mx,my)){return true;}}else if(child.type==LShape.RECT){if(LGlobal.hitPolygon(v,mx,my)){return true;}}else if(child.type==LShape.ARC){if((v[0]-mx)*(v[0]-mx)+(v[1]-my)*(v[1]-my)<v[3]){return true;}}}return false;},_changeShape:function(type,arg,m){var v,arg=arg,r2,i,l,v1,v2;if(type==LShape.VERTICES){v=[];for(i=0,l=arg.length; i<l; i++){v[i]=m.toArray([arg[i][0],arg[i][1],1]);}}else if(type==LShape.RECT){v=[[arg[0],arg[1]],[arg[0]+arg[2],arg[1]],[arg[0]+arg[2],arg[1]+arg[3]],[arg[0],arg[1]+arg[3]]];for(i=0,l=v.length; i<l; i++){v[i]=m.toArray([v[i][0],v[i][1],1]);}}else if(type==LShape.ARC){v1=m.toArray([arg[0],arg[1],1]);v2=m.toArray([arg[0]+arg[2],arg[1],1]);r2=(v1[0]-v2[0])*(v1[0]-v2[0])+(v1[1]-v2[1])*(v1[1]-v2[1]);v=[v1[0],v1[1],Math.sqrt(r2),r2];}return v;},getRootMatrix:function(){var parent=this,m=new LMatrix();while(parent&&parent!="root"){if(parent.scaleX!=1||parent.scaleY!=1){m.scale(parent.scaleX,parent.scaleY);}if(parent.rotate!=0){m.rotate(parent.rotate);}if(parent.x!=0||parent.y!=0){m.translate(parent.x,parent.y);}parent=parent.parent;}return m;},getLocalMatrix:function(){var parent=this,m=new LMatrix(),list=[];while(parent&&parent!="root"){list.push(parent);parent=parent.parent;}for(var i=list.length-1; i>=0; i--){parent=list[i];if(parent.x!=0||parent.y!=0){m.translate(-parent.x,-parent.y);}if(parent.rotate!=0){m.rotate(-parent.rotate);}if(parent.scaleX!=1||parent.scaleY!=1){m.scale(1/parent.scaleX,1/parent.scaleY);}}return m;},remove:function(){var s=this,p=s.parent;if(!p||p=="root"){return;}p.removeChild(s);s._ll_removeFromSelf=true;}};for(var k in p){LDisplayObject.prototype[k]=p[k];}return LDisplayObject;})();var LInteractiveObject=(function(){function LInteractiveObject(){var s=this;LExtends(s,LDisplayObject,[]);s.type="LInteractiveObject";s.mouseEnabled=true;s.mouseList=new Array();}var p={addEventListener:function(type,listener){var s=this;if(type.indexOf("mouse")>=0||type.indexOf("touch")>=0||type==LMouseEvent.DOUBLE_CLICK){if(LMouseEventContainer.container[type]||((type==LMouseEvent.MOUSE_OVER||type==LMouseEvent.MOUSE_OUT)&&LMouseEventContainer.container[LMouseEvent.MOUSE_MOVE])){LMouseEventContainer.addMouseEvent(s,type,listener);return;}s.mouseList.push({listener:listener,type:type});}else{s._eventList.push({listener:listener,type:type});}},removeEventListener:function(type,listener){var s=this,i,length;if(type.indexOf("mouse")>=0||type.indexOf("touch")>=0||type==LMouseEvent.DOUBLE_CLICK){if(LMouseEventContainer.container[type]||((type==LMouseEvent.MOUSE_OVER||type==LMouseEvent.MOUSE_OUT)&&LMouseEventContainer.container[LMouseEvent.MOUSE_MOVE])){LMouseEventContainer.removeMouseEvent(s,type,listener);return;}length=s.mouseList.length;for(i=0; i<length; i++){if(!s.mouseList[i]){continue;}if(type==s.mouseList[i].type&&s.mouseList[i].listener==listener){s.mouseList.splice(i,1);return;}}}else{return s.callParent("removeEventListener",arguments);}},removeAllEventListener:function(){var s=this;s.mouseList.length=0;s._eventList.length=0;if(LMouseEventContainer.container[LMouseEvent.MOUSE_DOWN]){LMouseEventContainer.removeMouseEvent(s,LMouseEvent.MOUSE_DOWN);}if(LMouseEventContainer.container[LMouseEvent.MOUSE_UP]){LMouseEventContainer.removeMouseEvent(s,LMouseEvent.MOUSE_UP);}if(LMouseEventContainer.container[LMouseEvent.MOUSE_MOVE]){LMouseEventContainer.removeMouseEvent(s,LMouseEvent.MOUSE_MOVE);LMouseEventContainer.removeMouseEvent(s,LMouseEvent.MOUSE_OVER);LMouseEventContainer.removeMouseEvent(s,LMouseEvent.MOUSE_OUT);}},hasEventListener:function(type,listener){var s=this,i,length;if(LMouseEventContainer.container[type]){return LMouseEventContainer.hasEventListener(s,type,listener);}if(type.indexOf("mouse")>=0||type.indexOf("touch")>=0||type==LMouseEvent.DOUBLE_CLICK){length=s.mouseList.length;for(i=0; i<length; i++){if(!s.mouseList[i]){continue;}if(type==s.mouseList[i].type&&(!listener||s.mouseList[i].listener==listener)){return true;}}}else{return s.callParent("hasEventListener",arguments);}return false;}};for(var k in p){LInteractiveObject.prototype[k]=p[k];}return LInteractiveObject;})();var LDisplayObjectContainer=(function(){function LDisplayObjectContainer(){var s=this;LExtends(s,LInteractiveObject,[]);s.childList=new Array();s.numChildren=0;s.mouseChildren=true;}var p={addChild:function(d){var s=this,t;if(d.parent){t=LGlobal.destroy;LGlobal.destroy=false;d.parent.removeChild(d);LGlobal.destroy=t;}d.parent=s;s.childList.push(d);s.numChildren=s.childList.length;s._ll_removeFromSelf=false;return d;},addChildAt:function(d,i){var s=this,t;if(i<0||i>s.childList.length){return;}if(typeof d.remove=="function"){t=LGlobal.destroy;LGlobal.destroy=false;d.remove();LGlobal.destroy=t;}d.parent=s;s.childList.splice(i,0,d);s.numChildren=s.childList.length;s._ll_removeFromSelf=false;return d;},removeChild:function(d){var s=this,c=s.childList,i,l;for(i=0,l=c.length; i<l; i++){if(d.objectIndex==c[i].objectIndex){if(LGlobal.destroy&&d.die){d.die();}s.childList.splice(i,1);break;}}s.numChildren=s.childList.length;delete d.parent;},getChildAt:function(i){var s=this,c=s.childList;if(c.length==0||c.length<=i){return null;}return c[i];},getChildByName:function(n){var s=this,c=s.childList,i,l;for(i=0,l=c.length; i<l; i++){if(!c[i]){continue;}if(c[i].name==n){return c[i];}}return null;},removeChildAt:function(i){var s=this,c=s.childList;if(c.length<=i){return;}if(LGlobal.destroy&&c[i].die){c[i].die();}var d=s.childList.splice(i,1);d=d[0];delete d.parent;s.numChildren=s.childList.length;return d;},getChildIndex:function(child){if(!child){return-1;}var s=this,c=s.childList,i,l=c.length;for(i=0; i<l; i++){if(c[i].objectIndex==child.objectIndex){return i;}}return-1;},setChildIndex:function(child,index){var s=this,c=s.childList,i,l=c.length;if(child.parent=="root"||child.parent.objectIndex!=s.objectIndex||index<0||index>=l){return-1;}for(i=0; i<l; i++){if(c[i].objectIndex==child.objectIndex){break;}}s.childList.splice(i,1);s.childList.splice(index,0,child);return index;},resize:function(){var s=this;s.width=s.getWidth();s.height=s.getHeight();},removeAllChild:function(){var s=this,c=s.childList,i,l;for(i=0,l=c.length; i<l; i++){if(LGlobal.destroy&&c[i].die){c[i].die();}}s.childList.length=0;s.width=0;s.height=0;s.numChildren=0;}};for(var k in p){LDisplayObjectContainer.prototype[k]=p[k];}return LDisplayObjectContainer;})();var LLoader=(function(){function LLoader(){var s=this;LExtends(s,LEventDispatcher,[]);s.type="LLoader";}LLoader.TYPE_BITMAPDATE="bitmapData";LLoader.prototype.load=function(u,t,xhr){var s=this;if(!t){t=LLoader.TYPE_BITMAPDATE;}s.loadtype=t;s.useXHR=xhr&&!LAjax.local&&LAjax.canUseBlob;if(t==LLoader.TYPE_BITMAPDATE){if(s.useXHR){LAjax.responseType=LAjax.ARRAY_BUFFER;LAjax.progress=function(e){var event=new LEvent(LEvent.PROGRESS);event.currentTarget=s;event.target=e.currentTarget;event.loaded=e.loaded;event.total=e.total;event.responseURL=e.responseURL;s.dispatchEvent(event);};LAjax.post(u,{},function(response){var blob;try{blob=new Blob([response],{type:'image/png'});}catch(e){if(e.name==='TypeError'&&window.BlobBuilder){var builder=new BlobBuilder();builder.append(response);blob=builder.getBlob();}else{blob=null;s.useXHR=false;}}if(s.useXHR){u=s.createObjectURL(blob);}s.loadStart(u);},function(request){var event=new LEvent(LEvent.ERROR);event.currentTarget=s;event.target=request;event.responseURL=request.responseURL;s.dispatchEvent(event);});}else{s.loadStart(u);}}};LLoader.prototype.loadStart=function(u){var s=this;s.content=new Image();s.content.onload=function(){s.content.onload=null;var event=new LEvent(LEvent.COMPLETE);event.currentTarget=s;event.target=s.content;if(s.useXHR){s.revokeObjectURL(s.content.src);}s.dispatchEvent(event);delete s.content;};if(!s.useXHR){s.content.onerror=function(e){var event=new LEvent(LEvent.ERROR);event.currentTarget=s;event.target=e.target;event.responseURL=e.target.src;s.dispatchEvent(event);};}s.content.src=u;};LLoader.prototype.createObjectURL=function(obj){var URL=window.URL||window.webkitURL;return URL.createObjectURL(obj);};LLoader.prototype.revokeObjectURL=function(src){var URL=window.URL||window.webkitURL;URL.revokeObjectURL(src);};return LLoader;})();var LURLLoader=(function(){function LURLLoader(){var s=this;LExtends(s,LEventDispatcher,[]);s.type="LURLLoader";s.loadtype="";s.content=null;s.event={};}LURLLoader.TYPE_TEXT="text";LURLLoader.TYPE_JS="js";LURLLoader.prototype.load=function(u,t){var s=this,event,ext;if(!t){ext=getExtension(u);if(ext=="txt"){t=LURLLoader.TYPE_TEXT;}else if(ext=="js"){t=LURLLoader.TYPE_JS;}}s.loadtype=t;if(t==LURLLoader.TYPE_TEXT){LAjax.progress=function(e){var event=new LEvent(LEvent.PROGRESS);event.currentTarget=s;event.target=e.currentTarget;event.loaded=e.loaded;event.total=e.total;event.responseURL=e.responseURL;s.dispatchEvent(event);};LAjax.get(u,{},function(data){event=new LEvent(LEvent.COMPLETE);s.data=data;event.currentTarget=s;event.target=data;s.dispatchEvent(event);delete s.content;delete s.data;},function(request){var event=new LEvent(LEvent.ERROR);event.currentTarget=s;event.target=request;event.responseURL=request.responseURL;s.dispatchEvent(event);});}else if(t==LURLLoader.TYPE_JS){var script=document.createElement("script");script.onerror=function(e){var event=new LEvent(LEvent.ERROR);event.currentTarget=s;event.target=e.target;event.responseURL=u;s.dispatchEvent(event);};script.onload=function(){event=new LEvent(LEvent.COMPLETE);event.currentTarget=s;event.target=s;s.dispatchEvent(event);delete s.content;};script.src=u;script.type="text/javascript";document.querySelector('head').appendChild(script);}};return LURLLoader;})();var LFontLoader=(function(){function LFontLoader(){var s=this;LExtends(s,LEventDispatcher,[]);s.type="LFontLoader";}LFontLoader.TYPE_FONT="font";LFontLoader.prototype.load=function(u,name){var s=this,font,tff,eot,a,b,d,t="";font=document.createElement("style");font.onerror=function(e){var event=new LEvent(LEvent.ERROR);event.currentTarget=s;event.target=e.target;event.responseURL=u;s.dispatchEvent(event);};a=u.split(',');for(var i=0; i<a.length; i++){b=a[i].split('.');d=b[b.length-1];if(d=="ttf"){tff=a[i];}else if(d=="eot"){eot=a[i];}}t="@font-face{font-family:'"+name+"';";if(eot){t+="src:url("+eot+");";}if(tff){t+="src:local('lufy'),url("+tff+")format('opentype');";}font.innerHTML=t;document.querySelector('head').appendChild(font);setTimeout(function(){var event=new LEvent(LEvent.COMPLETE);event.currentTarget=s;event.target=s;s.dispatchEvent(event);},1);};return LFontLoader;})();var LWebAudio=(function(){function LWebAudio(){var s=this;LExtends(s,LEventDispatcher,[]);s.currentTime=0;s.currentStart=0;s.currentSave=0;s.length=0;s.loopStart=0;s.loopEnd=0;s.loopIndex=0;s.loopLength=1;s.playing=false;s.volume=1;LSound.Container.add(s);}LWebAudio.container=[];LWebAudio.containerCount=0;try{LWebAudio.audioTag=new Audio();}catch(e){console.warn("ReferenceError:Can't find variable:Audio");LWebAudio.audioTag={canPlayType:function(){return false;}};}LWebAudio._context=null;var p={getWebAudio:function(){var data;if(LWebAudio.containerCount>0){data=LWebAudio.container.shift();}else{if(typeof AudioContext!==UNDEFINED){try{data=new AudioContext();}catch(e){LWebAudio.containerCount=LWebAudio.container.length;data=LWebAudio.container.shift();}}else if(typeof webkitAudioContext!==UNDEFINED){try{data=new webkitAudioContext();}catch(e){LWebAudio.containerCount=LWebAudio.container.length;data=LWebAudio.container.shift();}}else{throw "AudioContext not supported.:(";}}if(!data.createGainNode){data.createGainNode=data.createGain;}LWebAudio.container.push(data);return data;},onload:function(data){var s=this;if(Object.prototype.toString.apply(data)!=='[object AudioBuffer]'){s.load(data);return;};if(!s.data){s.data=s.getWebAudio();}s.buffer=data;s.length=s.buffer.duration;var e=new LEvent(LEvent.COMPLETE);e.currentTarget=s;e.target=s.buffer;s.dispatchEvent(e);},_onended:function(){var s=this;s.dispatchEvent(LEvent.SOUND_COMPLETE);s.close();if(++s.loopIndex<s.loopLength){s.play(s.currentStart,undefined,s.currentTimeTo);}},load:function(u){var s=this;if(typeof u!=="string"){if(Object.prototype.toString.apply(u)=='[object AudioBuffer]'){s.onload(u);}else if(Object.prototype.toString.apply(u)=='[object ArrayBuffer]'){if(!s.data){s.data=s.getWebAudio();}s.data.decodeAudioData(u,s.onload.bind(s),function(error){throw "AudioContext decodeAudioData error:"+error.toString();});}return;}var a,b,c,k,d,q={"mov":["quicktime"],"3gp":["3gpp"],"midi":["midi"],"mid":["midi"],"ogv":["ogg"],"m4a":["acc"],"mp3":["mpeg"],"wav":["wav","x-wav","wave"],"wave":["wav","x-wav","wave"],"aac":["mp4","aac"]};a=u.split(',');for(k=0; k<a.length; k++){b=a[k].split('.');d=b[b.length-1];if(q[d]){d=q[d];}else{d=[d];}c=d.some(function(element,index,array){return LWebAudio.audioTag.canPlayType(s._type+"/"+element);});if(c){LAjax.responseType=LAjax.ARRAY_BUFFER;LAjax.progress=function(e){var event=new LEvent(LEvent.PROGRESS);event.currentTarget=s;event.target=e.currentTarget;event.loaded=e.loaded;event.total=e.total;event.responseURL=e.responseURL;s.dispatchEvent(event);};LAjax.get(a[k],{},s.onload.bind(s),function(request){var event=new LEvent(LEvent.ERROR);event.currentTarget=s;event.target=request;event.responseURL=request.responseURL;s.dispatchEvent(event);});return;}else{console.warn("Not support "+b[b.length-1]+":"+a[k]);var e=new LEvent(LEvent.COMPLETE);e.currentTarget=e.target=s;s.dispatchEvent(e);}}},getCurrentTime:function(){var s=this;if(s.playing){return s.data.currentTime-s.currentSave+s.currentTime;}else{return s.currentSave;}},setVolume:function(v){var s=this;s.volume=v;if(s.playing){s.volumeNode.gain.value=v;}},getVolume:function(){return this.volume;},play:function(c,l,to){var s=this;if(s.length==0){return;}if(typeof l!==UNDEFINED){s.loopIndex=0;s.loopLength=l;}if(typeof c!==UNDEFINED){s.currentTime=c;s.currentStart=c;}if(typeof to!==UNDEFINED){s.currentTimeTo=to>s.length?s.length:to;}else{s.currentTimeTo=s.length;}s.data.loop=false;s.playing=true;if(s.timeout){clearTimeout(s.timeout);delete s.timeout;}s.timeout=setTimeout(s._onended.bind(s),(s.currentTimeTo-s.currentTime)*1000);s.bufferSource=s.data.createBufferSource();s.bufferSource.buffer=s.buffer;s.volumeNode=s.data.createGainNode();s.volumeNode.gain.value=s.volume;s.volumeNode.connect(s.data.destination);s.bufferSource.connect(s.volumeNode);s.currentSave=s.data.currentTime;if(s.bufferSource.start){s.bufferSource.start(0,s.currentTime,s.length-s.currentTime);}else{s.bufferSource.noteGrainOn(0,s.currentTime,s.length-s.currentTime);}},playSegment:function(c,seg,l){this.playTo(c,c+seg,l);},playTo:function(c,to,l){this.play(c,l,to);},stop:function(){var s=this;if(!s.playing){return;}if(s.timeout){clearTimeout(s.timeout);delete s.timeout;}if(s.bufferSource.stop){s.bufferSource.stop(0);}else{s.bufferSource.noteOff(0);}s.currentSave=s.getCurrentTime();s.currentTime=s.currentSave;s.playing=false;},close:function(){var s=this;if(!s.playing){return;}if(s.timeout){clearTimeout(s.timeout);delete s.timeout;}if(s.bufferSource.stop){s.bufferSource.stop(0);}else{s.bufferSource.noteOff(0);}s.playing=false;s.currentTime=0;s.currentSave=0;},ll_check:function(){var s=this;if(!s.playing){return;}if(s.currentTimeTo<s.data.currentTime-s.currentSave+LSound.Container.time*0.001){s._onended();}},die:function(){LSound.Container.remove(this);}};for(var k in p){LWebAudio.prototype[k]=p[k];}return LWebAudio;})();var LMedia=(function(){function LMedia(){var s=this;LExtends(s,LDisplayObject,[]);s.length=0;s.loopIndex=0;s.loopLength=1;s.playing=false;s.oncomplete=null;s.onsoundcomplete=null;s.currentStart=0;LSound.Container.add(this);}var p={onload:function(){var s=this;if(s.data.readyState){s.length=s.data.duration-(LGlobal.android?0.1:0);var e=new LEvent(LEvent.COMPLETE);e.currentTarget=s;e.target=s.data;s.dispatchEvent(e);return;}s.data.addEventListener("error",function(e){var event=new LEvent(LEvent.ERROR);event.currentTarget=s;event.target=e.target;event.responseURL=e.target.src;s.dispatchEvent(event);},false);s.data.addEventListener("canplaythrough",function(){s.onload();},false);},_onended:function(){var s=this,i,l;s.dispatchEvent(LEvent.SOUND_COMPLETE);if(++s.loopIndex<s.loopLength){i=s.loopIndex;l=s.loopLength;s.close();s.play(s.currentStart,s.loopLength,s.currentTimeTo);s.loopIndex=i;}else{s.close();}},load:function(u){var s=this;if(Object.prototype.toString.apply(u)=="[object HTMLAudioElement]"){s.data=u;s.onload();return;}var a,b,c,k,d,q={"mov":["quicktime"],"3gp":["3gpp"],"midi":["midi"],"mid":["midi"],"ogv":["ogg"],"m4a":["acc"],"mp3":["mpeg"],"wav":["wav","x-wav","wave"],"wave":["wav","x-wav","wave"],"aac":["mp4","aac"]};a=u.split(',');for(k=0; k<a.length; k++){b=a[k].split('.');d=b[b.length-1];if(q[d]){d=q[d];}else{d=[d];}c=d.some(function(element,index,array){return s.data.canPlayType(s._type+"/"+element);});if(c){s.data.src=a[k];s.onload();s.data.load();return;}else{console.warn("Not support "+b[b.length-1]+":"+a[k]);var e=new LEvent(LEvent.COMPLETE);e.currentTarget=e.target=s;s.dispatchEvent(e);}}if(s.oncomplete){s.oncomplete({});}},getCurrentTime:function(){return this.data.currentTime;},setVolume:function(v){this.data.volume=v;},getVolume:function(){return this.data.volume;},play:function(c,l,to){var s=this;if(s.length==0){return;}if(LGlobal.android){LSound.Container.stopOther(this);}if(typeof c!=UNDEFINED){s.data.currentTime=c;s.currentStart=c;}if(typeof l!=UNDEFINED){s.loopLength=l;}if(typeof to!==UNDEFINED){s.currentTimeTo=to>s.length?s.length:to;}else{s.currentTimeTo=s.length;}if(s.timeout){clearTimeout(s.timeout);delete s.timeout;}s.timeout=setTimeout(function(){s._onended();},(s.currentTimeTo-s.data.currentTime)*1000);s.data.loop=false;s.loopIndex=0;s.playing=true;s.data.play();},playSegment:function(c,seg,l){this.playTo(c,c+seg,l);},playTo:function(c,to,l){this.play(c,l,to);},stop:function(){var s=this;if(!s.playing){return;}if(s.timeout){clearTimeout(s.timeout);delete s.timeout;}s.playing=false;s.data.pause();},close:function(){var s=this;if(!s.playing){return;}if(s.timeout){clearTimeout(s.timeout);delete s.timeout;}s.playing=false;s.data.pause();s.data.currentTime=0;s.currentSave=0;},ll_check:function(){var s=this;if(!s.playing){return;}if(s.data.duration!=s._ll_duration){s._ll_duration=s.data.duration;s.length=s.data.duration-(LGlobal.android?0.1:0);}if(s.currentTimeTo<s.data.currentTime+LSound.Container.time*0.005){s._onended();}},die:function(){LSound.Container.remove(this);}};for(var k in p){LMedia.prototype[k]=p[k];}return LMedia;})();var LSound=(function(){function LSound(u){var s=this;s.type="LSound";s._type="audio";if(LSound.webAudioEnabled&&LGlobal.webAudio){LExtends(s,LWebAudio,[]);}else{LExtends(s,LMedia,[]);try{s.data=new Audio();}catch(e){console.warn("ReferenceError:Can't find variable:Audio");s.data={};}s.data.loop=false;s.data.autoplay=false;}if(u){s.load(u);}}LSound.TYPE_SOUND="sound";LSound.webAudioEnabled=false;var protocol=location.protocol;if(protocol=="http:"||protocol=="https:"){if(typeof AudioContext!==UNDEFINED){try{LWebAudio._context=new AudioContext();}catch(e){}}else if(typeof webkitAudioContext!==UNDEFINED){try{LWebAudio._context=new webkitAudioContext();}catch(e){}}if(LWebAudio._context){LWebAudio.container.push(LWebAudio._context);LSound.webAudioEnabled=true;}}LSound.Container={ll_save:0,time:0,list:[],ll_show:function(){var c=LSound.Container;var t=(new Date()).getTime();c.time=t-(c.ll_save?c.ll_save:t);c.ll_save=t;var l=c.list;for(var i=l.length-1; i>=0; i--){if(l[i]){l[i].ll_check();}}},add:function(obj){if(LSound.Container.list.indexOf(obj)>=0){return;}LSound.Container.list.push(obj);},remove:function(obj){var l=LSound.Container.list;for(var i=l.length-1; i>=0; i--){if(l[i].objectIndex==obj.objectIndex){l.splice(i,1);break;}}},stopOther:function(obj){var l=LSound.Container.list;for(var i=l.length-1; i>=0; i--){if(l[i].objectIndex!=obj.objectIndex){l[i].stop();}}}};LGlobal.childList.push(LSound.Container);return LSound;})();var LVideo=(function(){function LVideo(u){var s=this;LExtends(s,LMedia,[]);s.type="LVideo";s._type="video";s.rotatex=0;s.rotatey=0;s.data=document.createElement("video");s.data.style.display="none";document.body.appendChild(s.data);s.data.id="video_"+s.objectIndex;s.data.loop=false;s.data.autoplay=false;if(u){s.load(u);}}var p={_ll_show:function(c){var s=this;c.drawImage(s.data,s.x,s.y);},die:function(){var s=this;document.body.removeChild(s.data);delete s.data;},getWidth:function(){return this.data.width;},getHeight:function(){return this.data.height;}};for(var k in p){LVideo.prototype[k]=p[k];}return LVideo;})();var LPoint=(function(){function LPoint(x,y){var s=this;s.x=x;s.y=y;}LPoint.distance=function(p1,p2){return LPoint.distance2(p1.x,p1.y,p2.x,p2.y);};LPoint.distance2=function(x1,y1,x2,y2){var x=x1-x2,y=y1-y2;return Math.sqrt(x*x+y*y);};LPoint.interpolate=function(p1,p2,f){return new LPoint(p1.x+(p2.x-p1.x)*(1-f),p1.y+(p2.y-p1.y)*(1-f));};LPoint.polar=function(l,a){return new LPoint(l*Math.cos(a),l*Math.sin(a));};LPoint.prototype={toString:function(){return '[object LPoint('+this.x+','+this.y+')]';},length:function(){return LPoint.distance2(this.x,this.y,0,0);},add:function(v){return new LPoint(this.x+v.x,this.y+v.y);},clone:function(){return new LPoint(this.x,this.y);},setTo:function(x,y){this.x=x,this.y=y;},copyFrom:function(s){this.setTo(s.x,s.y);},equals:function(t){return this.x==t.x&&this.y==t.y;},normalize:function(t){var s=this,scale=t/s.length();s.x*=scale,s.y*=scale;},offset:function(dx,dy){this.x+=dx;this.y+=dy;},subtract:function(v){return new LPoint(this.x-v.x,this.y-v.y);}};return LPoint;})();var LRectangle=(function(){function LRectangle(x,y,w,h){var s=this;s.x=x;s.y=y;s.width=w;s.height=h;s.setRectangle();}LRectangle.prototype={setRectangle:function(){var s=this;s.bottom=s.y+s.height;s.right=s.x+s.width;s.left=s.x;s.top=s.y;},clone:function(){var s=this;return new LRectangle(s.x,s.y,s.width,s.height);},contains:function(x,y){var s=this;return x>=s.x&&x<=s.right&&y>=s.y&&y<=s.bottom;},containsRect:function(rect){var s=this;return rect.x>=s.x&&rect.right<=s.right&&rect.y>=s.y&&rect.bottom<=s.bottom;},equals:function(v){var s=this;return v.x==s.x&&v.width==s.width&&v.y==s.y&&v.height==s.height;},inflate:function(dx,dy){var s=this;s.width+=dx;s.height+=dy;s.setRectangle();},intersection:function(t){var s=this;var ix=s.x>t.x?s.x:t.x;var iy=s.y>t.y?s.y:t.y;var ax=s.right>t.right?t.right:s.right;var ay=s.bottom>t.bottom?t.bottom:s.bottom;if(ix<=ax&&iy<=ay){return new LRectangle(ix,iy,ax,ay);}else{return new LRectangle(0,0,0,0);}},intersects:function(t){var s=this;var ix=s.x>t.x?s.x:t.x;var iy=s.y>t.y?s.y:t.y;var ax=s.right>t.right?t.right:s.right;var ay=s.bottom>t.bottom?t.bottom:s.bottom;return ix<=ax&&iy<=ay;},isEmpty:function(){var s=this;return s.x==0&&s.y==0&&s.width==0&&s.height==0;},offset:function(dx,dy){var s=this;s.x+=dx;s.y+=dy;s.setRectangle();},setEmpty:function(){var s=this;s.x=0;s.y=0;s.width=0;s.height=0;s.setRectangle();},setTo:function(xa,ya,w,h){var s=this;s.x=xa;s.y=ya;s.width=w;s.height=h;s.setRectangle();},toString:function(){var s=this;return "[object LRectangle("+s.x+","+s.y+","+s.width+","+s.height+")]";},union:function(t){var s=this;return new LRectangle(s.x>t.x?t.x:s.x,s.y>t.y?t.y:s.y,s.right>t.right?s.right:t.right,s.bottom>t.bottom?s.bottom:t.bottom);}};return LRectangle;})();var LGraphics=(function(){function LGraphics(){var s=this;LExtends(s,LObject,[]);s.type="LGraphics";s.color="#000000";s.alpha=1;s.bitmap=null;s.setList=new Array();s.showList=new Array();}var p={ll_show:function(ctx){var s=this,k,l=s.setList.length;if(l==0){return;}for(k=0; k<l; k++){s.setList[k](ctx);if(LGlobal.fpsStatus){LGlobal.fpsStatus.graphics++;}}},clone:function(){var s=this,a=new LGraphics(),i,l,c;a.color=s.color;a.alpha=s.alpha;a.bitmap=s.bitmap;for(i=0,l=s.setList.length; i<l; i++){c=s.setList[i];a.setList.push(c);}for(i=0,l=s.showList.length; i<l; i++){c=s.showList[i];a.showList.push(c);}return a;},lineCap:function(t){var s=this;s.setList.push(function(ctx){ctx.lineCap=t;});},lineJoin:function(t){var s=this;s.setList.push(function(ctx){ctx.lineJoin=t;});},lineWidth:function(t){var s=this;s.setList.push(function(ctx){ctx.lineWidth=t;});},strokeStyle:function(co){var s=this;s.setList.push(function(ctx){ctx.strokeStyle=co;});},stroke:function(){var s=this;s.setList.push(function(ctx){ctx.stroke();});},beginPath:function(){var s=this;s.setList.push(function(ctx){ctx.beginPath();});},closePath:function(){var s=this;s.setList.push(function(ctx){ctx.closePath();});},moveTo:function(x,y){var s=this;s.setList.push(function(ctx){ctx.moveTo(x,y);});s.showList.push({type:LShape.POINT,arg:[x,y]});},lineTo:function(x,y){var s=this;s.setList.push(function(ctx){ctx.lineTo(x,y);});s.showList.push({type:LShape.POINT,arg:[x,y]});},rect:function(x,y,w,h){var s=this;s.setList.push(function(ctx){ctx.rect(x,y,w,h);});s.showList.push({type:LShape.RECT,arg:[x,y,w,h]});},fillStyle:function(co){var s=this;s.setList.push(function(ctx){ctx.fillStyle=co;});},fill:function(){var s=this;s.setList.push(function(ctx){ctx.fill();});},arc:function(x,y,r,sa,ea,aw){var s=this;s.setList.push(function(ctx){ctx.arc(x,y,r,sa,ea,aw);});s.showList.push({type:LShape.ARC,arg:sa});},lineStyle:function(tn,co){var s=this,c;if(co==null){co=s.color;}s.color=co;s.setList.push(function(c){c.lineWidth=tn;c.strokeStyle=co;});},clear:function(){var s=this;s.bitmap=null;s.setList.length=0;s.showList.length=0;},beginBitmapFill:function(b){var s=this;s.setList.push(function(){s.bitmap=b;});},drawEllipse:function(tn,lco,pa,isf,co){var s=this;s.setList.push(function(c){var x,y,w,h,k,ox,oy,xe,ye,xm,ym;c.beginPath();k=0.5522848;x=pa[0];y=pa[1];w=pa[2];h=pa[3];ox=(w/2)*k;oy=(h/2)*k;xe=x+w;ye=y+h;xm=x+w/2;ym=y+h/2;c.moveTo(x,ym);c.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);c.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);c.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);c.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);if(s.bitmap){c.save();c.clip();c.drawImage(s.bitmap.image,s.bitmap.x,s.bitmap.y,s.bitmap.width,s.bitmap.height,0,0,s.bitmap.width,s.bitmap.height);c.restore();s.bitmap=null;return;}if(isf){c.fillStyle=co;c.fill();}if(tn>0){c.lineWidth=tn;c.strokeStyle=lco;c.stroke();}});s.showList.push({type:LShape.RECT,arg:pa});},drawArc:function(tn,lco,pa,isf,co){var s=this;s.setList.push(function(c){c.beginPath();if(pa.length>6&&pa[6]){c.moveTo(pa[0],pa[1]);}c.arc(pa[0],pa[1],pa[2],pa[3],pa[4],pa[5]);if(pa.length>6&&pa[6]){c.lineTo(pa[0],pa[1]);}if(s.bitmap){c.save();c.clip();c.drawImage(s.bitmap.image,s.bitmap.x,s.bitmap.y,s.bitmap.width,s.bitmap.height,0,0,s.bitmap.width,s.bitmap.height);c.restore();s.bitmap=null;return;}if(isf){c.fillStyle=co;c.fill();}if(tn>0){c.lineWidth=tn;c.strokeStyle=lco;c.stroke();}});s.showList.push({type:LShape.ARC,arg:pa});},drawRect:function(tn,lco,pa,isf,co){var s=this;s.setList.push(function(c){c.beginPath();c.rect(pa[0],pa[1],pa[2],pa[3]);c.closePath();if(s.bitmap){c.save();c.clip();c.drawImage(s.bitmap.image,s.bitmap.x,s.bitmap.y,s.bitmap.width,s.bitmap.height,0,0,s.bitmap.width,s.bitmap.height);c.restore();s.bitmap=null;return;}if(isf){c.fillStyle=co;c.fill();}if(tn>0){c.lineWidth=tn;c.strokeStyle=lco;c.stroke();}});s.showList.push({type:LShape.RECT,arg:pa});},drawRoundRect:function(tn,lco,pa,isf,co){var s=this;s.setList.push(function(c){c.beginPath();c.moveTo(pa[0]+pa[4],pa[1]);c.lineTo(pa[0]+pa[2]-pa[4],pa[1]);c.arcTo(pa[0]+pa[2],pa[1],pa[0]+pa[2],pa[1]+pa[4],pa[4]);c.lineTo(pa[0]+pa[2],pa[1]+pa[3]-pa[4]);c.arcTo(pa[0]+pa[2],pa[1]+pa[3],pa[0]+pa[2]-pa[4],pa[1]+pa[3],pa[4]);c.lineTo(pa[0]+pa[4],pa[1]+pa[3]);c.arcTo(pa[0],pa[1]+pa[3],pa[0],pa[1]+pa[3]-pa[4],pa[4]);c.lineTo(pa[0],pa[1]+pa[4]);c.arcTo(pa[0],pa[1],pa[0]+pa[4],pa[1],pa[4]);c.closePath();if(s.bitmap){c.save();c.clip();c.drawImage(s.bitmap.image,0,0,s.bitmap.width,s.bitmap.height,0,0,s.bitmap.width,s.bitmap.height);c.restore();s.bitmap=null;return;}if(isf){c.fillStyle=co;c.fill();}if(tn>0){c.lineWidth=tn;c.strokeStyle=lco;c.stroke();}});s.showList.push({type:LShape.RECT,arg:pa});},drawVertices:function(tn,lco,v,isf,co){var s=this;if(v.length<3){return;}s.setList.push(function(c){c.beginPath();c.moveTo(v[0][0],v[0][1]);var i,l=v.length,pa;for(i=1; i<l; i++){pa=v[i];c.lineTo(pa[0],pa[1]);}c.lineTo(v[0][0],v[0][1]);c.closePath();if(s.bitmap){c.save();c.clip();c.drawImage(s.bitmap.image,s.bitmap.x,s.bitmap.y,s.bitmap.width,s.bitmap.height,0,0,s.bitmap.width,s.bitmap.height);c.restore();s.bitmap=null;return;}if(isf){c.fillStyle=co;c.fill();}if(tn>0){c.lineWidth=tn;c.strokeStyle=lco;c.closePath();c.stroke();}});s.showList.push({type:LShape.VERTICES,arg:v});},drawTriangles:function(ve,ind,u,tn,lco){var s=this;var i,j,l=ind.length,c;s.setList.push(function(c){var v=ve,a,k,sw;for(i=0,j=0; i<l; i+=3){a=0;c.save();c.beginPath();c.moveTo(v[ind[i]*2],v[ind[i]*2+1]);c.lineTo(v[ind[i+1]*2],v[ind[i+1]*2+1]);c.lineTo(v[ind[i+2]*2],v[ind[i+2]*2+1]);c.lineTo(v[ind[i]*2],v[ind[i]*2+1]);c.closePath();if(tn){c.lineWidth=tn;c.strokeStyle=lco;c.stroke();}c.clip();if(i % 6==0){sw=-1;var w=(u[ind[i+1+j]*2]-u[ind[i+j]*2])*s.bitmap.width;var h=(u[ind[i+2]*2+1]-u[ind[i]*2+1])*s.bitmap.height;if(j==0&&w<0){for(k=i+9; k<l; k+=3){if(u[ind[i+2]*2+1]==u[ind[k+2]*2+1]){j=k-i;break;}}if(j==0){j=l-i;}w=(u[ind[i+1+j]*2]-u[ind[i+j]*2])*s.bitmap.width;}if(i+j>=l){w=(u[ind[i+j-l]*2]-u[ind[i+1]*2])*s.bitmap.width;sw=u[ind[i]*2]==1?0:s.bitmap.width*u[ind[i]*2]+w;if(sw>s.bitmap.width){sw-=s.bitmap.width;}}else{sw=s.bitmap.width*u[ind[i+j]*2];}sh=s.bitmap.height*u[ind[i]*2+1];if(h<0){h=(u[ind[i+2-(i>0?6:-6)]*2+1]-u[ind[i-(i>0?6:-6)]*2+1])*s.bitmap.height;sh=0;}var t1=(v[ind[i+1]*2]-v[ind[i]*2])/w;var t2=(v[ind[i+1]*2+1]-v[ind[i]*2+1])/w;var t3=(v[ind[i+2]*2]-v[ind[i]*2])/h;var t4=(v[ind[i+2]*2+1]-v[ind[i]*2+1])/h;c.transform(t1,t2,t3,t4,v[ind[i]*2],v[ind[i]*2+1]);c.drawImage(s.bitmap.image,s.bitmap.x+sw,s.bitmap.y+sh,w,h,0,0,w,h);}else{var w=(u[ind[i+2+j]*2]-u[ind[i+1+j]*2])*s.bitmap.width;var h=(u[ind[i+2]*2+1]-u[ind[i]*2+1])*s.bitmap.height;if(j==0&&w<0){for(k=i+9; k<l; k+=3){if(u[ind[i+2]*2+1]==u[ind[k+2]*2+1]){j=k-i;break;}}if(j==0){j=l-i;}w=(u[ind[i+2+j]*2]-u[ind[i+1+j]*2])*s.bitmap.width;}if(i+1+j>=l){w=(u[ind[i+1+j-l]*2]-u[ind[i+2]*2])*s.bitmap.width;sw=u[ind[i+1]*2]==1?0:s.bitmap.width*u[ind[i+1]*2]+w;if(sw>s.bitmap.width){sw-=s.bitmap.width;}}else{sw=s.bitmap.width*u[ind[i+1+j]*2];}sh=s.bitmap.height*u[ind[i]*2+1];if(h<0){h=(u[ind[i+2-(i>0?6:-6)]*2+1]-u[ind[i-(i>0?6:-6)]*2+1])*s.bitmap.height;sh=0;}var t1=(v[ind[i+2]*2]-v[ind[i+1]*2])/w;var t2=(v[ind[i+2]*2+1]-v[ind[i+1]*2+1])/w;var t3=(v[ind[i+2]*2]-v[ind[i]*2])/h;var t4=(v[ind[i+2]*2+1]-v[ind[i]*2+1])/h;c.transform(t1,t2,t3,t4,v[ind[i+1]*2],v[ind[i+1]*2+1]);c.drawImage(s.bitmap.image,s.bitmap.x+sw,s.bitmap.y+sh,w,h,0,-h,w,h);}c.restore();}});},drawLine:function(tn,lco,pa){var s=this;s.setList.push(function(c){c.beginPath();c.moveTo(pa[0],pa[1]);c.lineTo(pa[2],pa[3]);c.lineWidth=tn;c.strokeStyle=lco;c.closePath();c.stroke();});s.showList.push({type:LShape.LINE,arg:pa});},add:function(f){this.setList.push(f);},ismouseon:function(e,co){var s=this;if(e==null||e==UNDEFINED||s.showList.length==0||!s.parent){return false;}return s.parent.ismouseonShapes(s.showList,e.offsetX,e.offsetY);},getWidth:function(){var s=this,k,k1,min,max,v,l,l1;for(k=0,l=s.showList.length; k<l; k++){if(s.showList[k].type==LShape.RECT){if(min>s.showList[k].arg[0]||typeof min==UNDEFINED){min=s.showList[k].arg[0];}if(max<s.showList[k].arg[0]+s.showList[k].arg[2]||typeof max==UNDEFINED){max=s.showList[k].arg[0]+s.showList[k].arg[2];}}else if(s.showList[k].type==LShape.ARC){if(min>s.showList[k].arg[0]-s.showList[k].arg[2]||typeof min==UNDEFINED){min=s.showList[k].arg[0]-s.showList[k].arg[2];}if(max<s.showList[k].arg[0]+s.showList[k].arg[2]||typeof max==UNDEFINED){max=s.showList[k].arg[0]+s.showList[k].arg[2];}}else if(s.showList[k].type==LShape.VERTICES){for(k1=0,l1=s.showList[k].arg.length; k1<l1; k1++){v=s.showList[k].arg[k1];if(min>v[0]||typeof min==UNDEFINED){min=v[0];}if(max<v[0]||typeof max==UNDEFINED){max=v[0];}}}else if(s.showList[k].type==LShape.LINE){if(min>s.showList[k].arg[0]||typeof min==UNDEFINED){min=s.showList[k].arg[0];}if(min>s.showList[k].arg[2]||typeof min==UNDEFINED){min=s.showList[k].arg[2];}if(max<s.showList[k].arg[0]||typeof max==UNDEFINED){max=s.showList[k].arg[0];}if(max<s.showList[k].arg[2]||typeof max==UNDEFINED){max=s.showList[k].arg[2];}}else if(s.showList[k].type==LShape.POINT){if(min>s.showList[k].arg[0]||typeof min==UNDEFINED){min=s.showList[k].arg[0];}if(max<s.showList[k].arg[0]||typeof max==UNDEFINED){max=s.showList[k].arg[0];}}}if(typeof min==UNDEFINED){min=max=0;}s.left=min;if(l>0&&max==min){max=min+1;}return max-min;},getHeight:function(){var s=this,k=null,k1=null,l,l1,min,max,v;for(k=0,l=s.showList.length; k<l; k++){if(s.showList[k].type==LShape.RECT){if(min>s.showList[k].arg[1]||typeof min==UNDEFINED){min=s.showList[k].arg[1];}if(max<s.showList[k].arg[1]+s.showList[k].arg[3]||typeof max==UNDEFINED){max=s.showList[k].arg[1]+s.showList[k].arg[3];}}else if(s.showList[k].type==LShape.ARC){if(min>s.showList[k].arg[1]-s.showList[k].arg[2]||typeof min==UNDEFINED){min=s.showList[k].arg[1]-s.showList[k].arg[2];}if(max<s.showList[k].arg[1]+s.showList[k].arg[2]||typeof max==UNDEFINED){max=s.showList[k].arg[1]+s.showList[k].arg[2];}}else if(s.showList[k].type==LShape.VERTICES){for(k1=0,l1=s.showList[k].arg.length; k1<l1; k1++){v=s.showList[k].arg[k1];if(min>v[1]||typeof min==UNDEFINED){min=v[1];}if(max<v[1]||typeof max==UNDEFINED){max=v[1];}}}else if(s.showList[k].type==LShape.LINE){if(min>s.showList[k].arg[1]||typeof min==UNDEFINED){min=s.showList[k].arg[1];}if(min>s.showList[k].arg[3]||typeof min==UNDEFINED){min=s.showList[k].arg[3];}if(max<s.showList[k].arg[1]||typeof max==UNDEFINED){max=s.showList[k].arg[1];}if(max<s.showList[k].arg[3]||typeof max==UNDEFINED){max=s.showList[k].arg[3];}}else if(s.showList[k].type==LShape.POINT){if(min>s.showList[k].arg[1]||typeof min==UNDEFINED){min=s.showList[k].arg[1];}if(max<s.showList[k].arg[1]||typeof max==UNDEFINED){max=s.showList[k].arg[1];}}}if(typeof min==UNDEFINED){min=max=0;}s.top=min;if(l>0&&max==min){max=min+1;}return max-min;},startX:function(){var s=this;s.getWidth();return s.left;},startY:function(){var s=this;s.getHeight();return s.top;}};for(var k in p){LGraphics.prototype[k]=p[k];}return LGraphics;})();var LShape=(function(){function LShape(){var s=this;LExtends(s,LInteractiveObject,[]);s.type="LShape";s.graphics=new LGraphics();s.graphics.parent=s;}LShape.POINT="point";LShape.LINE="line";LShape.ARC="arc";LShape.RECT="rect";LShape.VERTICES="vertices";var p={_ll_show:function(c){var s=this;s.graphics.ll_show(c);},getWidth:function(maskSize){var s=this,mx,mw,left=s.graphics.startX(),right=left+s.graphics.getWidth();if(maskSize&&s.mask){mx=s.mask._startX?s.mask._startX():s.mask.startX();mw=s.mask.getWidth();if(left<mx){left=mx;}if(right>mx+mw){right=mx+mw;}}s.ll_left=s.x+left;s.ll_right=s.x+right;return(right-left)*s.scaleX;},getHeight:function(maskSize){var s=this,my,mh,top=s.graphics.startY(),bottom=top+s.graphics.getHeight();if(maskSize&&s.mask){my=s.mask._startY?s.mask._startY():s.mask.startY();mh=s.mask.getHeight();if(top<my){top=my;}if(bottom>my+mh){bottom=my+mh;}}s.ll_top=s.y+top;s.ll_bottom=s.y+bottom;return(bottom-top)*s.scaleY;},_startX:function(){var s=this;s.getWidth();return s.ll_left;},startX:function(){var s=this;return s._startX()*s.scaleX;},_startY:function(){var s=this;s.getHeight();return s.ll_top;},startY:function(){var s=this;return s._startY()*s.scaleY;},clone:function(){var s=this,a=new LShape(),c,o;a.copyProperty(s);a.graphics=s.graphics.clone();a.graphics.parent=a;return a;},ismouseon:function(e,cd){var s=this,i=false,sc;if(!s.visible||e==null){return false;}if(s.mask){if(!s.mask.parent){s.mask.parent=s.parent;}if(!s.mask.ismouseon(e,cd)){return false;}}sc={x:s.x*cd.scaleX+cd.x,y:s.y*cd.scaleY+cd.y,scaleX:cd.scaleX*s.scaleX,scaleY:cd.scaleY*s.scaleY};if(s.graphics){i=s.graphics.ismouseon(e,sc);}return i;},die:function(){var s=this;s.graphics.clear();}};for(var k in p){LShape.prototype[k]=p[k];}return LShape;})();var LSprite=(function(){function LSprite(){var s=this;LExtends(s,LDisplayObjectContainer,[]);s.type="LSprite";s.rotatex;s.rotatey;s.graphics=new LGraphics();s.graphics.parent=s;s.box2dBody=null;s.shapes=new Array();s.dragRange=null;s.useCursor=null;}var p={setRotate:function(angle){var s=this;if(s.box2dBody){s.box2dBody.SetAngle(angle);}else{s.rotate=angle;}},_rotateReady:function(){var s=this;if(s.box2dBody){if((typeof s.rotatex)==UNDEFINED){s.getRotateXY();}s.x=s.box2dBody.GetPosition().x*LGlobal.box2d.drawScale-s.parent.x-s.rotatex;s.y=s.box2dBody.GetPosition().y*LGlobal.box2d.drawScale-s.parent.y-s.rotatey;s.rotate=s.box2dBody.GetAngle();}},_ll_show:function(c){var s=this;s.graphics.ll_show(c);LGlobal.show(s.childList,c);s._ll_debugShape(c);},startDrag:function(touchPointID){var s=this;if(s.ll_dragStart){return;}s.ll_touchPointID=touchPointID;s.ll_dragGlobalPoint=s.parent.localToGlobal(new LPoint(s.x,s.y));s.ll_dragMX=mouseX;s.ll_dragMY=mouseY;s.ll_dragStart=true;LGlobal.dragList.push(s);},stopDrag:function(){var s=this,i,l;for(i=0,l=LGlobal.dragList.length; i<l; i++){if(s.objectIndex==LGlobal.dragList[i].objectIndex){s.ll_dragStart=false;LGlobal.dragList.splice(i,1);break;}}},getRotateXY:function(w,h){var s=this;if(!w||!h){w=s.getWidth();h=s.getHeight();}s.rotatex=w/2;s.rotatey=h/2;},getWidth:function(maskSize){var s=this,i,l,o,a,b,mx,mw,left=s.graphics.startX(),right=left+s.graphics.getWidth();for(i=0,l=s.childList.length; i<l; i++){o=s.childList[i];if(typeof o.visible==UNDEFINED||!o.visible){continue;}a=o.x;if(typeof o._startX=="function"){a=o._startX(maskSize);}b=a+o.getWidth(maskSize);if(a<left){left=a;}if(b>right){right=b;}}if(maskSize&&s.mask){mx=s.mask._startX?s.mask._startX():s.mask.startX();mw=s.mask.getWidth();if(left<mx){left=mx;}if(right>mx+mw){right=mx+mw;}s.ll_left=left;s.ll_right=right;}else{s.ll_left=s.x+left;s.ll_right=s.x+right;}return(right-left)*s.scaleX;},getHeight:function(maskSize){var s=this,i,l,o,a,b,my,mh,top=s.graphics.startY(),bottom=top+s.graphics.getHeight();for(i=0,l=s.childList.length; i<l; i++){o=s.childList[i];if(typeof o.visible==UNDEFINED||!o.visible){continue;}a=o.y;if(typeof o._startY=="function"){a=o._startY(maskSize);}b=a+o.getHeight(maskSize);if(a<top){top=a;}if(b>bottom){bottom=b;}}if(maskSize&&s.mask){my=s.mask._startY?s.mask._startY():s.mask.startY();mh=s.mask.getHeight();if(top<my){top=my;}if(bottom>my+mh){bottom=my+mh;}s.ll_top=top;s.ll_bottom=bottom;}else{s.ll_top=s.y+top;s.ll_bottom=s.y+bottom;}return(bottom-top)*s.scaleY;},_startX:function(maskSize){var s=this;s.getWidth(maskSize);return s.ll_left;},startX:function(maskSize){var s=this;return s._startX(maskSize)*s.scaleX;},_startY:function(maskSize){var s=this;s.getHeight(maskSize);return s.ll_top;},startY:function(maskSize){var s=this;return s._startY(maskSize)*s.scaleY;},_ll_loopframe:function(){this.dispatchEvent(LEvent.ENTER_FRAME);},clone:function(){var s=this,a=new LSprite(),c,o,i,l;a.copyProperty(s);a.graphics=s.graphics.clone();a.graphics.parent=a;a.childList.length=0;for(i=0,l=s.childList.length; i<l; i++){c=s.childList[i];if(c.clone){o=c.clone();o.parent=a;a.childList.push(o);}}return a;},_mevent:function(type){var s=this,k;for(k=0; k<s.mouseList.length; k++){var o=s.mouseList[k];if(o.type==type){return true;}}return false;},ll_dispatchMouseEvent:function(type,e,cd,ox,oy){var s=this;if(!s.mouseEnabled){return;}for(k=0; k<s.mouseList.length; k++){var o=s.mouseList[k];if(o.type==type){e.selfX=(ox-(s.x*cd.scaleX+cd.x))/(cd.scaleX*s.scaleX);e.selfY=(oy-(s.y*cd.scaleY+cd.y))/(cd.scaleY*s.scaleY);e.currentTarget=e.clickTarget=s;if(!e.target){e.target=s;}o.listener(e,s);}}},ll_mouseout:function(e,type,cd,ox,oy){var s=this;if(type==LMouseEvent.MOUSE_MOVE&&s.ll_mousein){s.ll_mousein=false;if(s._mevent(LMouseEvent.MOUSE_OUT)){s.ll_dispatchMouseEvent(LMouseEvent.MOUSE_OUT,e,cd,ox,oy);}if(s.mouseChildren){for(var k=s.childList.length-1; k>=0; k--){if(s.childList[k].mouseEvent&&s.childList[k].ll_mouseout){s.childList[k].ll_mouseout(e,type,cd,ox,oy);}}}}},mouseEvent:function(e,type,cd){if(!e){return false;}var s=this,i,k,ox=e.offsetX,oy=e.offsetY,on,mc;if(!s.visible){return false;}if(cd==null){cd={x:0,y:0,scaleX:1,scaleY:1};}on=s.ismouseon(e,cd);if(on){if(LGlobal.os==OS_PC&&s.useCursor&&type==LMouseEvent.MOUSE_MOVE){LGlobal.cursor=s.useCursor;}if(type==LMouseEvent.MOUSE_MOVE&&!s.ll_mousein){s.ll_mousein=true;if(s._mevent(LMouseEvent.MOUSE_OVER)){s.ll_dispatchMouseEvent(LMouseEvent.MOUSE_OVER,e,cd,ox,oy);}}if(s.mouseChildren){mc={x:s.x*cd.scaleX+cd.x,y:s.y*cd.scaleY+cd.y,scaleX:cd.scaleX*s.scaleX,scaleY:cd.scaleY*s.scaleY};for(k=s.childList.length-1; k>=0; k--){if(s.childList[k].mouseEvent){i=s.childList[k].mouseEvent(e,type,mc);if(i){e.target=s.childList[k];if(type!=LMouseEvent.MOUSE_MOVE){break;}}}}if(s._mevent(type)){s.ll_dispatchMouseEvent(type,e,cd,ox,oy);}}return true;}else{s.ll_mouseout(e,type,cd,ox,oy);}return false;},hitTestPoint:function(x,y){var s=this,shapes=s.shapes;if(!shapes||shapes.length==0){s.getWidth();s.getHeight();shapes=[{"type":LShape.RECT,"arg":[s.ll_left-s.x,s.ll_top-s.y,s.ll_right-s.ll_left,s.ll_bottom-s.ll_top]}];}return s.ismouseonShapes(shapes,x,y);},hitTestObject:function(obj){var s=this,shapes=s.shapes,shapes1=obj.shapes,m,m1,j,child,j1,child1,vo1,v1;if(!shapes||shapes.length==0){s.getWidth();s.getHeight();shapes=[{"type":LShape.RECT,"arg":[s.ll_left-s.x,s.ll_top-s.y,s.ll_right-s.ll_left,s.ll_bottom-s.ll_top]}];}if(!shapes1||shapes1.length==0){obj.getWidth();obj.getHeight();shapes1=[{"type":LShape.RECT,"arg":[obj.ll_left-obj.x,obj.ll_top-obj.y,obj.ll_right-obj.ll_left,obj.ll_bottom-obj.ll_top]}];}m=s.getRootMatrix();m1=obj.getRootMatrix();for(j=shapes.length-1; j>=0; j--){child=shapes[j];v1=s._changeShape(child.type,child.arg,m);for(j1=shapes1.length-1; j1>=0; j1--){child1=shapes1[j1];vo1=obj._changeShape(child1.type,child1.arg,m1);if(child.type==LShape.VERTICES||child.type==LShape.RECT){if(child1.type==LShape.VERTICES||child1.type==LShape.RECT){if(LGlobal.hitTestPolygon(v1,vo1)){return true;}}else if(child1.type==LShape.ARC){if(LGlobal.hitTestPolygonArc(v1,vo1)){return true;}}}else{if(child1.type==LShape.VERTICES||child1.type==LShape.RECT){if(LGlobal.hitTestPolygonArc(vo1,v1)){return true;}}else if(child1.type==LShape.ARC){if(Math.sqrt((v1[0]-vo1[0])*(v1[0]-vo1[0])+(v1[1]-vo1[1])*(v1[1]-vo1[1]))<v1[2]+vo1[2]){return true;}}}}}return false;},addShape:function(type,arg){var s=this;if(type==LShape.VERTICES&&arg.length<3){return;}s.shapes.push({"type":type,"arg":arg});return s.shapes;},addShapes:function(shapes){var s=this;if(s.shapes.length==0){s.shapes=shapes;}else{s.shapes=s.shapes.concat(shapes);}},clearShape:function(){this.shapes=[];},_ll_debugShape:function(c){var s=this,i,l,child,arg,j,ll;if(!LGlobal.traceDebug||!s.shapes||s.shapes.length==0){return;}for(i=0,l=s.shapes.length; i<l; i++){child=s.shapes[i];c=c||LGlobal.canvas;arg=child.arg;c.beginPath();if(child.type==LShape.RECT){c.rect(arg[0],arg[1],arg[2],arg[3]);}else if(child.type==LShape.ARC){c.arc(arg[0],arg[1],arg[2],0,2*Math.PI);}else if(child.type==LShape.VERTICES){c.moveTo(arg[0][0],arg[0][1]);for(j=1,ll=arg.length; j<ll; j++){c.lineTo(arg[j][0],arg[j][1]);};c.lineTo(arg[0][0],arg[0][1]);}c.closePath();c.strokeStyle="#00FF00";c.stroke();}},ismouseon:function(e,cd){var s=this;if(!s.visible||e==null){return false;}if(s.mask){if(!s.mask.parent){s.mask.parent=s.parent;}if(!s.mask.ismouseon(e,cd)){return false;}}if(s.shapes&&s.shapes.length>0){return s.ismouseonShapes(s.shapes,e.offsetX,e.offsetY);}var k,i=false,l=s.childList,sc={x:s.x*cd.scaleX+cd.x,y:s.y*cd.scaleY+cd.y,scaleX:cd.scaleX*s.scaleX,scaleY:cd.scaleY*s.scaleY};for(k=l.length-1; k>=0; k--){if(l[k].ismouseon){i=l[k].ismouseon(e,sc);}if(i){e.target=s.childList[k];break;}}if(!i){i=s.graphics.ismouseon(e,sc);}return i;},die:function(){var s=this,i,c,l;s.graphics.clear();s.removeAllEventListener();s.stopDrag();if(s.box2dBody){s.clearBody();}for(i=0,c=s.childList,l=c.length; i<l; i++){if(c[i].die){c[i].die();}}}};for(var k in p){LSprite.prototype[k]=p[k];}return LSprite;})();var LButton=(function(){function LButton(upState,overState,downState,disableState){var s=this;LExtends(s,LSprite,[]);s.type="LButton";s.addChild(upState);if(!overState){overState=upState;}else{s.addChild(overState);}if(!downState){downState=overState;}else{s.addChild(downState);}if(!disableState){disableState=upState;}else{s.addChild(disableState);}s.upState=s.bitmap_up=upState;s.overState=s.bitmap_over=overState;s.downState=downState;s.disableState=disableState;s._ll_down_sx=s.downState.scaleX;s._ll_down_sy=s.downState.scaleY;s.overState.visible=false;s.downState.visible=false;s.upState.visible=true;s.buttonMode=true;s.staticMode=false;s.setState(LButton.STATE_ENABLE);if(LMouseEventContainer.container[LMouseEvent.MOUSE_MOVE]){LMouseEventContainer.pushButton(s);}s.addEventListener(LMouseEvent.MOUSE_DOWN,s.ll_modeDown);s.setCursorEnabled(true);}LButton.STATE_DISABLE="disable";LButton.STATE_ENABLE="enable";var p={setState:function(state){var s=this;if(state==LButton.STATE_DISABLE){s.upState.visible=false;s.overState.visible=false;s.downState.visible=false;s.disableState.visible=true;s.mouseEnabled=false;}else if(state==LButton.STATE_ENABLE){s.overState.visible=false;s.downState.visible=false;s.disableState.visible=false;s.upState.visible=true;s.mouseEnabled=true;}else{return;}s.state=state;},ll_mouseout:function(e,type,cd,ox,oy){var s=this;if(!s.ll_mousein){return;}e.clickTarget=s;s.ll_modeOut(e);s.ll_mousein=false;},mouseEvent:function(e,type,cd){if(!e){return false;}var s=this;if(type==LMouseEvent.MOUSE_MOVE&&s.ll_button_mode){s.ll_button_mode(e);}return this.callParent("mouseEvent",arguments);},ll_button_mode:function(e){var s=this;if(!s.visible){return;}e.clickTarget=s;if(s.hitTestPoint(e.offsetX,e.offsetY)){s.ll_modeOver(e);}else{s.ll_modeOut(e);}},ll_modeDown:function(e){var s=e.clickTarget,w,h,tw,th,x,y,tx,ty,onComplete;if(!s.buttonMode||s.tween){return;}if(s.state==LButton.STATE_DISABLE){s.upState.visible=false;s.overState.visible=false;s.downState.visible=false;s.disableState.visible=true;return;}s.upState.visible=false;s.overState.visible=false;s.downState.visible=true;s._tweenOver=s.ll_modeOver;onComplete=function(obj){var s=obj.parent;delete s.tween;s._tweenOver({clickTarget:s});delete s._tweenOver;};if(s.staticMode){s.tween=LTweenLiteTimeline.to(s.downState,0.3,{}).to(s.downState,0.1,{onComplete:onComplete});}else{w=s.downState.getWidth();h=s.downState.getHeight();tw=w*1.1;th=h*1.1;x=s.downState.x;y=s.downState.y;tx=x+(w-tw)*0.5;ty=y+(h-th)*0.5;s.tween=LTweenLiteTimeline.to(s.downState,0.3,{x:tx,y:ty,scaleX:s._ll_down_sx*1.1,scaleY:s._ll_down_sy*1.1,ease:Quart.easeOut}).to(s.downState,0.1,{x:x,y:y,scaleX:s._ll_down_sx,scaleY:s._ll_down_sy,ease:Quart.easeOut,onComplete:onComplete});}},ll_modeOver:function(e){var s=e.clickTarget;if(!s.buttonMode){return;}if(s.tween){s._tweenOver=s.ll_modeOver;return;}if(s.state==LButton.STATE_DISABLE){s.upState.visible=false;s.overState.visible=false;s.downState.visible=false;s.disableState.visible=true;return;}s.upState.visible=false;s.downState.visible=false;s.overState.visible=true;},ll_modeOut:function(e){var s=e.clickTarget;if(!s.buttonMode){return;}if(s.tween){s._tweenOver=s.ll_modeOut;return;}if(s.state==LButton.STATE_DISABLE){s.upState.visible=false;s.overState.visible=false;s.downState.visible=false;s.disableState.visible=true;return;}s.overState.visible=false;s.downState.visible=false;s.upState.visible=true;},setCursorEnabled:function(value){this.useCursor=value?"pointer":null;},clone:function(){var s=this;return new LButton(s.upState.clone(),s.overState.clone(),s.downState.clone(),s.disableState.clone());},die:function(){var s=this;if(LMouseEventContainer.container[LMouseEvent.MOUSE_MOVE]){LMouseEventContainer.removeButton(s);}s.callParent("die",arguments);}};for(var k in p){LButton.prototype[k]=p[k];}return LButton;})();function LBlendMode(){throw "LBlendMode cannot be instantiated";}LBlendMode.SOURCE_OVER="source-over";LBlendMode.SOURCE_ATOP="source-atop";LBlendMode.SOURCE_IN="source-in";LBlendMode.SOURCE_OUT="source-out";LBlendMode.DESTINATION_OVER="destination-over";LBlendMode.DESTINATION_ATOP="destination-atop";LBlendMode.DESTINATION_IN="destination-in";LBlendMode.DESTINATION_OUT="destination-out";LBlendMode.LIGHTER="lighter";LBlendMode.COPY="copy";LBlendMode.XOR="xor";LBlendMode.NONE=null;LBlendMode.NORMAL=null;var LTextFieldType=function(){throw "LTextFieldType cannot be instantiated";};LTextFieldType.INPUT="input";LTextFieldType.DYNAMIC=null;LStyleSheet=(function(){function LStyleSheet(){var s=this;LExtends(s,LObject,[]);s.styleIndex=0;s.styleNames={};}LStyleSheet.prototype.clone=function(){var s=this,a=new s.constructor();a.copyProperty(s);return a;};LStyleSheet.prototype.setStyle=function(styleName,styleObject){this.styleIndex++;if(styleObject===null){if(this.styleNames[styleName]){delete this.styleNames[styleName];}return;}var arr=styleObject.replace(/(^\{)|(\}$)/g,"").split(";"),i,styleObjects;styleObject={};for(i=0; i<arr.length; i++){if(!arr[i]){continue;}var styleObjects=arr[i].split(":");if(!styleObjects[0]){continue;}styleObject[styleObjects[0]]=styleObjects[1];}this.styleNames[styleName]=styleObject;};LStyleSheet.prototype.getStyle=function(styleName){return this.styleNames[styleName];};return LStyleSheet;})();LTextFormat=(function(){function LTextFormat(font,size,color,bold,italic,underline){var s=this;LExtends(s,LObject,[]);s.font=font?font:"Arial";s.size=size?size:15;s.color=color?color:"#000000";s.bold=bold?bold:false;s.italic=italic?italic:false;s.underline=underline?underline:false;}LTextFormat.prototype.clone=function(){var s=this,a=new s.constructor();a.copyProperty(s);return a;};LTextFormat.prototype.getFontText=function(){var s=this;return(s.italic?"italic ":"")+(s.bold?"bold ":"")+s.size+"px "+s.font;};LTextFormat.prototype.setCss=function(css){var s=this,k;for(k in css){switch(k){case "color":s.color=css[k];break;case "font-family":s.font=css[k];break;case "font-size":s.size=css[k];break;case "font-style":s.italic=(css[k]=="italic");break;case "font-weight":s.bold=(css[k]=="bold");break;case "text-decoration":s.color=(css[k]=="underline");break;}}};return LTextFormat;})();var LTextField=(function(){function LTextField(){var s=this;LExtends(s,LInteractiveObject,[]);s.type="LTextField";s.texttype=null;s.text="";s.htmlText="";s.styleSheet="";s.font="Arial";s.size=15;s.color="#000000";s.weight="normal";s.textAlign="left";s.textBaseline="top";s.heightMode=LTextField.HEIGHT_MODE_BOTTOM;s.stroke=false;s.lineWidth=1;s.lineColor="#000000";s.width=150;s.height=s.size;s.displayAsPassword=false;s.wordWrap=false;s.multiline=false;s.numLines=1;s.speed=0;s._speedIndex=100;}LTextField.HEIGHT_MODE_BOTTOM="bottom";LTextField.HEIGHT_MODE_BASELINE="baseline";var p={_showReady:function(c){var s=this;c.font=s.weight+" "+s.size+"px "+s.font;c.textAlign=s.textAlign;c.textBaseline=s.textBaseline;},ll_getStyleSheet:function(textFormat,tabName,attribute,text){var s=this,pattern,tf=textFormat.clone();if(tabName=="font"){var i=0;while(attribute){if(i++>4)break;pattern=/(([^\s]*?)(\s*)=(\s*)("|')(.*?)\5)*/g;var arr=pattern.exec(attribute);if(!arr||!arr[0]){break;}switch(arr[2]){case "face":tf.font=arr[6];break;case "color":tf.color=arr[6];break;case "size":tf.size=arr[6];break;}attribute=attribute.replace(arr[0],"").replace(/(^\s*)|(\s*$)|(\n)/g,"");}}else if(tabName=="b"){tf.bold=true;}else if(tabName=="u"){tf.underline=true;}else if(tabName=="i"){tf.italic=true;}else if(tabName=="p"&&s.wordWrap){text="\n"+text+"\n";}else if(s.styleSheet){var sheetObj;if(tabName=="span"){pattern=/(([^\s]*?)(\s*)=(\s*)("|')(.*?)\5)*/g;var arr=pattern.exec(attribute);if(arr&&arr[0]){switch(arr[2]){case "class":sheetObj=s.styleSheet.getStyle("."+arr[6]);break;}}}else if(s.styleSheet.getStyle(tabName)){sheetObj=s.styleSheet.getStyle(tabName);}if(sheetObj){tf.setCss(sheetObj);}}s.ll_getHtmlText(tf,text);},ll_getHtmlText:function(tf,text){if(!text){return;}var s=this,tabName,content,start,end,pattern=/<(.*?)(\s*)(.*?)>(.*?)<\/\1>/g,arr=pattern.exec(text);if(!arr||!arr[0]){s.ll_htmlTexts.push({textFormat:tf.clone(),text:text});return;}if(arr.index>0){s.ll_htmlTexts.push({textFormat:tf.clone(),text:text.substring(0,arr.index)});}tabName=arr[1];start=arr.index;end=start;do{end=text.indexOf("</"+tabName,end+1);start=text.indexOf("<"+tabName,start+1);}while(start>0&&start<end);content=text.substring(text.indexOf(">",arr.index)+1,end);s.ll_getStyleSheet(tf,tabName,arr[3],content);s.ll_getHtmlText(tf,text.substring(end+tabName.length+3));},_ll_show:function(c){var s=this,d,lbl,i,rc,j,l,k,m,b,h,enter,tf,underlineY;if(s.texttype==LTextFieldType.INPUT){s.inputBackLayer.ll_show();rc=s.getRootCoordinate();if(LGlobal.inputBox.name=="input"+s.objectIndex){LGlobal.inputBox.style.marginTop=(parseInt(LGlobal.canvasObj.style.marginTop)+(((rc.y+s.inputBackLayer.startY())*parseInt(LGlobal.canvasObj.style.height)/LGlobal.canvasObj.height)>>>0))+"px";LGlobal.inputBox.style.marginLeft=(parseInt(LGlobal.canvasObj.style.marginLeft)+(((rc.x+s.inputBackLayer.startX())*parseInt(LGlobal.canvasObj.style.width)/LGlobal.canvasObj.width)>>>0))+"px";}if(LGlobal.inputTextField&&LGlobal.inputTextField.objectIndex==s.objectIndex){return;}else{c.clip();}}if(LGlobal.fpsStatus){LGlobal.fpsStatus.text++;}c.fillStyle=s.color;if(s.stroke){c.strokeStyle=s.lineColor;c.lineWidth=s.lineWidth+1;}if(s.htmlText){if(s.ll_htmlText!=s.htmlText||(s.styleSheet&&(s.ll_style_objectIndex!=s.styleSheet.objectIndex||s.ll_styleIndex==s.styleSheet.styleIndex))){tf=new LTextFormat();s.ll_htmlTexts=[];s.ll_htmlText=s.htmlText;if(s.styleSheet){s.ll_style_objectIndex=s.styleSheet.objectIndex;s.ll_styleIndex=s.styleSheet.styleIndex;}s.ll_getHtmlText(tf,s.htmlText);}j=0,k=0,m=0,b=0;s._ll_height=s.wordHeight||30;if(!LTextField.underlineY){LTextField.underlineY={"alphabetic":0,"top":1,"bottom":-0.2,"middle":0.4,"hanging":0.8};}s.ll_htmlTexts.forEach(function(element){var textFormat=element.textFormat,text=element.text;c.font=textFormat.getFontText();c.fillStyle=textFormat.color;for(i=0,l=text.length; i<l; i++){enter=/(?:\r\n|\r|\n|¥n)/.exec(text.substr(i,1));if(enter){j=0;k=i+1;m++;}else{h=c.measureText("O").width*1.2;if(s.stroke){c.strokeText(text.substr(i,1),j,m*s._ll_height);}c.fillText(text.substr(i,1),j,m*s._ll_height);if(textFormat.underline){c.beginPath();underlineY=m*s._ll_height+h*LTextField.underlineY[s.textBaseline];c.moveTo(j,underlineY);c.lineTo(j+c.measureText(text.substr(i,1)).width,underlineY);c.stroke();}}j+=c.measureText(text.substr(i,1)).width;if(s.wordWrap&&j+c.measureText(text.substr(i+1,1)).width>s.width){j=0;k=i+1;m++;}}s.height=(m+1)*s._ll_height;});return;}lbl=s.text;if(s.displayAsPassword){lbl='';for(i=0,l=s.text.length; i<l; i++){lbl+='*';}}if(s.wordWrap||s.multiline){j=0,k=0,m=0,b=0;for(i=0,l=s.text.length; i<l; i++){enter=/(?:\r\n|\r|\n|¥n)/.exec(lbl.substr(i,1));if(enter){j=0;k=i+1;m++;}else{if(s.stroke){c.strokeText(lbl.substr(i,1),j,m*s.wordHeight);}c.fillText(lbl.substr(i,1),j,m*s.wordHeight);}s.numLines=m;j=c.measureText(s.text.substr(k,i+1-k)).width;if(s.wordWrap&&j+c.measureText(lbl.substr(i,1)).width>s.width){j=0;k=i+1;m++;}}s.height=(m+1)*s.wordHeight;}else{s.numLines=1;if(s.stroke){c.strokeText(lbl,0,0,c.measureText(lbl).width);}c.fillText(lbl,0,0,c.measureText(lbl).width);}if(s.windRunning){s._ll_windRun();}},_wordHeight:function(h){var s=this;if(h>0){s.wordHeight=h;}else{s.wordWrap=false;s.wordHeight=s.getHeight();}s.height=0;},setMultiline:function(v,h){var s=this;if(v){s._wordHeight(h);}s.multiline=v;},setWordWrap:function(v,h){var s=this;if(v){s._wordHeight(h);}s.wordWrap=v;},setType:function(type,inputBackLayer){var s=this;if(s.texttype!=type&&type==LTextFieldType.INPUT){if(inputBackLayer==null||inputBackLayer.type!="LSprite"){s.inputBackLayer=new LSprite();s.inputBackLayer.graphics.drawRect(1,"#000000",[0,-s.getHeight()*0.4,s.width,s.getHeight()*1.5]);}else{s.inputBackLayer=inputBackLayer;}s.inputBackLayer.parent=s;if(LMouseEventContainer.container[LMouseEvent.MOUSE_DOWN]){LMouseEventContainer.pushInputBox(s);}}else{s.inputBackLayer=null;LMouseEventContainer.removeInputBox(s);}s.texttype=type;},ismouseon:function(e,cood){var s=this;if(!e){return false;}if(!s.visible){return false;}if(!cood){cood={x:0,y:0,scaleX:1,scaleY:1};}if(s.mask){if(!s.mask.parent){s.mask.parent=s.parent;}if(!s.mask.ismouseon(e,cood)){return false;}}if(s.inputBackLayer){return s.inputBackLayer.ismouseon(e,{x:s.x*cood.scaleX+cood.x,y:s.y*cood.scaleY+cood.y,scaleX:cood.scaleX*s.scaleX,scaleY:cood.scaleY*s.scaleY});}return s.ismouseonShapes([{type:LShape.RECT,arg:[0,0,s._getWidth(),s._getHeight()]}],e.offsetX,e.offsetY);},clone:function(){var s=this,a=new s.constructor();a.copyProperty(s);a.texttype=null;if(s.texttype==LTextFieldType.INPUT){a.setType(LTextFieldType.INPUT);}return a;},mouseEvent:function(event,type,cood){var s=this,on;if(s.inputBackLayer==null||type!=LMouseEvent.MOUSE_DOWN){return;}on=s.ismouseon(event,cood);if(!on){return;}s.focus();},_ll_getValue:function(){if(LGlobal.inputBox.style.display!=NONE){LGlobal.inputTextField.text=LGlobal.inputTextBox.value;LEvent.removeEventListener(LGlobal.inputTextBox,LKeyboardEvent.KEY_DOWN,LGlobal.inputTextField._ll_input);LGlobal.inputBox.style.display=NONE;LGlobal.inputTextField.dispatchEvent(LFocusEvent.FOCUS_OUT);LGlobal.inputTextField=null;}},updateInput:function(){var s=this;if(s.texttype==LTextFieldType.INPUT&&LGlobal.inputTextField.objectIndex==s.objectIndex){LGlobal.inputTextBox.value=LGlobal.inputTextField.text;}},_ll_input:function(e){var event=new LEvent(LTextEvent.TEXT_INPUT);event.keyCode=e.keyCode;LGlobal.inputTextField.text=LGlobal.inputTextBox.value;if(LGlobal.inputTextField.hasEventListener(LTextEvent.TEXT_INPUT)){e.returnValue=LGlobal.inputTextField.dispatchEvent(event);}else{e.returnValue=true;}},focus:function(){var s=this,sc,sx;if(!s.parent){return;}if(s.texttype!=LTextFieldType.INPUT){return;}if(LGlobal.inputTextField&&LGlobal.inputTextField.objectIndex!=s.objectIndex){s._ll_getValue();}s.dispatchEvent(LFocusEvent.FOCUS_IN);sc=s.getAbsoluteScale();LGlobal.inputBox.style.display="";LGlobal.inputBox.name="input"+s.objectIndex;LGlobal.inputTextField=s;LGlobal.inputTextareaBoxObj.style.display=NONE;LGlobal.inputTextBoxObj.style.display=NONE;LGlobal.passwordBoxObj.style.display=NONE;if(s.displayAsPassword){LGlobal.inputTextBox=LGlobal.passwordBoxObj;}else if(s.multiline){LGlobal.inputTextBox=LGlobal.inputTextareaBoxObj;}else{LGlobal.inputTextBox=LGlobal.inputTextBoxObj;}sx=parseInt(LGlobal.canvasObj.style.width)/LGlobal.canvasObj.width;sy=parseInt(LGlobal.canvasObj.style.height)/LGlobal.canvasObj.height;LGlobal.inputTextBox.style.display="";LGlobal.inputTextBox.value=s.text;LGlobal.inputTextBox.style.height=s.inputBackLayer.getHeight()*sc.scaleY*s.scaleY*sy+"px";LGlobal.inputTextBox.style.width=s.inputBackLayer.getWidth()*sc.scaleX*s.scaleX*sx+"px";LGlobal.inputTextBox.style.color=s.color;LGlobal.inputTextBox.style.fontSize=((s.size*parseFloat(LGlobal.canvasObj.style.height)/LGlobal.canvasObj.height)>>0)+"px";LGlobal.inputTextBox.style.fontFamily=s.font;LEvent.addEventListener(LGlobal.inputTextBox,LKeyboardEvent.KEY_DOWN,LGlobal.inputTextField._ll_input);if(s.texttype==LTextFieldType.INPUT){rc=s.getRootCoordinate();if(LGlobal.inputBox.name=="input"+s.objectIndex){LGlobal.inputBox.style.marginTop=(parseInt(LGlobal.canvasObj.style.marginTop)+(((rc.y+s.inputBackLayer.startY())*parseInt(LGlobal.canvasObj.style.height)/LGlobal.canvasObj.height)>>>0))+"px";LGlobal.inputBox.style.marginLeft=(parseInt(LGlobal.canvasObj.style.marginLeft)+(((rc.x+s.inputBackLayer.startX())*parseInt(LGlobal.canvasObj.style.width)/LGlobal.canvasObj.width)>>>0))+"px";}}setTimeout(function(){LGlobal.inputTextBox.focus();},0);},_getWidth:function(){var s=this;if(s.wordWrap){return s.width;}LGlobal.canvas.font=s.size+"px "+s.font;return LGlobal.canvas.measureText(s.text).width;},getWidth:function(maskSize){var s=this,w,mx,mw;w=s._getWidth()*s.scaleX;if(maskSize&&s.mask){mx=s.mask._startX?s.mask._startX():s.mask.startX();if(mx>w){return 0;}mw=s.mask.getWidth();if(mx+mw>w){return w-mx;}else{return mw;}}return w;},_getHeight:function(){var s=this,c=LGlobal.canvas,i,l,j,k,m,enter;if(s.wordWrap){c.font=s.weight+" "+s.size+"px "+s.font;if(s.height==0){j=0,k=0,m=0;for(i=0,l=s.text.length; i<l; i++){enter=/(?:\r\n|\r|\n|¥n)/.exec(s.text.substr(i,1));if(enter){j=0;k=i+1;m++;}j=c.measureText(s.text.substr(k,i+1-k)).width;if(s.wordWrap&&j+c.measureText(s.text.substr(i+1,1)).width>s.width){j=0;k=i+1;m++;}}s.height=(m+1)*s.wordHeight;}return s.height;}c.font=s.weight+" "+s.size+"px "+s.font;l=c.measureText("O").width*1.2;if(s.heightMode==LTextField.HEIGHT_MODE_BASELINE){l=l*1.2;}return l;},getHeight:function(maskSize){var s=this,h,my,mh;h=s._getHeight()*s.scaleY;if(maskSize&&s.mask){my=s.mask._startY?s.mask._startY():s.mask.startY();if(my>h){return 0;}mh=s.mask.getHeight();if(my+mh>h){return h-my;}else{return mh;}}return h;},wind:function(listener){var s=this;s.wind_over_function=listener;s.windRunning=true;s._ll_wind_text=s.text;s.text="";s._ll_wind_length=0;},_ll_windRun:function(){var s=this;if(s._speedIndex++<s.speed){return;}s._speedIndex=0;if(s._ll_wind_length>s._ll_wind_text.length){s.windRunning=false;if(s.wind_over_function){s.wind_over_function();}s.dispatchEvent(new LEvent(LTextEvent.WIND_COMPLETE));return;}s.text=s._ll_wind_text.substring(0,s._ll_wind_length);s._ll_wind_length++;},die:function(){LMouseEventContainer.removeInputBox(this);}};for(var k in p){LTextField.prototype[k]=p[k];}return LTextField;})();var LBitmap=(function(){function LBitmap(bitmapdata){var s=this;LExtends(s,LDisplayObject,[]);s.type="LBitmap";s.rotateCenter=true;s.bitmapData=bitmapdata;if(s.bitmapData){s.width=s.bitmapData.width;s.height=s.bitmapData.height;}}var p={_canShow:function(){return(this.visible&&this.bitmapData);},_rotateReady:function(){var s=this;if(s.rotate!=0&&s.rotateCenter){s.rotatex=s.getWidth()*0.5;s.rotatey=s.getHeight()*0.5;}else{s.rotatex=s.rotatey=0;}},_coordinate:function(c){},_ll_show:function(c){this.ll_draw(c);},ll_draw:function(c){var s=this;if(LGlobal.fpsStatus){LGlobal.fpsStatus.bitmapData++;}c.drawImage(s.bitmapData.image,s.bitmapData.x,s.bitmapData.y,s.bitmapData.width,s.bitmapData.height,s.x,s.y,s.bitmapData.width,s.bitmapData.height);},clone:function(){var s=this,a=new LBitmap(s.bitmapData.clone());a.copyProperty(s);a.rotateCenter=s.rotateCenter;return a;},ismouseon:function(e,cood){var s=this;if(!e){return false;}if(!s.visible||!s.bitmapData){return false;}if(s.mask){if(!s.mask.parent){s.mask.parent=s.parent;}if(!s.mask.ismouseon(e,cood)){return false;}}return s.ismouseonShapes([{type:LShape.RECT,arg:[0,0,s.bitmapData.width,s.bitmapData.height]}],e.offsetX,e.offsetY);},getWidth:function(maskSize){var s=this,w,mx,mw;w=s.bitmapData!=null?s.bitmapData.width*(s.scaleX>0?s.scaleX:-s.scaleX):0;if(maskSize&&s.mask){mx=s.mask._startX?s.mask._startX():s.mask.startX();if(mx>w){return 0;}mw=s.mask.getWidth();if(mx+mw>w){return w-mx;}else{return mw;}}return w;},getHeight:function(maskSize){var s=this,h,my,mh;h=s.bitmapData!=null?s.bitmapData.height*(s.scaleY>0?s.scaleY:-s.scaleY):0;if(maskSize&&s.mask){my=s.mask._startY?s.mask._startY():s.mask.startY();if(my>h){return 0;}mh=s.mask.getHeight();if(my+mh>h){return h-my;}else{return mh;}}return h;},startX:function(){return this.x;},startY:function(){return this.y;},die:function(){}};for(var k in p){LBitmap.prototype[k]=p[k];}return LBitmap;})();var LBitmapData=(function(){function LBitmapData(image,x,y,width,height,dataType){var s=this;LExtends(s,LObject,[]);s.type="LBitmapData";if(typeof dataType==UNDEFINED){dataType=LBitmapData.DATA_IMAGE;}s.oncomplete=null;s._locked=false;s._setPixel=false;s.x=(x==null?0:x);s.y=(y==null?0:y);s.width=0;s.height=0;s.dataType=null;if(image&&typeof image=="object"){s.image=image;s.dataType=LBitmapData.DATA_IMAGE;s.width=(width==null?s.image.width:width);s.height=(height==null?s.image.height:height);s._setDataType(dataType);}else{s._createCanvas();s.dataType=LBitmapData.DATA_CANVAS;s._canvas.width=s.width=(width?width:1);s._canvas.height=s.height=(height?height:1);if(typeof image=="string"){s._context.fillStyle=image;s._context.fillRect(0,0,s.width,s.height);}else if(typeof image=="number"){var d=s._context.createImageData(s.width,s.height);for(var i=0; i<d.data.length; i+=4){d.data[i+0]=image>>16 & 0xFF;d.data[i+1]=image>>8 & 0xFF;d.data[i+2]=image & 0xFF;d.data[i+3]=255;}s._context.putImageData(d,0,0);}s.image=s._canvas;if(dataType==LBitmapData.DATA_IMAGE){s._setDataType(dataType);}}s.resize();}LBitmapData.DATA_IMAGE="data_image";LBitmapData.DATA_CANVAS="data_canvas";var p={_setDataType:function(dataType){var s=this;if(s.dataType==dataType){return;}if(dataType==LBitmapData.DATA_CANVAS){s._createCanvas();s._canvas.width=s.image.width;s._canvas.height=s.image.height;s._context.clearRect(0,0,s._canvas.width,s._canvas.height);s._context.drawImage(s.image,0,0);s.image=s._canvas;}else if(dataType==LBitmapData.DATA_IMAGE){s.image=new Image();s.image.width=s._canvas.width;s.image.height=s._canvas.height;s.image.src=s._canvas.toDataURL();}s.dataType=dataType;},_createCanvas:function(){var s=this;if(!s._canvas){s._canvas=document.createElement("canvas");s._context=s._canvas.getContext("2d");}},clear:function(rectangle){var s=this;s._createCanvas();if(rectangle){s._context.clearRect(rectangle.x,rectangle.y,rectangle.width,rectangle.height);}else{s._canvas.width=s.image.width;}if(s.dataType==LBitmapData.DATA_IMAGE){s.image.src=s._canvas.toDataURL();}},setProperties:function(x,y,width,height){var s=this;s.x=x;s.y=y;s.width=width;s.height=height;s.resize();},setCoordinate:function(x,y){var s=this;s.x=x;s.y=y;s.resize();},clone:function(){var s=this;return new LBitmapData(s.image,s.x,s.y,s.width,s.height,s.dataType);},_ready:function(){var s=this;s._dataType=s.dataType;s._setDataType(LBitmapData.DATA_CANVAS);s._data=s._context.getImageData(s.x,s.y,s.width,s.height);},_update:function(){var s=this;s._context.putImageData(s._data,s.x,s.y,0,0,s.width,s.height);s._setDataType(s._dataType);s._data=null;},applyFilter:function(sourceBitmapData,sourceRect,destPoint,filter,c){var s=this;var r=s._context.getImageData(s.x+sourceRect.x,s.y+sourceRect.y,sourceRect.width,sourceRect.height);var data=filter.filter(r,sourceRect.width,c);s.putPixels(new LRectangle(destPoint.x,destPoint.y,sourceRect.width,sourceRect.height),data);},getPixel:function(x,y,colorType){var s=this,i,d;x=x>>0;y=y>>0;if(!s._locked){s._ready();}i=s.width*4*y+x*4;d=s._data.data;if(!s._locked){s._update();}if(colorType=="number"){return d[i]<<16 | d[i+1]<<8 | d[i+2];}else{return [d[i],d[i+1],d[i+2],d[i+3]];}},setPixel:function(x,y,data){var s=this;x=x>>0;y=y>>0;if(!s._locked){s._ready();}var d=s._data,i=s.width*4*y+x*4;if(typeof data=="object"){d.data[i+0]=data[0];d.data[i+1]=data[1];d.data[i+2]=data[2];d.data[i+3]=data[3];}else{if(typeof data=="string"){data=parseInt(data.replace("#","0x"));}d.data[i+0]=data>>16 & 0xFF;d.data[i+1]=data>>8 & 0xFF;d.data[i+2]=data & 0xFF;d.data[i+3]=255;}if(!s._locked){s._update();}},getPixels:function(rect){var s=this,r;if(!s._locked){s._ready();}r=s._context.getImageData(s.x+rect.x,s.y+rect.y,rect.width,rect.height);if(!s._locked){s._update();}return r;},setPixels:function(rect,data){var s=this,i,j,d,w,sd,x,y;if(!s._locked){s._ready();}d=s._data;if(typeof data=="object"){w=s._canvas.width;for(x=rect.x; x<rect.right; x++){for(y=rect.y; y<rect.bottom; y++){i=w*4*(s.y+y)+(s.x+x)*4;j=data.width*4*(y-rect.y)+(x-rect.x)*4;d.data[i+0]=data.data[j+0];d.data[i+1]=data.data[j+1];d.data[i+2]=data.data[j+2];d.data[i+3]=data.data[j+3];}}}else{if(typeof data=="string"){data=parseInt(data.replace("#","0x"));}data=[data>>16 & 0xFF,data>>8 & 0xFF,data & 0xFF];w=s._canvas.width;for(x=rect.x; x<rect.right; x++){for(y=rect.y; y<rect.bottom; y++){i=w*4*(s.y+y)+(s.x+x)*4;d.data[i+0]=data[0];d.data[i+1]=data[1];d.data[i+2]=data[2];d.data[i+3]=255;}}}if(!s._locked){s._update();}},putPixels:function(rect,data){var s=this;if(s.dataType!=LBitmapData.DATA_CANVAS||typeof data!="object"){return;}s._context.putImageData(data,s.x+rect.x,s.y+rect.y,0,0,rect.width,rect.height);},lock:function(){var s=this;s._locked=true;s._ready();},unlock:function(){var s=this;s._locked=false;s._update();},draw:function(source,matrix,colorTransform,blendMode,clipRect){var s=this,c,bd=source,x,y,w,h,save=false;var _dataType=s.dataType;s._setDataType(LBitmapData.DATA_CANVAS);if(matrix||colorTransform||blendMode||clipRect){s._context.save();save=true;}if(clipRect){if(!(bd instanceof LBitmapData)){x=y=0;}else{x=bd.x;y=bd.y;}bd=new LBitmapData(bd.getDataCanvas(),x+clipRect.x,y+clipRect.y,clipRect.width,clipRect.height,LBitmapData.DATA_CANVAS);}w=bd.getWidth()>>>0;h=bd.getHeight()>>>0;if(w==0||h==0){s._setDataType(_dataType);return;}c=bd.getDataCanvas();if(colorTransform){bd.colorTransform(new LRectangle(0,0,w,h),colorTransform);c=bd.image;}if(matrix){s._context.setTransform(matrix.a,matrix.b,matrix.c,matrix.d,matrix.tx,matrix.ty);}if(blendMode){s._context.globalCompositeOperation=blendMode;}s._context.drawImage(c,bd.x,bd.y,w,h,0,0,w,h);if(save){s._context.restore();}s._setDataType(_dataType);s.resize();},getDataCanvas:function(){var s=this;var _dataType=s.dataType;s._setDataType(LBitmapData.DATA_CANVAS);s._setDataType(_dataType);return s._canvas;},getWidth:function(){return this.width;},getHeight:function(){return this.height;},resize:function(){var s=this,w=s.image.width-s.x,h=s.image.height-s.y;s.width=s.width<w?s.width:w;s.height=s.height<h?s.height:h;},colorTransform:function(rect,colorTransform){var s=this;if(s.dataType!=LBitmapData.DATA_CANVAS){return;}var x=rect.x>>0,y=rect.y>>0,w=rect.width>>0,h=rect.height>>0;var img=s._context.getImageData(s.x+rect.x,s.y+rect.y,rect.width,rect.height);var data=img.data;for(var i=0,l=data.length; i<l; i+=4){var r=i,g=i+1,b=i+2,a=i+3;data[r]=data[r]*colorTransform.redMultiplier+colorTransform.redOffset;data[g]=data[g]*colorTransform.greenMultiplier+colorTransform.greenOffset;data[b]=data[b]*colorTransform.blueMultiplier+colorTransform.blueOffset;data[a]=data[a]*colorTransform.alphaMultiplier+colorTransform.alphaOffset;}s._context.putImageData(img,s.x+rect.x,s.y+rect.y,0,0,rect.width,rect.height);},copyPixels:function(sourceBitmapData,sourceRect,destPoint){var s=this,left,top,width,height,bd=sourceBitmapData;if(s.dataType!=LBitmapData.DATA_CANVAS){return;}left=bd.x;top=bd.y;width=bd.width;height=bd.height;bd.setProperties(sourceRect.x+bd.x,sourceRect.y+bd.y,sourceRect.width,sourceRect.height);s._context.drawImage(bd.image,bd.x,bd.y,bd.width,bd.height,destPoint.x,destPoint.y,bd.width,bd.height);bd.x=left;bd.y=top;bd.width=width;bd.height=height;}};for(var k in p){LBitmapData.prototype[k]=p[k];}return LBitmapData;})();var LBitmapFilter=(function(){function LBitmapFilter(){var s=this;LExtends(s,LObject,[]);s.type="LBitmapFilter";}LBitmapFilter.prototype.ll_show=function(displayObject,c){var s=this;if(s.cacheMaking){return;}c=c||LGlobal.canvas;var d=displayObject,bitmapData;if(d.constructor.name=="LBitmap"){bitmapData=d.bitmapData;}else{if(!d._ll_cacheAsBitmap){s.cacheMaking=true;d.cacheAsBitmap(true);s.cacheMaking=false;}bitmapData=d._ll_cacheAsBitmap.bitmapData;}if(s.bitmapDataIndex===bitmapData.objectIndex){return;}s.bitmapDataIndex=bitmapData.objectIndex;bitmapData.applyFilter(bitmapData,new LRectangle(0,0,bitmapData.width,bitmapData.height),new LPoint(0,0),s,c);};return LBitmapFilter;})();var LDropShadowFilter=(function(){function LDropShadowFilter(distance,angle,color,blur){var s=this;LExtends(s,LBitmapFilter,[]);s.type="LDropShadowFilter";s.distance=distance?distance:0;s.angle=angle?angle:0;s.shadowColor=color?color:"#000000";s.shadowBlur=blur?blur:20;s.setShadowOffset();}var p={setShadowOffset:function(){var s=this;var a=s.angle*Math.PI/180;s.shadowOffsetX=s.distance*Math.cos(a);s.shadowOffsetY=s.distance*Math.sin(a);},ll_show:function(o,c){var s=this;c=c||LGlobal.canvas;c.shadowColor=s.shadowColor;c.shadowBlur=s.shadowBlur;c.shadowOffsetX=s.shadowOffsetX;c.shadowOffsetY=s.shadowOffsetY;},setDistance:function(distance){this.distance=distance;this.setShadowOffset();},setAngle:function(angle){this.angle=angle;this.setShadowOffset();},setColor:function(color){this.shadowColor=color;},setBlur:function(blur){this.shadowBlur=blur;}};for(var k in p){LDropShadowFilter.prototype[k]=p[k];}return LDropShadowFilter;})();var LColorMatrixFilter=(function(){function LColorMatrixFilter(matrix){var s=this;LExtends(s,LBitmapFilter,[]);s.type="LColorMatrixFilter";s.matrix=matrix;}var p={filter:function(olddata,w,c){var s=this;c=c||LGlobal.canvas;var oldpx=olddata.data;var newdata=c.createImageData(olddata);var newpx=newdata.data;var len=newpx.length;var a=s.matrix;for(var i=0; i<len; i+=4){newpx[i]=(a[0]*oldpx[i])+(a[1]*oldpx[i+1])+(a[2]*oldpx[i+2])+(a[3]*oldpx[i+3])+a[4];newpx[i+1]=(a[5]*oldpx[i])+(a[6]*oldpx[i+1])+(a[7]*oldpx[i+2])+(a[8]*oldpx[i+3])+a[9];newpx[i+2]=(a[10]*oldpx[i])+(a[11]*oldpx[i+1])+(a[12]*oldpx[i+2])+(a[13]*oldpx[i+3])+a[14];newpx[i+3]=(a[15]*oldpx[i])+(a[16]*oldpx[i+1])+(a[17]*oldpx[i+2])+(a[18]*oldpx[i+3])+a[19];}return newdata;}};for(var k in p){LColorMatrixFilter.prototype[k]=p[k];}return LColorMatrixFilter;})();var LConvolutionFilter=(function(){function LConvolutionFilter(matrixX,matrixY,matrix,divisor,bias,preserveAlpha,clamp,color,alpha){var s=this;LExtends(s,LBitmapFilter,[]);s.type="LConvolutionFilter";s.matrixX=matrixX?matrixX:0;s.matrixY=matrixY?matrixY:0;s.matrix=matrix;if(!divisor){divisor=matrix.reduce(function(a,b){return a+b;})||1;}s.divisor=divisor;s.bias=bias?bias:0;}var p={filter:function(olddata,w,c){var s=this;c=c||LGlobal.canvas;var oldpx=olddata.data;var newdata=c.createImageData(olddata);var newpx=newdata.data;var len=newpx.length;for(var i=0; i<len; i++){if((i+1)% 4===0){newpx[i]=oldpx[i];continue;}res=0;var these=[oldpx[i-w*4-4]||oldpx[i],oldpx[i-w*4]||oldpx[i],oldpx[i-w*4+4]||oldpx[i],oldpx[i-4]||oldpx[i],oldpx[i],oldpx[i+4]||oldpx[i],oldpx[i+w*4-4]||oldpx[i],oldpx[i+w*4]||oldpx[i],oldpx[i+w*4+4]||oldpx[i]];for(var j=0; j<9; j++){res+=these[j]*s.matrix[j];}res/=s.divisor;if(s.bias){res+=s.bias;}newpx[i]=res;}return newdata;}};for(var k in p){LConvolutionFilter.prototype[k]=p[k];}return LConvolutionFilter;})();var LAnimation=(function(){function LAnimation(layer,data,list){var s=this;LExtends(s,LSprite,[]);s.type="LAnimation";s.rowIndex=0;s.colIndex=0;s._ll_stepIndex=0;s._ll_stepArray=[];s.mode=1;s.isMirror=false;if(Array.isArray(data)){s.bitmapList=data;}else{s.bitmapList=[data];}s.bitmap=new LBitmap(s.bitmapList[0]);s.imageArray=list;s.addChild(s.bitmap);if(layer!=null){layer.addChild(s);}s.onframe();s.colIndex=0;}var p={setAction:function(rowIndex,colIndex,mode,isMirror){var s=this,changed=false;if(rowIndex!=null&&rowIndex>=0&&rowIndex<s.imageArray.length){s.rowIndex=rowIndex;changed=true;}if(colIndex!=null&&colIndex>=0&&colIndex<s.imageArray[rowIndex].length){s.colIndex=colIndex;changed=true;}if(mode!=null){s.mode=mode;changed=true;}if(isMirror!=null){s.isMirror=isMirror;if(s.isMirror){s.bitmap.x=s.bitmap.getWidth();s.bitmap.scaleX=-1*Math.abs(s.bitmap.scaleX);}else{s.bitmap.x=0;s.bitmap.scaleX=Math.abs(s.bitmap.scaleX);}changed=true;}if(changed){s._ll_stepIndex=0;s._send_complete=false;}},getAction:function(){var s=this;return [s.rowIndex,s.colIndex,s.mode,s.isMirror];},onframe:function(){var s=this,arr,sx=0,stepFrame=null;if(s.colIndex>=s.imageArray[s.rowIndex].length){s.colIndex=0;}arr=s.imageArray[s.rowIndex][s.colIndex];if(s._ll_stepArray[s.rowIndex]&&s._ll_stepArray[s.rowIndex][s.colIndex]){stepFrame=s._ll_stepArray[s.rowIndex][s.colIndex];}else{stepFrame=0;}if(s._ll_stepIndex==0){if(typeof arr.dataIndex=="number"&&Array.isArray(s.bitmapList)&&arr.dataIndex<s.bitmapList.length){s.bitmap.bitmapData=s.bitmapList[arr.dataIndex];}if(arr.script){for(i=0; i<arr.script.length; i++){obj=arr.script[i];l=s.ll_labelList[obj.name];if(l&&l.rowIndex==s.rowIndex&&l.colIndex==s.colIndex&&l.mode==s.mode&&l.isMirror==(s.bitmap.scaleX==-1)){obj.func(s,obj.params);}}}if(typeof arr.width!=UNDEFINED&&typeof arr.height!=UNDEFINED){s.bitmap.bitmapData.setProperties(arr.x,arr.y,arr.width,arr.height);}else{s.bitmap.bitmapData.setCoordinate(arr.x,arr.y);}if(typeof arr.sx!=UNDEFINED){sx=arr.sx;}if(typeof arr.sy!=UNDEFINED){s.bitmap.y=arr.sy;}if(typeof arr.mirror!=UNDEFINED){s.bitmap.rotateCenter=false;s.bitmap.scaleX=arr.mirror?-1:1;}s.bitmap.x=sx+(s.bitmap.scaleX==1?0:s.bitmap.getWidth());}if(s._ll_stepIndex++<stepFrame){return;}s._ll_stepIndex=0;s.colIndex+=s.mode;if(s.colIndex>=s.imageArray[s.rowIndex].length||s.colIndex<0){s.colIndex=s.mode>0?0:s.imageArray[s.rowIndex].length-1;if(s.constructor.name=="LAnimationTimeline"){s._send_complete=true;}else{s.dispatchEvent(LEvent.COMPLETE);}}},clone:function(){var s=this,a=new s.constructor(null,s.bitmapList,s.imageArray.slice(0));a.copyProperty(s);a.childList.length=0;a.bitmap=s.bitmap.clone();a.addChild(a.bitmap);return a;}};for(var k in p){LAnimation.prototype[k]=p[k];}return LAnimation;})();var LAnimationTimeline=(function(){function LAnimationTimeline(data,list){var s=this;LExtends(s,LAnimation,[null,data,list]);s.type="LAnimationTimeline";s.speed=0;s._speedIndex=0;s.ll_labelList={};for(var i=0,sublist,j,child; i<list.length; i++){sublist=list[i];for(j=0; j<sublist.length; j++){child=sublist[j];if(child.label){s.setLabel(child.label,i,j,1,child.isMirror?true:false);}}}s.addEventListener(LEvent.ENTER_FRAME,s._ll_onframe);};var p={clone:function(){var s=this,k,o,a=new s.constructor(s.bitmapList,s.imageArray.slice(0));a.copyProperty(s);a.childList.length=0;a.bitmap=s.bitmap.clone();a.addChild(a.bitmap);for(k in s.ll_labelList){o=s.ll_labelList[k];a.ll_labelList[k]={rowIndex:o.rowIndex,colIndex:o.colIndex,mode:o.mode,isMirror:o.isMirror};}return a;},setFrameSpeedAt:function(rowIndex,colIndex,speed){var s=this;if(!s._ll_stepArray[rowIndex]){s._ll_stepArray[rowIndex]=[];}s._ll_stepArray[rowIndex][colIndex]=speed;},_ll_onframe:function(event){var self=event.target;if(self._ll_stop){return;}if(self._speedIndex++<self.speed){return;}if(self._send_complete){self.dispatchEvent(LEvent.COMPLETE);self._send_complete=false;if(self._ll_stop){return;}}self._speedIndex=0;self.onframe();},setLabel:function(name,_rowIndex,_colIndex,_mode,_isMirror){this.ll_labelList[name]={rowIndex:_rowIndex,colIndex:_colIndex,mode:(typeof _mode==UNDEFINED?1:_mode),isMirror:(typeof _isMirror==UNDEFINED?false:_isMirror)};},play:function(){this._ll_stop=false;},stop:function(){this._ll_stop=true;},gotoAndPlay:function(name){var s=this,l=s.ll_labelList[name];s.setAction(l.rowIndex,l.colIndex,l.mode,l.isMirror);s.play();s.onframe();},gotoAndStop:function(name){var s=this,l=s.ll_labelList[name];s.setAction(l.rowIndex,l.colIndex,l.mode,l.isMirror);s.stop();s.onframe();},addFrameScript:function(name,func,params){var l=this.ll_labelList[name];var arr=this.imageArray[l.rowIndex][l.colIndex];if(!arr.script){arr.script=[];}arr.script.push({func:func,params:params,name:name});},removeFrameScript:function(name){var l=this.ll_labelList[name],obj,script,i;script=this.imageArray[l.rowIndex][l.colIndex].script;if(!script){return;}for(i=0; i<script.length; i++){obj=script[i];if(obj.name==name){script.splice(i,1);break;}}}};for(var k in p){LAnimationTimeline.prototype[k]=p[k];}return LAnimationTimeline;})();var LLoadManage=(function(){function LLoadManage(){var s=this;LExtends(s,LEventDispatcher,[]);s.llname="ll.file.";s.llload="ll.load.";}p={load:function(l,u,c){var s=this;if(!l||l.length==0){var event=new LEvent(LEvent.COMPLETE);event.currentTarget=s;event.target={};s.dispatchEvent(event);return;}s.list=l,s.onupdate=u,s.oncomplete=c;s.loader=s,s.index=0,s.loadIndex=0,s.result=[],s.lresult=[];s.loadInit();},loadInit:function(){var s=this;if(s.index>=s.list.length){return;}s.loadIndex=0;s.loadStart();},loadStart:function(){var s=this,d,ph,phs,ext;if(s.loadIndex>=s.list.length){return;}d=s.list[s.loadIndex];d.progress=0;if(!d.name){d.name=s.llname+s.loadIndex;}if(!s.lresult[s.llload+d.name]){if(!d["type"]){ext=getExtension(d.path);if(ext=="txt"){d["type"]=LURLLoader.TYPE_TEXT;}else if(ext=="js"){d["type"]=LURLLoader.TYPE_JS;}else if((new Array("mp3","ogg","wav","m4a")).indexOf(ext)>=0){d["type"]=LSound.TYPE_SOUND;}}if(d["type"]==LURLLoader.TYPE_TEXT||d["type"]==LURLLoader.TYPE_JS){s.loader=new LURLLoader();s.loader.parent=s;s.loader.name=d.name;s.loader.addEventListener(LEvent.PROGRESS,s._loadProgress);s.loader.addEventListener(LEvent.ERROR,s._loadError);s.loader.addEventListener(LEvent.COMPLETE,s._loadComplete);s.loader.load(s.url(d.path),d["type"]);}else if(d["type"]==LSound.TYPE_SOUND){s.loader=new LSound();s.loader.parent=s;s.loader.name=d.name;s.loader.addEventListener(LEvent.PROGRESS,s._loadProgress);s.loader.addEventListener(LEvent.ERROR,s._loadError);s.loader.addEventListener(LEvent.COMPLETE,s._loadComplete);s.loader.load(d.path);}else if(d["type"]==LFontLoader.TYPE_FONT){s.loader=new LFontLoader();s.loader.parent=s;s.loader.name=d.name;s.loader.addEventListener(LEvent.ERROR,s._loadError);s.loader.addEventListener(LEvent.COMPLETE,s._loadComplete);s.loader.load(d.path,d.name);}else{s.loader=new LLoader();s.loader.parent=s;s.loader.name=d.name;s.loader.addEventListener(LEvent.PROGRESS,s._loadProgress);s.loader.addEventListener(LEvent.ERROR,s._loadError);s.loader.addEventListener(LEvent.COMPLETE,s._loadComplete);s.loader.load(s.url(d.path),LLoader.TYPE_BITMAPDATE,d.useXHR);}s.loader._loadIndex=s.loadIndex;}s.loadIndex++;s.loadStart();},_loadProgress:function(e){var loader=e.currentTarget;var s=loader.parent;d=s.list[loader._loadIndex];d.progress=e.loaded/e.total;var progress=0;for(var i=0,l=s.list.length;i<l;i++){progress+=s.list[i].progress;}var event=new LEvent(LEvent.PROGRESS);event.currentTarget=s;event.target=e.currentTarget;event.loaded=progress;event.total=s.list.length;event.responseURL=e.responseURL;s.dispatchEvent(event);},_loadError:function(e){var loader=e.currentTarget;var s=loader.parent;delete loader.parent;loader.removeEventListener(LEvent.ERROR,s._loadError);var event=new LEvent(LEvent.ERROR);event.currentTarget=s;event.target=e.target;event.responseURL=e.responseURL;s.dispatchEvent(event);},_loadComplete:function(e){var s=e.currentTarget.parent;if(!s){return;}if(e&&e.currentTarget.name){e.currentTarget.removeEventListener(LEvent.COMPLETE,s._loadComplete);if(e.currentTarget.name.indexOf(s.llname)>=0){e.target=1;}if(s.lresult[s.llload+e.currentTarget.name]){return;}s.result[e.currentTarget.name]=e.target;s.lresult[s.llload+e.currentTarget.name]=1;}s.index++;e.loaded=e.total=1;s._loadProgress(e);delete e.currentTarget.parent;if(s.index>=s.list.length){var event=new LEvent(LEvent.COMPLETE);event.currentTarget=s;event.target=s.result;s.dispatchEvent(event);LGlobal.forceRefresh=true;}},url:function(u){if(!LGlobal.traceDebug){return u;}return u+(u.indexOf('?')>=0?'&':'?')+'t='+(new Date()).getTime();}};for(var k in p){LLoadManage.prototype[k]=p[k];}LLoadManage.load=function(l,u,c,e){var loadObj=new LLoadManage();if(u){loadObj.addEventListener(LEvent.PROGRESS,function(event){u((event.loaded*100/event.total).toFixed(2));});}if(c){loadObj.addEventListener(LEvent.COMPLETE,function(event){c(event.target);});}if(e){loadObj.addEventListener(LEvent.ERROR,e);}loadObj.load(l);};return LLoadManage;})();var LEasing={None:{easeIn:function(t,b,c,d){return b+t*c/d;},easeOut:function(t,b,c,d){return b+t*c/d;},easeInOut:function(t,b,c,d){return b+t*c/d;}},Quad:{easeIn:function(t,b,c,d){return c*(t/=d)*t+b;},easeOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b;}return-c/2*((--t)*(t-2)-1)+b;}},Cubic:{easeIn:function(t,b,c,d){return c*(t/=d)*t*t+b;},easeOut:function(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;},easeInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t+b;}return c/2*((t-=2)*t*t+2)+b;}},Quart:{easeIn:function(t,b,c,d){return c*(t/=d)*t*t*t+b;},easeOut:function(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;},easeInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t+b;}return-c/2*((t-=2)*t*t*t-2)+b;}},Quint:{easeIn:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b;},easeOut:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;},easeInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b;}return c/2*((t-=2)*t*t*t*t+2)+b;}},Sine:{easeIn:function(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;},easeOut:function(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;},easeInOut:function(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;}},Strong:{easeIn:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b;},easeOut:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;},easeInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b;}return c/2*((t-=2)*t*t*t*t+2)+b;}},Expo:{easeIn:function(t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b;},easeOut:function(t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},easeInOut:function(t,b,c,d){if(t==0){return b;}if(t==d){return b+c;}if((t/=d/2)<1){return c/2*Math.pow(2,10*(t-1))+b;}return c/2*(-Math.pow(2,-10*--t)+2)+b;}},Circ:{easeIn:function(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;},easeOut:function(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;},easeInOut:function(t,b,c,d){if((t/=d/2)<1){return-c/2*(Math.sqrt(1-t*t)-1)+b;}return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;}},Elastic:{easeIn:function(t,b,c,d,a,p){var s;if(t==0){return b;}if((t/=d)==1){return b+c;}if(!p){p=d*.3;}if(!a||a<Math.abs(c)){a=c;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(c/a);}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;},easeOut:function(t,b,c,d,a,p){var s;if(t==0){return b;}if((t/=d)==1){return b+c;}if(!p){p=d*.3;}if(!a||a<Math.abs(c)){a=c;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(c/a);}return(a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b);},easeInOut:function(t,b,c,d,a,p){var s;if(t==0){return b;}if((t/=d/2)==2){return b+c;}if(!p){p=d*(.3*1.5);}if(!a||a<Math.abs(c)){a=c;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(c/a);}if(t<1){return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b;}},Back:{easeIn:function(t,b,c,d,s){if(typeof s==UNDEFINED){s=1.70158;}return c*(t/=d)*t*((s+1)*t-s)+b;},easeOut:function(t,b,c,d,s){if(typeof s==UNDEFINED){s=1.70158;}return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},easeInOut:function(t,b,c,d,s){if(typeof s==UNDEFINED){s=1.70158;}if((t/=d/2)<1){return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;}return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;}},Bounce:{easeIn:function(t,b,c,d){return c-LEasing.Bounce.easeOut(d-t,0,c,d)+b;},easeOut:function(t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b;}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b;}else{return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b;}},easeInOut:function(t,b,c,d){if(t<d/2){return LEasing.Bounce.easeIn(t*2,0,c,d)*.5+b;}return LEasing.Bounce.easeOut(t*2-d,0,c,d)*.5+c*.5+b;}}};var Quad=LEasing.Quad,Cubic=LEasing.Cubic,Quart=LEasing.Quart,Quint=LEasing.Quint,Sine=LEasing.Sine,Strong=LEasing.Strong,Expo=LEasing.Expo,Circ=LEasing.Circ,Elastic=LEasing.Elastic,Back=LEasing.Back,Bounce=LEasing.Bounce;var LTweenLiteTimeline;var LTweenLite=(function(){function LTweenLiteChild($target,$duration,$vars){var s=this;LExtends(s,LObject,[]);s.type="LTweenLiteChild";s.toNew=[];s.init($target,$duration,$vars);}var p={init:function($target,$duration,$vars){var s=this,k=null;if(typeof $vars["tweenTimeline"]==UNDEFINED){$vars["tweenTimeline"]=LTweenLite.TYPE_FRAME;}s.target=$target;s.duration=$duration||0.001;s.vars=$vars;s.delay=s.vars.delay||0;if(s.vars["tweenTimeline"]==LTweenLite.TYPE_TIMER){s.currentTime=(new Date()).getTime()/1000;s.initTime=s.currentTime;s.startTime=s.initTime+s.delay;}else{s.currentTime=0;s.duration*=1000;s.currentTime-=s.delay*1000;}s.combinedTimeScale=s.vars.timeScale||1;s.active=s.duration==0&&s.delay==0;s.varsto={};s.varsfrom={};s.varsDiff={};s.varsListIndex={};s.varsListCurr={};s.varsListTo={};s.varsListLength={};s.stop=false;if(typeof(s.vars.ease)!="function"){s.vars.ease=LEasing.None.easeIn;}s.ease=s.vars.ease;delete s.vars.ease;if(s.vars.onComplete){s.onComplete=s.vars.onComplete;delete s.vars.onComplete;}if(s.vars.onUpdate){s.onUpdate=s.vars.onUpdate;delete s.vars.onUpdate;}if(s.vars.onStart){s.onStart=s.vars.onStart;delete s.vars.onStart;}for(k in s.vars){if(k=="coordinate"&&Array.isArray(s.vars[k])){var diff=0,curr={x:s.target.x,y:s.target.y};for(var i=0,l=s.vars[k].length; i<l; i++){var p=s.vars[k][i];diff+=LPoint.distance(p,curr);curr=p;}s.varsListIndex[k]=0;s.varsListCurr[k]=0;s.varsListTo[k]=diff;s.varsto[k]=s.vars[k];s.varsfrom[k]={x:s.target.x,y:s.target.y};continue;}else if(typeof s.vars[k]!="number"){continue;}s.varsto[k]=s.vars[k];s.varsfrom[k]=s.target[k];s.varsDiff[k]=s.vars[k]-s.target[k];}},pause:function(){this.stop=true;},resume:function(){this.stop=false;},tween:function(){var s=this,tweentype;var type_timer=(s.vars["tweenTimeline"]==LTweenLite.TYPE_TIMER);if(type_timer){var time=(new Date()).getTime()/1000,etime=time-s.startTime;if(etime<0){return;}}else{if(s.stop){return;}s.currentTime+=LGlobal.speed;if(s.currentTime<0){return;}}for(k in s.varsto){if(typeof s.varsListTo[k]!=UNDEFINED){var curr=s.ease(type_timer?etime:s.currentTime,0,s.varsListTo[k],s.duration);if(curr>s.varsListTo[k]){curr=s.varsListTo[k];}var c=s.varsListIndex[k]>0?s.vars[k][s.varsListIndex[k]-1]:s.varsfrom[k];var v=s.vars[k][s.varsListIndex[k]];var d=LPoint.distance(c,v);while(s.varsListCurr[k]+d<curr){s.varsListCurr[k]+=d;c=v;s.varsListIndex[k]++;v=s.vars[k][s.varsListIndex[k]];d=LPoint.distance(c,v);}s.target.x=c.x;s.target.y=c.y;if(d!=0&&v.x-c.x!=0){s.target.x+=(v.x-c.x)*(curr-s.varsListCurr[k])/d;}if(d!=0&&v.y-c.y!=0){s.target.y+=(v.y-c.y)*(curr-s.varsListCurr[k])/d;}continue;}s.target[k]=s.ease(type_timer?etime:s.currentTime,s.varsfrom[k],s.varsDiff[k],s.duration);}if(s.onStart){s._dispatchEvent(s.onStart);delete s.onStart;}var e;if(type_timer){e=(etime>=s.duration);}else{e=(s.currentTime>=s.duration);}if(e){for(tweentype in s.varsto){if(typeof s.varsListTo[tweentype]!=UNDEFINED){var p=s.varsto[tweentype][s.vars[tweentype].length-1];s.target.x=p.x;s.target.y=p.y;continue;}s.target[tweentype]=s.varsto[tweentype];}if(s.onComplete){s._dispatchEvent(s.onComplete);}return true;}else if(s.onUpdate){s._dispatchEvent(s.onUpdate);}return false;},_dispatchEvent:function(f){var s=this;s.target.target=s.target;s.target.currentTarget=s;f(s.target);delete s.target.currentTarget;delete s.target.target;},to:function($target,$duration,$vars,$data){var s=this;s.toNew.push({target:$target,duration:$duration,vars:$vars,data:$data});return s;},keep:function(){var s=this,t,vs,k,d;if(s.toNew.length>0){t=s.toNew.shift();if(t.vars.loop){s.loop=true;}if(s.loop){d={};vs={};for(k in t.vars){vs[k]=t.vars[k];if(typeof t.target[k]==UNDEFINED||t.vars.playStyle!=LTweenLite.PlayStyle.Init){continue;}if(t.data){t.target[k]=t.data[k];continue;}d[k]=t.target[k];}if(!t.data){t.data=d;}s.to(t.target,t.duration,vs,t.data);}s.init(t.target,t.duration,t.vars);return true;}return false;}};for(var k in p){LTweenLiteChild.prototype[k]=p[k];}function LTweenLite(){var s=this;LExtends(s,LObject,[]);s.type="LTweenLite";s.tweens=[];}LTweenLite.PlayStyle={None:"none",Init:"init"};LTweenLite.TYPE_FRAME="type_frame";LTweenLite.TYPE_TIMER="type_timer";p={count:function(){return this.tweens.length;},ll_show:function(){var s=this;var i,length=s.tweens.length,t;for(i=0; i<length; i++){t=s.tweens[i];if(t&&t.tween&&t.tween()){s.tweens.splice(i,1);i--;length=s.tweens.length;if(t.keep()){s.add(t);}}}},to:function($target,$duration,$vars){if(!$target){return;}var s=this;var tween=new LTweenLiteChild({},0,{});s.tweens.push(tween);tween.to($target,$duration,$vars);return tween;},add:function(tween){this.tweens.push(tween);},remove:function(tween){var s=this;if(typeof tween==UNDEFINED){return;}for(var i=0,l=s.tweens.length; i<l; i++){if(tween.objectIndex==s.tweens[i].objectIndex){s.tweens.splice(i,1);break;}}},removeAll:function(){this.tweens.splice(0,this.tweens.length);},pauseAll:function(){for(var i=0,l=this.tweens.length; i<l; i++){this.tweens[i].pause();}},resumeAll:function(){for(var i=0,l=this.tweens.length; i<l; i++){this.tweens[i].resume();}}};for(var k in p){LTweenLite.prototype[k]=p[k];}LTweenLiteTimeline=new LTweenLite();LGlobal.childList.push(LTweenLiteTimeline);var tween=new LTweenLite();tween.TYPE_FRAME=LTweenLite.TYPE_FRAME;tween.TYPE_TIMER=LTweenLite.TYPE_TIMER;tween.PlayStyle=LTweenLite.PlayStyle;LGlobal.childList.push(tween);return tween;})();var LAjax=(function(){function LAjax(){this.responseType=null;window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;this.canUseBlob=window.Blob||window.BlobBuilder;var protocol=location.protocol;this.local=!(protocol=="http:"||protocol=="https:");}LAjax.prototype={TEXT:"text",JSON:"json",ARRAY_BUFFER:"arraybuffer",BLOB:"blob",get:function(url,data,oncomplete,onerror){this.getRequest("GET",url,data,oncomplete,onerror);},post:function(url,data,oncomplete,onerror){this.getRequest("POST",url,data,oncomplete,onerror);},getRequest:function(t,url,d,oncomplete,err){var s=this,k,data="",a="";s.err=err;var ajax=s.getHttp();if(!ajax){return;}if(d){for(k in d){data+=(a+k+"="+d[k]);a="&";}}if(t.toLowerCase()=="get"&&data.length>0){url+=((url.indexOf('?')>=0?'&':'?')+data);data=null;}ajax.onerror=function(e){if(err){err(e);err=null;}};var progress=s.progress;s.progress=null;ajax.addEventListener("progress",function(e){if(e.currentTarget.status==404){if(err){err(e.currentTarget);err=null;}}else if(e.currentTarget.status==200){if(progress){progress(e);}}},false);ajax.open(t,url,true);if(s.responseType){if(s.responseType==s.JSON){try{ajax.responseType=s.responseType;}catch(e){ajax.responseType=s.TEXT;ajax._responseType="json";}}else{ajax.responseType=s.responseType;}s.responseType=s.TEXT;}ajax.setRequestHeader("Content-Type","application/x-www-form-urlencoded");ajax.onreadystatechange=function(e){var request=e.currentTarget;if(request.readyState==4){if(request.status>=200&&request.status<300||request.status===304){if(oncomplete){if(request._responseType==s.JSON){request._responseType=s.TEXT;oncomplete(JSON.parse(request.responseText));}else if(request.responseType==s.ARRAY_BUFFER||request.responseType==s.BLOB||request.responseType==s.JSON){oncomplete(request.response);}else if(request.responseText.length>0){oncomplete(request.responseText);}else{oncomplete(null);}}}else{if(err){err(request);err=null;}}}};ajax.send(data);},getHttp:function(){if(typeof XMLHttpRequest!=UNDEFINED){return new XMLHttpRequest();}try{return new ActiveXObject("Msxml2.XMLHTTP");}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP");}catch(e){if(!this.err){this.err(e);}}}return false;}};return new LAjax();})();var LStageWebView=(function(){function LStageWebView(){var s=this;LExtends(s,LEventDispatcher,[]);s.display=document.createElement("div");s.iframe=document.createElement("iframe");s.display.style.position="absolute";s.display.style.marginTop="0px";s.display.style.marginLeft="0px";s.display.style.zIndex=LStageWebView.START_INDEX++;if(LGlobal.ios){s.display.style.overflow="auto";s.display.style.webkitOverflowScrolling="touch";}s.display.appendChild(s.iframe);s.idAdded=false;}LStageWebView.START_INDEX=11;var p={loadURL:function(u){var s=this;s.iframe.src=u;s.iframe.onload=function(){s.dispatchEvent(LEvent.COMPLETE);};},show:function(){var s=this;if(!s.idAdded){LGlobal.object.appendChild(s.display);s.idAdded=true;}if(s.display.style.display=="none"){s.display.style.display="";}},die:function(){LGlobal.object.removeChild(this.display);this.idAdded=false;},hide:function(){this.display.style.display="none";},setViewPort:function(r){var s=this,sx=parseInt(LGlobal.canvasObj.style.width)/LGlobal.canvasObj.width,sy=parseInt(LGlobal.canvasObj.style.height)/LGlobal.canvasObj.height;s.display.style.marginTop=(parseInt(LGlobal.canvasObj.style.marginTop)+((r.y*sy)>>>0))+"px";s.display.style.marginLeft=(parseInt(LGlobal.canvasObj.style.marginLeft)+((r.x*sx)>>>0))+"px";s.iframe.style.width=s.display.style.width=(r.width*sx>>>0)+"px";s.iframe.style.height=s.display.style.height=(r.height*sy>>>0)+"px";}};for(var k in p){LStageWebView.prototype[k]=p[k];}return LStageWebView;})();var FPS=(function(){function FPS(){var s=this;LExtends(s,LSprite,[]);if(!LGlobal.fpsStatus){LGlobal.fpsStatus={a:0,b:0,c:0,d:0,e:0,bitmapData:0,display:0,transform:0,graphics:0,text:0,reset:function(){this.a=this.bitmapData;this.b=this.display-1;this.c=this.transform-1;this.d=this.graphics-1;this.e=this.text-5;this.bitmapData=0;this.display=0;this.transform=0;this.graphics=0;this.text=0;}};}s.fps=[];s.back=new LShape();s.back.alpha=0.5;s.addChild(s.back);for(var i=0;i<5;i++){var f=new LTextField();f.color="#ffffff";f.y=i*20;s.addChild(f);s.fps.push(f);}s.fpsCount=0;s.fpsTime=(new Date()).getTime();s.addEventListener(LEvent.ENTER_FRAME,s.showFPS);}FPS.prototype.showFPS=function(e){var s=e.currentTarget,t,f;s.fpsCount++;t=(new Date()).getTime();if(t-s.fpsTime<1000)return;s.fps[0].text="FPS:"+Math.round(s.fpsCount*10000/(t-s.fpsTime))/10;f=LGlobal.fpsStatus;s.fps[1].text="DisplayObject:"+f.c+"/"+f.b;s.fps[2].text="Draw image:"+f.a;s.fps[3].text="Draw graphics:"+f.d;s.fps[4].text="Draw text:"+f.e;s.fpsTime=t;s.fpsCount=0;s.back.graphics.clear();s.back.graphics.drawRect(0,"#000000",[0,0,s.fps[1].getWidth(),100],true,"#000000");};FPS.prototype.die=function(){var s=this;LGlobal.fpsStatus=null;s.callParent("die",arguments);};return FPS;})();var LQuadTree=(function(){function LQuadTree(rect){var s=this;LExtends(s,LObject,[]);s.q1=null;s.q2=null;s.q3=null;s.q4=null;s.parent=null;s.data=[];s.rect=rect;s.root=s;}var p={createChildren:function(deep){if(deep==0){return;}var s=this;var hw=s.rect.width/2,hh=s.rect.height/2;s.q1=new LQuadTree(new LRectangle(s.rect.x+hw,s.rect.y,hw,hh));s.q2=new LQuadTree(new LRectangle(s.rect.x+hw,s.rect.y+hh,hw,hh));s.q3=new LQuadTree(new LRectangle(s.rect.x,s.rect.y+hh,hw,hh));s.q4=new LQuadTree(new LRectangle(s.rect.x,s.rect.y,hw,hh));s.q1.parent=s.q2.parent=s.q3.parent=s.q4.parent=s;s.q1.root=s.q2.root=s.q3.root=s.q4.root=s.root;s.q1.createChildren(deep-1);s.q2.createChildren(deep-1);s.q3.createChildren(deep-1);s.q4.createChildren(deep-1);},hasChildren:function(){var s=this;return s.q1&&s.q2&&s.q3&&s.q4;},clear:function(){var s=this;if(s.hasChildren()){return s.q1.clear()||s.q2.clear()||s.q3.clear()||s.q4.clear();}else{s.q1=null;s.q2=null;s.q3=null;s.q4=null;s.parent=null;s.data=[];return s;}},add:function(v,x,y){var s=this;if(!s.isIn(x,y)){return null;}if(s.hasChildren()){return s.q1.add(v,x,y)||s.q2.add(v,x,y)||s.q3.add(v,x,y)||s.q4.add(v,x,y);}else{s.data.push(v);return s;}},remove:function(v,x,y){var s=this;if(!s.isIn(x,y)){return null;}if(s.hasChildren()){return s.q1.remove(v,x,y)||s.q2.remove(v,x,y)||s.q3.remove(v,x,y)||s.q4.remove(v,x,y);}else{var index=s.data.indexOf(v);if(index!=-1){s.data.splice(index,1);return s;}else{return null;}}},isIn:function(x,y){var s=this;return(typeof x==UNDEFINED||(x>=s.rect.x&&x<s.rect.right))&&(typeof y==UNDEFINED||(y>=s.rect.y&&y<s.rect.bottom));},getDataInRect:function(rect){var s=this;if(!s.rect.intersects(rect)){return [];}var r=s.data.concat();if(s.hasChildren()){r.push.apply(r,s.q1.getDataInRect(rect));r.push.apply(r,s.q2.getDataInRect(rect));r.push.apply(r,s.q3.getDataInRect(rect));r.push.apply(r,s.q4.getDataInRect(rect));}return r;}};for(var k in p){LQuadTree.prototype[k]=p[k];}return LQuadTree;})();var LoadingSample1=(function(){function LoadingSample1(step,b,c){base(this,LSprite,[]);var s=this;s.numberList=new Array([1,1,1,1,0,1,1,0,1,1,0,1,1,1,1],[0,1,0,1,1,0,0,1,0,0,1,0,0,1,0],[1,1,1,0,0,1,1,1,1,1,0,0,1,1,1],[1,1,1,0,0,1,1,1,1,0,0,1,1,1,1],[1,0,1,1,0,1,1,1,1,0,0,1,0,0,1],[1,1,1,1,0,0,1,1,1,0,0,1,1,1,1],[1,1,1,1,0,0,1,1,1,1,0,1,1,1,1],[1,1,1,0,0,1,0,0,1,0,0,1,0,0,1],[1,1,1,1,0,1,1,1,1,1,0,1,1,1,1],[1,1,1,1,0,1,1,1,1,0,0,1,1,1,1]);s.backgroundColor=b==null?"#000000":b;s.color=c==null?"#ffffff":c;s.progress=0;s.step=step==null?LGlobal.width*0.5/15:step;s.back=new LSprite();s.addChild(s.back);s.num=new LSprite();s.addChild(s.num);s.num.mask=new LSprite();s.screenX=(LGlobal.width-s.step*15)/2;s.screenY=(LGlobal.height-s.step*5)/2;s.num.x=s.screenX;s.num.y=s.screenY;s.setProgress(s.progress);}LoadingSample1.prototype.setProgress=function(value){var s=this,c=LGlobal.canvas;value=Math.floor(value);var num_0="",num_1,num_2,i;var s_x=s.step;if(value>=100){num_0=s.getNumber(1);num_1=s.getNumber(0);num_2=s.getNumber(0);s_x=s.step*3;}else if(value>=10){num_1=s.getNumber(Math.floor(value/10));num_2=s.getNumber(value % 10);}else{num_1=s.getNumber(0);num_2=s.getNumber(value);}s.back.graphics.clear();s.back.graphics.add(function(){c.beginPath();c.fillStyle=s.backgroundColor;c.fillRect(0,0,LGlobal.width,LGlobal.height);c.closePath();c.fillStyle=s.color;if(value>=100){for(i=0; i<num_0.length; i++){if(num_0[i]==0){continue;}c.fillRect(s.screenX+Math.floor(i % 3)*s.step,s.screenY+Math.floor(i/3)*s.step,s.step,s.step);}}for(i=0; i<num_1.length; i++){if(num_1[i]==0){continue;}c.fillRect(s.screenX+s_x+Math.floor(i % 3)*s.step,s.screenY+Math.floor(i/3)*s.step,s.step,s.step);}for(i=0; i<num_2.length; i++){if(num_2[i]==0){continue;}c.fillRect(s.screenX+s_x+Math.floor(i % 3)*s.step+s.step*4,s.screenY+Math.floor(i/3)*s.step,s.step,s.step);}c.moveTo(s.screenX+s_x+s.step*9.7,s.screenY);c.lineTo(s.screenX+s_x+s.step*10.5,s.screenY);c.lineTo(s.screenX+s_x+s.step*9.3,s.screenY+s.step*5);c.lineTo(s.screenX+s_x+s.step*8.5,s.screenY+s.step*5);c.lineTo(s.screenX+s_x+s.step*9.7,s.screenY);c.fill();c.moveTo(s.screenX+s_x+s.step*8.5,s.screenY+s.step);c.arc(s.screenX+s_x+s.step*8.5,s.screenY+s.step,s.step*0.6,0,360+Math.PI/180);c.moveTo(s.screenX+s_x+s.step*10.5,s.screenY+s.step*4);c.arc(s.screenX+s_x+s.step*10.5,s.screenY+s.step*4,s.step*0.6,0,360+Math.PI/180);c.fill();});s.num.mask.graphics.clear();s.num.mask.graphics.add(function(){if(value>=100){for(i=0; i<num_0.length; i++){if(num_0[i]==0){continue;}c.rect(s.screenX+Math.floor(i % 3)*s.step,s.screenY+Math.floor(i/3)*s.step,s.step,s.step);}}for(var i=0; i<num_1.length; i++){if(num_1[i]==0){continue;}c.rect(s.screenX+s_x+Math.floor(i % 3)*s.step,s.screenY+Math.floor(i/3)*s.step,s.step,s.step);}for(var i=0; i<num_2.length; i++){if(num_2[i]==0){continue;}c.rect(s.screenX+s_x+Math.floor(i % 3)*s.step+s.step*4,s.screenY+Math.floor(i/3)*s.step,s.step,s.step);}});c.fillStyle=LGlobal._create_loading_color();s.num.graphics.clear();s.num.graphics.drawRect(1,c.fillStyle,[0,s.step*5*(100-value)*0.01,LGlobal.width,LGlobal.height],true,c.fillStyle);};LoadingSample1.prototype.getNumber=function(value){return this.numberList[value];};return LoadingSample1;})();function LoadingSample2(size,background,color){base(this,LSprite,[]);var s=this,c=LGlobal.canvas,t="Loading...",l;s.backgroundColor=background==null?"#000000":background;s.graphics.drawRect(1,s.backgroundColor,[0,0,LGlobal.width,LGlobal.height],true,s.backgroundColor);if(color==null)color=LGlobal._create_loading_color();s.color=color;s.progress=0;s.size=size==null?LGlobal.height*0.2:size;l=new LTextField();l.text=t;l.size=s.size;l.color="#ffffff";l.x=(LGlobal.width-l.getWidth())/2;l.y=(LGlobal.height-s.size)/2;s.addChild(l);s.backLabel=l;l=new LTextField();l.text="***%";l.size=s.size*0.3;l.color=color;l.x=(LGlobal.width-l.getWidth())/2;l.y=(LGlobal.height-s.size)/2-s.size*0.4;s.addChild(l);s.progressLabel=l;l=new LTextField();l.text=t;l.size=s.size;l.color=s.color;l.x=(LGlobal.width-l.getWidth())/2;l.y=(LGlobal.height-s.size)/2;l.mask=new LGraphics();s.screenX=l.x;s.screenY=l.y;s.screenWidth=l.getWidth();s.addChild(l);s.showLabel=l;c.shadowOffsetX=2;c.shadowOffsetY=2;c.shadowColor="blue";s.setProgress(s.progress);}LoadingSample2.prototype.setProgress=function(value){var s=this,c=LGlobal.canvas;s.progressLabel.text=value+"%";s.showLabel.mask.clear();s.showLabel.mask.drawRect(0,"#000000",[s.screenX,0,s.screenWidth*value*0.01,LGlobal.height]);if(value>=100){c.shadowOffsetX=0;c.shadowOffsetY=0;}};function LoadingSample3(height,background,color){base(this,LSprite,[]);var s=this,c=LGlobal.canvas;s.backgroundColor=background==null?"#000000":background;s.graphics.drawRect(1,s.backgroundColor,[0,0,LGlobal.width,LGlobal.height],true,s.backgroundColor);if(color==null)color=LGlobal._create_loading_color();s.color=color;s.progress=0;s.screenWidth=LGlobal.width*0.75;s.screenHeight=height==null?LGlobal.height*0.1:height;if(s.screenHeight>5)s.screenHeight=5;s.screenX=(LGlobal.width-s.screenWidth)/2;s.screenY=(LGlobal.height-s.screenHeight)/2;s.back=new LSprite();s.addChild(s.back);s.label=new LTextField();s.label.color="#ffffff";s.label.weight="bolder";s.label.size=s.screenHeight*2;s.label.x=s.screenX+(s.screenWidth-s.label.getWidth())*0.5;s.label.y=s.screenY-s.screenHeight*4;s.addChild(s.label);s.star=new Array();s.addEventListener(LEvent.ENTER_FRAME,s.onframe);s.setProgress(s.progress);}LoadingSample3.prototype.onframe=function(s){var i,star,l;if(s.progress>=100){if(s.star.length>0){for(i=0,l=s.star.length;i<l;i++){s.removeChild(s.star[i]);}s.star.length=0;}return;}for(i=0,l=s.star.length;i<l;i++){star=s.star[i];star.alpha-=0.1;star.x+=star.speedx;star.y+=star.speedy;if(star.alpha<=0){s.star.splice(i,1);s.removeChild(star);i--,l--;}}if(s.star.length<10)s.addStar();};LoadingSample3.prototype.addStar=function(){var s=this,c=LGlobal.canvas;var star=new LSprite();var step=1+Math.floor(Math.random()*4);star.graphics.add(function(){c.beginPath();c.fillStyle="#ffffff";c.lineTo(step*2,step);c.lineTo(step*4,0);c.lineTo(step*3,step*2);c.lineTo(step*4,step*4);c.lineTo(step*2,step*3);c.lineTo(0,step*4);c.lineTo(step,step*2);c.lineTo(0,0);c.fill();});star.x=s.screenX+s.screenWidth*s.progress*0.01;star.y=s.screenY;star.speedx=4-8*Math.random();star.speedy=4-8*Math.random();s.star.push(star);s.addChild(star);};LoadingSample3.prototype.setProgress=function(value){var s=this,c=LGlobal.canvas;if(value>100)value=100;s.progress=value;s.back.graphics.clear();s.back.graphics.add(function(){c.beginPath();c.fillStyle="#00FFFF";c.rect(s.screenX-3,s.screenY-3,s.screenWidth+6,s.screenHeight+6);c.fill();c.beginPath();c.fillStyle="#990033";c.rect(s.screenX,s.screenY,s.screenWidth,s.screenHeight);c.fill();c.beginPath();c.fillStyle=s.color;c.rect(s.screenX,s.screenY,s.screenWidth*value*0.01,s.screenHeight);c.fill();});s.label.text=value+"%";};function LoadingSample4(height,background,color){base(this,LSprite,[]);var s=this,c=LGlobal.canvas;s.backgroundColor=background==null?"#000000":background;s.graphics.drawRect(1,s.backgroundColor,[0,0,LGlobal.width,LGlobal.height],true,s.backgroundColor);if(color==null)color="#FFFFFF";s.arc=new LSprite();s.arc.x=LGlobal.width*0.5;s.arc.y=LGlobal.height*0.5;s.addChild(s.arc);for(var i=0;i<360;i++){s.arc.graphics.drawArc(1+i/36,color,[0,0,50,(2*Math.PI/360)*i,(2*Math.PI/360)*(i+2)]);}s.progress=0;s.label=new LTextField();s.label.color=color;s.label.weight="bolder";s.label.size=18;s.label.x=LGlobal.width*0.5;s.label.y=LGlobal.height*0.5-s.label.getHeight()*0.5;s.addChild(s.label);var shadow=new LDropShadowFilter(0,0,"#FFFFFF",30);s.arc.filters=[shadow];s.addEventListener(LEvent.ENTER_FRAME,s.onframe);s.setProgress(s.progress);}LoadingSample4.prototype.onframe=function(event){event.target.arc.rotate+=20;};LoadingSample4.prototype.setProgress=function(value){var s=this;if(value>100)value=100;s.progress=value;s.label.text=value+"%";s.label.x=LGlobal.width*0.5-s.label.getWidth()*0.5;};function LoadingSample5(height,background,color){base(this,LSprite,[]);var s=this,c=LGlobal.canvas;s.backgroundColor=background==null?"#000000":background;s.graphics.drawRect(1,s.backgroundColor,[0,0,LGlobal.width,LGlobal.height],true,s.backgroundColor);if(color==null)color="#FFFFFF";s.arc=new LSprite();s.arc.x=LGlobal.width*0.5;s.arc.y=LGlobal.height*0.5;s.addChild(s.arc);var r=50;for(var i=0;i<360;i+=30){var child=new LSprite();child.graphics.drawArc(0,color,[r,0,7,0,2*Math.PI],true,color);child.rotate=i;child.alpha=0.1+i/360;s.arc.addChild(child);}s.index=0;s.max=3;s.progress=0;s.label=new LTextField();s.label.color="#FFFFFF";s.label.weight="bolder";s.label.size=18;s.label.x=LGlobal.width*0.5;s.label.y=LGlobal.height*0.5-s.label.getHeight()*0.5;s.addChild(s.label);var shadow=new LDropShadowFilter(0,0,"#FFFFFF",30);s.arc.filters=[shadow];s.addEventListener(LEvent.ENTER_FRAME,s.onframe);s.setProgress(s.progress);}LoadingSample5.prototype.onframe=function(event){var s=event.target;if(s.index++<s.max)return;s.index=0;s.arc.rotate+=30;};LoadingSample5.prototype.setProgress=function(value){var s=this;if(value>100)value=100;s.progress=value;s.label.text=value+"%";s.label.x=LGlobal.width*0.5-s.label.getWidth()*0.5;};function LoadingSample6(r,color,filterColor){var self=this;base(self,LSprite,[]);self.progress=0;self.step=0;self.holeR=r||10;self.holeAmount=5;self.holesx=20;self.loadingBarWidth=self.holeR*2*self.holeAmount+self.holesx*(self.holeAmount-1);self.loadingBarHeight=self.holeR*2;self.progressColor=color||"#2187e7";self.filterColor=filterColor||"#00c6ff";self.backLayer=new LSprite();self.backLayer.graphics.drawRect(0,"",[0,0,LGlobal.width,LGlobal.height],true,"#161616");self.addChild(self.backLayer);self.holeLayer=new LSprite();self.holeLayer.x=(LGlobal.width-self.loadingBarWidth)*0.5;self.holeLayer.y=(LGlobal.height-self.loadingBarHeight)*0.5;self.addChild(self.holeLayer);self.progressLayer=new LSprite();self.progressLayer.x=(LGlobal.width-self.loadingBarWidth)*0.5;self.progressLayer.y=(LGlobal.height-self.loadingBarHeight)*0.5;self.addChild(self.progressLayer);self._addHole();}LoadingSample6.prototype._addHole=function(){var self=this;var amount=self.holeAmount,sx=self.holeR*2+self.holesx,r=self.holeR;for(var i=0; i<amount; i++){var holeObj=new LSprite();holeObj.x=i*sx;holeObj.graphics.drawArc(1,"#111",[0,0,r,0,2*Math.PI],true,"#000");holeObj.graphics.drawArc(1,"#333",[0,0,r,1.7*Math.PI,0.7*Math.PI],false);self.holeLayer.addChild(holeObj);}};LoadingSample6.prototype.setProgress=function(value){var self=this;var sx=self.holeR*2+self.holesx,r=self.holeR;self.progress=value/100;var tweenList=new Array();while(Math.floor(self.progress/0.2)>self.step){var cw=r*2;var ch=cw;var grd=LGlobal.canvas.createLinearGradient(0,-ch*2,0,ch);grd.addColorStop(0,"white");grd.addColorStop(1,self.progressColor);var po=new LSprite();po.x=self.step*sx;po.scaleX=0;po.scaleY=0;po.graphics.drawArc(0,"",[0,0,r,0,2*Math.PI],true,grd);self.progressLayer.addChild(po);tweenList.push(po);self.step++;}var completeFunc=function(o){var circleObj=new LSprite();circleObj.alpha=0.9;circleObj.x=o.x;circleObj.graphics.drawArc(1,self.filterColor,[0,0,r,0,2*Math.PI],false);self.progressLayer.addChild(circleObj);var shadow=new LDropShadowFilter(0,5,self.filterColor,10);circleObj.filters=[shadow];LTweenLite.to(circleObj,0.5,{scaleX:1.7,scaleY:1.7,alpha:0,onComplete:function(s){s.parent.removeChild(s);}});};for(var i=0; i<tweenList.length; i++){var o=tweenList[i];LTweenLite.to(o,1,{scaleX:1,scaleY:1,onComplete:completeFunc});}};function LoadingSample7(w,h,color){var self=this;base(self,LSprite,[]);self.progress=0;self.step=0;self.holeW=w||10;self.holeH=h||30;self.holeAmount=10;self.holesx=8;self.loadingBarWidth=self.holeW*self.holeAmount+self.holesx*(self.holeAmount-1);self.loadingBarHeight=self.holeH;self.progressColor=color||"#2187e7";self.backLayer=new LSprite();self.backLayer.graphics.drawRect(0,"",[0,0,LGlobal.width,LGlobal.height],true,"#161616");self.addChild(self.backLayer);self.holeLayer=new LSprite();self.holeLayer.x=(LGlobal.width-self.loadingBarWidth)*0.5;self.holeLayer.y=(LGlobal.height-self.loadingBarHeight)*0.5;self.addChild(self.holeLayer);self.progressLayer=new LSprite();self.progressLayer.x=(LGlobal.width-self.loadingBarWidth)*0.5;self.progressLayer.y=(LGlobal.height-self.loadingBarHeight)*0.5;self.addChild(self.progressLayer);self._addHole();}LoadingSample7.prototype._addHole=function(){var self=this;var amount=self.holeAmount,sx=self.holeW+self.holesx,w=self.holeW,h=self.holeH;for(var i=0; i<amount; i++){var holeObj=new LSprite();holeObj.x=i*sx;holeObj.graphics.drawRect(1,"#333",[1,1,self.holeW,self.holeH],false);holeObj.graphics.drawRect(1,"#111",[0,0,self.holeW,self.holeH],true,"#000");self.holeLayer.addChild(holeObj);var grd=LGlobal.canvas.createLinearGradient(0,-h,0,h);grd.addColorStop(0,"white");grd.addColorStop(1,self.progressColor);var progressObj=new LSprite();progressObj.alpha=0;progressObj.x=i*sx;progressObj.graphics.drawRect(0,"",[0,0,self.holeW,self.holeH],true,grd);self.progressLayer.addChild(progressObj);}};LoadingSample7.prototype.setProgress=function(value){var self=this;self.progress=value/100;if(Math.floor(self.progress/0.1)>self.step){var n=Math.ceil(self.progress/0.1);if(n>10)n=10;for(var i=0; i<n; i++){var sc=self.progressLayer.childList;if(sc[i].alpha>0)continue;var o=self.progressLayer.childList[i];LTweenLite.to(o,1,{alpha:1});}self.step++;}};var LBox2d=(function(){function LBox2d(gravity,doSleep,drawScale){var s=this;Box2D.Dynamics.b2World.prototype.LAddController=Box2D.Dynamics.b2World.prototype.AddController;Box2D.Dynamics.b2World.prototype.AddController=function(c){var l={},k;for(k in c){l[k]=c[k];}if(LBox2d){LBox2d.m_controllerList=l;}return this.LAddController(c);};var i,j,b=Box2D,d,a=[b.Collision,b.Common,b.Common.Math,b.Dynamics,b.Dynamics.Contacts,b.Dynamics.Controllers,b.Dynamics.Joints,b.Collision.Shapes];for(i in a){for(j in a[i]){s[j]=a[i][j];}}if(typeof drawScale==UNDEFINED){drawScale=30;}s.stop=false;s.drawScale=30;s.selectedBody=null;s.mouseJoint=null;s.mousePVec=null;s.contactListener=null;if(typeof gravity==UNDEFINED){gravity=new s.b2Vec2(0,9.8);}else{gravity=new s.b2Vec2(gravity[0],gravity[1]);}if(typeof doSleep==UNDEFINED){doSleep=true;}s.world=new s.b2World(gravity,doSleep);s.removeList=new Array();if(LGlobal.traceDebug){d=new s.b2DebugDraw();d.SetSprite(LGlobal.canvas);d.SetLineThickness(1);d.SetFillAlpha(0.5);d.SetAlpha(1);d.SetDrawScale(s.drawScale);d.SetFlags(s.b2DebugDraw.e_shapeBit | s.b2DebugDraw.e_jointBit);s.world.SetDebugDraw(d);}LGlobal.destroy=true;}LBox2d.prototype={setEvent:function(t_v,f_v){var s=this;if(t_v==LEvent.ENTER_FRAME){s.ll_enterFrame=f_v;return;}if(!s.contactListener){s.contactListener=new s.b2ContactListener();s.world.SetContactListener(s.contactListener);}switch(t_v){case LEvent.END_CONTACT:s.contactListener.EndContact=f_v;break;case LEvent.PRE_SOLVE:s.contactListener.PreSolve=f_v;break;case LEvent.POST_SOLVE:s.contactListener.PostSolve=f_v;break;case LEvent.BEGIN_CONTACT:default:s.contactListener.BeginContact=f_v;}},setWeldJoint:function(A,B){var s=this;var j=new s.b2WeldJointDef();j.Initialize(B,A,B.GetWorldCenter());return s.world.CreateJoint(j);},setLineJoint:function(A,B,vec,t,m){var s=this;var wa=new s.b2Vec2(vec[0],vec[1]);var j=new s.b2LineJointDef();j.Initialize(A,B,B.GetWorldCenter(),wa);if(t==null){j.enableLimit=false;}else{j.lowerTranslation=t[0];j.upperTranslation=t[1];j.enableLimit=true;}if(m==null){j.enableMotor=false;}else{j.maxMotorForce=m[0];j.motorSpeed=m[1];j.enableMotor=true;}return s.world.CreateJoint(j);},setGearJoint:function(A,B,ra,r,p){var s=this;var j=new s.b2GearJointDef();j.joint1=r;j.joint2=p;j.bodyA=A;j.bodyB=B;j.ratio=ra*s.b2Settings.b2_pi/(300/s.drawScale);return s.world.CreateJoint(j);},setPrismaticJoint:function(A,B,vec,t,m){var s=this;var wa=new s.b2Vec2(vec[0],vec[1]);var j=new s.b2PrismaticJointDef();j.Initialize(B,A,B.GetWorldCenter(),wa);if(t==null){j.enableLimit=false;}else{j.lowerTranslation=t[0];j.upperTranslation=t[1];j.enableLimit=true;}if(m==null){j.enableMotor=false;}else{j.maxMotorForce=m[0];j.motorSpeed=m[1];j.enableMotor=true;}return s.world.CreateJoint(j);},setRevoluteJoint:function(A,B,a,m){var s=this;var j=new s.b2RevoluteJointDef();j.Initialize(A,B,B.GetWorldCenter());if(a==null){j.enableLimit=false;}else{j.lowerAngle=a[0]*s.b2Settings.b2_pi/180;j.upperAngle=a[1]*s.b2Settings.b2_pi/180;j.enableLimit=true;}if(m==null){j.enableMotor=false;}else{j.maxMotorTorque=m[0];j.motorSpeed=m[1];j.enableMotor=true;}return s.world.CreateJoint(j);},setDistanceJoint:function(A,B){var s=this;var j=new s.b2DistanceJointDef();j.Initialize(A,B,A.GetWorldCenter(),B.GetWorldCenter());return s.world.CreateJoint(j);},setPulleyJoint:function(A,B,vA,vB,ratio){var s=this;var a1=A.GetWorldCenter();var a2=B.GetWorldCenter();var g1=new s.b2Vec2(a1.x+(vA[0]/s.drawScale),a1.y+(vA[1]/s.drawScale));var g2=new s.b2Vec2(a2.x+(vB[0]/s.drawScale),a2.y+(vB[1]/s.drawScale));var j=new s.b2PulleyJointDef();j.Initialize(A,B,g1,g2,a1,a2,ratio);j.maxLengthA=vA[2]/s.drawScale;j.maxLengthB=vB[2]/s.drawScale;return s.world.CreateJoint(j);},addCircle:function(r,cx,cy,t,d,f,e){var s=this;s.bodyDef=new s.b2BodyDef;s.bodyDef.type=t;s.fixDef=new s.b2FixtureDef;s.fixDef.density=d;s.fixDef.friction=f;s.fixDef.restitution=e;s.fixDef.shape=new s.b2CircleShape(r);s.bodyDef.position.x=cx;s.bodyDef.position.y=cy;var shape=s.world.CreateBody(s.bodyDef);shape.CreateFixture(s.fixDef);return shape;},addPolygon:function(w,h,cx,cy,type,d,f,e){var s=this;s.bodyDef=new s.b2BodyDef;s.bodyDef.type=type;s.fixDef=new s.b2FixtureDef;s.fixDef.density=d;s.fixDef.friction=f;s.fixDef.restitution=e;s.fixDef.shape=new s.b2PolygonShape;s.fixDef.shape.SetAsBox(w,h);s.bodyDef.position.x=cx;s.bodyDef.position.y=cy;var shape=s.world.CreateBody(s.bodyDef);shape.CreateFixture(s.fixDef);return shape;},addVertices:function(vertices,type,d,f,e){var s=this,i,l;s.bodyDef=new s.b2BodyDef;s.bodyDef.type=type;var shape=s.world.CreateBody(s.bodyDef);for(i=0,l=vertices.length; i<l; i++){s.createShapeAsArray(shape,vertices[i],type,d,f,e);}return shape;},createShapeAsArray:function(c,vertices,type,d,f,e){var s=this;var shape=new s.b2PolygonShape();var sv=s.createVerticesArray(vertices);shape.SetAsArray(sv,0);var def=new s.b2FixtureDef();def.shape=shape;def.density=d;def.friction=f;def.restitution=e;c.CreateFixture(def);},createVerticesArray:function(a){var s=this,i,l;var v=new Array();if(a.length<3){return v;}for(i=0,l=a.length; i<l; i++){v.push(new s.b2Vec2(a[i][0]/s.drawScale,a[i][1]/s.drawScale));}return v;},getBodyAtMouse:function(mouseX,mouseY){var s=this;s.mousePVec=new s.b2Vec2(mouseX,mouseY);var aabb=new s.b2AABB();aabb.lowerBound.Set(mouseX-0.001,mouseY-0.001);aabb.upperBound.Set(mouseX+0.001,mouseY+0.001);s.selectedBody=null;s.world.QueryAABB(s.getBodyCallBack,aabb);return s.selectedBody;},getBodyCallBack:function(fixture){var s=LGlobal.box2d;if(fixture.GetBody().GetType()!=s.b2Body.b2_staticBody){if(fixture.GetShape().TestPoint(fixture.GetBody().GetTransform(),s.mousePVec)){s.selectedBody=fixture.GetBody();return false;}}return true;},ll_show:function(){var s=this,k=null;for(k in s.removeList){s.world.DestroyBody(s.removeList[k]);}s.removeList.splice(0,s.removeList.length);if(s.stop){return;}if(s.ll_enterFrame){s.ll_enterFrame({target:s});}s.world.Step(1/30,10,10);s.world.ClearForces();if(LGlobal.traceDebug){s.world.DrawDebugData();}},synchronous:function(){var s=this;var parent=null,child,position=null,cx=0,cy=0,currentBody,joint;for(currentBody=s.world.GetBodyList(); currentBody; currentBody=currentBody.GetNext()){child=currentBody.GetUserData();if(child){if(position==null){parent=child.parent;cx=currentBody.GetPosition().x;cy=currentBody.GetPosition().y;}currentBody.SetPosition(new s.b2Vec2((child.x+child.rotatex+parent.x)/s.drawScale,(child.y+child.rotatey+parent.y)/s.drawScale));if(position==null){position={x:(currentBody.GetPosition().x-cx),y:(currentBody.GetPosition().y-cy)};}}}for(joint=s.world.GetJointList(); joint; joint=joint.GetNext()){if(joint.m_groundAnchor1){joint.m_groundAnchor1.x+=position.x;joint.m_groundAnchor1.y+=position.y;}if(joint.m_groundAnchor2){joint.m_groundAnchor2.x+=position.x;joint.m_groundAnchor2.y+=position.y;}}if(LBox2d.m_controllerList&&s.world.m_controllerList&&parent){LGlobal.box2d.world.m_controllerList.offset=LBox2d.m_controllerList.offset-parent.y/LGlobal.box2d.drawScale;}}};return LBox2d;})();LSprite.prototype.setBodyMouseJoint=function(value){var s=this;if(!s.box2dBody){return;}s.box2dBody.mouseJoint=value;};LSprite.prototype.clearBody=function(value){var s=this;if(!s.box2dBody){return;}LGlobal.box2d.removeList.push(s.box2dBody);s.box2dBody=null;};LSprite.prototype.addBodyCircle=function(radius,cx,cy,type,density,friction,restitution){var s=this;s.rotatex=radius;s.rotatey=radius;s.box2dBody=LGlobal.box2d.addCircle(radius/LGlobal.box2d.drawScale,(s.x+cx)/LGlobal.box2d.drawScale,(s.y+cy)/LGlobal.box2d.drawScale,(type==1)?LGlobal.box2d.b2Body.b2_dynamicBody:LGlobal.box2d.b2Body.b2_staticBody,density==null?0.5:density,friction==null?0.4:friction,restitution==null?0.8:restitution);s.box2dBody.SetUserData(s);};LSprite.prototype.addBodyPolygon=function(w,h,type,density,friction,restitution){var s=this;s.rotatex=w/2;s.rotatey=h/2;s.box2dBody=LGlobal.box2d.addPolygon(w*0.5/LGlobal.box2d.drawScale,h*0.5/LGlobal.box2d.drawScale,s.x/LGlobal.box2d.drawScale,s.y/LGlobal.box2d.drawScale,(type==1)?LGlobal.box2d.b2Body.b2_dynamicBody:LGlobal.box2d.b2Body.b2_staticBody,density==null?0.5:density,friction==null?0.4:friction,restitution==null?0.8:restitution);s.box2dBody.SetUserData(s);};LSprite.prototype.addBodyVertices=function(vertices,cx,cy,type,density,friction,restitution){var s=this;s.rotatex=0;s.rotatey=0;s.box2dBody=LGlobal.box2d.addVertices(vertices,(type==1)?LGlobal.box2d.b2Body.b2_dynamicBody:LGlobal.box2d.b2Body.b2_staticBody,density,friction,restitution);s.box2dBody.SetUserData(s);s.box2dBody.SetPosition(new LGlobal.box2d.b2Vec2((s.x+cx)/LGlobal.box2d.drawScale,(s.y+cy)/LGlobal.box2d.drawScale));};LGlobal.mouseJoint_start=function(eve){if(!LGlobal.IS_MOUSE_DOWN||!LGlobal.box2d||LGlobal.box2d.mouseJoint||LGlobal.box2d.stop){return;}var mX=eve.offsetX/LGlobal.box2d.drawScale,mY=eve.offsetY/LGlobal.box2d.drawScale,b=LGlobal.box2d.getBodyAtMouse(mX,mY);if(b&&b.mouseJoint){var m=new LGlobal.box2d.b2MouseJointDef();m.bodyA=LGlobal.box2d.world.GetGroundBody();m.bodyB=b;m.target.Set(mX,mY);m.collideConnected=true;m.maxForce=300000.0*b.GetMass();LGlobal.box2d.mouseJoint=LGlobal.box2d.world.CreateJoint(m);b.SetAwake(true);};};LGlobal.mouseJoint_move=function(eve){if(!LGlobal.IS_MOUSE_DOWN||!LGlobal.box2d||!LGlobal.box2d.mouseJoint){return;}mX=eve.offsetX/LGlobal.box2d.drawScale,mY=eve.offsetY/LGlobal.box2d.drawScale;LGlobal.box2d.mouseJoint.SetTarget(new LGlobal.box2d.b2Vec2(mX,mY));};LGlobal.mouseJoint_end=function(){if(LGlobal.box2d!=null&&LGlobal.box2d.mouseJoint){LGlobal.box2d.world.DestroyJoint(LGlobal.box2d.mouseJoint);LGlobal.box2d.mouseJoint=null;}};var LTransition=(function(){function LTransition(displayObject,transObj){this.child=displayObject;this.trans=transObj;}LTransition.prototype={startTransition:function(){var self=this;switch(self.trans.type){case LTransition.Blinds:self.blinds();break;case LTransition.Fade:self.fade();break;case LTransition.Fly:self.fly();break;case LTransition.Iris:self.iris();break;case LTransition.Squeeze:self.squeeze();break;case LTransition.Wipe:self.wipe();break;case LTransition.Zoom:self.zoom();break;case LTransition.PixelDissolve:self.pixelDissolve();break;case LTransition.Curtain:self.curtain();break;default:throw("the type is not exists.");}},blindsComplete:function(self){if(self.trans.direction==LTransition.OUT){self.child.mask.clear();}else{self.blindsUpdateRun();}self.child.mask=null;if(self.trans.onComplete){self.trans.onComplete(self.child);}},blindsUpdateRun:function(){var self=this,g=self.child.mask,c=LGlobal.canvas;g.clear();if(self.trans.dimension){g.add(function(){c.save();for(var i=0; i<self.trans.numStrips; i++){c.rect(i*self.maxSize,0,self.blindsSize,self.child.getHeight());}c.restore();});}else{g.add(function(){c.save();for(var i=0; i<self.trans.numStrips; i++){c.rect(0,0+i*self.maxSize,self.child.getWidth(),self.blindsSize);}c.restore();});}},blindsUpdate:function(self){self.blindsUpdateRun();if(self.trans.onUpdate){self.trans.onUpdate(self.child);}},blinds:function(){var self=this;if(!self.trans.numStrips)self.trans.numStrips=1;self.blindsSize=0;if(self.trans.dimension){self.maxSize=self.child.getWidth()/self.trans.numStrips>>0;}else{self.maxSize=self.child.getHeight()/self.trans.numStrips>>0;}var g=new LGraphics();self.child.mask=g;var toSize=self.maxSize;if(self.trans.direction==LTransition.OUT){self.blindsSize=self.maxSize;toSize=0;}LTweenLite.to(self,self.trans.duration,{blindsSize:toSize,onComplete:self.blindsComplete,onUpdate:self.blindsUpdate,ease:self.trans.easing});},fadeComplete:function(self){self.child.alpha=self.alpha;if(self.trans.onComplete){self.trans.onComplete(self.child);}},fadeUpdate:function(self){self.child.alpha=self.alpha;if(self.trans.onUpdate){self.trans.onUpdate(self.child);}},fade:function(){var self=this;var toAlpha=1;self.alpha=0;if(self.trans.direction==LTransition.OUT){self.alpha=1;toAlpha=0;}self.child.alpha=self.alpha;LTweenLite.to(self,self.trans.duration,{alpha:toAlpha,onComplete:self.fadeComplete,onUpdate:self.fadeUpdate,ease:self.trans.easing});},flyComplete:function(self){self.child.x=self.x;self.child.y=self.y;if(self.trans.onComplete){self.trans.onComplete(self.child);}},flyUpdate:function(self){self.child.x=self.x;self.child.y=self.y;if(self.trans.onUpdate){self.trans.onUpdate(self.child);}},fly:function(){var self=this;var toX=self.child.x;var toY=self.child.y;switch(self.trans.startPoint){case 1:self.x=-self.child.getWidth();self.y=-self.child.getHeight();break;case 2:self.x=(LGlobal.width-self.child.getWidth())*0.5;self.y=-self.child.getHeight();break;case 3:self.x=LGlobal.width;self.y=-self.child.getHeight();break;case 4:self.x=-self.child.getWidth();self.y=(LGlobal.height-self.child.getHeight())*0.5;break;case 6:self.x=LGlobal.width;self.y=(LGlobal.height-self.child.getHeight())*0.5;break;case 7:self.x=-self.child.getWidth();self.y=LGlobal.height;break;case 8:self.x=(LGlobal.width-self.child.getWidth())*0.5;self.y=LGlobal.height;break;case 9:self.x=LGlobal.width;self.y=LGlobal.height;break;case 5:default:self.x=(LGlobal.width-self.child.getWidth())*0.5;self.y=(LGlobal.height-self.child.getHeight())*0.5;}if(self.trans.direction==LTransition.OUT){var toX=self.x;var toY=self.y;self.x=self.child.x;self.y=self.child.y;}else{self.child.x=self.x;self.child.y=self.y;}LTweenLite.to(self,self.trans.duration,{x:toX,y:toY,onComplete:self.flyComplete,onUpdate:self.flyUpdate,ease:self.trans.easing});},irisComplete:function(self){if(self.trans.direction==LTransition.OUT){self.child.mask.clear();}else{self.irisUpdateRun();}self.child.mask=null;if(self.trans.onComplete){self.trans.onComplete(self.child);}},irisUpdateRun:function(){var self=this,g=self.child.mask,c=LGlobal.canvas;g.clear();if(self.trans.shape==LIris.CIRCLE){g.drawArc(0,"#000000",[self.x,self.y,self.r,0,Math.PI*2]);}else{g.drawRect(0,"#000000",[self.x+self.sLeft,self.y+self.sTop,self.width,self.height]);}},irisUpdate:function(self){self.irisUpdateRun();if(self.trans.onUpdate){self.trans.onUpdate(self.child);}},iris:function(){var self=this;self.sLeft=0;self.sTop=0;self.width=0;self.height=0;self.x=0;self.y=0;self.r=0;self.eWidth=self.child.getWidth();self.eHeight=self.child.getHeight();switch(self.trans.startPoint){case 1:self.eR=Math.sqrt(self.eWidth*self.eWidth+self.eHeight*self.eHeight);break;case 2:self.eR=Math.sqrt((self.eWidth*0.5)*(self.eWidth*0.5)+self.eHeight*self.eHeight);self.x=self.child.getWidth()*0.5;break;case 3:self.eR=Math.sqrt(self.eWidth*self.eWidth+self.eHeight*self.eHeight);self.x=self.child.getWidth();break;case 4:self.eR=Math.sqrt(self.eWidth*self.eWidth+(self.eHeight*0.5)*(self.eHeight*0.5));self.y=self.child.getHeight()*0.5;break;case 6:self.eR=Math.sqrt(self.eWidth*self.eWidth+(self.eHeight*0.5)*(self.eHeight*0.5));self.x=self.child.getWidth();self.y=self.child.getHeight()*0.5;break;case 7:self.eR=Math.sqrt(self.eWidth*self.eWidth+self.eHeight*self.eHeight);self.y=self.child.getHeight();break;case 8:self.eR=Math.sqrt((self.eWidth*0.5)*(self.eWidth*0.5)+self.eHeight*self.eHeight);self.x=self.child.getWidth()*0.5;self.y=self.child.getHeight();break;case 9:self.eR=Math.sqrt(self.eWidth*self.eWidth+self.eHeight*self.eHeight);self.x=self.child.getWidth();self.y=self.child.getHeight();break;case 5:default:self.eR=Math.sqrt((self.eWidth*0.5)*(self.eWidth*0.5)+(self.eHeight*0.5)*(self.eHeight*0.5));self.x=self.child.getWidth()*0.5;self.y=self.child.getHeight()*0.5;}self.eLeft=-self.x;self.eTop=-self.y;var g=new LGraphics();self.child.mask=g;var toSize=self.maxSize;if(self.trans.direction==LTransition.OUT){self.sLeft=self.eLeft;self.sTop=self.eTop;self.eLeft=0;self.eTop=0;self.width=self.eWidth;self.height=self.eHeight;self.eWidth=0;self.eHeight=0;self.r=self.eR;self.eR=0;}LTweenLite.to(self,self.trans.duration,{width:self.eWidth,height:self.eHeight,sLeft:self.eLeft,sTop:self.eTop,r:self.eR,onComplete:self.irisComplete,onUpdate:self.irisUpdate,ease:self.trans.easing});},curtainComplete:function(self){if(self.trans.direction==LTransition.OUT){self.child.mask.clear();}else{self.curtainUpdateRun();}self.child.mask=null;if(self.trans.onComplete){self.trans.onComplete(self.child);}},curtainUpdateRun:function(){var self=this,g=self.child.mask,c=LGlobal.canvas;g.clear();if(self.trans.dimension){g.add(function(){c.beginPath();c.save();c.rect(0,0,self.width,self.child.getHeight());c.rect(self.child.getWidth()-self.width,0,self.width,self.child.getHeight());c.restore();});}else{g.add(function(){c.beginPath();c.save();c.rect(0,0,self.child.getWidth(),self.height);c.rect(0,self.child.getHeight()-self.height,self.child.getWidth(),self.height);c.restore();});}},curtainUpdate:function(self){self.curtainUpdateRun();if(self.trans.onUpdate){self.trans.onUpdate(self.child);}},curtain:function(){var self=this;var eW=self.child.getWidth()*0.5;var eH=self.child.getHeight()*0.5;if(self.trans.dimension){eH=0;}else{eW=0;}self.width=0;self.height=0;var g=new LGraphics();self.child.mask=g;var toSize=self.maxSize;if(self.trans.direction==LTransition.OUT){self.width=eW;self.height=eH;eW=0;eH=0;}LTweenLite.to(self,self.trans.duration,{width:eW,height:eH,onComplete:self.curtainComplete,onUpdate:self.curtainUpdate,ease:self.trans.easing});},squeezeComplete:function(self){self.child.scaleX=self.scaleX;self.child.scaleY=self.scaleY;if(self.trans.onComplete){self.trans.onComplete(self.child);}},squeezeUpdate:function(self){self.child.scaleX=self.scaleX;self.child.scaleY=self.scaleY;if(self.trans.onUpdate){self.trans.onUpdate(self.child);}},squeeze:function(){var self=this;var toScaleX=1,toScaleY=1;self.scaleX=0,self.scaleY=0;if(self.trans.dimension){self.scaleX=1;}else{self.scaleY=1;}if(self.trans.direction==LTransition.OUT){toScaleX=self.scaleX,toScaleY=self.scaleY;self.scaleX=1,self.scaleY=1;}self.child.scaleX=self.scaleX;self.child.scaleY=self.scaleY;LTweenLite.to(self,self.trans.duration,{scaleX:toScaleX,scaleY:toScaleY,onComplete:self.squeezeComplete,onUpdate:self.squeezeUpdate,ease:self.trans.easing});},zoomComplete:function(self){self.child.scaleX=self.scaleX;self.child.scaleY=self.scaleY;if(self.trans.onComplete){self.trans.onComplete(self.child);}},zoomUpdate:function(self){self.child.scaleX=self.scaleX;self.child.scaleY=self.scaleY;if(self.trans.onUpdate){self.trans.onUpdate(self.child);}},zoom:function(){var self=this;var toScaleX=1,toScaleY=1;self.scaleX=0,self.scaleY=0;if(self.trans.direction==LTransition.OUT){toScaleX=0,toScaleY=0;self.scaleX=1,self.scaleY=1;}self.child.scaleX=self.scaleX;self.child.scaleY=self.scaleY;LTweenLite.to(self,self.trans.duration,{scaleX:toScaleX,scaleY:toScaleY,onComplete:self.zoomComplete,onUpdate:self.zoomUpdate,ease:self.trans.easing});},wipeComplete:function(self){if(self.trans.direction==LTransition.OUT){self.child.mask.clear();}else{self.wipeUpdateRun();}self.child.mask=null;if(self.trans.onComplete){self.trans.onComplete(self.child);}},wipeUpdateRun:function(){var self=this,g=self.child.mask,c=LGlobal.canvas;g.clear();g.drawVertices(0,"#000000",[[self.leftTopX,self.leftTopY],[self.leftBottomX,self.leftBottomY],[self.rightBottomX,self.rightBottomY],[self.rightTopX,self.rightTopY]]);},wipeUpdate:function(self){self.wipeUpdateRun();if(self.trans.onUpdate){self.trans.onUpdate(self.child);}},wipe:function(){var self=this,w=self.child.getWidth(),h=self.child.getHeight(),ltX=self.leftTopX=0,ltY=self.leftTopY=0,lbX=self.leftBottomX=0,lbY=self.leftBottomY=h,rtX=self.rightTopX=w,rtY=self.rightTopY=0,rbX=self.rightBottomX=w,rbY=self.rightBottomY=h;switch(self.trans.startPoint){case 1:ltX=self.leftTopX=-w;lbX=self.leftBottomX=-w*2;self.rightTopX=0;rtX=w*2;self.rightBottomX=-w;rbX=w;break;case 2:ltY=self.leftTopY=-h;self.leftBottomY=0;lbY=h;rtY=self.rightTopY=-h;self.rightBottomY=0;rbY=h;break;case 3:self.leftTopX=w;ltX=-w;self.leftBottomX=w*2;lbX=0;rtX=self.rightTopX=w*2;rbX=self.rightBottomX=w*3;break;case 4:self.rightTopX=0;rtX=w;self.rightBottomX=0;rbX=w;break;case 6:self.leftTopX=w;ltX=0;self.leftBottomX=w;lbX=0;break;case 7:lbX=self.leftBottomX=-w;ltX=self.leftTopX=-w*2;self.rightBottomX=0;rbX=w*2;self.rightTopX=-w;rtX=w;break;case 8:lbY=self.leftBottomY=h;self.leftTopY=h;ltY=0;rbY=self.rightBottomY=h;self.rightTopY=h;rtY=0;break;case 9:self.leftBottomX=w;lbX=-w;self.leftTopX=w*2;ltX=0;rbX=self.rightBottomX=w*2;rtX=self.rightTopX=w*3;break;case 5:default:self.leftTopX=w*0.5;self.leftTopY=h*0.5;self.rightTopX=w*0.5;self.rightTopY=h*0.5;self.leftBottomX=w*0.5;self.leftBottomY=h*0.5;self.rightBottomX=w*0.5;self.rightBottomY=h*0.5;ltX=0,ltY=0;lbX=0,lbY=h;rtX=w,rtY=0;rbX=w,rbY=h;}var g=new LGraphics();self.child.mask=g;if(self.trans.direction==LTransition.OUT){var oltX=ltX,oltY=ltY,olbX=lbX,olbY=lbY,ortX=rtX,ortY=rtY,orbX=rbX,orbY=rbY;ltX=self.leftTopX,ltY=self.leftTopY,lbX=self.leftBottomX,lbY=self.leftBottomY,rtX=self.rightTopX,rtY=self.rightTopY,rbX=self.rightBottomX,rbY=self.rightBottomY;self.leftTopX=oltX,self.leftTopY=oltY,self.leftBottomX=olbX,self.leftBottomY=olbY,self.rightTopX=ortX,self.rightTopY=ortY,self.rightBottomX=orbX,self.rightBottomY=orbY;}LTweenLite.to(self,self.trans.duration,{leftTopX:ltX,leftTopY:ltY,leftBottomX:lbX,leftBottomY:lbY,rightTopX:rtX,rightTopY:rtY,rightBottomX:rbX,rightBottomY:rbY,onComplete:self.wipeComplete,onUpdate:self.wipeUpdate,ease:self.trans.easing});},pixelDissolveComplete:function(self){if(self.trans.direction==LTransition.OUT){self.child.mask.clear();}else{self.pixelDissolveUpdateRun();}self.child.mask=null;if(self.trans.onComplete){self.trans.onComplete(self.child);}},pixelDissolveUpdateRun:function(){var self=this,g=self.child.mask,c=LGlobal.canvas,list;g.clear();g.add(function(){c.beginPath();c.save();for(var i=0; i<self.index; i++){list=self.list[i];c.rect(list[0]*self.w,list[1]*self.h,self.w,self.h);}c.restore();});},pixelDissolveUpdate:function(self){self.pixelDissolveUpdateRun();if(self.trans.onUpdate){self.trans.onUpdate(self.child);}},pixelDissolve:function(){var self=this;var g=new LGraphics();self.child.mask=g;LGlobal.mg=g;self.w=self.child.getWidth()/self.trans.xSections,self.h=self.child.getHeight()/self.trans.ySections;self.list=[];for(var i=0; i<self.trans.xSections; i++){for(var j=0; j<self.trans.ySections; j++){self.list.push([i,j]);}}self.index=0;var to=self.trans.xSections*self.trans.ySections;if(self.trans.direction==LTransition.OUT){self.index=to;to=0;}self.list=self.list.sort(function(a,b){return Math.random()>0.5;});self.pixelDissolveUpdateRun();LTweenLite.to(self,self.trans.duration,{index:to,onComplete:self.pixelDissolveComplete,onUpdate:self.pixelDissolveUpdate,ease:self.trans.easing});}};LTransition.IN="in";LTransition.OUT="out";LTransition.Blinds=1;LTransition.Fade=2;LTransition.Fly=3;LTransition.Iris=4;LTransition.Curtain=5;LTransition.PixelDissolve=6;LTransition.Squeeze=7;LTransition.Wipe=8;LTransition.Zoom=9;return LTransition;})();var LIris=(function(){function LIris(){}LIris.SQUARE=0;LIris.CIRCLE=1;return LIris;})();var LTransitionManager=(function(){function LTransitionManager(displayObject){this.child=displayObject;}LTransitionManager.prototype={startTransition:function(transParams){return LTransitionManager.start(this.child,transParams);}};LTransitionManager.start=function(displayObject,transParams){var trans=new LTransition(displayObject,transParams);trans.startTransition();return trans;};return LTransitionManager;})();var LFlash=(function(){function LFlash(){}LFlash.SpriteSheetConvert=function(frames){var result=[],child;for(var i=0;i<frames.length;i++){child=frames[i];result.push({x:child.frame.x,sx:child.spriteSourceSize.x,y:child.frame.y,sy:child.spriteSourceSize.y,width:child.frame.w,height:child.frame.h});}return result;};return LFlash;})();var LString={trim:function(s){return s.replace(/(^\s*)|(\s*$)|(\n)/g,"");},leftTrim:function(s){return s.replace(/(^\s*)|(^\n)/g,"");},rightTrim:function(s){return s.replace(/(\s*$)|(\n$)/g,"");},numberFormat:function(s,l){if(!l||l<1){l=3;}s=String(s).split(".");s[0]=s[0].replace(new RegExp('(\\d)(?=(\\d{'+l+'})+$)','ig'),"$1,");return s.join(".");},isString:function(s){var p=/^([a-z]|[A-Z])+$/;return p.exec(s);},isNumber:function(s){var p=/^\d+\.\d+$/;return p.exec(s);},isInt:function(s){var p=/^\d+$/;return p.exec(s);}};LMath=LString;

